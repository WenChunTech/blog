[{"categories":["draft"],"content":"Btrfsæ–‡ä»¶ç³»ç»Ÿä»‹ç» ","date":"2024-01-21","objectID":"/btrfs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/:0:0","tags":["draft"],"title":"Btrfsæ–‡ä»¶ç³»ç»Ÿ","uri":"/btrfs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"},{"categories":["draft"],"content":"1. Btrfsç®€ä»‹ Btrfs æ˜¯ä¸€ç§æ–°å‹çš„å†™æ—¶å¤åˆ¶ï¼ˆCoWï¼‰Linux æ–‡ä»¶ç³»ç»Ÿï¼Œå·²ç»å¹¶å…¥å†…æ ¸ä¸»çº¿ã€‚ä½ å¯ä»¥è¯»ä½œ Better File Systemã€B-tree File Systemã€Butter File System ç­‰ç­‰ï¼Œéƒ½æ˜¯æ­£ç¡®çš„ã€‚Btrfs åœ¨è®¾è®¡å®ç°é«˜çº§åŠŸèƒ½çš„åŒæ—¶ï¼Œç€é‡äºå®¹é”™ã€ä¿®å¤ä»¥åŠæ˜“äºç®¡ç†ã€‚å®ƒç”± Oracleã€Red Hatã€Fujitsuã€Intelã€SUSEã€STRATO ç­‰ä¼ä¸šå’Œå¼€å‘è€…å…±åŒå¼€å‘ã€‚Btrfs ä»¥ GNU GPL åè®®æˆæƒï¼ŒåŒæ—¶ä¹Ÿæ¬¢è¿ä»»ä½•äººçš„è´¡çŒ®ã€‚ ","date":"2024-01-21","objectID":"/btrfs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/:1:0","tags":["draft"],"title":"Btrfsæ–‡ä»¶ç³»ç»Ÿ","uri":"/btrfs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"},{"categories":["draft"],"content":"2. Btrfsçš„ç‰¹æ€§ æ‰©å±•æ€§ç›¸å…³ B-tree Btrfs æ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æœ‰çš„ metadata éƒ½ç”± B-tree ç®¡ç†ã€‚ä½¿ç”¨ B-tree çš„ä¸»è¦å¥½å¤„åœ¨äºæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œéƒ½å¾ˆé«˜æ•ˆã€‚å¯ä»¥è¯´ B-tree æ˜¯ Btrfs çš„æ ¸å¿ƒ åŸºäº Extent çš„æ–‡ä»¶å­˜å‚¨ âœ… é’ˆå¯¹ SSD çš„ä¼˜åŒ–æ”¯æŒ Btrfs çš„ CoW æŠ€æœ¯ä»æ ¹æœ¬ä¸Šé¿å…äº†å¯¹åŒä¸€ä¸ªç‰©ç†å•å…ƒçš„åå¤å†™æ“ä½œã€‚å¦‚æœç”¨æˆ·æ‰“å¼€äº† SSD ä¼˜åŒ–é€‰é¡¹ï¼ŒBtrfs å°†åœ¨åº•å±‚çš„å—ç©ºé—´åˆ†é…ç­–ç•¥ä¸Šè¿›è¡Œä¼˜åŒ–ï¼šå°†å¤šæ¬¡ç£ç›˜ç©ºé—´åˆ†é…è¯·æ±‚èšåˆæˆä¸€ä¸ªå¤§å°ä¸º 2M çš„è¿ç»­çš„å—ã€‚å¤§å—è¿ç»­åœ°å€çš„ IO èƒ½å¤Ÿè®©å›ºåŒ–åœ¨ SSD å†…éƒ¨çš„å¾®ä»£ç æ›´å¥½çš„è¿›è¡Œè¯»å†™ä¼˜åŒ–ï¼Œä»è€Œæé«˜ I/O æ€§èƒ½ åŠ¨æ€ Inode åˆ†é… æ”¯æŒéå¸¸å¤§çš„å•ä¸ªæ–‡ä»¶å¤§å° æ•°æ®ä¸€è‡´æ€§ç›¸å…³ âœ… å†™æ—¶å¤åˆ¶ï¼ˆCoWï¼‰ æ¯”å°±åœ°ä¿®æ”¹çš„æ–‡ä»¶ç³»ç»Ÿæœ‰æ›´å¤§çš„å¥½å¤„ï¼Œè¯¦ç»†çš„è¯´æ˜è§ä¸‹æ–‡ æ ¡éªŒå’Œï¼ˆChecksumï¼‰ ä¿è¯äº†æ•°æ®çš„å¯é æ€§ï¼šç”±äºç¡¬ä»¶åŸå› ï¼Œä»ç£ç›˜ä¸Šè¯»å‡ºçš„æ•°æ®ä¼šå‡ºé”™ã€‚æ¯”å¦‚ block A ä¸­å­˜æ”¾çš„æ•°æ®ä¸º 0x55ï¼Œä½†è¯»å–å‡ºæ¥çš„æ•°æ®å˜æˆäº† 0x54ï¼Œå› ä¸ºè¯»å–æ“ä½œå¹¶æœªæŠ¥é”™ï¼Œæ‰€ä»¥è¿™ç§é”™è¯¯ä¸èƒ½è¢«ä¸Šå±‚è½¯ä»¶æ‰€å¯Ÿè§‰ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯ä¿å­˜æ•°æ®çš„æ ¡éªŒå’Œï¼Œåœ¨è¯»å–æ•°æ®åæ£€æŸ¥æ ¡éªŒå’Œã€‚å¦‚æœä¸ç¬¦åˆï¼Œä¾¿çŸ¥é“æ•°æ®å‡ºç°äº†é”™è¯¯ã€‚å¦‚æœæœ€ç»ˆä»ç£ç›˜è¯»å–å‡ºæ¥çš„æ•°æ®å’Œ checksum ä¸ç›¸åŒï¼ŒBtrfs ä¼šé¦–å…ˆå°è¯•è¯»å–æ•°æ®çš„é•œåƒå¤‡ä»½ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰é•œåƒå¤‡ä»½ï¼ŒBtrfs å°†è¿”å›é”™è¯¯ã€‚å†™å…¥ç£ç›˜æ•°æ®ä¹‹å‰ï¼ŒBtrfs è®¡ç®—æ•°æ®çš„ checksumã€‚ç„¶åå°† checksum å’Œæ•°æ®åŒæ—¶å†™å…¥ç£ç›˜ã€‚ å¤šè®¾å¤‡ç®¡ç†ç›¸å…³ âœ… å¤šè®¾å¤‡ç®¡ç† Btrfs æ”¯æŒåŠ¨æ€æ·»åŠ è®¾å¤‡ã€‚ç”¨æˆ·åœ¨ç³»ç»Ÿä¸­å¢åŠ æ–°çš„ç£ç›˜ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ btrfs çš„ç›¸å…³å‘½ä»¤å°†è¯¥è®¾å¤‡æ·»åŠ åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ âœ… å­å·ï¼ˆSubvolumeï¼‰ æŠŠæ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†é…ç½®ä¸ºä¸€ä¸ªå®Œæ•´çš„å­æ–‡ä»¶ç³»ç»Ÿ âœ… å¿«ç…§ï¼ˆSnapshotï¼‰å’Œå…‹éš†ï¼ˆCloneï¼‰ æ”¯æŒå¿«ç…§ æ”¯æŒå¿«ç…§çš„å¿«ç…§ï¼ˆå¢é‡å¤‡ä»½ï¼‰ å¯ä»¥å¯¹å•ä¸ªæ–‡ä»¶è¿›è¡Œå¤‡ä»½ âœ… å†…ç½®æ”¯æŒ RAIDï¼Œæ”¯æŒæ¡å¸¦æˆ– mirror ç­‰å¸¸è§çš„ RAID åŠŸèƒ½ âœ… æ”¯æŒçƒ­ç§»é™¤ã€çƒ­æ·»åŠ è®¾å¤‡ å…¶ä»–ç‰¹æ€§ âœ… é€æ˜å‹ç¼© å‡å°äº†æ–‡ä»¶çš„å¤§å°ï¼Œé€šè¿‡å‡å°‘æ–‡ä»¶å†™å…¥å¢å¹…æ¥æ˜¾è‘—å»¶é•¿é—ªå­˜ä»‹è´¨çš„å¯¿å‘½ã€‚åœ¨æŸäº›ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚å•çº¿ç¨‹ã€é‡è´Ÿè·çš„æ–‡ä»¶ I/Oï¼‰è¿˜æé«˜äº†æ€§èƒ½ å»¶è¿Ÿåˆ†é…ï¼ˆDelay allocationï¼‰ åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå°å—ç©ºé—´é¢‘ç¹çš„åˆ†é…å’Œé‡Šæ”¾ä¼šé€ æˆç¢ç‰‡ã€‚å»¶è¿Ÿåˆ†é…åˆ™æ˜¯è¿™æ ·ä¸€ç§æŠ€æœ¯ â€”â€” å½“ç”¨æˆ·éœ€è¦ç£ç›˜ç©ºé—´æ—¶ï¼Œå…ˆå°†æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚å°†ç£ç›˜åˆ†é…éœ€æ±‚å‘é€ç»™ç£ç›˜ç©ºé—´åˆ†é…å™¨ï¼Œç£ç›˜ç©ºé—´åˆ†é…å™¨å¹¶ä¸ç«‹å³åˆ†é…çœŸæ­£çš„ç£ç›˜ç©ºé—´ã€‚åªæ˜¯è®°å½•ä¸‹è¿™ä¸ªè¯·æ±‚ä¾¿è¿”å›ã€‚ç£ç›˜ç©ºé—´åˆ†é…è¯·æ±‚å¯èƒ½å¾ˆé¢‘ç¹ï¼Œæ‰€ä»¥åœ¨å»¶è¿Ÿåˆ†é…çš„ä¸€æ®µæ—¶é—´å†…ï¼Œç£ç›˜åˆ†é…å™¨å¯ä»¥æ”¶åˆ°å¾ˆå¤šçš„åˆ†é…è¯·æ±‚ â€”â€” ä¸€äº›è¯·æ±‚ä¹Ÿè®¸å¯ä»¥åˆå¹¶ï¼Œä¸€äº›è¯·æ±‚åœ¨è¿™æ®µå»¶è¿ŸæœŸé—´ç”šè‡³å¯èƒ½è¢«å–æ¶ˆã€‚é€šè¿‡è¿™æ ·çš„â€œç­‰å¾…â€ï¼Œå¾€å¾€èƒ½å¤Ÿå‡å°‘ä¸å¿…è¦çš„åˆ†é…ï¼Œä¹Ÿæœ‰å¯èƒ½å°†å¤šä¸ªå°çš„åˆ†é…è¯·æ±‚åˆå¹¶ä¸ºä¸€ä¸ªå¤§çš„è¯·æ±‚ï¼Œä»è€Œæé«˜ I/O æ•ˆç‡ Inline File ç³»ç»Ÿä¸­å¾€å¾€å­˜åœ¨å¤§é‡çš„å°æ–‡ä»¶ï¼ˆå‡ ç™¾ä¸ªå­—èŠ‚æˆ–è€…æ›´å°ï¼‰ã€‚å¦‚æœä¸ºå…¶åˆ†é…å•ç‹¬çš„æ•°æ® blockï¼Œä¾¿ä¼šå¼•èµ·å†…éƒ¨ç¢ç‰‡ï¼Œæµªè´¹ç£ç›˜ç©ºé—´ã€‚Btrfs å°†å°æ–‡ä»¶çš„å†…å®¹ä¿å­˜åœ¨å…ƒæ•°æ®ä¸­ï¼Œä¸å†é¢å¤–åˆ†é…å­˜æ”¾æ–‡ä»¶æ•°æ®çš„ç£ç›˜å—ã€‚æ”¹å–„äº†å†…éƒ¨ç¢ç‰‡é—®é¢˜ï¼Œä¹Ÿå¢åŠ äº†æ–‡ä»¶çš„è®¿é—®æ•ˆç‡ã€‚å¾—ç›Šäº Inline File æŠ€æœ¯ï¼ŒBtrfs å¤„ç†å°æ–‡ä»¶çš„æ•ˆç‡éå¸¸é«˜ï¼Œä¹Ÿé¿å…äº†ç£ç›˜ç¢ç‰‡é—®é¢˜ ç›®å½•ç´¢å¼•ï¼ˆDirectory Indexï¼‰ å½“ä¸€ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶æ•°ç›®å·¨å¤§æ—¶ï¼Œç›®å½•ç´¢å¼•å¯ä»¥æ˜¾è‘—æé«˜æ–‡ä»¶æœç´¢æ—¶é—´ã€‚ Btrfs æœ¬èº«é‡‡ç”¨ B-tree å­˜å‚¨ç›®å½•é¡¹ï¼Œæ‰€ä»¥åœ¨ç»™å®šç›®å½•ä¸‹æœç´¢æ–‡ä»¶çš„æ•ˆç‡æ˜¯éå¸¸é«˜çš„ã€‚ç„¶è€Œï¼ŒBtrfs ä½¿ç”¨ B-tree ç®¡ç†ç›®å½•é¡¹çš„æ–¹å¼æ— æ³•åŒæ—¶æ»¡è¶³ readdir çš„éœ€æ±‚ã€‚readdir æ˜¯ POSIX æ ‡å‡† APIï¼Œå®ƒè¦æ±‚è¿”å›æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼›å¹¶ä¸”ç‰¹åˆ«çš„ï¼Œè¿™äº›æ–‡ä»¶è¦æŒ‰ç…§ inode number æ’åºã€‚è€Œ Btrfs ç›®å½•é¡¹æ’å…¥ B-tree æ—¶çš„ Key å¹¶ä¸æ˜¯ inode numberï¼Œè€Œæ˜¯æ ¹æ®æ–‡ä»¶åè®¡ç®—çš„ä¸€ä¸ª hash å€¼ã€‚è¿™ç§æ–¹å¼åœ¨æŸ¥æ‰¾ä¸€ä¸ªç‰¹å®šæ–‡ä»¶æ—¶éå¸¸é«˜æ•ˆï¼Œä½†å´ä¸é€‚äº readdir ã€‚ä¸ºæ­¤ï¼ŒBtrfs åœ¨æ¯æ¬¡åˆ›å»ºæ–°çš„æ–‡ä»¶æ—¶ï¼Œé™¤äº†æ’å…¥ä»¥ hash å€¼ä¸º Key çš„ç›®å½•é¡¹å¤–ï¼Œè¿˜åŒæ—¶æ’å…¥å¦å¤–ä¸€ç§ç›®å½•é¡¹ç´¢å¼•ï¼Œè¯¥ç›®å½•é¡¹ç´¢å¼•çš„ Key ä»¥ sequence number ä½œä¸º B-tree çš„é”®å€¼ã€‚è¿™ä¸ª sequence number åœ¨æ¯æ¬¡åˆ›å»ºæ–°æ–‡ä»¶æ—¶çº¿æ€§å¢åŠ ã€‚å› ä¸º Inode number ä¹Ÿæ˜¯æ¯æ¬¡åˆ›å»ºæ–°æ–‡ä»¶æ—¶å¢åŠ çš„ï¼Œæ‰€ä»¥ sequence number å’Œ inode number çš„é¡ºåºç›¸åŒã€‚ä»¥è¿™ç§ sequence number ä½œä¸º Key åœ¨ B-tree ä¸­æŸ¥æ‰¾ä¾¿å¯ä»¥æ–¹ä¾¿çš„å¾—åˆ°ä¸€ä¸ªä»¥ inode number æ’åºçš„æ–‡ä»¶åˆ—è¡¨ å¦å¤–ä»¥ sequence number æ’åºçš„æ–‡ä»¶å¾€å¾€åœ¨ç£ç›˜ä¸Šçš„ä½ç½®ä¹Ÿæ˜¯ç›¸é‚»çš„ï¼Œæ‰€ä»¥ä»¥ sequence number ä¸ºåºè®¿é—®å¤§é‡æ–‡ä»¶ä¼šè·å¾—æ›´å¥½çš„ I/O æ•ˆç‡ é¢„åˆ†é… å¾ˆå¤šåº”ç”¨ç¨‹åºæœ‰é¢„å…ˆåˆ†é…ç£ç›˜ç©ºé—´çš„éœ€è¦ã€‚ä»–ä»¬å¯ä»¥é€šè¿‡ posix_fallocate æ¥å£å‘Šè¯‰æ–‡ä»¶ç³»ç»Ÿåœ¨ç£ç›˜ä¸Šé¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´ï¼Œä½†æš‚æ—¶å¹¶ä¸å†™å…¥æ•°æ®ã€‚å¦‚æœåº•å±‚æ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒ fallocateï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºåªæœ‰ä½¿ç”¨ write é¢„å…ˆå†™ä¸€äº›æ— ç”¨ä¿¡æ¯ä»¥ä¾¿ä¸ºè‡ªå·±é¢„ç•™è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ã€‚ç”±æ–‡ä»¶ç³»ç»Ÿæ¥æ”¯æŒé¢„ç•™ç©ºé—´æ›´åŠ æœ‰æ•ˆï¼Œè€Œä¸”èƒ½å¤Ÿå‡å°‘ç£ç›˜ç¢ç‰‡ï¼Œå› ä¸ºæ‰€æœ‰çš„ç©ºé—´éƒ½æ˜¯ä¸€æ¬¡åˆ†é…ï¼Œå› è€Œæ›´æœ‰å¯èƒ½ä½¿ç”¨è¿ç»­çš„ç©ºé—´ã€‚ Btrfs æ”¯æŒ posix_fallocate ","date":"2024-01-21","objectID":"/btrfs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/:2:0","tags":["draft"],"title":"Btrfsæ–‡ä»¶ç³»ç»Ÿ","uri":"/btrfs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"},{"categories":["draft"],"content":"Btrfs ä¸å…¶å®ƒæ–‡ä»¶ç³»ç»ŸåŠŸèƒ½æ¯”è¾ƒ# Feature Ext 2 / 3 Ext 4 ReiserFS XFS OCFS2 Btrfs Journal (date / metadata) âš« / âš« âš« / âš« âšª / âš« âšª / âš« âšª / âš« N/A Journal (internal / external) âš« / âš« âš« / âš« âš« / âš« âš« / âš« âš« / âšª N/A Offline extend / shrink âš« / âš« âš« / âš« âš« / âš« âšª / âšª âš« / âšª âš« / âš« Online extend / shrink âš« / âšª âš« / âšª âš« / âšª âš« / âšª âš« / âšª âš« / âš« Inode allocation map table table B*-tree B+-tree table B-tree Sparse files âš« âš« âš« âš« âš« âš« Tail packing âšª âš« âš« âšª âšª âš« Defragmentation âšª âš« âšª âš« âšª âš« ExtArributes / ACLs âš« / âš« âš« / âš« âš« / âš« âš« / âš« âš« / âš« âš« / âš« Quotas âš« âš« âš« âš« âš« ğŸ”´ Dump / restore âš« âš« âšª âš« âšª âšª Default block size 4 KiB 4 KiB 4 KiB 4 KiB 4 KiB 4 KiB max. file system size 16 TiB 1 EiB 16 TiB 8 EiB 4 PiB 16 EiB max. file size 2 TiB 1 EiB 1 EiB 8 EiB 4 PiB 16 EiB Support status SLES SLES SLES SLES SLE HA SLES ","date":"2024-01-21","objectID":"/btrfs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/:2:1","tags":["draft"],"title":"Btrfsæ–‡ä»¶ç³»ç»Ÿ","uri":"/btrfs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"},{"categories":["draft"],"content":"3. Barfsçš„ç®€å•ä½¿ç”¨ 3.1 åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ mkfs.btrfs -f /dev/sda1 3.2 æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ mount /dev/sda1 /mnt 3.3 åˆ›å»ºå­å· btrfs subvolume create subvolume_name 3.4 åˆ é™¤å­å· btrfs subvolume delete subvolume_name # or rm -rf subvolume_name 3.5 åˆ›å»ºå¿«ç…§ btrfs subvolume snapshot source destination 3.6 åˆ é™¤å¿«ç…§ btrfs subvolume delete snapshot_name 3.7 æŸ¥çœ‹å¿«ç…§ btrfs subvolume list /mnt 3.8 æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ btrfs filesystem show /mnt 3.9 æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨æƒ…å†µ btrfs filesystem df /mnt 3.10 æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿçš„å‹ç¼©æƒ…å†µ btrfs filesystem df -c /mnt 3.11 æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿçš„å‹ç¼©ç®—æ³• btrfs filesystem df -c /mnt 3.12 æŸ¥çœ‹å­å·ä¿¡æ¯ btrfs subvolume show /mnt ","date":"2024-01-21","objectID":"/btrfs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/:3:0","tags":["draft"],"title":"Btrfsæ–‡ä»¶ç³»ç»Ÿ","uri":"/btrfs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"},{"categories":["linux"],"content":"VPN åŸç†æµ…è°ˆ ","date":"2023-11-05","objectID":"/vpn%E5%8E%9F%E7%90%86%E6%B5%85%E8%B0%88/:0:0","tags":["vpn","tun","linux"],"title":"VPNåŸç†æµ…è°ˆ","uri":"/vpn%E5%8E%9F%E7%90%86%E6%B5%85%E8%B0%88/"},{"categories":["linux"],"content":"VPN çš„åº”ç”¨åœºæ™¯ ä¿æŠ¤éšç§ï¼š VPN é€šè¿‡åŠ å¯†é€šä¿¡ï¼Œç¡®ä¿ä½ çš„äº’è”ç½‘è¿æ¥æ˜¯å®‰å…¨çš„ã€‚è¿™å¯¹äºåœ¨å…¬å…± Wi-Fi ç½‘ç»œä¸Šæµè§ˆäº’è”ç½‘æ—¶å°¤å…¶é‡è¦ï¼Œå› ä¸ºå…¬å…±ç½‘ç»œé€šå¸¸æ›´å®¹æ˜“å—åˆ°é»‘å®¢æ”»å‡»ã€‚ ç»•è¿‡åœ°ç†é™åˆ¶ï¼š æœ‰äº›ç½‘ç«™æˆ–æœåŠ¡åœ¨ç‰¹å®šåœ°åŒºå¯èƒ½ä¸å¯ç”¨ï¼Œæˆ–è€…å†…å®¹å—åˆ°åœ°ç†é™åˆ¶ã€‚ä½¿ç”¨ VPN å¯ä»¥æ”¹å˜ä½ çš„ IP åœ°å€ï¼Œä½¿ä½ èƒ½å¤Ÿç»•è¿‡è¿™äº›åœ°ç†é™åˆ¶ï¼Œè®¿é—®å—é™åˆ¶çš„å†…å®¹ã€‚ ä¿æŠ¤å…¬å¸å†…éƒ¨ç½‘ç»œï¼š å…¬å¸å¯ä»¥ä½¿ç”¨ VPN æ¥å»ºç«‹å®‰å…¨çš„è¿œç¨‹è®¿é—®é€šé“ï¼Œå‘˜å·¥å¯ä»¥é€šè¿‡ VPN è¿æ¥åˆ°å…¬å¸å†…éƒ¨ç½‘ç»œï¼Œä»¥ä¾¿åœ¨è¿œç¨‹åœ°ç‚¹å®‰å…¨åœ°è®¿é—®å…¬å¸èµ„æºã€‚ åŒ¿åä¸Šç½‘ï¼š VPN å¯ä»¥éšè—ä½ çš„çœŸå® IP åœ°å€ï¼Œæé«˜ä¸Šç½‘çš„åŒ¿åæ€§ã€‚è¿™å¯¹äºé‚£äº›å¸Œæœ›åœ¨äº’è”ç½‘ä¸Šä¿æŒç›¸å¯¹åŒ¿åçš„ç”¨æˆ·æ¥è¯´å¾ˆæœ‰ç”¨ã€‚ ç»•è¿‡å®¡æŸ¥ï¼š åœ¨ä¸€äº›å›½å®¶ï¼Œäº’è”ç½‘å®¡æŸ¥å¯èƒ½ä¼šé™åˆ¶å¯¹ç‰¹å®šç½‘ç«™æˆ–æœåŠ¡çš„è®¿é—®ã€‚ä½¿ç”¨ VPN å¯ä»¥ç»•è¿‡è¿™äº›å®¡æŸ¥ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿè‡ªç”±åœ°è®¿é—®äº’è”ç½‘ã€‚ å®‰å…¨è¿œç¨‹åŠå…¬ï¼š å¯¹äºè¿œç¨‹å·¥ä½œè€…æˆ–åˆ†å¸ƒå¼å›¢é˜Ÿæ¥è¯´ï¼ŒVPN æä¾›äº†ä¸€ä¸ªå®‰å…¨çš„é€šä¿¡æ¸ é“ï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿè¿œç¨‹è¿æ¥åˆ°å…¬å¸ç½‘ç»œå¹¶è®¿é—®å¿…è¦çš„èµ„æºã€‚ é˜²æ­¢æ•°æ®è¢«çªƒå–ï¼š åœ¨ä½¿ç”¨ä¸å®‰å…¨çš„ç½‘ç»œæ—¶ï¼ŒVPN å¯ä»¥åŠ å¯†ä½ çš„æ•°æ®æµï¼Œé˜²æ­¢æ•æ„Ÿä¿¡æ¯è¢«çªƒå–ï¼Œç¡®ä¿é€šä¿¡çš„æœºå¯†æ€§ã€‚ æ¸¸æˆåŠ é€Ÿï¼š ä¸€äº›ç©å®¶å¯èƒ½ä½¿ç”¨ VPN æ¥è¿æ¥åˆ°ç‰¹å®šåœ°åŒºçš„æ¸¸æˆæœåŠ¡å™¨ï¼Œä»¥è·å¾—æ›´å¥½çš„æ¸¸æˆæ€§èƒ½æˆ–è®¿é—®ç‰¹å®šåœ°åŒºçš„æ¸¸æˆå†…å®¹ã€‚ ","date":"2023-11-05","objectID":"/vpn%E5%8E%9F%E7%90%86%E6%B5%85%E8%B0%88/:1:0","tags":["vpn","tun","linux"],"title":"VPNåŸç†æµ…è°ˆ","uri":"/vpn%E5%8E%9F%E7%90%86%E6%B5%85%E8%B0%88/"},{"categories":["linux"],"content":"VPN çš„å·¥ä½œåŸç† æ¶‰åŠåˆ°çš„åº•å±‚æŠ€æœ¯ tun/tap: ç”¨äºåˆ›å»ºè™šæ‹Ÿç½‘å¡ï¼Œç”¨äºæ¥æ”¶å’Œå‘é€æ•°æ®åŒ…, ä¸»è¦çš„æ“ä½œå°±æ˜¯åœ¨æ­¤å®ç°çš„ iptablesï¼š ç”¨äºå®ç°æ•°æ®åŒ…çš„è½¬å‘ iproute2ï¼š ç”¨äºå®ç°è·¯ç”±è¡¨çš„ç®¡ç† tun/tap æ¦‚è¿°ï¼š tun è®¾å¤‡: TUNè®¾å¤‡æ˜¯ä¸€ç§è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œç”¨äºåœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´ä¼ é€’ç½‘ç»œæ•°æ®ã€‚TUNä»£è¡¨â€œç½‘ç»œéš§é“â€ï¼ˆNetwork TUNnelï¼‰ï¼Œå®ƒå…è®¸ç”¨æˆ·ç©ºé—´çš„ç¨‹åºé€šè¿‡æ ‡å‡†çš„ç½‘ç»œå¥—æ¥å­—æ¥å£å‘é€å’Œæ¥æ”¶IPæ•°æ®åŒ…ï¼ŒåŒæ—¶å†…æ ¸ä¼šå¤„ç†ç½‘ç»œåè®®çš„éƒ¨åˆ†ã€‚TUNè®¾å¤‡é€šå¸¸ç”¨äºåˆ›å»ºè™šæ‹Ÿç§æœ‰ç½‘ç»œï¼ˆVPNï¼‰å’Œå…¶ä»–ç½‘ç»œéš§é“ï¼Œä»¥åœ¨ç”¨æˆ·ç©ºé—´ä¸­è¿è¡Œçš„ç¨‹åºä¸å†…æ ¸ä¹‹é—´ä¼ é€’ç½‘ç»œæµé‡ã€‚è¿™å¯¹äºå®ç°ç½‘ç»œéš”ç¦»ã€è™šæ‹Ÿä¸“ç”¨ç½‘ç»œã€å®‰å…¨éš§é“ç­‰åº”ç”¨åœºæ™¯éå¸¸æœ‰ç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨TUNè®¾å¤‡çš„æµç¨‹å¦‚ä¸‹ï¼š ç”¨æˆ·ç©ºé—´ç¨‹åºé€šè¿‡TUNè®¾å¤‡å‘é€IPæ•°æ®åŒ…ã€‚ å†…æ ¸å°†æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ä»TUNè®¾å¤‡ä¸­è¯»å–ã€‚ ç”¨æˆ·ç©ºé—´ç¨‹åºå¯ä»¥é€šè¿‡æ ‡å‡†çš„å¥—æ¥å­—æ¥å£ç›‘å¬å’Œå¤„ç†è¿™äº›æ•°æ®åŒ…ã€‚ tap è®¾å¤‡ï¼šTAPè®¾å¤‡ï¼ˆTapè™šæ‹Ÿç½‘å¡ï¼‰æ˜¯ä¸€ç§è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œä¸TUNè®¾å¤‡ç±»ä¼¼ï¼Œä¹Ÿç”¨äºåœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´ä¼ é€’ç½‘ç»œæ•°æ®ã€‚TAPä»£è¡¨â€œç½‘ç»œé€æ˜é€‚é…å™¨â€ï¼ˆNetwork TAPï¼‰ï¼Œä¸TUNè®¾å¤‡ä¸åŒçš„æ˜¯ï¼ŒTAPè®¾å¤‡åœ¨æ•°æ®é“¾è·¯å±‚ï¼ˆOSIæ¨¡å‹çš„ç¬¬äºŒå±‚ï¼‰å·¥ä½œï¼Œè€ŒTUNè®¾å¤‡åœ¨ç½‘ç»œå±‚ï¼ˆç¬¬ä¸‰å±‚ï¼‰å·¥ä½œã€‚ä¸»è¦åŒºåˆ«åœ¨äºï¼š TAPè®¾å¤‡ï¼šå®ƒä»¥å¤ªç½‘è®¾å¤‡çš„å½¢å¼å­˜åœ¨ï¼Œå¯ä»¥å¤„ç†é“¾è·¯å±‚çš„æ•°æ®åŒ…ã€‚å› æ­¤ï¼ŒTAPè®¾å¤‡å¯ä»¥ä¼ è¾“ä»¥å¤ªç½‘å¸§ï¼ŒåŒ…æ‹¬å¤„ç†MACåœ°å€ç­‰ã€‚TAPè®¾å¤‡é€šå¸¸ç”¨äºéœ€è¦åœ¨äºŒå±‚è¿›è¡Œæ“ä½œçš„åœºæ™¯ï¼Œæ¯”å¦‚è™šæ‹Ÿå±€åŸŸç½‘ï¼ˆVLANï¼‰çš„å®ç°ã€æ¡¥æ¥ç½‘ç»œã€ä»¥å¤ªç½‘éš§é“ç­‰ã€‚ TUNè®¾å¤‡ï¼šä¸TAPä¸åŒï¼ŒTUNè®¾å¤‡æ˜¯åœ¨ç½‘ç»œå±‚å·¥ä½œçš„ï¼Œåªèƒ½ä¼ è¾“IPæ•°æ®åŒ…ã€‚TUNè®¾å¤‡é€šå¸¸ç”¨äºå®ç°è™šæ‹Ÿç§æœ‰ç½‘ç»œï¼ˆVPNï¼‰ç­‰åº”ç”¨ï¼Œå®ƒåªå…³å¿ƒIPå±‚çš„æ•°æ®ï¼Œè€Œä¸æ¶‰åŠé“¾è·¯å±‚çš„ç»†èŠ‚ã€‚ åœ¨ä½¿ç”¨TAPè®¾å¤‡æ—¶ï¼Œç”¨æˆ·ç©ºé—´ç¨‹åºå¯ä»¥åƒå¤„ç†çœŸå®çš„ç½‘ç»œæ¥å£ä¸€æ ·å¤„ç†TAPè®¾å¤‡ï¼ŒåŒ…æ‹¬å‘é€å’Œæ¥æ”¶ä»¥å¤ªç½‘å¸§ã€‚ iptables ç®€å•ä½¿ç”¨: # è®¾ç½®ä»eth0å‡ºå»çš„æ•°æ®åŒ…,åŠ¨æ€å°†å†…éƒ¨åœ°å€è½¬ä¸ºå¤–éƒ¨å¯è®¿é—®åœ°å€ iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE # è®¾ç½®ä»tun0å‡ºå»çš„æ•°æ®åŒ…,åŠ¨æ€å°†å†…éƒ¨åœ°å€è½¬ä¸ºå¤–éƒ¨å¯è®¿é—®åœ°å€ iptables -t nat -A POSTROUTING -o tun0 -j MASQUERADE # è®¾ç½®ä»eth0è¿›æ¥ï¼ŒçŠ¶æ€ä¸ºRELATED,ESTABLISHED çš„æ•°æ®åŒ…ï¼Œå…è®¸è¿›å…¥ iptables -A INPUT -i eth0 -m state --state RELATED,ESTABLISHED -j ACCEPT # è®¾ç½®ä»tun0è¿›æ¥ï¼ŒçŠ¶æ€ä¸ºRELATED,ESTABLISHED çš„æ•°æ®åŒ…ï¼Œå…è®¸è¿›å…¥ iptables -A INPUT -i tun0 -m state --state RELATED,ESTABLISHED -j ACCEPT # å…è®¸æ‰€ä»¥æ•°æ®åŒ…è½¬å‘ iptables -A FORWARD -j ACCEPT iproute2 ç®€å•ä½¿ç”¨ # è®¾ç½®tun0è®¾å¤‡çš„ipä¸º192.168.1.10/24 ip addr add 192.168.1.10/24 dev tun0 # æ·»åŠ èµ°åˆ°tun0è®¾å¤‡çš„è·¯ç”± ip route add 192.168 # ä¸ºtable 100æ·»åŠ ä¸€æ¡æ¥è‡ª 192.168.1.10çš„è§„åˆ™ ip rule add from 192.168.1.10 table 100 ","date":"2023-11-05","objectID":"/vpn%E5%8E%9F%E7%90%86%E6%B5%85%E8%B0%88/:2:0","tags":["vpn","tun","linux"],"title":"VPNåŸç†æµ…è°ˆ","uri":"/vpn%E5%8E%9F%E7%90%86%E6%B5%85%E8%B0%88/"},{"categories":["linux"],"content":"VPN çš„ç®€å•å®ç°","date":"2023-11-05","objectID":"/vpn%E5%8E%9F%E7%90%86%E6%B5%85%E8%B0%88/:3:0","tags":["vpn","tun","linux"],"title":"VPNåŸç†æµ…è°ˆ","uri":"/vpn%E5%8E%9F%E7%90%86%E6%B5%85%E8%B0%88/"},{"categories":["linux"],"content":"æ€§èƒ½ Profiling â€“ ä½¿ç”¨ Perf å‘½ä»¤ ","date":"2023-10-22","objectID":"/perf%E6%80%A7%E8%83%BDprofiling/:0:0","tags":["perf","linux"],"title":"Perfæ€§èƒ½Profiling","uri":"/perf%E6%80%A7%E8%83%BDprofiling/"},{"categories":["linux"],"content":"1. Perf å¸¸ç”¨å‘½ä»¤ perf top å¸¸ç”¨å‚æ•° -eï¼šæŒ‡å®šæ€§èƒ½äº‹ä»¶ -aï¼šæ˜¾ç¤ºåœ¨æ‰€æœ‰ CPU ä¸Šçš„æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯ -Cï¼šæ˜¾ç¤ºåœ¨æŒ‡å®š CPU ä¸Šçš„æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯ -pï¼šæŒ‡å®šè¿›ç¨‹ PID -tï¼šæŒ‡å®šçº¿ç¨‹ TID -Kï¼šéšè—å†…æ ¸ç»Ÿè®¡ä¿¡æ¯ -Uï¼šéšè—ç”¨æˆ·ç©ºé—´çš„ç»Ÿè®¡ä¿¡æ¯ -sï¼šæŒ‡å®šå¾…è§£æçš„ç¬¦å·ä¿¡æ¯ â€˜â€Gâ€™ orâ€˜â€â€callâ€graphâ€™ \u003coutput_type,min_percent,call_order\u003e graph: ä½¿ç”¨è°ƒç”¨æ ‘ï¼Œå°†æ¯æ¡è°ƒç”¨è·¯å¾„è¿›ä¸€æ­¥æŠ˜å ã€‚è¿™ç§æ˜¾ç¤ºæ–¹å¼æ›´åŠ ç›´è§‚ã€‚ æ¯æ¡è°ƒç”¨è·¯å¾„çš„é‡‡æ ·ç‡ä¸ºç»å¯¹å€¼ã€‚ä¹Ÿå°±æ˜¯è¯¥æ¡è·¯å¾„å æ•´ä¸ªé‡‡æ ·åŸŸçš„æ¯”ç‡ã€‚ perf list perf test perf record: è®°å½•ä¸€æ®µæ—¶é—´å†…ç³»ç»Ÿ/è¿›ç¨‹çš„æ€§èƒ½æ—¶é—´ å¸¸ç”¨å‚æ•° -eï¼šé€‰æ‹©æ€§èƒ½äº‹ä»¶ -pï¼šå¾…åˆ†æè¿›ç¨‹çš„ id -tï¼šå¾…åˆ†æçº¿ç¨‹çš„ id -aï¼šåˆ†ææ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ -Cï¼šåªé‡‡é›†æŒ‡å®š CPU æ•°æ® -cï¼šäº‹ä»¶çš„é‡‡æ ·å‘¨æœŸ -oï¼šæŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼Œé»˜è®¤ä¸º perf.data -Aï¼šä»¥ append çš„æ–¹å¼å†™è¾“å‡ºæ–‡ä»¶ -fï¼šä»¥ OverWrite çš„æ–¹å¼å†™è¾“å‡ºæ–‡ä»¶ -gï¼šè®°å½•å‡½æ•°é—´çš„è°ƒç”¨å…³ç³» perf report: è¯»å– perf record ç”Ÿæˆçš„æ•°æ®æ–‡ä»¶ï¼Œå¹¶æ˜¾ç¤ºåˆ†ææ•°æ® å¸¸ç”¨å‚æ•° -iï¼šè¾“å…¥çš„æ•°æ®æ–‡ä»¶ -vï¼šæ˜¾ç¤ºæ¯ä¸ªç¬¦å·çš„åœ°å€ -d ï¼šåªæ˜¾ç¤ºæŒ‡å®š dos çš„ç¬¦å· -Cï¼šåªæ˜¾ç¤ºæŒ‡å®š comm çš„ä¿¡æ¯ï¼ˆComm. è§¦å‘äº‹ä»¶çš„è¿›ç¨‹åï¼‰ -Sï¼šåªè€ƒè™‘æŒ‡å®šç¬¦å· -Uï¼šåªæ˜¾ç¤ºå·²è§£æçš„ç¬¦å· -g[type,min,order]ï¼šæ˜¾ç¤ºè°ƒç”¨å…³ç³»ï¼Œå…·ä½“ç­‰åŒäº perf top å‘½ä»¤ä¸­çš„-g -cï¼šåªæ˜¾ç¤ºæŒ‡å®š cpu é‡‡æ ·ä¿¡æ¯ -Mï¼šä»¥æŒ‡å®šæ±‡ç¼–æŒ‡ä»¤é£æ ¼æ˜¾ç¤º â€“sourceï¼šä»¥æ±‡ç¼–å’Œ source çš„å½¢å¼è¿›è¡Œæ˜¾ç¤º -pï¼šç”¨æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤è°ƒç”¨å‡½æ•° ","date":"2023-10-22","objectID":"/perf%E6%80%A7%E8%83%BDprofiling/:1:0","tags":["perf","linux"],"title":"Perfæ€§èƒ½Profiling","uri":"/perf%E6%80%A7%E8%83%BDprofiling/"},{"categories":["linux"],"content":"2. ç”Ÿæˆç«ç„°å›¾ç¤ºä¾‹ # é‡‡é›†æ•°æ® perf record -F 99 -p 1234 -g \u003ccommand\u003e -- sleep 30 # è§£ææ•°æ® perf script -i perf.data \u0026\u003e perf.unfold # ç”Ÿæˆç«ç„°å›¾ # å…‹éš†ä»“åº“ git clone https://github.com/brendangregg/FlameGraph.git cd FlameGraph # å¯¹perf.unfoldæ–‡ä»¶è¿›è¡Œç¬¦å·æŠ˜å  ./stackcollapse-perf.pl perf.unfold \u003e perf.folded # ç”Ÿæˆç«ç„°å›¾ï¼ˆsvgå›¾ï¼‰ ./flamegraph.pl perf.folded \u003e perf.svg ","date":"2023-10-22","objectID":"/perf%E6%80%A7%E8%83%BDprofiling/:2:0","tags":["perf","linux"],"title":"Perfæ€§èƒ½Profiling","uri":"/perf%E6%80%A7%E8%83%BDprofiling/"},{"categories":["linux"],"content":"IP è·¯ç”±ç›¸å…³å‘½ä»¤æ€»ç»“ ","date":"2023-10-12","objectID":"/ip%E8%B7%AF%E7%94%B1%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/:0:0","tags":["route","linux","tun"],"title":"Ipè·¯ç”±ç›¸å…³å‘½ä»¤","uri":"/ip%E8%B7%AF%E7%94%B1%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/"},{"categories":["linux"],"content":"ä¸€ï¼Œè·¯ç”±ç­–ç•¥ï¼ˆä½¿ç”¨ip ruleå‘½ä»¤æ“ä½œè·¯ç”±ç­–ç•¥æ•°æ®åº“ï¼‰ åŸºäºç­–ç•¥çš„è·¯ç”±æ¯”ä¼ ç»Ÿè·¯ç”±åœ¨åŠŸèƒ½ä¸Šæ›´å¼ºå¤§ï¼Œä½¿ç”¨æ›´çµæ´»ï¼Œå®ƒä½¿ç½‘ç»œç®¡ç†å‘˜ä¸ä»…èƒ½å¤Ÿæ ¹æ®ç›®çš„åœ°å€è€Œä¸”èƒ½å¤Ÿæ ¹æ®æŠ¥æ–‡å¤§å°ï¼Œåº”ç”¨æˆ–IPæºåœ°å€ç­‰å±æ€§æ¥é€‰æ‹©è½¬å‘è·¯å¾„ã€‚ ip ruleå‘½ä»¤ï¼š Usage: ip rule { add | del } SELECTOR ACTION ip rule { flush | save | restore } ip rule [ list [ SELECTOR ]] SELECTOR := [ not ] [ from PREFIX ] [ to PREFIX ] [ tos TOS ] [ fwmark FWMARK[/MASK] ] [ iif STRING ] [ oif STRING ] [ pref NUMBER ] [ l3mdev ] [ uidrange NUMBER-NUMBER ] [ ipproto PROTOCOL ] [ sport [ NUMBER | NUMBER-NUMBER ] [ dport [ NUMBER | NUMBER-NUMBER ] ] ACTION := [ table TABLE_ID ] [ protocol PROTO ] [ nat ADDRESS ] [ realms [SRCREALM/]DSTREALM ] [ goto NUMBER ] SUPPRESSOR SUPPRESSOR := [ suppress_prefixlength NUMBER ] [ suppress_ifgroup DEVGROUP ] TABLE_ID := [ local | main | default | NUMBER ] #ä¾‹å­1ï¼šé€šè¿‡è·¯ç”±è¡¨ table 1 è·¯ç”±æ¥è‡ªæºåœ°å€ä¸º192.203.80/24çš„æ•°æ®åŒ… ip rule add from 192.203.80/24 table 1 #ä¾‹å­2ï¼šæŠŠæºåœ°å€ä¸º192.168.1.10çš„æ•°æ®æŠ¥çš„æºåœ°å€è½¬æ¢ä¸º192.168.2.20ï¼Œå¹¶é€šè¿‡è¡¨1è¿›è¡Œè·¯ç”± ip rule add from 193.168.1.10 nat 192.168.2.20 table 1 #å®ä¾‹3ï¼šè®©eht0æµé‡ä½¿ç”¨table 1 ip rule add dev eth0 table1 åœ¨ Linux ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå†…æ ¸ä¼šä¸ºè·¯ç”±ç­–ç•¥æ•°æ®åº“é…ç½®ä¸‰æ¡ç¼ºçœçš„è§„åˆ™ï¼š 0ï¼šåŒ¹é…ä»»ä½•æ¡ä»¶ï¼ŒæŸ¥è¯¢è·¯ç”±è¡¨local(ID 255)ï¼Œè¯¥è¡¨localæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è·¯ç”±è¡¨ï¼ŒåŒ…å«å¯¹äºæœ¬åœ°å’Œå¹¿æ’­åœ°å€çš„ä¼˜å…ˆçº§æ§åˆ¶è·¯ç”±ã€‚rule 0éå¸¸ç‰¹æ®Šï¼Œä¸èƒ½è¢«åˆ é™¤æˆ–è€…è¦†ç›–ã€‚ 32766ï¼šåŒ¹é…ä»»ä½•æ¡ä»¶ï¼ŒæŸ¥è¯¢è·¯ç”±è¡¨main(ID 254)ï¼Œè¯¥è¡¨æ˜¯ä¸€ä¸ªé€šå¸¸çš„è¡¨ï¼ŒåŒ…å«æ‰€æœ‰çš„æ— ç­–ç•¥è·¯ç”±ã€‚ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥åˆ é™¤æˆ–è€…ä½¿ç”¨å¦å¤–çš„è§„åˆ™è¦†ç›–è¿™æ¡è§„åˆ™ã€‚ 32767ï¼šåŒ¹é…ä»»ä½•æ¡ä»¶ï¼ŒæŸ¥è¯¢è·¯ç”±è¡¨default(ID 253)ï¼Œè¯¥è¡¨æ˜¯ä¸€ä¸ªç©ºè¡¨ï¼Œå®ƒæ˜¯åç»­å¤„ç†ä¿ç•™ã€‚å¯¹äºå‰é¢çš„ç­–ç•¥æ²¡æœ‰åŒ¹é…åˆ°çš„æ•°æ®åŒ…ï¼Œç³»ç»Ÿä½¿ç”¨è¿™ä¸ªç­–ç•¥è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªè§„åˆ™ä¹Ÿå¯ä»¥åˆ é™¤ã€‚ **æ³¨ï¼š**ä¸è¦æ··æ·†è·¯ç”±è¡¨å’Œç­–ç•¥ï¼šè§„åˆ™æŒ‡å‘è·¯ç”±è¡¨ï¼Œå¤šä¸ªè§„åˆ™å¯ä»¥å¼•ç”¨ä¸€ä¸ªè·¯ç”±è¡¨ï¼Œè€Œä¸”æŸäº›è·¯ç”±è¡¨å¯ä»¥ç­–ç•¥æŒ‡å‘å®ƒã€‚å¦‚æœç³»ç»Ÿç®¡ç†å‘˜åˆ é™¤äº†æŒ‡å‘æŸä¸ªè·¯ç”±è¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œè¿™ä¸ªè¡¨æ²¡æœ‰ç”¨äº†ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨ï¼Œç›´åˆ°é‡Œé¢çš„æ‰€æœ‰è·¯ç”±éƒ½è¢«åˆ é™¤ï¼Œå®ƒæ‰ä¼šæ¶ˆå¤±ã€‚ linux ç³»ç»Ÿä¸­ï¼Œå¯ä»¥è‡ªå®šä¹‰ä» 1ï¼252ä¸ªè·¯ç”±è¡¨ï¼Œå…¶ä¸­ï¼Œlinuxç³»ç»Ÿç»´æŠ¤äº†4ä¸ªè·¯ç”±è¡¨ï¼š 0#è¡¨ï¼š ç³»ç»Ÿä¿ç•™è¡¨ 253#è¡¨ï¼š defulte table æ²¡ç‰¹åˆ«æŒ‡å®šçš„é»˜è®¤è·¯ç”±éƒ½æ”¾åœ¨æ”¹è¡¨ 254#è¡¨ï¼š main table æ²¡æŒ‡æ˜è·¯ç”±è¡¨çš„æ‰€æœ‰è·¯ç”±æ”¾åœ¨è¯¥è¡¨ 255#è¡¨ï¼š locale table ä¿å­˜æœ¬åœ°æ¥å£åœ°å€ï¼Œå¹¿æ’­åœ°å€ã€NATåœ°å€ ç”±ç³»ç»Ÿç»´æŠ¤ï¼Œç”¨æˆ·ä¸å¾—æ›´æ”¹ è·¯ç”±è¡¨çš„æŸ¥çœ‹å¯æœ‰ä»¥ä¸‹äºŒç§æ–¹æ³•ï¼š ip route show table table_number ip route show table table_name è·¯ç”±è¡¨åºå·å’Œè¡¨åçš„å¯¹åº”å…³ç³»åœ¨ /etc/iproute2/rt_tablesæ–‡ä»¶ä¸­ï¼Œå¯ä»¥æ‰‹åŠ¨ç¼–è¾‘ï¼Œè·¯ç”±è¡¨æ·»åŠ å®Œæ¯•åŠæ—¶ç”Ÿæ•ˆï¼Œå®ä¾‹å¦‚ä¸‹ï¼š #å®ä¾‹1ï¼šåœ¨ä¸€å·è¡¨ä¸­æ·»åŠ é»˜è®¤è·¯ç”±ä¸º192.168.1.1 ip route add default via 192.168.1.1 table 1 #å®ä¾‹2ï¼šåœ¨ä¸€å·è¡¨ä¸­æ·»åŠ ä¸€æ¡åˆ°192.168.0.0ç½‘æ®µçš„è·¯ç”±ä¸º192.168.1.2 ip route add 192.168.0.0/24 via 192.168.1.2 table 1 ","date":"2023-10-12","objectID":"/ip%E8%B7%AF%E7%94%B1%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/:1:0","tags":["route","linux","tun"],"title":"Ipè·¯ç”±ç›¸å…³å‘½ä»¤","uri":"/ip%E8%B7%AF%E7%94%B1%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/"},{"categories":["linux"],"content":"äºŒï¼Œè·¯ç”±è¡¨ï¼ˆä½¿ç”¨ip routeå‘½ä»¤æ“ä½œé™æ€è·¯ç”±è¡¨ï¼‰ æ‰€è°“è·¯ç”±è¡¨ï¼ŒæŒ‡çš„æ˜¯è·¯ç”±å™¨æˆ–è€…å…¶ä»–äº’è”ç½‘ç½‘ç»œè®¾å¤‡ä¸Šå­˜å‚¨çš„è¡¨ï¼Œè¯¥è¡¨ä¸­å­˜æœ‰åˆ°è¾¾ç‰¹å®šç½‘ç»œç»ˆç«¯çš„è·¯å¾„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿˜æœ‰ä¸€äº›ä¸è¿™äº›è·¯å¾„ç›¸å…³çš„åº¦é‡ã€‚è·¯ç”±å™¨çš„ä¸»è¦å·¥ä½œå°±æ˜¯ä¸ºç»è¿‡è·¯ç”±å™¨çš„æ¯ä¸ªæ•°æ®åŒ…å¯»æ‰¾ä¸€æ¡æœ€ä½³çš„ä¼ è¾“è·¯å¾„ï¼Œå¹¶å°†è¯¥æ•°æ®æœ‰æ•ˆåœ°ä¼ é€åˆ°ç›®çš„ç«™ç‚¹ã€‚ç”±æ­¤å¯è§ï¼Œé€‰æ‹©æœ€ä½³è·¯å¾„çš„ç­–ç•¥å³è·¯ç”±ç®—æ³•æ˜¯è·¯ç”±å™¨çš„å…³é”®æ‰€åœ¨ã€‚ä¸ºäº†å®Œæˆè¿™é¡¹å·¥ä½œï¼Œåœ¨è·¯ç”±å™¨ä¸­ä¿å­˜ç€å„ç§ä¼ è¾“è·¯å¾„çš„ç›¸å…³æ•°æ®â€“è·¯ç”±è¡¨ï¼Œä¾›è·¯ç”±é€‰æ‹©æ—¶ä½¿ç”¨ï¼Œè¡¨ä¸­åŒ…å«çš„ä¿¡æ¯å†³å®šäº†æ•°æ®è½¬å‘çš„ç­–ç•¥ã€‚ ä»¥ä¸€ä¾‹å­æ¥è¯´æ˜ï¼šå…¬å¸å†…ç½‘è¦æ±‚192.168.0.100 ä»¥å†…çš„ä½¿ç”¨ 10.0.0.1 ç½‘å…³ä¸Šç½‘ ï¼ˆç”µä¿¡ï¼‰ï¼Œå…¶ä»–IPä½¿ç”¨ 20.0.0.1 ï¼ˆç½‘é€šï¼‰ä¸Šç½‘ã€‚ é¦–å…ˆè¦åœ¨ç½‘å…³æœåŠ¡å™¨ä¸Šæ·»åŠ ä¸€ä¸ªé»˜è®¤è·¯ç”±ï¼Œå½“ç„¶è¿™ä¸ªæŒ‡å‘æ˜¯ç»å¤§å¤šæ•°çš„IPçš„å‡ºå£ç½‘å…³ï¼šip route add default gw 20.0.0.1 ä¹‹åé€šè¿‡ ip route æ·»åŠ ä¸€ä¸ªè·¯ç”±è¡¨ï¼šip route add table 3 via 10.0.0.1 dev ethX (ethx æ˜¯ 10.0.0.1 æ‰€åœ¨çš„ç½‘å¡, 3 æ˜¯è·¯ç”±è¡¨çš„ç¼–å·) ä¹‹åæ·»åŠ  ip rule è§„åˆ™ï¼šip rule add fwmark 3 table 3 ï¼ˆfwmark 3 æ˜¯æ ‡è®°ï¼Œtable 3 æ˜¯è·¯ç”±è¡¨3 ä¸Šè¾¹ã€‚ æ„æ€å°±æ˜¯å‡¡äº‹æ ‡è®°äº† 3 çš„æ•°æ®ä½¿ç”¨ table3 è·¯ç”±è¡¨ï¼‰ ä¹‹åä½¿ç”¨ iptables ç»™ç›¸åº”çš„æ•°æ®æ‰“ä¸Šæ ‡è®°ï¼šiptables -A PREROUTING -t mangle -i eth0 -s 192.168.0.1 - 192.168.0.100 -j MARK â€“set-mark 3 ","date":"2023-10-12","objectID":"/ip%E8%B7%AF%E7%94%B1%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/:2:0","tags":["route","linux","tun"],"title":"Ipè·¯ç”±ç›¸å…³å‘½ä»¤","uri":"/ip%E8%B7%AF%E7%94%B1%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/"},{"categories":["docker"],"content":"Docker åŸºæœ¬å‘½ä»¤ ","date":"2023-09-13","objectID":"/docker%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/:0:0","tags":["docker"],"title":"DockeråŸºæœ¬å‘½ä»¤","uri":"/docker%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/"},{"categories":["docker"],"content":"1. ä½¿ç”¨é•œåƒ docker pull [é€‰é¡¹] [Docker Registry åœ°å€[:ç«¯å£å·]/]ä»“åº“å[:æ ‡ç­¾] Docker é•œåƒä»“åº“åœ°å€ï¼šåœ°å€çš„æ ¼å¼ä¸€èˆ¬æ˜¯ \u003cåŸŸå/IP\u003e[:ç«¯å£å·]ã€‚é»˜è®¤åœ°å€æ˜¯ Docker Hub(docker.io)ã€‚ ä»“åº“åï¼šå¦‚ä¹‹å‰æ‰€è¯´ï¼Œè¿™é‡Œçš„ä»“åº“åæ˜¯ä¸¤æ®µå¼åç§°ï¼Œå³ \u003cç”¨æˆ·å\u003e/\u003cè½¯ä»¶å\u003eã€‚å¯¹äº Docker Hubï¼Œå¦‚æœä¸ç»™å‡ºç”¨æˆ·åï¼Œåˆ™é»˜è®¤ä¸º libraryï¼Œä¹Ÿå°±æ˜¯å®˜æ–¹é•œåƒã€‚ ","date":"2023-09-13","objectID":"/docker%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/:1:0","tags":["docker"],"title":"DockeråŸºæœ¬å‘½ä»¤","uri":"/docker%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/"},{"categories":["docker"],"content":"2. æ“ä½œå®¹å™¨ -itï¼šè¿™æ˜¯ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ -iï¼šäº¤äº’å¼æ“ä½œï¼Œä¸€ä¸ªæ˜¯ -t ç»ˆç«¯ã€‚æˆ‘ä»¬è¿™é‡Œæ‰“ç®—è¿›å…¥ bash æ‰§è¡Œä¸€äº›å‘½ä»¤å¹¶æŸ¥çœ‹è¿”å›ç»“æœï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦äº¤äº’å¼ç»ˆç«¯ã€‚ -d: è®©å®¹å™¨åœ¨åå°è¿è¡Œ --rmï¼šè¿™ä¸ªå‚æ•°æ˜¯è¯´å®¹å™¨é€€å‡ºåéšä¹‹å°†å…¶åˆ é™¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ºäº†æ’éšœéœ€æ±‚ï¼Œé€€å‡ºçš„å®¹å™¨å¹¶ä¸ä¼šç«‹å³åˆ é™¤ï¼Œé™¤éæ‰‹åŠ¨ docker rmã€‚æˆ‘ä»¬è¿™é‡Œåªæ˜¯éšä¾¿æ‰§è¡Œä¸ªå‘½ä»¤ï¼Œçœ‹çœ‹ç»“æœï¼Œä¸éœ€è¦æ’éšœå’Œä¿ç•™ç»“æœï¼Œå› æ­¤ä½¿ç”¨ --rm å¯ä»¥é¿å…æµªè´¹ç©ºé—´ã€‚ ubuntu:18.04ï¼šè¿™æ˜¯æŒ‡ç”¨ ubuntu:18.04 é•œåƒä¸ºåŸºç¡€æ¥å¯åŠ¨å®¹å™¨ã€‚ bashï¼šæ”¾åœ¨é•œåƒååçš„æ˜¯ å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸ªäº¤äº’å¼ Shellï¼Œå› æ­¤ç”¨çš„æ˜¯ bash, ä¹Ÿå¯ä»¥ä½¿ç”¨dashæˆ–è€…fishã€‚ ","date":"2023-09-13","objectID":"/docker%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/:2:0","tags":["docker"],"title":"DockeråŸºæœ¬å‘½ä»¤","uri":"/docker%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/"},{"categories":["docker"],"content":"3. æ•°æ®ç®¡ç† åˆ›å»ºä¸€ä¸ªæ•°æ®å· docker volume create my-vol åˆ é™¤æ•°æ®å· docker volume rm my-vol æ— ä¸»çš„æ•°æ®å·å¯èƒ½ä¼šå æ®å¾ˆå¤šç©ºé—´ï¼Œè¦æ¸…ç†è¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤: docker volume prune æŸ¥çœ‹æ‰€æœ‰æ•°æ®å· docker volume ls åœ¨ä¸»æœºé‡Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹æŒ‡å®š æ•°æ®å· çš„ä¿¡æ¯ docker volume inspect my-vol æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ docker inspect container_id æŒ‚è½½ä¸»æœºç›®å½• docker run -d -P \\ --name web \\ # -v /src/webapp:/usr/share/nginx/html \\ --mount type=bind,source=/src/webapp,target=/usr/share/nginx/html \\ nginx:alpine æ³¨æ„: æœ¬åœ°ç›®å½•çš„è·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„,ä½¿ç”¨ -v å‚æ•°æ—¶å¦‚æœæœ¬åœ°ç›®å½•ä¸å­˜åœ¨ Docker ä¼šè‡ªåŠ¨ä¸ºä½ åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç°åœ¨ä½¿ç”¨ --mount å‚æ•°æ—¶å¦‚æœæœ¬åœ°ç›®å½•ä¸å­˜åœ¨ï¼ŒDocker ä¼šæŠ¥é”™ã€‚ Docker æŒ‚è½½ä¸»æœºç›®å½•çš„é»˜è®¤æƒé™æ˜¯ è¯»å†™ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡å¢åŠ  readonly æŒ‡å®šä¸º åªè¯» docker run -d -P \\ --name web \\ # -v /src/webapp:/usr/share/nginx/html:ro \\ --mount type=bind,source=/src/webapp,target=/usr/share/nginx/html,readonly \\ nginx:alpine ","date":"2023-09-13","objectID":"/docker%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/:3:0","tags":["docker"],"title":"DockeråŸºæœ¬å‘½ä»¤","uri":"/docker%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/"},{"categories":["linux","docker"],"content":"Docker åŸºçŸ³-NetworkNamespace ","date":"2023-08-31","objectID":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/:0:0","tags":["veth","docker"],"title":"DockeråŸºçŸ³ NetworkNamespace","uri":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/"},{"categories":["linux","docker"],"content":"1. veth-pair æ˜¯ä»€ä¹ˆ veth-pair æ˜¯ä¸€å¯¹è™šæ‹Ÿç½‘å¡ï¼Œé€šè¿‡ veth-pair å¯ä»¥å°†ä¸¤ä¸ªç½‘ç»œå‘½åç©ºé—´è¿æ¥èµ·æ¥ï¼Œä»è€Œå®ç°ä¸¤ä¸ªç½‘ç»œå‘½åç©ºé—´ä¹‹é—´çš„é€šä¿¡ã€‚å’Œ tap/tun è®¾å¤‡ä¸åŒçš„æ˜¯ï¼Œå®ƒéƒ½æ˜¯æˆå¯¹å‡ºç°çš„ã€‚ä¸€ç«¯è¿ç€åè®®æ ˆï¼Œä¸€ç«¯å½¼æ­¤ç›¸è¿ç€ å…¨ç¨‹åªä½¿ç”¨ ip å‘½ä»¤è¿›è¡Œæ¼”ç¤º ","date":"2023-08-31","objectID":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/:1:0","tags":["veth","docker"],"title":"DockeråŸºçŸ³ NetworkNamespace","uri":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/"},{"categories":["linux","docker"],"content":"2. ä½¿ç”¨ veth-pair å’Œ netns è¿›è¡Œæ¼”ç¤º ","date":"2023-08-31","objectID":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/:2:0","tags":["veth","docker"],"title":"DockeråŸºçŸ³ NetworkNamespace","uri":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/"},{"categories":["linux","docker"],"content":"2.1 åˆ›å»ºä¸¤ä¸ªç½‘ç»œå‘½åç©ºé—´ ip netns add ns1 ip netns add ns2 ","date":"2023-08-31","objectID":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/:2:1","tags":["veth","docker"],"title":"DockeråŸºçŸ³ NetworkNamespace","uri":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/"},{"categories":["linux","docker"],"content":"2.2 åˆ›å»º veth-pair ip link add veth1 type veth peer name veth2 ","date":"2023-08-31","objectID":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/:2:2","tags":["veth","docker"],"title":"DockeråŸºçŸ³ NetworkNamespace","uri":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/"},{"categories":["linux","docker"],"content":"2.3 å°† veth1 ç§»åŠ¨åˆ° ns1 ä¸­ ip link set veth1 netns ns1 ","date":"2023-08-31","objectID":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/:2:3","tags":["veth","docker"],"title":"DockeråŸºçŸ³ NetworkNamespace","uri":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/"},{"categories":["linux","docker"],"content":"2.4 å°† veth2 ç§»åŠ¨åˆ° ns2 ä¸­ ip link set veth2 netns ns2 ","date":"2023-08-31","objectID":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/:2:4","tags":["veth","docker"],"title":"DockeråŸºçŸ³ NetworkNamespace","uri":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/"},{"categories":["linux","docker"],"content":"2.5 å¯åŠ¨ veth1 ip netns exec ns1 ip link set dev veth1 up ","date":"2023-08-31","objectID":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/:2:5","tags":["veth","docker"],"title":"DockeråŸºçŸ³ NetworkNamespace","uri":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/"},{"categories":["linux","docker"],"content":"2.6 å¯åŠ¨ veth2 ip netns exec ns2 ip link set dev veth2 up ","date":"2023-08-31","objectID":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/:2:6","tags":["veth","docker"],"title":"DockeråŸºçŸ³ NetworkNamespace","uri":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/"},{"categories":["linux","docker"],"content":"2.7 è®¾ç½® veth1 çš„ IP åœ°å€ ip netns exec ns1 ip addr add 192.168.1.2/24 dev veth1 ","date":"2023-08-31","objectID":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/:2:7","tags":["veth","docker"],"title":"DockeråŸºçŸ³ NetworkNamespace","uri":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/"},{"categories":["linux","docker"],"content":"2.8 è®¾ç½® veth2 çš„ IP åœ°å€ ip netns exec ns2 ip addr add 192.168.1.3/24 dev veth2 ","date":"2023-08-31","objectID":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/:2:8","tags":["veth","docker"],"title":"DockeråŸºçŸ³ NetworkNamespace","uri":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/"},{"categories":["linux","docker"],"content":"2.9 æµ‹è¯• ip netns exec ns1 ping 192.168.1.3 ","date":"2023-08-31","objectID":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/:2:9","tags":["veth","docker"],"title":"DockeråŸºçŸ³ NetworkNamespace","uri":"/docker%E5%9F%BA%E7%9F%B3-networknamespace/"},{"categories":["pytorch"],"content":"torch.fxæ¨¡å—çš„ä½¿ç”¨ ","date":"2023-07-23","objectID":"/torch.fx%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/:0:0","tags":["pytorch","torch.fx"],"title":"Torch.fxæ¨¡å—çš„ä½¿ç”¨","uri":"/torch.fx%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/"},{"categories":["pytorch"],"content":"torch.fxä¸»è¦æœ‰3ä¸ªç»„ä»¶ï¼š ç¬¦å·è¿½è¸ªå™¨ï¼ˆsymbolic tracer) ä¸­é—´è¡¨ç¤ºï¼ˆintermediate representation) Pythonä»£ç ç”Ÿæˆï¼ˆPython code generation) import torch # Simple module for demonstration class MyModule(torch.nn.Module): def __init__(self): super().__init__() self.param = torch.nn.Parameter(torch.rand(3, 4)) self.linear = torch.nn.Linear(4, 5) def forward(self, x): return self.linear(x + self.param).clamp(min=0.0, max=1.0) module = MyModule() from torch.fx import symbolic_trace # ç¬¦å·è¿½è¸ªè¿™ä¸ªæ¨¡å— # Symbolic tracing frontend - captures the semantics of the module symbolic_traced : torch.fx.GraphModule = symbolic_trace(module) # ä¸­é—´è¡¨ç¤º # High-level intermediate representation (IR) - Graph representation print(symbolic_traced.graph) \"\"\" graph(): %x : [#users=1] = placeholder[target=x] %param : [#users=1] = get_attr[target=param] %add : [#users=1] = call_function[target=operator.add](args = (%x, %param), kwargs = {}) %linear : [#users=1] = call_module[target=linear](args = (%add,), kwargs = {}) %clamp : [#users=1] = call_method[target=clamp](args = (%linear,), kwargs = {min: 0.0, max: 1.0}) return clamp \"\"\" # ç”Ÿæˆä»£ç  # Code generation - valid Python code print(symbolic_traced.code) \"\"\" def forward(self, x): param = self.param add = x + param; x = param = None linear = self.linear(add); add = None clamp = linear.clamp(min = 0.0, max = 1.0); linear = None return clamp \"\"\" ","date":"2023-07-23","objectID":"/torch.fx%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/:1:0","tags":["pytorch","torch.fx"],"title":"Torch.fxæ¨¡å—çš„ä½¿ç”¨","uri":"/torch.fx%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/"},{"categories":["pytorch"],"content":"ä½¿ç”¨åœºæ™¯ Replace one op Conv/Batch Norm fusion replace_pattern: Basic usage Quantization Invert Transformation èåˆä¾‹å­: # Works for length 2 patterns with 2 modules def matches_module_pattern(pattern: Iterable[Type], node: fx.Node, modules: Dict[str, Any]): if len(node.args) == 0: return False nodes: Tuple[Any, fx.Node] = (node.args[0], node) for expected_type, current_node in zip(pattern, nodes): if not isinstance(current_node, fx.Node): return False if current_node.op != 'call_module': return False if not isinstance(current_node.target, str): return False if current_node.target not in modules: return False if type(modules[current_node.target]) is not expected_type: return False return True def replace_node_module(node: fx.Node, modules: Dict[str, Any], new_module: torch.nn.Module): assert(isinstance(node.target, str)) parent_name, name = _parent_name(node.target) modules[node.target] = new_module setattr(modules[parent_name], name, new_module) def fuse(model: torch.nn.Module, inplace=False) -\u003e torch.nn.Module: \"\"\" Fuses convolution/BN layers for inference purposes. Will deepcopy your model by default, but can modify the model inplace as well. \"\"\" patterns = [(nn.Conv1d, nn.BatchNorm1d), (nn.Conv2d, nn.BatchNorm2d), (nn.Conv3d, nn.BatchNorm3d)] if not inplace: model = copy.deepcopy(model) fx_model = fx.symbolic_trace(model) modules = dict(fx_model.named_modules()) new_graph = copy.deepcopy(fx_model.graph) for pattern in patterns: for node in new_graph.nodes: # æ‰¾åˆ°ç›®æ ‡Nodeï¼šargsæ˜¯Convï¼Œtargetæ˜¯BN if matches_module_pattern(pattern, node, modules): if len(node.args[0].users) \u003e 1: # Output of conv is used by other nodes continue conv = modules[node.args[0].target] bn = modules[node.target] # èåˆBNå’ŒConv fused_conv = fuse_conv_bn_eval(conv, bn) # æ›¿æ¢Nodeçš„moduleï¼Œå…¶å®å°±æ˜¯å°†èåˆåçš„moduleæ›¿æ¢Conv Nodeçš„targetï¼ŒèƒŒåæ˜¯æ¨¡å—æ›¿æ¢ replace_node_module(node.args[0], modules, fused_conv) # å°†æ‰€æœ‰ç”¨åˆ°BN Nodeçš„æ›¿æ¢ä¸ºConv Nodeï¼ˆå·²ç»èåˆåçš„Convï¼‰ node.replace_all_uses_with(node.args[0]) # åˆ é™¤BN Node new_graph.erase_node(node) return fx.GraphModule(fx_model, new_graph) from torch.fx.experimental.optimization import fuse from torchvision.models import resnet18 model = resnet18() model.eval() # å¿…é¡»åœ¨evalæ¨¡å‹ä¸‹fuse ''' (layer4): Sequential( (0): BasicBlock( (conv1): Conv2d(256, 512, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1), bias=False) (bn1): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True) (relu): ReLU(inplace=True) (conv2): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False) (bn2): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True) (downsample): Sequential( (0): Conv2d(256, 512, kernel_size=(1, 1), stride=(2, 2), bias=False) (1): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True) ) ) (1): BasicBlock( (conv1): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False) (bn1): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True) (relu): ReLU(inplace=True) (conv2): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False) (bn2): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True) ) ) (avgpool): AdaptiveAvgPool2d(output_size=(1, 1)) (fc): Linear(in_features=512, out_features=1000, bias=True) ) ''' fused_model = fuse(model) ''' (layer4): Module( (0): Module( (conv1): Conv2d(256, 512, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1)) (relu): ReLU(inplace=True) (conv2): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1)) (downsample): Module( (0): Conv2d(256, 512, kernel_size=(1, 1), stride=(2, 2)) ) ) (1): Module( (conv1): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1)) (relu): ReLU(inplace=True) (conv2): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1)) ) ) (avgpool): AdaptiveAvgPool2d(output_size=(1, 1)) (fc): Linear(in_features=512, out_features=1000, bias=True) ) ''' ","date":"2023-07-23","objectID":"/torch.fx%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/:2:0","tags":["pytorch","torch.fx"],"title":"Torch.fxæ¨¡å—çš„ä½¿ç”¨","uri":"/torch.fx%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/"},{"categories":["pytorch"],"content":"å‚è€ƒé“¾æ¥: PyTorchæ–°æŠ€èƒ½è§£é”ï¼štorch.fx - çŸ¥ä¹ (zhihu.com) ","date":"2023-07-23","objectID":"/torch.fx%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/:3:0","tags":["pytorch","torch.fx"],"title":"Torch.fxæ¨¡å—çš„ä½¿ç”¨","uri":"/torch.fx%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"matplotlibçš„ç®€å•ä½¿ç”¨ matplotlibç»“æ„ ","date":"2023-07-13","objectID":"/matplotlib%E4%BD%BF%E7%94%A8/:0:0","tags":["python","matplotlib"],"title":"Matplotlibä½¿ç”¨","uri":"/matplotlib%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"1. fig,ax,plt ä¸‰è€…çš„åŸºæœ¬æ¦‚å¿µ fig Figureï¼Œå°±æ˜¯å›¾çš„å¤–æ¡†ï¼Œä¹Ÿå«ç”»å¸ƒï¼Œå¯ä»¥åŒ…æ‹¬1-æ— ç©·ä¸ªå†…æ¡†Axes ax Axesï¼Œå°±æ˜¯å›¾çš„å†…æ¡†(å¯ä»¥å°†ç”»å¸ƒåˆ†ä¸ºå¤šä¸ªç»˜å›¾åŒºåŸŸ)ï¼Œé‡Œé¢å¯ä»¥ç”»å„ç§å›¾ï¼Œæœ€å¸¸è§çš„å°±æ˜¯äºŒç»´çš„ç»Ÿè®¡å›¾æˆ–è€…æŠ˜çº¿å›¾ï¼Œä¹Ÿå¯ä»¥ç”»ä¸‰ç»´å›¾xyzå’Œæåæ ‡å›¾theta-r Axisï¼Œå°±æ˜¯åæ ‡è½´ plt Pyplotä¸ºåº•å±‚é¢å‘å¯¹è±¡çš„ç»˜å›¾åº“æä¾›çŠ¶æ€æœºæ¥å£ã€‚çŠ¶æ€æœºéšå¼è‡ªåŠ¨åˆ›å»ºå›¾å½¢å’Œè½´ï¼Œä»¥å®ç°æ‰€éœ€çš„ç»˜å›¾ã€‚ ","date":"2023-07-13","objectID":"/matplotlib%E4%BD%BF%E7%94%A8/:1:0","tags":["python","matplotlib"],"title":"Matplotlibä½¿ç”¨","uri":"/matplotlib%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"2.å¸¸ç”¨å‡½æ•°è¯´æ˜ matplotlib.pyplotæ¨¡å—æä¾›äº†ä¸€ä¸ª subplot() å‡½æ•°ï¼Œå®ƒå¯ä»¥å‡ç­‰åœ°åˆ’åˆ†ç”»å¸ƒ import matplotlib.pyplot as plt plt.plot([1,2,3]) #ç°åœ¨åˆ›å»ºä¸€ä¸ªå­å›¾ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªæœ‰2è¡Œ1åˆ—çš„ç½‘æ ¼çš„é¡¶éƒ¨å›¾ã€‚ #å› ä¸ºè¿™ä¸ªå­å›¾å°†ä¸ç¬¬ä¸€ä¸ªé‡å ï¼Œæ‰€ä»¥ä¹‹å‰åˆ›å»ºçš„å›¾å°†è¢«åˆ é™¤ plt.subplot(211) plt.plot(range(12)) #åˆ›å»ºå¸¦æœ‰é»„è‰²èƒŒæ™¯çš„ç¬¬äºŒä¸ªå­å›¾ plt.subplot(212, facecolor='y') plt.plot(range(12)) Matplotlib æä¾›äº†matplotlib.figureå›¾å½¢ç±»æ¨¡å—ï¼Œå®ƒåŒ…å«äº†åˆ›å»ºå›¾å½¢å¯¹è±¡çš„æ–¹æ³•ã€‚é€šè¿‡è°ƒç”¨ pyplot æ¨¡å—ä¸­ figure() å‡½æ•°æ¥å®ä¾‹åŒ– figure å¯¹è±¡ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š from matplotlib import pyplot as plt import numpy as np import math x = np.arange(0, math.pi*2, 0.05) y = np.sin(x) fig = plt.figure() # add_axes() çš„å‚æ•°å€¼æ˜¯ä¸€ä¸ªåºåˆ—ï¼Œåºåˆ—ä¸­çš„ 4 ä¸ªæ•°å­—åˆ†åˆ«å¯¹åº”å›¾å½¢çš„å·¦ä¾§ï¼Œåº•éƒ¨ï¼Œå®½åº¦ï¼Œå’Œé«˜åº¦ï¼Œä¸”æ¯ä¸ªæ•°å­—å¿…é¡»ä»‹äº 0 åˆ° 1 ä¹‹é—´ã€‚ ax = fig.add_axes([0,0,1,1]) ax.plot(x,y) ax.set_title(\"sine wave\") ax.set_xlabel('angle') ax.set_ylabel('sine') plt.show() matplotlib.pyplotæ¨¡å—æä¾›äº†ä¸€ä¸ª subplots() å‡½æ•°ï¼Œå®ƒçš„ä½¿ç”¨æ–¹æ³•å’Œ subplot() å‡½æ•°ç±»ä¼¼ã€‚å…¶ä¸åŒä¹‹å¤„åœ¨äºï¼Œsubplots() æ—¢åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«å­å›¾åŒºåŸŸçš„ç”»å¸ƒï¼Œåˆåˆ›å»ºäº†ä¸€ä¸ª figure å›¾å½¢å¯¹è±¡ï¼Œè€Œ subplot() åªæ˜¯åˆ›å»ºä¸€ä¸ªåŒ…å«å­å›¾åŒºåŸŸçš„ç”»å¸ƒã€‚ import matplotlib.pyplot as plt # å°†ç”»å¸ƒåˆ†ä¸º2*2çš„ç»˜å›¾åŒºåŸŸ fig,a = plt.subplots(2,2) import numpy as np x = np.arange(1,5) #ç»˜åˆ¶å¹³æ–¹å‡½æ•° a[0][0].plot(x,x*x) a[0][0].set_title('square') #ç»˜åˆ¶å¹³æ–¹æ ¹å›¾åƒ a[0][1].plot(x,np.sqrt(x)) a[0][1].set_title('square root') #ç»˜åˆ¶æŒ‡æ•°å‡½æ•° a[1][0].plot(x,np.exp(x)) a[1][0].set_title('exp') #ç»˜åˆ¶å¯¹æ•°å‡½æ•° a[1][1].plot(x,np.log10(x)) a[1][1].set_title('log') plt.show() ","date":"2023-07-13","objectID":"/matplotlib%E4%BD%BF%E7%94%A8/:2:0","tags":["python","matplotlib"],"title":"Matplotlibä½¿ç”¨","uri":"/matplotlib%E4%BD%BF%E7%94%A8/"},{"categories":["c/cpp"],"content":"ä¸€ã€string.hä¸­å­—ç¬¦ä¸²å¤„ç†å‡½æ•° åœ¨å¤´æ–‡ä»¶\u003cstring.h\u003eä¸­å®šä¹‰äº†ä¸¤ç»„å­—ç¬¦ä¸²å‡½æ•°ã€‚ç¬¬ä¸€ç»„å‡½æ•°çš„åå­—ä»¥strå¼€å¤´ï¼›ç¬¬äºŒç»„å‡½æ•°çš„åå­—ä»¥memå¼€å¤´ã€‚ åªæœ‰å‡½æ•°memmoveå¯¹é‡å å¯¹è±¡é—´çš„æ‹·è´è¿›è¡Œäº†å®šä¹‰ï¼Œè€Œå…¶ä»–å‡½æ•°éƒ½æœªå®šä¹‰ã€‚æ¯”è¾ƒç±»å‡½æ•°å°†å…¶å˜é‡è§†ä¸ºunsigned charç±»å‹çš„æ•°ç»„ã€‚ 1 strcpy #include \u003cstring.h\u003e char *strcpy(char *str1, const char *str2); æŠŠå­—ç¬¦ä¸²str2(åŒ…æ‹¬â€™\\0â€™)æ‹·è´åˆ°å­—ç¬¦ä¸²str1å½“ä¸­ï¼Œå¹¶è¿”å›str1ã€‚ 2 strncpy #include \u003cstring.h\u003e char *strncpy(char *str1, const char *str2, size_t count); æŠŠå­—ç¬¦ä¸²str2ä¸­æœ€å¤šcountä¸ªå­—ç¬¦æ‹·è´åˆ°å­—ç¬¦ä¸²str1ä¸­ï¼Œå¹¶è¿”å›str1ã€‚å¦‚æœstr2ä¸­å°‘äºcountä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆå°±ç”¨â€™\\0â€™æ¥å¡«å……ï¼Œç›´åˆ°æ»¡è¶³countä¸ªå­—ç¬¦ä¸ºæ­¢ã€‚ 3 strcat #include \u003cstring.h\u003e char *strcat(char *str1, const char *str2); æŠŠstr2(åŒ…æ‹¬â€™\\0â€™)æ‹·è´åˆ°str1çš„å°¾éƒ¨(è¿æ¥)ï¼Œå¹¶è¿”å›str1ã€‚å…¶ä¸­ç»ˆæ­¢åŸstr1çš„â€™\\0â€™è¢«str2çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è¦†ç›–ã€‚ 4 strncat #include \u003cstring.h\u003e char *strncat(char *str1, const char *str2, size_t count); æŠŠstr2ä¸­æœ€å¤šcountä¸ªå­—ç¬¦è¿æ¥åˆ°str1çš„å°¾éƒ¨ï¼Œå¹¶ä»¥â€™\\0â€™ç»ˆæ­¢str1ï¼Œè¿”å›str1ã€‚å…¶ä¸­ç»ˆæ­¢åŸstr1çš„â€™\\0â€™è¢«str2çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è¦†ç›–ã€‚ æ³¨æ„ï¼Œæœ€å¤§æ‹·è´å­—ç¬¦æ•°æ˜¯count+1ã€‚ 5 strcmp #include \u003cstring.h\u003e int strcmp(const char *str1, const char *str2); æŒ‰å­—å…¸é¡ºåºæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œè¿”å›æ•´æ•°å€¼çš„æ„ä¹‰å¦‚ä¸‹ï¼š å°äº0ï¼Œstr1å°äºstr2ï¼› ç­‰äº0ï¼Œstr1ç­‰äºstr2ï¼› å¤§äº0ï¼Œstr1å¤§äºstr2ï¼› 6 strncmp #include \u003cstring.h\u003e int strncmp(const char *str1, const char *str2, size_t count); åŒstrcmpï¼Œé™¤äº†æœ€å¤šæ¯”è¾ƒcountä¸ªå­—ç¬¦ã€‚æ ¹æ®æ¯”è¾ƒç»“æœè¿”å›çš„æ•´æ•°å€¼å¦‚ä¸‹ï¼š å°äº0ï¼Œstr1å°äºstr2ï¼› ç­‰äº0ï¼Œstr1ç­‰äºstr2ï¼› å¤§äº0ï¼Œstr1å¤§äºstr2ï¼› 7 strchr #include \u003cstring.h\u003e char *strchr(const char *str, int ch); è¿”å›æŒ‡å‘å­—ç¬¦ä¸²strä¸­å­—ç¬¦chç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®çš„æŒ‡é’ˆï¼Œå¦‚æœsträ¸­ä¸åŒ…å«chï¼Œåˆ™è¿”å›NULLã€‚ 8 strrchr #include \u003cstring.h\u003e char *strrchr(const char *str, int ch); è¿”å›æŒ‡å‘å­—ç¬¦ä¸²strä¸­å­—ç¬¦chæœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®çš„æŒ‡é’ˆï¼Œå¦‚æœsträ¸­ä¸åŒ…å«chï¼Œåˆ™è¿”å›NULLã€‚ 9 strspn #include \u003cstring.h\u003e size_t strspn(const char *str1, const char *str2); è¿”å›å­—ç¬¦ä¸²str1ä¸­ç”±å­—ç¬¦ä¸²str2ä¸­å­—ç¬¦æ„æˆçš„ç¬¬ä¸€ä¸ªå­ä¸²çš„é•¿åº¦ã€‚ 10 strcspn #include \u003cstring.h\u003e size_t strcspn(const char *str1, const char *str2); è¿”å›å­—ç¬¦ä¸²str1ä¸­ç”±ä¸åœ¨å­—ç¬¦ä¸²str2ä¸­å­—ç¬¦æ„æˆçš„ç¬¬ä¸€ä¸ªå­ä¸²çš„é•¿åº¦ã€‚ 11 strpbrk #include \u003cstring.h\u003e char *strpbrk(const char *str1, const char *str2); è¿”å›æŒ‡å‘å­—ç¬¦ä¸²str2ä¸­çš„ä»»æ„å­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°åœ¨å­—ç¬¦ä¸²str1ä¸­çš„ä½ç½®çš„æŒ‡é’ˆï¼›å¦‚æœstr1ä¸­æ²¡æœ‰ä¸str2ç›¸åŒçš„å­—ç¬¦ï¼Œé‚£ä¹ˆè¿”å›NULLã€‚ 12 strstr #include \u003cstring.h\u003e char *strstr(const char *str1, const char *str2); è¿”å›æŒ‡å‘å­—ç¬¦ä¸²str2ç¬¬ä¸€æ¬¡å‡ºç°åœ¨å­—ç¬¦ä¸²str1ä¸­çš„ä½ç½®çš„æŒ‡é’ˆï¼›å¦‚æœstr1ä¸­ä¸åŒ…å«str2ï¼Œåˆ™è¿”å›NULLã€‚ 13 strlen #include \u003cstring.h\u003e size_t strlen(const char *str); è¿”å›å­—ç¬¦ä¸²strçš„é•¿åº¦ï¼Œâ€™\\0â€™ä¸ç®—åœ¨å†…ã€‚ 14 strerror #include \u003cstring.h\u003e char *strerror(int errnum); è¿”å›æŒ‡å‘ä¸é”™è¯¯åºå·errnumå¯¹åº”çš„é”™è¯¯ä¿¡æ¯å­—ç¬¦ä¸²çš„æŒ‡é’ˆ(é”™è¯¯ä¿¡æ¯çš„å…·ä½“å†…å®¹ä¾èµ–äºå®ç°)ã€‚ 15 strtok #include \u003cstring.h\u003e char *strtok(char *str1, const char *str2); åœ¨str1ä¸­æœç´¢ç”±str2ä¸­çš„åˆ†ç•Œç¬¦ç•Œå®šçš„å•è¯ã€‚ å¯¹strtok()çš„ä¸€ç³»åˆ—è°ƒç”¨å°†æŠŠå­—ç¬¦ä¸²str1åˆ†æˆè®¸å¤šå•è¯ï¼Œè¿™äº›å•è¯ä»¥str2ä¸­çš„å­—ç¬¦ä¸ºåˆ†ç•Œç¬¦ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶str1éç©ºï¼Œå®ƒæœç´¢str1ï¼Œæ‰¾å‡ºç”±éstr2ä¸­çš„å­—ç¬¦ç»„æˆçš„ç¬¬ä¸€ä¸ªå•è¯ï¼Œå°†str1ä¸­çš„ä¸‹ä¸€ä¸ªå­—ç¬¦æ›¿æ¢ä¸ºâ€™\\0â€™ï¼Œå¹¶è¿”å›æŒ‡å‘å•è¯çš„æŒ‡é’ˆã€‚éšåçš„æ¯æ¬¡strtok()è°ƒç”¨(å‚æ•°str1ç”¨NULLä»£æ›¿)ï¼Œå‡ä»å‰ä¸€æ¬¡ç»“æŸçš„ä½ç½®ä¹‹åå¼€å§‹ï¼Œè¿”å›ä¸‹ä¸€ä¸ªç”±éstr2ä¸­çš„å­—ç¬¦ç»„æˆçš„å•è¯ã€‚å½“str1ä¸­æ²¡æœ‰è¿™æ ·çš„å•è¯æ—¶è¿”å›NULLã€‚æ¯æ¬¡è°ƒç”¨æ—¶å­—ç¬¦ä¸²str2å¯ä»¥ä¸åŒã€‚ å¦‚ï¼š char *p; p = strtok(\"The summer soldier,the sunshine patriot\", \" \"); printf(\"%s\", p); do { p = strtok(\"\\0\", \", \"); /* æ­¤å¤„str2æ˜¯é€—å·å’Œç©ºæ ¼ */ if (p) printf(\"|%s\", p); } while (p); æ˜¾ç¤ºç»“æœæ˜¯ï¼šThe | summer | soldier | the | sunshine | patriot 16 memcpy #include \u003cstring.h\u003e void *memcpy(void *to, const void *from, size_t count); æŠŠfromä¸­çš„countä¸ªå­—ç¬¦æ‹·è´åˆ°toä¸­ã€‚å¹¶è¿”å›toã€‚ 17 memmove #include \u003cstring.h\u003e void *memmove(void *to, const void *from, size_t count); åŠŸèƒ½ä¸memcpyç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œå½“å‘ç”Ÿå¯¹è±¡é‡å æ—¶ï¼Œå‡½æ•°ä»èƒ½æ­£ç¡®æ‰§è¡Œã€‚ 18 memcmp #include \u003cstring.h\u003e int memcmp(const void *buf1, const void *buf2, size_t count); æ¯”è¾ƒbuf1å’Œbuf2çš„å‰countä¸ªå­—ç¬¦ï¼Œè¿”å›å€¼ä¸strcmpçš„è¿”å›å€¼ç›¸åŒã€‚ 19 memchr #include \u003cstring.h\u003e void *memchr(const void *buffer, int ch, size_t count); è¿”å›æŒ‡å‘chåœ¨bufferä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®æŒ‡é’ˆï¼Œå¦‚æœåœ¨bufferçš„å‰countä¸ªå­—ç¬¦å½“ä¸­æ‰¾ä¸åˆ°åŒ¹é…ï¼Œåˆ™è¿”å›NULLã€‚ 20 memset #include \u003cstring.h\u003e void *memset(void *buf, int ch, size_t count); æŠŠbufä¸­çš„å‰countä¸ªå­—ç¬¦æ›¿æ¢ä¸ºchï¼Œå¹¶è¿”å›buf ","date":"2023-07-09","objectID":"/c%E8%AF%AD%E8%A8%80%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/:0:0","tags":["c/c++"],"title":"Cè¯­è¨€å¸¸ç”¨å‡½æ•°","uri":"/c%E8%AF%AD%E8%A8%80%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/"},{"categories":["c/cpp"],"content":"example #include \"malloc.h\" #include \"stdint.h\" #include \"stdio.h\" #include \"stdlib.h\" #include \"string.h\" #include \u003cstdlib.h\u003e #include \u003cstring.h\u003e int main() { // malloc and memset and strlen usage char *s = (char *)malloc(sizeof(char) * 10); printf(\"origin strlen(s): %llu\\n\", strlen(s)); memset(s, 'i', 12); printf(\"after memset, strlen(s): %llu\\n\", strlen(s)); int *i = (int *)malloc(sizeof(int) * 10); printf(\"sizeof(i): %llu\\n\", sizeof(i)); // strcpy usage char *s1 = (char *)malloc(sizeof(char) * 10); char s2[] = {\"hello\"}; printf(\"strlen(s1): %llu\\n\", strlen(s1)); printf(\"sizeof(s1): %llu\\n\", sizeof(s1)); printf(\"strlen(s2): %llu\\n\", strlen(s2)); printf(\"sizeof(s2): %llu\\n\", sizeof(s2)); strcpy_s(s1, strlen(s2) + 1, s2); // strncpy_s(s1, strlen(s2)+1, s2, 3); printf(\"s1=%s\\n\", s1); printf(\"*****************************\\n\"); char s3[] = {\"world\"}; // strstr return pointer char *p = strstr(s3, \"ld\"); printf(\"p=%s\\n\", p); // calculate the offset printf(\"%lld\\n\", p-s3); p = strchr(s3, 'o'); printf(\"strchr p=%s\\n\", p); printf(\"strchr offset:%lld\\n\", p-s3); p = strrchr(s3, 'l'); printf(\"strrchr p=%s\\n\", p); printf(\"strrchr offset:%lld\\n\", p-s3); p = strtok(s3, \"or\"); while (p) { printf(\"strtok p=%s\\n\", p); p = strtok(NULL, \"or\"); } printf(\"after strtok, s3=%s\\n\", s3); int a = strcmp(s3, \"world\"); printf(\"strcmp a=%d\\n\", a); a = strncmp(s3, \"world\", 1); printf(\"strncmp a=%d\\n\", a); char s4[] = {\"hello\"}; memmove(s4+1, s4, 1); printf(\"memmove s4=%s\\n\", s4); memcpy(s4, \"hello\", 5); printf(\"memccpy s4=%s\\n\", s4); return 0; } // output: // origin strlen(s): 6 // after memset, strlen(s): 14 // sizeof(i): 8 // strlen(s1): 6 // sizeof(s1): 8 // strlen(s2): 5 // sizeof(s2): 6 // s1=hello // ***************************** // p=ld // 3 // strchr p=orld // strchr offset:1 // strrchr p=ld // strrchr offset:3 // strtok p=w // strtok p=ld // after strtok, s3=w // strcmp a=-1 // strncmp a=0 // memmove s4=hhllo // memccpy s4=hello äºŒã€stdlib.hä¸­å­—ç¬¦ä¸²ä¸æ•°å­—ç›¸äº’è½¬æ¢å¤„ç†å‡½æ•° 1. æ•°å­—è½¬åŒ–ä¸ºå­—ç¬¦ä¸²: â— itoa()ï¼šå°†æ•´å‹å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ â— ltoa()ï¼šå°†é•¿æ•´å‹å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ â— ultoa()ï¼šå°†æ— ç¬¦å·é•¿æ•´å‹å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ â— gcvt()ï¼šå°†æµ®ç‚¹å‹æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå–å››èˆäº”å…¥ã€‚ â— ecvt()ï¼šå°†åŒç²¾åº¦æµ®ç‚¹å‹å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè½¬æ¢ç»“æœä¸­ä¸åŒ…å«åè¿›åˆ¶å°æ•°ç‚¹ã€‚ â— fcvt()ï¼šæŒ‡å®šä½æ•°ä¸ºè½¬æ¢ç²¾åº¦ï¼Œå…¶ä½™åŒecvt()ã€‚ ä¾‹å­ï¼š # include \u003cstdio.h\u003e # include \u003cstdlib.h\u003e int main () { int num_int = 435; double num_double = 435.10f; char str_int[30]; char str_double[30]; itoa(num_int, str_int, 10); //æŠŠæ•´æ•°num_intè½¬æˆå­—ç¬¦ä¸²str_int gcvt(num_double, 8, str_double); //æŠŠæµ®ç‚¹æ•°num_doubleè½¬æˆå­—ç¬¦ä¸²str_double printf(\"str_int: %s\\n\", str_int); printf(\"str_double: %s\\n\", str_double); return 0; } ç¨‹åºè¾“å‡ºç»“æœï¼š str_int: 435 str_double: 435.10001 ä»£ç ç¬¬11è¡Œä¸­çš„å‚æ•°10è¡¨ç¤ºæŒ‰åè¿›åˆ¶ç±»å‹è¿›è¡Œè½¬æ¢ï¼Œè½¬æ¢åçš„ç»“æœæ˜¯â€œ435â€ï¼Œå¦‚æœæŒ‰äºŒè¿›åˆ¶ç±»å‹è¿›è¡Œè½¬æ¢ï¼Œåˆ™ç»“æœä¸ºâ€œ1101110011â€ã€‚ ä»£ç ç¬¬12è¡Œä¸­çš„å‚æ•°8è¡¨ç¤ºç²¾ç¡®ä½æ•°ï¼Œè¿™é‡Œå¾—åˆ°çš„ç»“æœæ˜¯â€œ435.10001â€ã€‚ 2. å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•°å­— atof()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºåŒç²¾åº¦æµ®ç‚¹å‹å€¼ã€‚ atoi()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´å‹å€¼ã€‚ atol()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºé•¿æ•´å‹å€¼ã€‚ strtod()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºåŒç²¾åº¦æµ®ç‚¹å‹å€¼ï¼Œå¹¶æŠ¥å‘Šä¸èƒ½è¢«è½¬æ¢çš„æ‰€æœ‰å‰©ä½™æ•°å­—ã€‚ strtol()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºé•¿æ•´å€¼ï¼Œå¹¶æŠ¥å‘Šä¸èƒ½è¢«è½¬æ¢çš„æ‰€æœ‰å‰©ä½™æ•°å­—ã€‚ strtoul()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ— ç¬¦å·é•¿æ•´å‹å€¼ï¼Œå¹¶æŠ¥å‘Šä¸èƒ½è¢«è½¬æ¢çš„æ‰€æœ‰å‰©ä½™æ•°å­—ã€‚ ä¾‹å­ï¼š # include \u003cstdio.h\u003e # include \u003cstdlib.h\u003e int main () { int num_int; double num_double; char str_int[30] = \"435\"; //å°†è¦è¢«è½¬æ¢ä¸ºæ•´å‹çš„å­—ç¬¦ä¸² char str_double[30] = \"436.55\"; //å°†è¦è¢«è½¬æ¢ä¸ºæµ®ç‚¹å‹çš„å­—ç¬¦ä¸² num_int = atoi(str_int); //è½¬æ¢ä¸ºæ•´å‹å€¼ num_double = atof(str_double); //è½¬æ¢ä¸ºæµ®ç‚¹å‹å€¼ printf(\"num_int: %d\\n\", num_int); printf(\"num_double: %lf\\n\", num_double); return 0; } // è¾“å‡ºç»“æœï¼š // num_int: 435 // num_double: 436.550000 ","date":"2023-07-09","objectID":"/c%E8%AF%AD%E8%A8%80%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/:1:0","tags":["c/c++"],"title":"Cè¯­è¨€å¸¸ç”¨å‡½æ•°","uri":"/c%E8%AF%AD%E8%A8%80%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/"},{"categories":["c/cpp"],"content":"è¿›åˆ¶äº’è½¬ // int to binary char tmp[10] = {}; char *conv = itoa(5, tmp, 2); printf(\"itoa to 2: conv=%s\\n\", conv); // int to hex conv = itoa(17, tmp, 16); printf(\"itoa to 16: conv=0x%s\\n\", conv); // hex to 10 int hex = strtol(\"0x11\", NULL, 16); printf(\"strtol: hex=%d\\n\", hex); // binary to 10 int bin = strtol(\"101\", NULL, 2); printf(\"strtol: bin=%d\\n\", bin); // output // itoa to 2: conv=101 // itoa to 16: conv=0x11 // strtol: hex=17 // strtol: bin=5? ","date":"2023-07-09","objectID":"/c%E8%AF%AD%E8%A8%80%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/:2:0","tags":["c/c++"],"title":"Cè¯­è¨€å¸¸ç”¨å‡½æ•°","uri":"/c%E8%AF%AD%E8%A8%80%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/"},{"categories":["python"],"content":"ä»‹ç» å¼‚æ­¥IOï¼šå°±æ˜¯å‘èµ·ä¸€ä¸ªIOæ“ä½œï¼ˆå¦‚ï¼šç½‘ç»œè¯·æ±‚ï¼Œæ–‡ä»¶è¯»å†™ç­‰ï¼‰ï¼Œè¿™äº›æ“ä½œä¸€èˆ¬æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œä¸ç”¨ç­‰å¾…å®ƒç»“æŸï¼Œå¯ä»¥ç»§ç»­åšå…¶ä»–äº‹æƒ…ï¼Œç»“æŸæ—¶ä¼šå‘æ¥é€šçŸ¥ã€‚ åç¨‹ï¼šåˆç§°ä¸ºå¾®çº¿ç¨‹ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæ‰§è¡Œå‡½æ•°æ—¶å¯ä»¥éšæ—¶ä¸­æ–­ï¼Œç”±ç¨‹åºï¼ˆç”¨æˆ·ï¼‰è‡ªèº«æ§åˆ¶ï¼Œæ‰§è¡Œæ•ˆç‡æé«˜ï¼Œä¸å¤šçº¿ç¨‹æ¯”è¾ƒï¼Œæ²¡æœ‰åˆ‡æ¢çº¿ç¨‹çš„å¼€é”€å’Œå¤šçº¿ç¨‹é”æœºåˆ¶ã€‚ ","date":"2023-05-28","objectID":"/asyncio%E4%BD%BF%E7%94%A8/:0:0","tags":["async"],"title":"Asyncioä½¿ç”¨","uri":"/asyncio%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"asyncioä¸­å‡ ä¸ªé‡è¦æ¦‚å¿µ ","date":"2023-05-28","objectID":"/asyncio%E4%BD%BF%E7%94%A8/:1:0","tags":["async"],"title":"Asyncioä½¿ç”¨","uri":"/asyncio%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"1.äº‹ä»¶å¾ªç¯ äº‹ä»¶å¾ªç¯æ˜¯æ¯ä¸ª asyncio åº”ç”¨çš„æ ¸å¿ƒï¼Œç®¡ç†æ‰€æœ‰çš„äº‹ä»¶ï¼Œåœ¨æ•´ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¸æ–­å¾ªç¯æ‰§è¡Œå¹¶è¿½è¸ªäº‹ä»¶å‘ç”Ÿçš„é¡ºåºå°†å®ƒä»¬æ”¾åœ¨é˜Ÿåˆ—ä¸­ï¼Œç©ºé—²æ—¶è°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†è€…æ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚ åˆ›å»ºäº‹ä»¶å¾ªç¯ loop = asyncio.get_event_loop() è·å–å½“å‰äº‹ä»¶å¾ªç¯ã€‚ å¦‚æœå½“å‰ OS çº¿ç¨‹æ²¡æœ‰è®¾ç½®å½“å‰äº‹ä»¶å¾ªç¯å¹¶ä¸” set_event_loop() è¿˜æ²¡æœ‰è¢«è°ƒç”¨ï¼Œasyncio å°†åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¾ªç¯å¹¶å°†å…¶è®¾ç½®ä¸ºå½“å‰å¾ªç¯ã€‚ å¦èµ·ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºäº‹ä»¶å¾ªç¯ from threading import Thread import asyncio def start_thread_loop(loop): asyncio.set_event_loop(loop) loop.run_forever() new_loop = asyncio.new_event_loop() loop_thread = Thread(target=start_thread_loop, args=(new_loop,)) loop_thread.setDaemon(True) # å®ˆæŠ¤çº¿ç¨‹ loop_thread.start() ","date":"2023-05-28","objectID":"/asyncio%E4%BD%BF%E7%94%A8/:1:1","tags":["async"],"title":"Asyncioä½¿ç”¨","uri":"/asyncio%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"2.Future Futureå¯¹è±¡è¡¨ç¤ºå°šæœªå®Œæˆçš„è®¡ç®—ï¼Œè¿˜æœªå®Œæˆçš„ç»“æœï¼Œå®ƒå’Œtaskä¸Šæ²¡æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ« ","date":"2023-05-28","objectID":"/asyncio%E4%BD%BF%E7%94%A8/:1:2","tags":["async"],"title":"Asyncioä½¿ç”¨","uri":"/asyncio%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"3.Task æ˜¯Futureçš„å­ç±»ï¼Œä½œç”¨æ˜¯åœ¨è¿è¡ŒæŸä¸ªä»»åŠ¡çš„åŒæ—¶å¯ä»¥å¹¶å‘çš„è¿è¡Œå¤šä¸ªä»»åŠ¡ã€‚ asyncio.Taskç”¨äºå®ç°åä½œå¼å¤šä»»åŠ¡çš„åº“ï¼Œä¸”Taskå¯¹è±¡ä¸èƒ½ç”¨æˆ·æ‰‹åŠ¨å®ä¾‹åŒ–ï¼Œé€šè¿‡ä¸‹é¢2ä¸ªå‡½æ•°åˆ›å»ºï¼š loop.create_task() æˆ– asyncio.ensure_future() loop.create_task() ,è¦åœ¨å®šä¹‰loopå¯¹è±¡ä¹‹åï¼Œè°ƒç”¨å°†æ–¹æ³•å¯¹è±¡è½¬åŒ–æˆäº†taskçš„å¯¹è±¡ asyncio.ensure_future() ç›´æ¥è°ƒç”¨asyncio çš„ensure_future() æ–¹æ³•ï¼Œè¿”å›çš„ä¹Ÿæ˜¯task å¯¹è±¡ï¼ˆæˆ‘ä»¬è¿˜æ²¡æœ‰å£°æ˜ loop ä¹Ÿå¯ä»¥æå‰å®šä¹‰å¥½ task å¯¹è±¡ï¼‰ ","date":"2023-05-28","objectID":"/asyncio%E4%BD%BF%E7%94%A8/:1:3","tags":["async"],"title":"Asyncioä½¿ç”¨","uri":"/asyncio%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"4.async/await å…³é”®å­— asyncioå®ç°äº†TCPã€UDPã€SSLç­‰åè®®ï¼Œasyncå®šä¹‰ä¸€ä¸ªåç¨‹ï¼Œawaitç”¨äºæŒ‚èµ·é˜»å¡çš„å¼‚æ­¥è°ƒç”¨æ¥å£ã€‚ å¯¹äºå¼‚æ­¥ioä½ éœ€è¦çŸ¥é“çš„é‡ç‚¹ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œawaitè¯­æ³•åªèƒ½å‡ºç°åœ¨é€šè¿‡asyncä¿®é¥°çš„å‡½æ•°ä¸­ï¼Œå¦åˆ™ä¼šæŠ¥SyntaxErroré”™è¯¯ã€‚è€Œä¸”awaitåé¢çš„å¯¹è±¡éœ€è¦æ˜¯ä¸€ä¸ªAwaitableï¼Œæˆ–è€…å®ç°äº†ç›¸å…³çš„åè®®ã€‚ æ³¨æ„ 1. æ‰€æœ‰éœ€è¦å¼‚æ­¥æ‰§è¡Œçš„å‡½æ•°ï¼Œéƒ½éœ€è¦asyncioä¸­çš„è½®è¯¢å™¨å»è½®è¯¢æ‰§è¡Œï¼Œå¦‚æœå‡½æ•°é˜»å¡ï¼Œè½®è¯¢å™¨å°±ä¼šå»æ‰§è¡Œä¸‹ä¸€ä¸ªå‡½æ•°ã€‚æ‰€ä»¥æ‰€æœ‰éœ€è¦å¼‚æ­¥æ‰§è¡Œçš„å‡½æ•°éƒ½éœ€è¦åŠ å…¥åˆ°è¿™ä¸ªè½®è¯¢å™¨ä¸­ã€‚è‹¥åœ¨åç¨‹ä¸­éœ€è¦æœ‰å»¶æ—¶æ“ä½œï¼Œåº”è¯¥ä½¿ç”¨ await asyncio.sleep()ï¼Œè€Œä¸æ˜¯ä½¿ç”¨time.sleep()ï¼Œå› ä¸ºä½¿ç”¨time.sleep()åä¼šé‡Šæ”¾GILï¼Œé˜»å¡æ•´ä¸ªä¸»çº¿ç¨‹ï¼Œä»è€Œé˜»å¡æ•´ä¸ªäº‹ä»¶å¾ªç¯ã€‚ åˆ›å»ºä¸€ä¸ªåç¨‹ ä½¿ç”¨asyncå¯ä»¥å®šä¹‰åç¨‹å¯¹è±¡ï¼Œä½¿ç”¨awaitå¯ä»¥é’ˆå¯¹è€—æ—¶çš„æ“ä½œè¿›è¡ŒæŒ‚èµ·ï¼Œå°±åƒç”Ÿæˆå™¨é‡Œçš„yieldä¸€æ ·ï¼Œå‡½æ•°è®©å‡ºæ§åˆ¶æƒã€‚åç¨‹é‡åˆ°awaitï¼Œäº‹ä»¶å¾ªç¯å°†ä¼šæŒ‚èµ·è¯¥åç¨‹ï¼Œæ‰§è¡Œåˆ«çš„åç¨‹ï¼Œç›´åˆ°å…¶ä»–çš„åç¨‹ä¹ŸæŒ‚èµ·æˆ–è€…æ‰§è¡Œå®Œæ¯•ï¼Œå†è¿›è¡Œä¸‹ä¸€ä¸ªåç¨‹çš„æ‰§è¡Œ è€—æ—¶çš„æ“ä½œä¸€èˆ¬æ˜¯ä¸€äº›IOæ“ä½œï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚ï¼Œæ–‡ä»¶è¯»å–ç­‰ã€‚æˆ‘ä»¬ä½¿ç”¨asyncio.sleepå‡½æ•°æ¥æ¨¡æ‹ŸIOæ“ä½œã€‚åç¨‹çš„ç›®çš„ä¹Ÿæ˜¯è®©è¿™äº›IOæ“ä½œå¼‚æ­¥åŒ–ã€‚ ","date":"2023-05-28","objectID":"/asyncio%E4%BD%BF%E7%94%A8/:1:4","tags":["async"],"title":"Asyncioä½¿ç”¨","uri":"/asyncio%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"ç®€å•ä¾‹å­ import asyncio from asyncio import tasks from asyncore import loop async def main(): await asyncio.sleep(2) print('this is main running') async def add_log(): await asyncio.sleep(1) print('add log before running') async def run_background(): await asyncio.sleep(3) print('running task in background') async def parameter_verification(): await asyncio.sleep(1) print('parameter verification before running') if __name__ == '__main__': # running async function method: # first method: tasks = asyncio.wait([main(), add_log(), run_background(), parameter_verification()]) # the sequence of the tasks is not the same as the sequence of the function calling, and the same as define sequence result = asyncio.run(tasks) print(result) print(f'{\"*\" * 20}{\"another method\"}{\"*\" * 20}') # second method: tasks = asyncio.wait([main(), add_log(), run_background(), parameter_verification()]) loop = asyncio.get_event_loop() result = loop.run_until_complete(tasks) print(result) é¦–å…ˆæˆ‘ä»¬å¼•å…¥äº† asyncio è¿™ä¸ªåŒ…ï¼Œè¿™æ ·æˆ‘ä»¬æ‰å¯ä»¥ä½¿ç”¨ async å’Œ awaitï¼Œç„¶åæˆ‘ä»¬ä½¿ç”¨ async å®šä¹‰äº†ä¸€ä¸ª execute() æ–¹æ³•ï¼Œæ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ•°å­—å‚æ•°ï¼Œæ–¹æ³•æ‰§è¡Œä¹‹åä¼šæ‰“å°è¿™ä¸ªæ•°å­—ã€‚ éšåæˆ‘ä»¬ç›´æ¥è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œç„¶è€Œè¿™ä¸ªæ–¹æ³•å¹¶æ²¡æœ‰æ‰§è¡Œï¼Œè€Œæ˜¯è¿”å›äº†ä¸€ä¸ª coroutine åç¨‹å¯¹è±¡ã€‚éšåæˆ‘ä»¬ä½¿ç”¨ get_event_loop() æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªäº‹ä»¶å¾ªç¯ loopï¼Œå¹¶è°ƒç”¨äº† loop å¯¹è±¡çš„ run_until_complete() æ–¹æ³•å°†åç¨‹æ³¨å†Œåˆ°äº‹ä»¶å¾ªç¯ loop ä¸­ï¼Œç„¶åå¯åŠ¨ã€‚æœ€åæˆ‘ä»¬æ‰çœ‹åˆ°äº† execute() æ–¹æ³•æ‰“å°äº†è¾“å‡ºç»“æœã€‚ å¯è§ï¼Œasync å®šä¹‰çš„æ–¹æ³•å°±ä¼šå˜æˆä¸€ä¸ªæ— æ³•ç›´æ¥æ‰§è¡Œçš„ coroutine å¯¹è±¡ï¼Œå¿…é¡»å°†å…¶æ³¨å†Œåˆ°äº‹ä»¶å¾ªç¯ä¸­æ‰å¯ä»¥æ‰§è¡Œã€‚ ","date":"2023-05-28","objectID":"/asyncio%E4%BD%BF%E7%94%A8/:2:0","tags":["async"],"title":"Asyncioä½¿ç”¨","uri":"/asyncio%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"è¿›é˜¶ä¾‹å­ å¤šä¸ªä»»åŠ¡ï¼Œå®šä¹‰ä¸€ä¸ªtaskåˆ—è¡¨ï¼Œä½¿ç”¨asyncio.gather(*tasks) æˆ– asyncio.wait(tasks) æ¥æ”¶ import asyncio import time now = lambda: time.time() \"\"\" asyncio.gatherä¸»è¦é›†ä¸­åœ¨æ”¶é›†ç»“æœä¸Šã€‚å®ƒç­‰å¾…ä¸€å †taskå¹¶æŒ‰ç»™å®šçš„é¡ºåºè¿”å›ç»“æœã€‚ asyncio.waitç­‰å¾…taskã€‚è€Œä¸æ˜¯ç›´æ¥ç»™ä½ ç»“æœï¼Œå®ƒæä¾›å®Œæˆå’Œå¾…å¤„ç†çš„ä»»åŠ¡ã€‚ä½ å¿…é¡»æ‰‹å·¥æ”¶é›†ç»“æœã€‚ asyncio.wait(tasks) ps:asyncio.wait([1,2,3]) ä¹Ÿå¯ä»¥ä½¿ç”¨ asyncio.gather(*tasks) ps: asyncio.gather(1,2,3),å‰è€…æ¥å—ä¸€ä¸ªtaskåˆ—è¡¨ï¼Œåè€…æ¥æ”¶ä¸€å †taskã€‚ \"\"\" # å®šä¹‰ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ async def do_some_work(x): print(\"waiting:\", x) # æ¨¡æ‹Ÿioé˜»å¡ await asyncio.sleep(x) return \"Done after {}s\".format(x) async def main(loop): \"\"\" :param loop: loop.create_taskï¼ˆéœ€è¦ä¼ è¿›loopå‚æ•°ï¼‰ :return: None \"\"\" coroutine1 = do_some_work(1) coroutine2 = do_some_work(2) coroutine3 = do_some_work(4) # asyncio.ensure_future tasks = [ asyncio.ensure_future(coroutine1), asyncio.ensure_future(coroutine2), asyncio.ensure_future(coroutine3) ] # loop.create_taskï¼ˆéœ€è¦ä¼ è¿›loopå‚æ•°ï¼‰ # tasks = [ # loop.create_task(coroutine1), # loop.create_task(coroutine2), # loop.create_task(coroutine3) # ] # è¿”å› å®Œæˆçš„ task object dones, pendings = await asyncio.wait(tasks) print(dones, pendings) for task in dones: print(\"Task ret:\", task.result()) # è¿”å› task æ–¹æ³•çš„ è¿”å›å€¼ # results = await asyncio.gather(*tasks) # for result in results: # print(\"Task ret:\",result) start = now() loop = asyncio.get_event_loop() loop.run_until_complete(main(loop)) print(\"Time:\", now() - start) gatherå’Œwait çš„åŒºåˆ« æŠŠå¤šä¸ªåç¨‹æ³¨å†Œè¿›ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­çš„ä¸¤ç§æ–¹æ³• ","date":"2023-05-28","objectID":"/asyncio%E4%BD%BF%E7%94%A8/:3:0","tags":["async"],"title":"Asyncioä½¿ç”¨","uri":"/asyncio%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"ä½¿ç”¨æ–¹å¼åŒºåˆ« ä½¿ç”¨asyncio.wait() loop = asyncio.get_event_loop() loop.run_until_complete(asyncio.wait(tasks)) ä½¿ç”¨asyncio.gather() loop = asyncio.get_event_loop() loop.run_until_complete(asyncio.gather(*tasks)) # *æ¥æ”¶argså‚æ•° ","date":"2023-05-28","objectID":"/asyncio%E4%BD%BF%E7%94%A8/:4:0","tags":["async"],"title":"Asyncioä½¿ç”¨","uri":"/asyncio%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"æ¥æ”¶å‚æ•°åŒºåˆ« ","date":"2023-05-28","objectID":"/asyncio%E4%BD%BF%E7%94%A8/:5:0","tags":["async"],"title":"Asyncioä½¿ç”¨","uri":"/asyncio%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"asyncio.wait å‚æ•°å¿…é¡»æ˜¯listå¯¹è±¡ ï¼Œlist å¯¹è±¡å­˜æ”¾å¤šä¸ª task object ç”¨asyncio.ensure_futureè½¬ä¸ºtaskå¯¹è±¡ tasks=[ asyncio.ensure_future(coroutine1), asyncio.ensure_future(coroutine2), asyncio.ensure_future(coroutine3) ] loop = asyncio.get_event_loop() loop.run_until_complete(asyncio.wait(tasks)) ä¸è½¬ä¸ºtaskå¯¹è±¡ loop = asyncio.get_event_loop() tasks=[ coroutine1, coroutine2, coroutine3 ] loop.run_until_complete(asyncio.wait(tasks)) ","date":"2023-05-28","objectID":"/asyncio%E4%BD%BF%E7%94%A8/:5:1","tags":["async"],"title":"Asyncioä½¿ç”¨","uri":"/asyncio%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"asyncio.gather å¿…é¡»ç”¨ * æ¥æ¥æ”¶ list å¯¹è±¡ tasks=[ asyncio.ensure_future(coroutine1), asyncio.ensure_future(coroutine2), asyncio.ensure_future(coroutine3) ] loop = asyncio.get_event_loop() loop.run_until_complete(asyncio.gather(*tasks)) ","date":"2023-05-28","objectID":"/asyncio%E4%BD%BF%E7%94%A8/:5:2","tags":["async"],"title":"Asyncioä½¿ç”¨","uri":"/asyncio%E4%BD%BF%E7%94%A8/"},{"categories":["python"],"content":"è¿”å›ç»“æœåŒºåˆ« asyncio.wait asyncio.waitè¿”å›doneså’Œpendings donesï¼šè¡¨ç¤ºå·²ç»å®Œæˆçš„ä»»åŠ¡ pendingsï¼šè¡¨ç¤ºæœªå®Œæˆçš„ä»»åŠ¡ æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å»è·å–ç»“æœ dones, pendings = await asyncio.wait(tasks) print(dones, pendings) for task in dones: print(\"Task ret:\", task.result()) asyncio.gather å®ƒçš„è¿”å›å€¼å°±æ˜¯ returnçš„ç»“æœ ï¼Œä¸ç”¨å†task.result() æ¥è·å– # è¿”å› task æ–¹æ³•çš„ è¿”å›å€¼ results = await asyncio.gather(*tasks) for result in results: print(\"Task ret:\",result) å¦ asyncio.wait å¸¦æœ‰æ§åˆ¶åŠŸèƒ½ ã€æ§åˆ¶è¿è¡Œä»»åŠ¡æ•°ã€‘ï¼šè¿è¡Œç¬¬ä¸€ä¸ªä»»åŠ¡å°±è¿”å› FIRST_COMPLETED ï¼šç¬¬ä¸€ä¸ªä»»åŠ¡å®Œå…¨è¿”å› FIRST_EXCEPTIONï¼šäº§ç”Ÿç¬¬ä¸€ä¸ªå¼‚å¸¸è¿”å› ALL_COMPLETEDï¼šæ‰€æœ‰ä»»åŠ¡å®Œæˆè¿”å› ï¼ˆé»˜è®¤é€‰é¡¹ï¼‰ import asyncio import random async def coro(tag): print(\"\u003e\", tag) await asyncio.sleep(random.uniform(0.5, 5)) print(\"\u003c\", tag) return tag loop = asyncio.get_event_loop() tasks = [coro(i) for i in range(1, 11)] # ç¬¬ä¸€æ¬¡wait å®Œæˆæƒ…å†µ print(\"Get first result:\") finished, unfinished = loop.run_until_complete( asyncio.wait(tasks, return_when=asyncio.FIRST_COMPLETED)) # ç¬¬ä¸€ä¸ªä»»åŠ¡å®Œå…¨è¿”å› for task in finished: print(task.result()) print(\"unfinished:\", len(unfinished)) # ç»§ç»­ç¬¬ä¸€æ¬¡æœªå®Œæˆä»»åŠ¡ print(\"Get more results in 2 seconds:\") finished2, unfinished2 = loop.run_until_complete( asyncio.wait(unfinished, timeout=2)) # è¶…æ—¶2s è¿”å› for task in finished2: print(task.result()) print(\"unfinished2:\", len(unfinished2)) # ç»§ç»­ç¬¬2æ¬¡æœªå®Œæˆä»»åŠ¡ print(\"Get all other results:\") finished3, unfinished3 = loop.run_until_complete(asyncio.wait(unfinished2)) # ALL_COMPLETEDï¼šæ‰€æœ‰ä»»åŠ¡å®Œæˆè¿”å› ï¼ˆé»˜è®¤é¡¹ï¼‰ for task in finished3: print(task.result()) loop.close() åŠ¨æ€æ·»åŠ åç¨‹ å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬çš„äº‹ä»¶å¾ªç¯ç”¨äºæ³¨å†Œåç¨‹ï¼Œè€Œæœ‰çš„åç¨‹éœ€è¦åŠ¨æ€çš„æ·»åŠ åˆ°äº‹ä»¶å¾ªç¯ä¸­ã€‚ä¸€ä¸ªç®€å•çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹ã€‚å½“å‰çº¿ç¨‹åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œç„¶ååœ¨æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨æ–°çº¿ç¨‹ä¸­å¯åŠ¨äº‹ä»¶å¾ªç¯ã€‚å½“å‰çº¿ç¨‹ä¸ä¼šè¢«block ç›¸å…³å‡½æ•°ä»‹ç»ï¼š loop.call_soon_threadsafe() ï¼šä¸ call_soon()ç±»ä¼¼ï¼Œç­‰å¾…æ­¤å‡½æ•°è¿”å›åé©¬ä¸Šè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ª asyncio.Handle å¯¹è±¡ï¼Œæ­¤å¯¹è±¡å†…åªæœ‰ä¸€ä¸ªæ–¹æ³•ä¸º cancel()æ–¹æ³•ï¼Œç”¨æ¥å–æ¶ˆå›è°ƒå‡½æ•°ã€‚ loop.call_soon() ï¼š ä¸call_soon_threadsafe()ç±»ä¼¼ï¼Œcall_soon_threadsafe() æ˜¯çº¿ç¨‹å®‰å…¨çš„ loop.call_later()ï¼šå»¶è¿Ÿå¤šå°‘ç§’åæ‰§è¡Œå›è°ƒå‡½æ•° loop.call_at()ï¼šåœ¨æŒ‡å®šæ—¶é—´æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œè¿™é‡Œçš„æ—¶é—´ç»Ÿä¸€ä½¿ç”¨ loop.time() æ¥æ›¿ä»£ time.sleep() asyncio.run_coroutine_threadsafe()ï¼š åŠ¨æ€çš„åŠ å…¥åç¨‹ï¼Œå‚æ•°ä¸ºä¸€ä¸ªå›è°ƒå‡½æ•°å’Œä¸€ä¸ªloopå¯¹è±¡ï¼Œè¿”å›å€¼ä¸ºfutureå¯¹è±¡ï¼Œé€šè¿‡future.result()è·å–å›è°ƒå‡½æ•°è¿”å›å€¼ åŠ¨æ€æ·»åŠ åç¨‹åŒæ­¥æ–¹å¼ é€šè¿‡è°ƒç”¨ call_soon_threadsafe()å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°callbackå’Œä¸€ä¸ªä½ç½®å‚æ•° æ³¨æ„ï¼šåŒæ­¥æ–¹å¼ï¼Œå›è°ƒå‡½æ•° more_work()ä¸ºæ™®é€šå‡½æ•° import asyncio from threading import Thread import time now = lambda: time.time() def start_loop(loop): asyncio.set_event_loop(loop) loop.run_forever() def more_work(x): print('More work {}'.format(x)) time.sleep(x) print('Finished more work {}'.format(x)) start = now() new_loop = asyncio.new_event_loop() t = Thread(target=start_loop, args=(new_loop,)) t.start() print('TIME: {}'.format(time.time() - start)) new_loop.call_soon_threadsafe(more_work, 6) new_loop.call_soon_threadsafe(more_work, 3) print('here') å¯åŠ¨ä¸Šè¿°ä»£ç ä¹‹åï¼Œå½“å‰çº¿ç¨‹ä¸ä¼šè¢«blockï¼Œæ–°çº¿ç¨‹ä¸­ä¼šæŒ‰ç…§é¡ºåºæ‰§è¡Œcall_soon_threadsafeæ–¹æ³•æ³¨å†Œçš„more_workæ–¹æ³•ï¼Œ åè€…å› ä¸ºtime.sleepæ“ä½œæ˜¯åŒæ­¥é˜»å¡çš„ï¼Œå› æ­¤è¿è¡Œå®Œæ¯•more_workéœ€è¦å¤§è‡´6 + 3 å¼‚æ­¥æ–¹å¼ import asyncio import time from threading import Thread now = lambda: time.time() def start_loop(loop): asyncio.set_event_loop(loop) loop.run_forever() async def do_some_work(x): print('Waiting {}'.format(x)) await asyncio.sleep(x) print('Done after {}s'.format(x)) start = now() new_loop = asyncio.new_event_loop() t = Thread(target=start_loop, args=(new_loop,)) t.start() print('TIME: {}'.format(time.time() - start)) asyncio.run_coroutine_threadsafe(do_some_work(6), new_loop) asyncio.run_coroutine_threadsafe(do_some_work(4), new_loop) ä¸Šè¿°çš„ä¾‹å­ï¼Œä¸»çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªnew_loopï¼Œç„¶ååœ¨å¦å¤–çš„å­çº¿ç¨‹ä¸­å¼€å¯ä¸€ä¸ªæ— é™äº‹ä»¶å¾ªç¯ã€‚ ä¸»çº¿ç¨‹é€šè¿‡run_coroutine_threadsafeæ–°æ³¨å†Œåç¨‹å¯¹è±¡ã€‚è¿™æ ·å°±èƒ½åœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œäº‹ä»¶å¾ªç¯çš„å¹¶å‘æ“ä½œï¼ŒåŒæ—¶ä¸»çº¿ç¨‹åˆä¸ä¼šè¢«blockã€‚ä¸€å…±æ‰§è¡Œçš„æ—¶é—´å¤§æ¦‚åœ¨6så·¦å³ã€‚ åç¨‹çš„åœæ­¢ futureå¯¹è±¡æœ‰å‡ ä¸ªçŠ¶æ€ï¼š Pending Running Done Cacelled åˆ›å»ºfutureçš„æ—¶å€™ï¼Œtaskä¸ºpendingï¼Œäº‹ä»¶å¾ªç¯è°ƒç”¨æ‰§è¡Œçš„æ—¶å€™å½“ç„¶å°±æ˜¯runningï¼Œè°ƒç”¨å®Œæ¯•è‡ªç„¶å°±æ˜¯doneï¼Œå¦‚æœéœ€è¦åœæ­¢äº‹ä»¶å¾ªç¯ï¼Œå°±éœ€è¦å…ˆæŠŠtaskå–æ¶ˆã€‚å¯ä»¥ä½¿ç”¨asyncio.Taskè·å–äº‹ä»¶å¾ªç¯çš„task import asyncio import time now = lambda: time.time() async def do_some_work(x): print(\"Waiting:\", x) await asyncio.sleep(x) return \"Done after {}s\".format(x) coroutine1 = do_some_work(1) coroutine2 = do_some_work(2) coroutine3 = do_some_work(2) tasks = [ asyncio.ensure_future(coroutine1), asyncio.ensure_future(coroutine2), asyncio.ensure_future(coroutine3), ] start = now() loop = asyncio.get_event_loop() try: loop.run_until_complete(asyncio.wait(tasks)) except KeyboardInterrupt as e: print(asyncio.Task.all_tasks()) for ","date":"2023-05-28","objectID":"/asyncio%E4%BD%BF%E7%94%A8/:5:3","tags":["async"],"title":"Asyncioä½¿ç”¨","uri":"/asyncio%E4%BD%BF%E7%94%A8/"},{"categories":["draft"],"content":"SelfAttentionå’ŒMultiHeadAttentionæµç¨‹ç®€è¿° ","date":"2023-05-07","objectID":"/selfattention%E5%92%8Cmultiheadattention%E6%B5%81%E7%A8%8B%E7%AE%80%E8%BF%B0/:0:0","tags":["draft"],"title":"SelfAttentionå’ŒMultiHeadAttentionæµç¨‹ç®€è¿°","uri":"/selfattention%E5%92%8Cmultiheadattention%E6%B5%81%E7%A8%8B%E7%AE%80%E8%BF%B0/"},{"categories":["draft"],"content":"1. SelfAttention 1.1 å¯¹äºæ¯ä¸€ä¸ªè¾“å…¥$I$,åˆå§‹åŒ–3ä¸ªæƒé‡çŸ©é˜µ$W_q,W_k,W_v$. 1.2 è¾“å…¥$I$åˆ†åˆ«ä¸3ä¸ªæƒé‡çŸ©é˜µç›¸ä¹˜å¾—åˆ°$Q,K,V$ 1.3 å°†$Q$ä¸$K$ç›¸ä¹˜(çŸ©é˜µä¹˜æ³•)å¾—åˆ°$A$(attention score) 1.4 $A$ç»è¿‡softmaxæ¿€æ´»å¾—åˆ°$A'$ 1.5 å°†$Aâ€™$ä¸$V$ç›¸ä¹˜å¾—åˆ°B ä»£ç ç¤ºä¾‹: In [16]: i = torch.randn(3,4) In [17]: w_query = torch.randn(4, 2) In [18]: w_key = torch.randn(4, 2) In [19]: w_value = torch.randn(4, 2) In [20]: i Out[20]: tensor([[ 0.4313, 1.3749, -0.2489, 1.3275], [-0.6467, 1.6335, 2.8923, 0.9124], [ 0.2326, -0.2314, 0.3554, 0.0892]]) In [21]: w_query Out[21]: tensor([[ 0.3673, -0.8505], [-0.3559, -0.3708], [-1.2093, 0.6634], [ 0.4042, 0.8015]]) In [22]: w_key Out[22]: tensor([[-1.1617, 0.4023], [-0.1249, -0.1605], [-0.8427, 1.1002], [-1.1320, 0.4611]]) In [23]: w_value Out[23]: tensor([[-0.7675, -0.3179], [-1.1910, -0.6937], [-1.4809, -1.5502], [-0.7373, 1.0511]]) In [24]: querys = i @ w_query In [25]: keys = i @ w_key In [26]: values = i @ w_value In [27]: querys Out[27]: tensor([[ 0.5066, 0.0223], [-3.9478, 2.5946], [-0.2259, 0.1952]]) In [28]: keys Out[28]: tensor([[-1.9656, 0.2911], [-2.9229, 3.0806], [-0.6418, 0.5629]]) In [29]: values Out[29]: tensor([[-2.5787, 0.6903], [-6.4049, -4.4522], [-0.4950, -0.3706]]) In [30]: att_scores = querys @ keys.T In [31]: att_scores Out[31]: tensor([[-0.9893, -1.4121, -0.3126], [ 8.5152, 19.5319, 3.9940], [ 0.5009, 1.2617, 0.2549]]) In [32]: att_scores_softmax = torch.nn.functional.softmax(att_scores, dim=-1) In [33]: att_scores_softmax Out[33]: tensor([[2.7604e-01, 1.8087e-01, 5.4310e-01], [1.6426e-05, 9.9998e-01, 1.7865e-07], [2.5498e-01, 5.4565e-01, 1.9937e-01]]) In [34]: outputs = att_scores_softmax @ values In [35]: outputs Out[35]: tensor([[-2.1390, -0.8160], [-6.4048, -4.4521], [-4.2510, -2.3272]]) In [36]: outputs.shape Out[36]: torch.Size([3, 2]) ","date":"2023-05-07","objectID":"/selfattention%E5%92%8Cmultiheadattention%E6%B5%81%E7%A8%8B%E7%AE%80%E8%BF%B0/:1:0","tags":["draft"],"title":"SelfAttentionå’ŒMultiHeadAttentionæµç¨‹ç®€è¿°","uri":"/selfattention%E5%92%8Cmultiheadattention%E6%B5%81%E7%A8%8B%E7%AE%80%E8%BF%B0/"},{"categories":["DeepLearning"],"content":"ä»€ä¹ˆæ˜¯äº¤å‰ç†µ äº¤å‰ç†µæ˜¯ä¸€ä¸ªåœ¨MLé¢†åŸŸç»å¸¸ä¼šè¢«æåˆ°çš„åè¯ã€‚åœ¨è¿™ç¯‡æ–‡ç« é‡Œå°†å¯¹è¿™ä¸ªæ¦‚å¿µè¿›è¡Œè¯¦ç»†çš„åˆ†æã€‚ ","date":"2023-02-28","objectID":"/%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%A4%E5%8F%89%E7%86%B5/:0:0","tags":["DeepLearning"],"title":"ä»€ä¹ˆæ˜¯äº¤å‰ç†µ","uri":"/%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%A4%E5%8F%89%E7%86%B5/"},{"categories":["DeepLearning"],"content":"1.ä»€ä¹ˆæ˜¯ä¿¡æ¯é‡ï¼Ÿ å‡è®¾$x$æ˜¯ä¸€ä¸ªç¦»æ•£å‹éšæœºå˜é‡ï¼Œå…¶å–å€¼é›†åˆä¸º$X$ï¼Œæ¦‚ç‡åˆ†å¸ƒå‡½æ•°ä¸º$p(x)=Pr(X=x), x \\in X $ï¼Œæˆ‘ä»¬å®šä¹‰äº‹ä»¶çš„ä¿¡æ¯é‡ä¸ºï¼š$X=x_0$ï¼Œå¯ä»¥ç†è§£ä¸ºï¼Œä¸€ä¸ªäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡è¶Šå¤§ï¼Œåˆ™å®ƒæ‰€æºå¸¦çš„ä¿¡æ¯é‡å°±è¶Šå°ï¼Œè€Œå½“$p(x_0)=1$æ—¶ï¼Œç†µå°†ç­‰äº0ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥äº‹ä»¶çš„å‘ç”Ÿä¸ä¼šå¯¼è‡´ä»»ä½•ä¿¡æ¯é‡çš„å¢åŠ ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå°æ˜å¹³æ—¶ä¸çˆ±å­¦ä¹ ï¼Œè€ƒè¯•ç»å¸¸ä¸åŠæ ¼ï¼Œè€Œå°ç‹æ˜¯ä¸ªå‹¤å¥‹å­¦ä¹ çš„å¥½å­¦ç”Ÿï¼Œç»å¸¸å¾—æ»¡åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åšå¦‚ä¸‹å‡è®¾ï¼š äº‹ä»¶Aï¼šå°æ˜è€ƒè¯•åŠæ ¼ï¼Œå¯¹åº”çš„æ¦‚ç‡$P(x_A)=0.1$ï¼Œä¿¡æ¯é‡ä¸º$I(x_A)=âˆ’log(0.1)=3.3219$ äº‹ä»¶Bï¼šå°ç‹è€ƒè¯•åŠæ ¼ï¼Œå¯¹åº”çš„æ¦‚ç‡$P(x_B)=0.999$ï¼Œä¿¡æ¯é‡ä¸º$I(x_B)=âˆ’log(0.999)=0.0014$ å¯ä»¥çœ‹å‡ºï¼Œç»“æœéå¸¸ç¬¦åˆç›´è§‚ï¼šå°æ˜åŠæ ¼çš„å¯èƒ½æ€§å¾ˆä½(åæ¬¡è€ƒè¯•åªæœ‰ä¸€æ¬¡åŠæ ¼)ï¼Œå› æ­¤å¦‚æœæŸæ¬¡è€ƒè¯•åŠæ ¼äº†ï¼ˆå¤§å®¶éƒ½ä¼šè¯´ï¼šXXXç«Ÿç„¶åŠæ ¼äº†ï¼ï¼‰ï¼Œå¿…ç„¶ä¼šå¼•å…¥è¾ƒå¤§çš„ä¿¡æ¯é‡ï¼Œå¯¹åº”çš„$I$å€¼ä¹Ÿè¾ƒé«˜ã€‚è€Œå¯¹äºå°ç‹è€Œè¨€ï¼Œè€ƒè¯•åŠæ ¼æ˜¯å¤§æ¦‚ç‡äº‹ä»¶ï¼Œåœ¨äº‹ä»¶Bå‘ç”Ÿå‰ï¼Œå¤§å®¶æ™®éè®¤ä¸ºäº‹ä»¶Bçš„å‘ç”Ÿå‡ ä¹æ˜¯ç¡®å®šçš„ï¼Œå› æ­¤å½“æŸæ¬¡è€ƒè¯•å°ç‹åŠæ ¼è¿™ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶å¹¶ä¸ä¼šå¼•å…¥å¤ªå¤šçš„ä¿¡æ¯é‡ï¼Œç›¸åº”çš„$I$å€¼ä¹Ÿéå¸¸çš„ä½ã€‚ ","date":"2023-02-28","objectID":"/%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%A4%E5%8F%89%E7%86%B5/:1:0","tags":["DeepLearning"],"title":"ä»€ä¹ˆæ˜¯äº¤å‰ç†µ","uri":"/%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%A4%E5%8F%89%E7%86%B5/"},{"categories":["DeepLearning"],"content":"2.ä»€ä¹ˆæ˜¯ç†µï¼Ÿ é‚£ä¹ˆä»€ä¹ˆåˆæ˜¯ç†µå‘¢ï¼Ÿè¿˜æ˜¯é€šè¿‡ä¸Šè¾¹çš„ä¾‹å­æ¥è¯´æ˜ï¼Œå‡è®¾å°æ˜çš„è€ƒè¯•ç»“æœæ˜¯ä¸€ä¸ª0-1åˆ†å¸ƒ$X_A$åªæœ‰ä¸¤ä¸ªå–å€¼{0ï¼šä¸åŠæ ¼ï¼Œ1ï¼šåŠæ ¼}ï¼Œåœ¨æŸæ¬¡è€ƒè¯•ç»“æœå…¬å¸ƒå‰ï¼Œå°æ˜çš„è€ƒè¯•ç»“æœæœ‰å¤šå¤§çš„ä¸ç¡®å®šåº¦å‘¢ï¼Ÿä½ è‚¯å®šä¼šè¯´ï¼šåæœ‰å…«ä¹ä¸åŠæ ¼ï¼å› ä¸ºæ ¹æ®å…ˆéªŒçŸ¥è¯†ï¼Œå°æ˜åŠæ ¼çš„æ¦‚ç‡ä»…æœ‰0.1,90%çš„å¯èƒ½éƒ½æ˜¯ä¸åŠæ ¼çš„ã€‚æ€ä¹ˆæ¥åº¦é‡è¿™ä¸ªä¸ç¡®å®šåº¦ï¼Ÿæ±‚æœŸæœ›ï¼ä¸é”™ï¼Œæˆ‘ä»¬å¯¹æ‰€æœ‰å¯èƒ½ç»“æœå¸¦æ¥çš„é¢å¤–ä¿¡æ¯é‡æ±‚å–å‡å€¼ï¼ˆæœŸæœ›ï¼‰ï¼Œå…¶ç»“æœä¸å°±èƒ½å¤Ÿè¡¡é‡å‡ºå°æ˜è€ƒè¯•æˆç»©çš„ä¸ç¡®å®šåº¦äº†å—ã€‚ å³ï¼š $H_A(x) = -[p(x_A)log(p(X_A))] + (1-p(x_A))log(1-p(x_A))]=0.4690$ å¯¹åº”å°ç‹çš„ç†µï¼š $H_B(x)=âˆ’[p(x_B)log(p(x_B))+(1âˆ’p(x_B))log(1âˆ’p(x_B))]=0.0114$ è™½ç„¶å°æ˜è€ƒè¯•ç»“æœçš„ä¸ç¡®å®šæ€§è¾ƒä½ï¼Œæ¯•ç«Ÿåæ¬¡æœ‰9æ¬¡éƒ½ä¸åŠæ ¼ï¼Œä½†æ˜¯ä¹Ÿæ¯”ä¸ä¸Šå°ç‹ï¼ˆ1000æ¬¡è€ƒè¯•åªæœ‰ä¸€æ¬¡æ‰å¯èƒ½ä¸åŠæ ¼ï¼Œç»“æœç›¸å½“çš„ç¡®å®šï¼‰ æˆ‘ä»¬å†å‡è®¾ä¸€ä¸ªæˆç»©ç›¸å¯¹æ™®é€šçš„å­¦ç”Ÿå°ä¸œï¼Œä»–åŠæ ¼çš„æ¦‚ç‡æ˜¯$P(x_C)=0.5$,å³åŠæ ¼ä¸å¦çš„æ¦‚ç‡æ˜¯ä¸€æ ·çš„ï¼Œå¯¹åº”çš„ç†µï¼š $H_C(x)=âˆ’[p(x_C)log(p(x_C))+(1âˆ’p(x_C))log(1âˆ’p(x_C))]=1$ å…¶ç†µä¸º1ï¼Œä»–çš„ä¸ç¡®å®šæ€§æ¯”å‰è¾¹ä¸¤ä½åŒå­¦è¦é«˜å¾ˆå¤šï¼Œåœ¨æˆç»©å…¬å¸ƒä¹‹å‰ï¼Œå¾ˆéš¾å‡†ç¡®çŒœæµ‹å‡ºä»–çš„è€ƒè¯•ç»“æœã€‚ å¯ä»¥çœ‹å‡ºï¼Œç†µå…¶å®æ˜¯ä¿¡æ¯é‡çš„æœŸæœ›å€¼ï¼Œå®ƒæ˜¯ä¸€ä¸ªéšæœºå˜é‡çš„ç¡®å®šæ€§çš„åº¦é‡ã€‚ç†µè¶Šå¤§ï¼Œå˜é‡çš„å–å€¼è¶Šä¸ç¡®å®šï¼Œåä¹‹å°±è¶Šç¡®å®šã€‚ å¯¹äºä¸€ä¸ªéšæœºå˜é‡Xè€Œè¨€ï¼Œå®ƒçš„æ‰€æœ‰å¯èƒ½å–å€¼çš„ä¿¡æ¯é‡çš„æœŸæœ›$ï¼ˆE[I(x)]$å°±ç§°ä¸ºç†µã€‚ $X$çš„ç†µå®šä¹‰ä¸ºï¼š $H(X)=Ep \\space log \\frac 1 {p(x)}=âˆ’\\sum \\limits_{x \\in X}p(x)logp(x)$ å¦‚æœ$p(x)$æ˜¯è¿ç»­å‹éšæœºå˜é‡çš„pdfï¼Œåˆ™ç†µå®šä¹‰ä¸ºï¼š $H(X)=âˆ’âˆ«_{xâˆˆX}p(x)logp(x)dx$ ä¸ºäº†ä¿è¯æœ‰æ•ˆæ€§ï¼Œè¿™é‡Œçº¦å®šå½“$p(x)â†’0$æ—¶,æœ‰$p(x)logp(x)â†’0$ å½“Xä¸º0-1åˆ†å¸ƒæ—¶ï¼Œç†µä¸æ¦‚ç‡pçš„å…³ç³»å¦‚ä¸‹å›¾ï¼š å¯ä»¥çœ‹å‡ºï¼Œå½“ä¸¤ç§å–å€¼çš„å¯èƒ½æ€§ç›¸ç­‰æ—¶ï¼Œä¸ç¡®å®šåº¦æœ€å¤§ï¼ˆæ­¤æ—¶æ²¡æœ‰ä»»ä½•å…ˆéªŒçŸ¥è¯†ï¼‰ï¼Œè¿™ä¸ªç»“è®ºå¯ä»¥æ¨å¹¿åˆ°å¤šç§å–å€¼çš„æƒ…å†µã€‚åœ¨å›¾ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œå½“p=0æˆ–1æ—¶ï¼Œç†µä¸º0ï¼Œå³æ­¤æ—¶Xå®Œå…¨ç¡®å®šã€‚ ç†µçš„å•ä½éšç€å…¬å¼ä¸­$log$è¿ç®—çš„åº•æ•°è€Œå˜åŒ–ï¼Œå½“åº•æ•°ä¸º2æ—¶ï¼Œå•ä½ä¸ºâ€œæ¯”ç‰¹â€(bit)ï¼Œåº•æ•°ä¸ºeæ—¶ï¼Œå•ä½ä¸ºâ€œå¥ˆç‰¹â€ã€‚ ","date":"2023-02-28","objectID":"/%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%A4%E5%8F%89%E7%86%B5/:2:0","tags":["DeepLearning"],"title":"ä»€ä¹ˆæ˜¯äº¤å‰ç†µ","uri":"/%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%A4%E5%8F%89%E7%86%B5/"},{"categories":["DeepLearning"],"content":"3.ä»€ä¹ˆæ˜¯ç›¸å¯¹ç†µï¼Ÿ ç›¸å¯¹ç†µ(relative entropy)åˆç§°ä¸ºKLæ•£åº¦ï¼ˆKullback-Leibler divergenceï¼‰ï¼ŒKLè·ç¦»ï¼Œæ˜¯ä¸¤ä¸ªéšæœºåˆ†å¸ƒé—´è·ç¦»çš„åº¦é‡ã€‚è®°ä¸º$D_{KL}(p||q)$ã€‚å®ƒåº¦é‡å½“çœŸå®åˆ†å¸ƒä¸ºpæ—¶ï¼Œå‡è®¾åˆ†å¸ƒ$q$çš„æ— æ•ˆæ€§ã€‚ $$\\begin{split} \\ D_{KL}(p||q) \u0026= Ep[log \\frac {p(x)} {q(x)}] \\ \u0026=\\sum _{xâˆˆX} p(x) log \\frac {p(x)} {q(x)} \\ \u0026=\\sum {xâˆˆX}[p(x)logp(x)âˆ’p(x)logq(x)] \\ \u0026=\\sum{xâˆˆX}p(x)logp(x)âˆ’\\sum _{xâˆˆX}p(x)logq(x) \\ \u0026=âˆ’H(p)âˆ’\\sum _{xâˆˆX} p(x)logq(x) \\ \u0026=âˆ’H(p)+Ep[âˆ’logq(x)] \\ \u0026=Hp(q)âˆ’H(p)\\end{split}$$ å¹¶ä¸”ä¸ºäº†ä¿è¯è¿ç»­æ€§ï¼Œåšå¦‚ä¸‹çº¦å®šï¼š $$0log \\frac 0 0=0ï¼Œ0log \\frac 0 q=0ï¼Œplog \\frac p 0=âˆ$$ æ˜¾ç„¶ï¼Œå½“$p=q$æ—¶,ä¸¤è€…ä¹‹é—´çš„ç›¸å¯¹ç†µ$D_{KL}(p||q)=0$ ä¸Šå¼æœ€åçš„$H_p(q)$)è¡¨ç¤ºåœ¨påˆ†å¸ƒä¸‹ï¼Œä½¿ç”¨qè¿›è¡Œç¼–ç éœ€è¦çš„bitæ•°ï¼Œè€Œ$H(p)$è¡¨ç¤ºå¯¹çœŸå®åˆ†å¸ƒpæ‰€éœ€è¦çš„æœ€å°ç¼–ç bitæ•°ã€‚åŸºäºæ­¤ï¼Œç›¸å¯¹ç†µçš„æ„ä¹‰å°±å¾ˆæ˜ç¡®äº†ï¼š$D_{KL}(p||q)$)è¡¨ç¤ºåœ¨å®åˆ†å¸ƒä¸º$p$çš„å‰æä¸‹ï¼Œä½¿ç”¨qåˆ†å¸ƒè¿›è¡Œç¼–ç ç›¸å¯¹äºä½¿ç”¨çœŸå®åˆ†å¸ƒpè¿›è¡Œç¼–ç ï¼ˆå³æœ€ä¼˜ç¼–ç ï¼‰æ‰€å¤šå‡ºæ¥çš„bitæ•°ã€‚ ","date":"2023-02-28","objectID":"/%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%A4%E5%8F%89%E7%86%B5/:3:0","tags":["DeepLearning"],"title":"ä»€ä¹ˆæ˜¯äº¤å‰ç†µ","uri":"/%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%A4%E5%8F%89%E7%86%B5/"},{"categories":["DeepLearning"],"content":"4. ä»€ä¹ˆæ˜¯äº¤å‰ç†µï¼Ÿ äº¤å‰ç†µå®¹æ˜“è·Ÿç›¸å¯¹ç†µææ··ï¼ŒäºŒè€…è”ç³»ç´§å¯†ï¼Œä½†åˆæœ‰æ‰€åŒºåˆ«ã€‚å‡è®¾æœ‰ä¸¤ä¸ªåˆ†å¸ƒ$pï¼Œq$åˆ™å®ƒä»¬åœ¨ç»™å®šæ ·æœ¬é›†ä¸Šçš„äº¤å‰ç†µå®šä¹‰å¦‚ä¸‹ï¼š $$ CEH(p,q)=Ep[âˆ’logq]=âˆ’âˆ‘\\limits_{xâˆˆX}p(x)logq(x)=H(p)+D_{KL}(p||q) $$ å¯ä»¥çœ‹å‡ºï¼Œäº¤å‰ç†µä¸ä¸Šä¸€èŠ‚å®šä¹‰çš„ç›¸å¯¹ç†µä»…ç›¸å·®äº†$H(p)$,å½“$p$å·²çŸ¥æ—¶ï¼Œå¯ä»¥æŠŠ$H(p)$çœ‹åšä¸€ä¸ªå¸¸æ•°ï¼Œæ­¤æ—¶äº¤å‰ç†µä¸KLè·ç¦»åœ¨è¡Œä¸ºä¸Šæ˜¯ç­‰ä»·çš„ï¼Œéƒ½åæ˜ äº†åˆ†å¸ƒ$pï¼Œq$çš„ç›¸ä¼¼ç¨‹åº¦ã€‚æœ€å°åŒ–äº¤å‰ç†µç­‰äºæœ€å°åŒ–KLè·ç¦»ã€‚å®ƒä»¬éƒ½å°†åœ¨$p=q$æ—¶å–å¾—æœ€å°å€¼$H(p)$ï¼ˆp=qæ—¶KLè·ç¦»ä¸º0ï¼‰ï¼Œå› æ­¤æœ‰çš„å·¥ç¨‹æ–‡çŒ®ä¸­å°†æœ€å°åŒ–KLè·ç¦»çš„æ–¹æ³•ç§°ä¸ºPrinciple of Minimum Cross-Entropy (MCE)æˆ–Minxentæ–¹æ³•ã€‚ ç‰¹åˆ«çš„ï¼Œåœ¨logistic regressionä¸­ï¼Œ p:çœŸå®æ ·æœ¬åˆ†å¸ƒï¼Œæœä»å‚æ•°ä¸ºpçš„0-1åˆ†å¸ƒï¼Œå³$Xâˆ¼B(1,p)$ q:å¾…ä¼°è®¡çš„æ¨¡å‹ï¼Œæœä»å‚æ•°ä¸ºqçš„0-1åˆ†å¸ƒï¼Œå³$Xâˆ¼B(1,q)$ ä¸¤è€…çš„äº¤å‰ç†µä¸ºï¼š $$\\begin{split} CEH(p,q) \u0026=âˆ’\\sum _{xâˆˆX}p(x)logq(x) \\ \u0026=âˆ’[P_p(x=1)logP_q(x=1)+P_p(x=0)logP_q(x=0)] \\ \u0026=âˆ’[plogq+(1âˆ’p)log(1âˆ’q)] \\ \u0026=âˆ’[ylogh_Î¸(x)+(1âˆ’y)log(1âˆ’h_Î¸(x))] \\ \\end{split}$$ å¯¹æ‰€æœ‰è®­ç»ƒæ ·æœ¬å–å‡å€¼å¾—ï¼š $$âˆ’\\frac 1 m \\sum \\limits^{m} \\limits _{i=1m} [y(i)logh_Î¸(x^{(i)})+(1âˆ’y^{(i)})log(1âˆ’h_Î¸(x^{(i)}))]$$ è¿™ä¸ªç»“æœä¸é€šè¿‡æœ€å¤§ä¼¼ç„¶ä¼°è®¡æ–¹æ³•æ±‚å‡ºæ¥çš„ç»“æœä¸€è‡´ã€‚ è½¬è½½å‡ºå¤„: äº¤å‰ç†µï¼ˆCross-Entropyï¼‰_rtygbwwwerrçš„åšå®¢-CSDNåšå®¢ ","date":"2023-02-28","objectID":"/%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%A4%E5%8F%89%E7%86%B5/:4:0","tags":["DeepLearning"],"title":"ä»€ä¹ˆæ˜¯äº¤å‰ç†µ","uri":"/%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%A4%E5%8F%89%E7%86%B5/"},{"categories":["Python"],"content":"å¼ºå¤§çš„GANç½‘ç»œ ","date":"2023-02-25","objectID":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/:0:0","tags":["deeplearning","gan"],"title":"å¼ºå¤§çš„GANç½‘ç»œ","uri":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/"},{"categories":["Python"],"content":"1. æ¦‚è¦ â€‹ GANç½‘ç»œå…¨ç§°generative adversarial network,ç¿»è¯‘ä¸ºç”Ÿæˆå¼å¯¹æŠ—ç½‘ç»œ,æ˜¯ä¸€ç§éç›‘ç£å¼å­¦ä¹ æœºå™¨å­¦ä¹ æ–¹æ³•ã€‚ç”±Ian J,Goodfello ç­‰äººäº2014å¹´åœ¨Generative Adversarial Nets è®ºæ–‡ä¸­æå‡ºã€‚å…¶ä¸­åœ¨GANç½‘ç»œä¸­,æœ‰ä¸¤ä¸ªæ¨¡å‹â€”â€”ç”Ÿæˆæ¨¡å‹(generative model G),åˆ¤åˆ«æ¨¡å‹(discriminative model D). ","date":"2023-02-25","objectID":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/:1:0","tags":["deeplearning","gan"],"title":"å¼ºå¤§çš„GANç½‘ç»œ","uri":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/"},{"categories":["Python"],"content":"2. åŸç† â€‹ GANç½‘ç»œä¸»è¦è¿ç”¨äº†åšå¼ˆè®ºçš„æ€æƒ³,æ¨¡å‹ä¸­çš„2ä¸ºåšå¼ˆæ–¹åˆ†åˆ«ç”±ç”Ÿæˆæ¨¡å‹å’Œåˆ¤åˆ«æ¨¡å‹æ‹…å½“.ç”Ÿæˆæ¨¡å‹ç”¨éšæœºå–æ ·ä½œä¸ºè¾“å…¥,å®ƒçš„è¾“å‡ºç»“æœè¦å°½å¯èƒ½å’Œè®­ç»ƒæ ·æœ¬å°½å¯èƒ½ç›¸ä¼¼,æœ€å¥½çš„æƒ…å†µå°±æ˜¯åˆ†è¾¨ä¸å‡ºæ˜¯çœŸå®æ ·æœ¬è¿˜æ˜¯ç”Ÿæˆå‡ºæ¥çš„æ ·æœ¬.è€Œåˆ¤åˆ«æ¨¡å‹å°±æ˜¯å°½å¯èƒ½åˆ¤åˆ«ç”Ÿæˆæ¨¡å‹ç”Ÿæˆçš„ç»“æœå’ŒçœŸå®æ ·æœ¬.è¿™æ ·2ä¸ªç½‘ç»œç›¸äº’å¯¹æŠ—,ä¸æ–­è°ƒæ•´å‚æ•°,æœ€ç»ˆè¾¾åˆ°çº³ä»€å‡è¡¡. è¿™ä¸ªè¿‡ç¨‹å¯ä»¥è¡¨ç¤ºä¸º: $$ min_G max_DV(D,G) = \\Epsilon_{x\\sim P_{data}(x)}[logD(x)] + \\Epsilon_{z\\sim p_{z}(z)}[log(1-D(G(z)))] $$ å…¬å¼è§£é‡Š: 1. å½“è®­ç»ƒDæ—¶,å¸Œæœ›è¿™ä¸ªå¼å­çš„å€¼è¶Šå¤§è¶Šå¥½.çœŸå®æ•°æ®å¸Œæœ›è¢«Dåˆ†æˆ1,ç”Ÿæˆæ•°æ®å¸Œæœ›è¢«åˆ†æˆ0\r2. å½“è®­ç»ƒGæ—¶,å¸Œæœ›è¿™ä¸ªå¼å­çš„å€¼è¶Šå°è¶Šå¥½.å¸Œæœ›Dåˆ†ä¸å¼€çœŸå®æ•°æ®è¿˜æ˜¯ç”Ÿæˆæ•°æ®\ré›¶å’Œåšå¼ˆï¼ˆzero-sum gameï¼‰ï¼Œåˆç§°é›¶å’Œæ¸¸æˆï¼Œä¸éé›¶å’Œåšå¼ˆç›¸å¯¹ï¼Œæ˜¯åšå¼ˆè®ºçš„ä¸€ä¸ªæ¦‚å¿µï¼Œå±éåˆä½œåšå¼ˆã€‚æŒ‡å‚ä¸åšå¼ˆçš„å„æ–¹ï¼Œåœ¨ä¸¥æ ¼ç«äº‰ä¸‹ï¼Œä¸€æ–¹çš„æ”¶ç›Šå¿…ç„¶æ„å‘³ç€å¦ä¸€æ–¹çš„æŸå¤±ï¼Œåšå¼ˆå„æ–¹çš„æ”¶ç›Šå’ŒæŸå¤±ç›¸åŠ æ€»å’Œæ°¸è¿œä¸ºâ€œé›¶â€ï¼ŒåŒæ–¹ä¸å­˜åœ¨åˆä½œçš„å¯èƒ½ã€‚å°±åƒä¸‹æ£‹çš„æ¸¸æˆä¸€æ ·ï¼Œä½ èµ°çš„æ¯ä¸€æ­¥å’Œå¯¹æ–¹èµ°çš„æ¯ä¸€æ­¥éƒ½æ˜¯å‘ç€å¯¹è‡ªå·±æœ‰åˆ©çš„æ–¹å‘èµ°ï¼Œç„¶åä½ å’Œå¯¹æ‰‹è½®æµèµ°æ­¥ æ¯ä¸€æ­¥éƒ½å‘ç€è‡ªå·±æœ€å¤§å¯èƒ½èƒ½èµ¢çš„åœ°æ–¹èµ°ã€‚è¿™å°±æ˜¯é›¶å’Œåšå¼ˆã€‚ ","date":"2023-02-25","objectID":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/:2:0","tags":["deeplearning","gan"],"title":"å¼ºå¤§çš„GANç½‘ç»œ","uri":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/"},{"categories":["Python"],"content":"3. ç®€å•ä»£ç å®ç° ","date":"2023-02-25","objectID":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/:3:0","tags":["deeplearning","gan"],"title":"å¼ºå¤§çš„GANç½‘ç»œ","uri":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/"},{"categories":["Python"],"content":"3.1 å¯¼åŒ… import torch import torch.nn as nn import torch.nn.functional as F from torch.utils.data import DataLoader from torch import optim import torchvision from torchvision import transforms from torch.utils.tensorboard import SummaryWriter import matplotlib.pyplot as plt ","date":"2023-02-25","objectID":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/:3:1","tags":["deeplearning","gan"],"title":"å¼ºå¤§çš„GANç½‘ç»œ","uri":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/"},{"categories":["Python"],"content":"3.2 åŠ è½½æ•°æ®é›† # åˆå§‹åŒ–tensorboardæ•°æ®ä¿å­˜è·¯å¾„ writer = SummaryWriter('./logs') device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\") batch_size = 32 transform = transforms.Compose([transforms.ToTensor(), transforms.Normalize(mean=(0.5, ), std=(0.5, ))]) train_dataset = torchvision.datasets.MNIST(root='./data', train=True, download=False, transform=transform) train_loader = DataLoader(dataset=train_dataset, batch_size=batch_size, shuffle=True, drop_last=True) ","date":"2023-02-25","objectID":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/:3:2","tags":["deeplearning","gan"],"title":"å¼ºå¤§çš„GANç½‘ç»œ","uri":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/"},{"categories":["Python"],"content":"3.3 å®šä¹‰ç”Ÿæˆæ¨¡å‹ class Generator(nn.Module): def __init__(self, g_input_dim, g_output_dim): super(Generator, self).__init__() self.fc1 = nn.Linear(g_input_dim, 256) self.fc2 = nn.Linear(self.fc1.out_features, self.fc1.out_features*2) self.fc3 = nn.Linear(self.fc2.out_features, self.fc2.out_features*2) self.fc4 = nn.Linear(self.fc3.out_features, g_output_dim) # forward method def forward(self, x): x = F.leaky_relu(self.fc1(x), 0.2) x = F.leaky_relu(self.fc2(x), 0.2) x = F.leaky_relu(self.fc3(x), 0.2) return torch.tanh(self.fc4(x)) ","date":"2023-02-25","objectID":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/:3:3","tags":["deeplearning","gan"],"title":"å¼ºå¤§çš„GANç½‘ç»œ","uri":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/"},{"categories":["Python"],"content":"3.4 å®šä¹‰åˆ¤åˆ«æ¨¡å‹ class Discriminator(nn.Module): def __init__(self, d_input_dim): super(Discriminator, self).__init__() self.fc1 = nn.Linear(d_input_dim, 1024) self.fc2 = nn.Linear(self.fc1.out_features, self.fc1.out_features//2) self.fc3 = nn.Linear(self.fc2.out_features, self.fc2.out_features//2) self.fc4 = nn.Linear(self.fc3.out_features, 1) # forward method def forward(self, x): x = F.leaky_relu(self.fc1(x), 0.2) x = F.dropout(x, 0.3) x = F.leaky_relu(self.fc2(x), 0.2) x = F.dropout(x, 0.3) x = F.leaky_relu(self.fc3(x), 0.2) x = F.dropout(x, 0.3) return torch.sigmoid(self.fc4(x)) ","date":"2023-02-25","objectID":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/:3:4","tags":["deeplearning","gan"],"title":"å¼ºå¤§çš„GANç½‘ç»œ","uri":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/"},{"categories":["Python"],"content":"3.5 æ„é€ æ¨¡å‹,å®šä¹‰æŸå¤±å’Œä¼˜åŒ–å™¨ z_dim = 100 mnist_dim = train_dataset.train_data.size(1) * train_dataset.train_data.size(2) # build network G = Generator(g_input_dim = z_dim, g_output_dim = mnist_dim).to(device) D = Discriminator(mnist_dim).to(device) writer.add_graph(G, input_to_model=torch.randn(batch_size, z_dim)) writer.add_graph(D, input_to_model=torch.randn(batch_size, mnist_dim)) # optimizer lr = 0.0002 g_optimizer = optim.Adam(G.parameters(), lr = lr) d_optimizer = optim.Adam(D.parameters(), lr = lr) # loss criterion = nn.BCELoss() ","date":"2023-02-25","objectID":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/:3:5","tags":["deeplearning","gan"],"title":"å¼ºå¤§çš„GANç½‘ç»œ","uri":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/"},{"categories":["Python"],"content":"3.6 è®­ç»ƒåˆ¤åˆ«å™¨å’Œç”Ÿæˆå™¨ def d_train(x): D.zero_grad() x_real, y_real = x.view(-1, mnist_dim).to(device), torch.ones(batch_size, 1).to(device) print(x_real.shape, y_real.shape) d_output = D(x_real) print(d_output.shape, y_real.shape) d_real_loss = criterion(d_output, y_real) d_real_score = d_output z = torch.randn(batch_size, z_dim).to(device) x_fake, y_fake = G(z), torch.zeros(batch_size, 1).to(device) d_output = D(x_fake) d_fake_loss = criterion(d_output, y_fake) d_fake_score = d_output d_loss = d_real_loss + d_fake_loss d_loss.backward() d_optimizer.step() return d_loss.item() def g_train(x): G.zero_grad() z = torch.randn(batch_size, z_dim).to(device) y = torch.ones(batch_size, 1).to(device) g_output = G(z) d_output = D(g_output) g_loss = criterion(d_output, y) g_loss.backward() g_optimizer.step() return g_loss.item() ","date":"2023-02-25","objectID":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/:3:6","tags":["deeplearning","gan"],"title":"å¼ºå¤§çš„GANç½‘ç»œ","uri":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/"},{"categories":["Python"],"content":"3.7 è®­ç»ƒç½‘ç»œ epochs = 10 step = 0 for epoch in range(epochs): d_losses, g_losses = [], [] for batch_idx, (x, _) in enumerate(train_loader): step += 1 d_losses.append(d_train(x)) g_losses.append(g_train(x)) print('[%d/%d]: [%d/%d]: loss_d: %.3f, loss_g: %.3f' % ( epoch, epochs,batch_idx, len(train_loader), torch.mean(torch.FloatTensor(d_losses)), torch.mean(torch.FloatTensor(g_losses)))) writer.add_scalar('g_loss', torch.mean(torch.FloatTensor(g_losses)), step) writer.add_scalar('d_loss', torch.mean(torch.FloatTensor(d_losses)), step) if batch_idx % 10 == 0: with torch.no_grad(): test_z = torch.randn(batch_size, z_dim).to(device) generated = G(test_z) img = img = torchvision.utils.make_grid(generated.view(generated.size(0), 1, 28, 28)) writer.add_image(f'mnist_{epoch}_{batch_idx}', img, global_step=step) writer.close() ","date":"2023-02-25","objectID":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/:3:7","tags":["deeplearning","gan"],"title":"å¼ºå¤§çš„GANç½‘ç»œ","uri":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/"},{"categories":["Python"],"content":"3.8 ä¿å­˜æ¨¡å‹ torch.save(D, './model/discriminator.pt') torch.save(G, './model/generator.pt') ","date":"2023-02-25","objectID":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/:3:8","tags":["deeplearning","gan"],"title":"å¼ºå¤§çš„GANç½‘ç»œ","uri":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/"},{"categories":["Python"],"content":"3.9 æ±‡æ€»ä»£ç  import torch import torch.nn as nn import torch.nn.functional as F from torch.utils.data import DataLoader from torch import optim import torchvision from torchvision import transforms from torchinfo import summary from torch.utils.tensorboard import SummaryWriter import matplotlib.pyplot as plt writer = SummaryWriter('./logs') device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\") batch_size = 32 transform = transforms.Compose([transforms.ToTensor(), transforms.Normalize(mean=(0.5, ), std=(0.5, ))]) train_dataset = torchvision.datasets.MNIST(root='./data', train=True, download=False, transform=transform) # è®¾ç½®drop_lastä¸¢å¼ƒæœ€åä¸æ»¡ä¸€ä¸ªbatch_sizeçš„æ•°æ® train_loader = DataLoader(dataset=train_dataset, batch_size=batch_size, shuffle=True, drop_last=True) class Generator(nn.Module): def __init__(self, g_input_dim, g_output_dim): super(Generator, self).__init__() self.fc1 = nn.Linear(g_input_dim, 256) self.fc2 = nn.Linear(self.fc1.out_features, self.fc1.out_features*2) self.fc3 = nn.Linear(self.fc2.out_features, self.fc2.out_features*2) self.fc4 = nn.Linear(self.fc3.out_features, g_output_dim) # forward method def forward(self, x): x = F.leaky_relu(self.fc1(x), 0.2) x = F.leaky_relu(self.fc2(x), 0.2) x = F.leaky_relu(self.fc3(x), 0.2) return torch.tanh(self.fc4(x)) class Discriminator(nn.Module): def __init__(self, d_input_dim): super(Discriminator, self).__init__() self.fc1 = nn.Linear(d_input_dim, 1024) self.fc2 = nn.Linear(self.fc1.out_features, self.fc1.out_features//2) self.fc3 = nn.Linear(self.fc2.out_features, self.fc2.out_features//2) self.fc4 = nn.Linear(self.fc3.out_features, 1) # forward method def forward(self, x): x = F.leaky_relu(self.fc1(x), 0.2) x = F.dropout(x, 0.3) x = F.leaky_relu(self.fc2(x), 0.2) x = F.dropout(x, 0.3) x = F.leaky_relu(self.fc3(x), 0.2) x = F.dropout(x, 0.3) return torch.sigmoid(self.fc4(x)) z_dim = 100 mnist_dim = train_dataset.train_data.size(1) * train_dataset.train_data.size(2) # build network G = Generator(g_input_dim = z_dim, g_output_dim = mnist_dim).to(device) D = Discriminator(mnist_dim).to(device) # æ·»åŠ ç½‘ç»œå›¾åˆ°tensorboard writer.add_graph(G, input_to_model=torch.randn(batch_size, z_dim)) writer.add_graph(D, input_to_model=torch.randn(batch_size, mnist_dim)) # optimizer lr = 0.0002 g_optimizer = optim.Adam(G.parameters(), lr = lr) d_optimizer = optim.Adam(D.parameters(), lr = lr) # loss criterion = nn.BCELoss() def d_train(x): D.zero_grad() x_real, y_real = x.view(-1, mnist_dim).to(device), torch.ones(batch_size, 1).to(device) print(x_real.shape, y_real.shape) d_output = D(x_real) print(d_output.shape, y_real.shape) d_real_loss = criterion(d_output, y_real) d_real_score = d_output z = torch.randn(batch_size, z_dim).to(device) x_fake, y_fake = G(z), torch.zeros(batch_size, 1).to(device) d_output = D(x_fake) d_fake_loss = criterion(d_output, y_fake) d_fake_score = d_output d_loss = d_real_loss + d_fake_loss d_loss.backward() d_optimizer.step() return d_loss.item() def g_train(x): G.zero_grad() z = torch.randn(batch_size, z_dim).to(device) y = torch.ones(batch_size, 1).to(device) g_output = G(z) d_output = D(g_output) g_loss = criterion(d_output, y) g_loss.backward() g_optimizer.step() return g_loss.item() epochs = 10 step = 0 for epoch in range(epochs): d_losses, g_losses = [], [] for batch_idx, (x, _) in enumerate(train_loader): step += 1 d_losses.append(d_train(x)) g_losses.append(g_train(x)) print('[%d/%d]: [%d/%d]: loss_d: %.3f, loss_g: %.3f' % ( epoch, epochs,batch_idx, len(train_loader), torch.mean(torch.FloatTensor(d_losses)), torch.mean(torch.FloatTensor(g_losses)))) writer.add_scalar('g_loss', torch.mean(torch.FloatTensor(g_losses)), step) writer.add_scalar('d_loss', torch.mean(torch.FloatTensor(d_losses)), step) if batch_idx % 10 == 0: with torch.no_grad(): test_z = torch.randn(batch_size, z_dim).to(device) generated = G(test_z) img = img = torchvision.utils.make_grid(generated.view(generated.size(0), 1, 28, 28)) writer.add_image(f'mnist_{epoch}_{batch_idx}', img, global_","date":"2023-02-25","objectID":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/:3:9","tags":["deeplearning","gan"],"title":"å¼ºå¤§çš„GANç½‘ç»œ","uri":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/"},{"categories":["Python"],"content":"å‚è€ƒèµ„æ–™: GANå…¥é—¨ç†è§£åŠå…¬å¼æ¨å¯¼ - çŸ¥ä¹ (zhihu.com) lyeoni/pytorch-mnist-GAN (github.com) ","date":"2023-02-25","objectID":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/:3:10","tags":["deeplearning","gan"],"title":"å¼ºå¤§çš„GANç½‘ç»œ","uri":"/%E5%BC%BA%E5%A4%A7%E7%9A%84gan%E7%BD%91%E7%BB%9C/"},{"categories":["Markdown"],"content":"Markdownä½¿ç”¨mermaid ","date":"2023-02-19","objectID":"/markdown%E4%BD%BF%E7%94%A8mermaid/:0:0","tags":["markdown","mermaid"],"title":"Markdownä½¿ç”¨mermaid","uri":"/markdown%E4%BD%BF%E7%94%A8mermaid/"},{"categories":["Markdown"],"content":"0. ç¬¦å·è¡¨ç¤º ç±»å…ƒç´ çš„å¯è§èŒƒå›´ å¯è§èŒƒå›´ è¡¨ç¤ºæ–¹æ³• private - public + protected # package ~ ç±»çš„ä¿®é¥° ç¬¦å· ç±»å‹ \u003c\u003cInterface\u003e\u003e æ¥å£ \u003c\u003cabstract\u003e\u003e æŠ½è±¡ç±» \u003c\u003cService\u003e\u003e serviceç±» \u003c\u003cenumeration\u003e\u003e æšä¸¾ ","date":"2023-02-19","objectID":"/markdown%E4%BD%BF%E7%94%A8mermaid/:1:0","tags":["markdown","mermaid"],"title":"Markdownä½¿ç”¨mermaid","uri":"/markdown%E4%BD%BF%E7%94%A8mermaid/"},{"categories":["Markdown"],"content":"1. æ³›åŒ– å®šä¹‰: è¡¨ç¤ºç»§æ‰¿å…³ç³»(å­ç±»å’Œçˆ¶ç±»). è¡¨ç¤º:ä¸‰è§’å®çº¿,æŒ‡å‘çˆ¶ç±». classDiagram class Animal{ -age: int +sleep(): void } class Dog Animal \u003c|-- Dog ","date":"2023-02-19","objectID":"/markdown%E4%BD%BF%E7%94%A8mermaid/:2:0","tags":["markdown","mermaid"],"title":"Markdownä½¿ç”¨mermaid","uri":"/markdown%E4%BD%BF%E7%94%A8mermaid/"},{"categories":["Markdown"],"content":"2. å®ç° å®šä¹‰: è¡¨ç¤ºç±»å’Œæ¥å£ä¹‹é—´çš„å…³ç³». è¡¨ç¤º: ä¸‰è§’è™šçº¿,æŒ‡å‘æ¥å£. classDiagram class Person { + say(): void } class Man Person \u003c|.. Man ","date":"2023-02-19","objectID":"/markdown%E4%BD%BF%E7%94%A8mermaid/:3:0","tags":["markdown","mermaid"],"title":"Markdownä½¿ç”¨mermaid","uri":"/markdown%E4%BD%BF%E7%94%A8mermaid/"},{"categories":["Markdown"],"content":"3. ç»„åˆ å®šä¹‰: æ•´ä½“ä¸å±€éƒ¨çš„å…³ç³»,éƒ¨åˆ†ä¸èƒ½ç¦»å¼€æ•´ä½“å•ç‹¬å­˜åœ¨,ç§°ä¸ºå¼ºèšåˆ,å±äºå…³è”å…³ç³»çš„ä¸€ç§. è¡¨ç¤º: å®å¿ƒè±å½¢å®çº¿,å®å¿ƒè±å½¢æŒ‡å‘æ•´ä½“. ä»£ç ä½“ç°: æˆå‘˜å˜é‡ classDiagram class Person{ -brain } class Brain { - weight } Person *-- Brain ","date":"2023-02-19","objectID":"/markdown%E4%BD%BF%E7%94%A8mermaid/:4:0","tags":["markdown","mermaid"],"title":"Markdownä½¿ç”¨mermaid","uri":"/markdown%E4%BD%BF%E7%94%A8mermaid/"},{"categories":["Markdown"],"content":"4. èšåˆ å®šä¹‰: æ•´ä½“ä¸å±€éƒ¨çš„å…³ç³»,éƒ¨åˆ†èƒ½ç¦»å¼€æ•´ä½“å•ç‹¬å­˜åœ¨,ç§°ä¸ºå¼ºèšåˆ,å±äºå…³è”å…³ç³»çš„ä¸€ç§. è¡¨ç¤º: ç©ºå¿ƒè±å½¢å®çº¿,ç©ºå¿ƒè±å½¢æŒ‡å‘æ•´ä½“. ä»£ç ä½“ç°: æˆå‘˜å˜é‡ classDiagram class Computer { -keyboard } class Keyboard { -type } Computer o-- Keyboard ","date":"2023-02-19","objectID":"/markdown%E4%BD%BF%E7%94%A8mermaid/:5:0","tags":["markdown","mermaid"],"title":"Markdownä½¿ç”¨mermaid","uri":"/markdown%E4%BD%BF%E7%94%A8mermaid/"},{"categories":["Markdown"],"content":"5. å…³è” å®šä¹‰: ä¸€ç§æ‹¥æœ‰çš„å…³ç³», ä½¿ä¸€ä¸ªç±»çŸ¥é“å¦ä¸€ä¸ªç±»çš„å±æ€§å’Œæ–¹æ³•,å…³è”å¯ä»¥æ˜¯å•å‘çš„,ä¹Ÿå¯ä»¥æ˜¯åŒå‘çš„.åŒå‘çš„å…³è”å¯ä»¥æœ‰ä¸¤ä¸ªç®­å¤´æˆ–è€…æ²¡æœ‰ç®­å¤´ï¼Œå•å‘çš„å…³è”æœ‰ä¸€ä¸ªç®­å¤´. è¡¨ç¤º: æ™®é€šç®­å¤´çš„å®å¿ƒçº¿,æŒ‡å‘è¢«æ‹¥æœ‰è€…. ä»£ç ä½“ç°: æˆå‘˜å˜é‡ classDiagram class Teacher { -students: List\u003cStudent\u003e +teach(): void } class Student { -teacher: List\u003cTeacher\u003e +learn(): void } Teacher \u003c--\u003e Student ","date":"2023-02-19","objectID":"/markdown%E4%BD%BF%E7%94%A8mermaid/:6:0","tags":["markdown","mermaid"],"title":"Markdownä½¿ç”¨mermaid","uri":"/markdown%E4%BD%BF%E7%94%A8mermaid/"},{"categories":["Markdown"],"content":"6. ä¾èµ– å®šä¹‰: ä¸€ç§ä½¿ç”¨å…³ç³». è¡¨ç¤º: æ™®é€šç®­å¤´çš„è™šçº¿,ç®­å¤´æŒ‡å‘è¢«ä½¿ç”¨è€… ä»£ç ä½“ç°: å±€éƒ¨å˜é‡, æ–¹æ³•çš„å½¢å‚, æ–¹æ³•è¿”å›å€¼é™æ€æ–¹æ³•çš„è°ƒç”¨ classDiagram class Person { +draw(tool: DrawTool): void } class DrawTool { -color } Person \u003c.. DrawTool ","date":"2023-02-19","objectID":"/markdown%E4%BD%BF%E7%94%A8mermaid/:7:0","tags":["markdown","mermaid"],"title":"Markdownä½¿ç”¨mermaid","uri":"/markdown%E4%BD%BF%E7%94%A8mermaid/"},{"categories":["Markdown"],"content":"7. å„ç§å…³ç³»å¼ºå¼±é¡ºåº æ³›åŒ– = å®ç° \u003e ç»„åˆ \u003e èšåˆ \u003e å…³è” \u003e ä¾èµ– ","date":"2023-02-19","objectID":"/markdown%E4%BD%BF%E7%94%A8mermaid/:8:0","tags":["markdown","mermaid"],"title":"Markdownä½¿ç”¨mermaid","uri":"/markdown%E4%BD%BF%E7%94%A8mermaid/"},{"categories":["Git","Windows"],"content":"Git for Windows å®‰è£… Pacman ","date":"2022-12-24","objectID":"/git_for_windows/:0:0","tags":["git","pacman","msys2"],"title":"Git for Windows å®‰è£… Pacman","uri":"/git_for_windows/"},{"categories":["Git","Windows"],"content":"1. ä¸‹è½½å¿…è¦å‹ç¼©åŒ… curl -o pacman-6.0.1-9-x86_64.pkg.tar.zst -L https://repo.msys2.org/msys/x86_64/pacman-6.0.1-9-x86_64.pkg.tar.zst curl -o pacman-mirrors-20221016-1-any.pkg.tar.zst -L https://repo.msys2.org/msys/x86_64/pacman-mirrors-20221016-1-any.pkg.tar.zst curl -o msys2-keyring-1~20221024-1-any.pkg.tar.zst -L https://repo.msys2.org/msys/x86_64/msys2-keyring-1~20221024-1-any.pkg.tar.zst # æ­£å¸¸æ¥è¯´åªéœ€è¦ä¸Šé¢ä¸‰ä¸ªåŒ…ä½†æ˜¯ç”±äºç¼ºå°‘ zstd è§£å‹å·¥å…·è¿˜éœ€è¦ zstd åŒ… curl -o zstd-1.5.2-2-x86_64.pkg.tar.zst -L https://repo.msys2.org/msys/x86_64/zstd-1.5.2-2-x86_64.pkg.tar.zst # ä½†æ˜¯åˆå› ä¸º zstd åŒ…ä¹Ÿæ˜¯ zstd æ‰“åŒ…åˆéœ€è¦å¦ä¸€ä¸ªä¸æ˜¯ zstd æ‰“åŒ…çš„è§£å‹å·¥å…·æ¥è§£å‹ curl -o zstd-v1.5.2-win64.zip -L https://github.com/facebook/zstd/releases/download/v1.5.2/zstd-v1.5.2-win64.zip ","date":"2022-12-24","objectID":"/git_for_windows/:1:0","tags":["git","pacman","msys2"],"title":"Git for Windows å®‰è£… Pacman","uri":"/git_for_windows/"},{"categories":["Git","Windows"],"content":"2 .è§£å‹å¹¶å®‰è£…: unzip zstd-v1.5.2-win64.zip \"zstd-v1.5.2-win64/zstd.exe\" -d . ./zstd-v1.5.2-win64/zstd.exe -d -o zstd-1.5.2-2-x86_64.pkg.tar zstd-1.5.2-2-x86_64.pkg.tar.zst tar -xvf zstd-1.5.2-2-x86_64.pkg.tar -C / tar -xvf msys2-keyring-1~20221024-1-any.pkg.tar.zst -C / tar -xvf pacman-mirrors-20221016-1-any.pkg.tar.zst -C / tar -xvf pacman-6.0.1-9-x86_64.pkg.tar.zst -C / ","date":"2022-12-24","objectID":"/git_for_windows/:2:0","tags":["git","pacman","msys2"],"title":"Git for Windows å®‰è£… Pacman","uri":"/git_for_windows/"},{"categories":["Git","Windows"],"content":"3. æ·»åŠ å¯†é’¥å¹¶æ›´æ–°æ•°æ®åº“: pacman-key --init \u0026\u0026 pacman-key --populate msys2 pacman-db-upgrade -r /../ pacman -Sy ","date":"2022-12-24","objectID":"/git_for_windows/:3:0","tags":["git","pacman","msys2"],"title":"Git for Windows å®‰è£… Pacman","uri":"/git_for_windows/"},{"categories":["Git","Windows"],"content":"4. æ›´æ–°å…ƒæ•°æ®: # pacman -S pacman-mirrors-20221016-1 msys2-keyring-1~20221024-1 zstd-1.5.2-2 # pacman -S $(cut -d ' ' -f 1 /etc/package-versions.txt) URL=https://github.com/git-for-windows/git-sdk-64/raw/main cat /etc/package-versions.txt | while read p v; do d=/var/lib/pacman/local/$p-$v mkdir -p $d for f in desc files install mtree; do echo \"$URL$d/$f\" ..... $d/$f curl -sSL \"$URL$d/$f\" -o $d/$f done done curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/pacman-6.0.1-9/desc -o /var/lib/pacman/local/pacman-6.0.1-9/desc curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/pacman-6.0.1-9/files -o /var/lib/pacman/local/pacman-6.0.1-9/files curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/pacman-6.0.1-9/install -o /var/lib/pacman/local/pacman-6.0.1-9/install curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/pacman-6.0.1-9/mtree -o /var/lib/pacman/local/pacman-6.0.1-9/mtree curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/pacman-mirrors-20221016-1/desc -o /var/lib/pacman/local/pacman-mirrors-20221016-1/desc curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/pacman-mirrors-20221016-1/files -o /var/lib/pacman/local/pacman-mirrors-20221016-1/files curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/pacman-mirrors-20221016-1/install -o /var/lib/pacman/local/pacman-mirrors-20221016-1/install curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/pacman-mirrors-20221016-1/mtree -o /var/lib/pacman/local/pacman-mirrors-20221016-1/mtree curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/msys2-keyring-1~20221024-1/desc -o /var/lib/pacman/local/msys2-keyring-1~20221024-1/desc curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/msys2-keyring-1~20221024-1/files -o /var/lib/pacman/local/msys2-keyring-1~20221024-1/files curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/msys2-keyring-1~20221024-1/install -o /var/lib/pacman/local/msys2-keyring-1~20221024-1/install curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/msys2-keyring-1~20221024-1/mtree -o /var/lib/pacman/local/msys2-keyring-1~20221024-1/mtree curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/zstd-1.5.2-2/desc -o /var/lib/pacman/local/zstd-1.5.2-2/desc curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/zstd-1.5.2-2/files -o /var/lib/pacman/local/zstd-1.5.2-2/files curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/zstd-1.5.2-2/install -o /var/lib/pacman/local/zstd-1.5.2-2/install curl -sSL https://github.com/git-for-windows/git-sdk-64/raw/main/zstd-1.5.2-2/mtree -o /var/lib/pacman/local/zstd-1.5.2-2/mtree ","date":"2022-12-24","objectID":"/git_for_windows/:4:0","tags":["git","pacman","msys2"],"title":"Git for Windows å®‰è£… Pacman","uri":"/git_for_windows/"},{"categories":["Git","Windows"],"content":"5. å®‰è£…Fish Shell ","date":"2022-12-24","objectID":"/git_for_windows/:5:0","tags":["git","pacman","msys2"],"title":"Git for Windows å®‰è£… Pacman","uri":"/git_for_windows/"},{"categories":["Git","Windows"],"content":"5.1 å®‰è£…å¿…è¦ä¾èµ– pacman -S gcc-libs ","date":"2022-12-24","objectID":"/git_for_windows/:5:1","tags":["git","pacman","msys2"],"title":"Git for Windows å®‰è£… Pacman","uri":"/git_for_windows/"},{"categories":["Git","Windows"],"content":"5.2 å®‰è£…Fish Shellå¹¶å¯åŠ¨ pacman -S fish ","date":"2022-12-24","objectID":"/git_for_windows/:5:2","tags":["git","pacman","msys2"],"title":"Git for Windows å®‰è£… Pacman","uri":"/git_for_windows/"},{"categories":["Git","Windows"],"content":"5.3 å¯åŠ¨Fish Shell # åœ¨~/.bashrcæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œè®¾ç½®é»˜è®¤shellä¸ºfish if [ -t 1 ]; then exec fish fi ","date":"2022-12-24","objectID":"/git_for_windows/:5:3","tags":["git","pacman","msys2"],"title":"Git for Windows å®‰è£… Pacman","uri":"/git_for_windows/"},{"categories":["Git","Windows"],"content":"5.4 æ›´æ¢Fish Shell ä¸»é¢˜ fish_config ","date":"2022-12-24","objectID":"/git_for_windows/:5:4","tags":["git","pacman","msys2"],"title":"Git for Windows å®‰è£… Pacman","uri":"/git_for_windows/"},{"categories":["Git","Windows"],"content":"5. 5 Fish Shell å¸¸ç”¨å‘½ä»¤å’ŒåŸºæœ¬è®¾ç½® # å…³é—­é—®å€™è¯­ set -g -x fish_greeting '' set -U fish_greeting # è®¾ç½®ç¯å¢ƒå˜é‡ #åœ¨æœ€åä¸€è¡ŒåŠ å…¥(æ³¨æ„ç›®å½•é—´ç”¨ç©ºæ ¼éš”å¼€) set -x PATH /opt/demo/bin /home/guest/bin $PATH # åˆ é™¤å˜é‡ set -e Foo # é…ç½®åˆ«å # Define alias in config file alias rmi=\"rm -i\" # åˆ‡æ¢é»˜è®¤shellï¼Œgit for windowsä¸‹ä¸å¯ç”¨ echo $SHELL cat /etc/shells chsh -s /usr/bin/fish # å‘½ä»¤æ›¿æ¢ echo (date) # åœ¨bashä¸‹é¢ # echo `date` å‚è€ƒèµ„æ–™: pacmanå¸¸ç”¨å‘½ä»¤-æ˜¨å¤œæ˜Ÿè¾° (hustlei.github.io) Install inside MSYS2 proper Â· git-for-windows/git Wiki (github.com) Git:çµ¦ git for windows è£å€‹ç¿…è†€ (å®‰è£ pacman åŠå…¶ä»–å·¥å…·) @ å‚‘å…‹! çœŸæ˜¯å¤ªç¥å¥‡äº†! :: ç—å®¢é‚¦ :: (pixnet.net) åœ¨ Windows çš„ Git Bash ä¸­ä½¿ç”¨åŒ…ç®¡ç†å™¨ - iris (ginshio.org) Index of /msys/x86_64/ (msys2.org) Releases Â· facebook/zstd (github.com) Windows çš„ç»ˆç«¯é…ç½®(ç»™ git-windows æ·»åŠ  msys2 åŒ…ç®¡ç†å™¨) - zeromake çš„ä¸ªäººåšå®¢ MSYS2 å’Œ mintty æ‰“é€  Windows ä¸‹ Linux å·¥å…·ä½“éªŒ - Creaink - Build something for life Using fish shell with git bash on windows (github.com) Package management in Git for Windows (Git Bash)? - Stack Overflow Fish Shell | å®‰è£…é…ç½®æŒ‡å— - URmyLucky - åšå®¢å›­ (cnblogs.com) ","date":"2022-12-24","objectID":"/git_for_windows/:5:5","tags":["git","pacman","msys2"],"title":"Git for Windows å®‰è£… Pacman","uri":"/git_for_windows/"},{"categories":["Rust"],"content":"Rustååƒ»çŸ¥è¯†ç‚¹ ","date":"2022-12-13","objectID":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/:0:0","tags":["Rust"],"title":"Rustååƒ»çŸ¥è¯†ç‚¹","uri":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/"},{"categories":["Rust"],"content":"Cow(Clone on Write) ä¸¤ä¸ªå¯é€‰å€¼ï¼š Borrowedï¼Œç”¨äºåŒ…è£¹å¯¹è±¡çš„å¼•ç”¨ï¼ˆé€šç”¨å¼•ç”¨ï¼‰ï¼› Ownedï¼Œç”¨äºåŒ…è£¹å¯¹è±¡çš„æ‰€æœ‰è€…ï¼› Cow æä¾› å¯¹æ­¤å¯¹è±¡çš„ä¸å¯å˜è®¿é—®ï¼ˆæ¯”å¦‚å¯ç›´æ¥è°ƒç”¨æ­¤å¯¹è±¡åŸæœ‰çš„ä¸å¯å˜æ–¹æ³•ï¼‰ï¼› å¦‚æœé‡åˆ°éœ€è¦ä¿®æ”¹æ­¤å¯¹è±¡ï¼Œæˆ–è€…éœ€è¦è·å¾—æ­¤å¯¹è±¡çš„æ‰€æœ‰æƒçš„æƒ…å†µï¼ŒCow æä¾›æ–¹æ³•åšå…‹éš†å¤„ç†ï¼Œå¹¶é¿å…å¤šæ¬¡é‡å¤å…‹éš†ã€‚ Cow çš„è®¾è®¡ç›®çš„æ˜¯æé«˜æ€§èƒ½ï¼ˆå‡å°‘å¤åˆ¶ï¼‰åŒæ—¶å¢åŠ çµæ´»æ€§ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¸šåŠ¡åœºæ™¯éƒ½æ˜¯è¯»å¤šå†™å°‘ã€‚åˆ©ç”¨ Cowï¼Œå¯ä»¥ç”¨ç»Ÿä¸€ï¼Œè§„èŒƒçš„å½¢å¼å®ç°ï¼Œéœ€è¦å†™çš„æ—¶å€™æ‰åšä¸€æ¬¡å¯¹è±¡å¤åˆ¶ã€‚è¿™æ ·å°±å¯èƒ½ä¼šå¤§å¤§å‡å°‘å¤åˆ¶çš„æ¬¡æ•°ã€‚ å®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªè¦ç‚¹éœ€è¦æŒæ¡ï¼š Cow\u003cT\u003e èƒ½ç›´æ¥è°ƒç”¨ T çš„ä¸å¯å˜æ–¹æ³•ï¼Œå› ä¸º Cow è¿™ä¸ªæšä¸¾ï¼Œå®ç°äº† Derefï¼› åœ¨éœ€è¦å†™ T çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ .to_mut() æ–¹æ³•å¾—åˆ°ä¸€ä¸ªå…·æœ‰æ‰€æœ‰æƒçš„å€¼çš„å¯å˜å€Ÿç”¨ï¼›æ³¨æ„ï¼Œè°ƒç”¨ .to_mut() ä¸ä¸€å®šä¼šäº§ç”Ÿå…‹éš†ï¼› åœ¨å·²ç»å…·æœ‰æ‰€æœ‰æƒçš„æƒ…å†µä¸‹ï¼Œè°ƒç”¨ .to_mut() æœ‰æ•ˆï¼Œä½†æ˜¯ä¸ä¼šäº§ç”Ÿæ–°çš„å…‹éš†ï¼› å¤šæ¬¡è°ƒç”¨ .to_mut() åªä¼šäº§ç”Ÿä¸€æ¬¡å…‹éš†ã€‚ åœ¨éœ€è¦å†™ T çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ .into_owned() åˆ›å»ºæ–°çš„æ‹¥æœ‰æ‰€æœ‰æƒçš„å¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾€å¾€æ„å‘³ç€å†…å­˜æ‹·è´å¹¶åˆ›å»ºæ–°å¯¹è±¡ï¼› å¦‚æœä¹‹å‰ Cow ä¸­çš„å€¼æ˜¯å€Ÿç”¨çŠ¶æ€ï¼Œè°ƒç”¨æ­¤æ“ä½œå°†æ‰§è¡Œå…‹éš†ï¼› æœ¬æ–¹æ³•ï¼Œå‚æ•°æ˜¯selfç±»å‹ï¼Œå®ƒä¼šâ€œåƒæ‰â€åŸå…ˆçš„é‚£ä¸ªå¯¹è±¡ï¼Œè°ƒç”¨ä¹‹ååŸå…ˆçš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå°±æˆªæ­¢äº†ï¼Œåœ¨ Cow ä¸Šä¸èƒ½è°ƒç”¨å¤šæ¬¡ï¼› ä¸¾ä¾‹:å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¿‡æ»¤æ‰è¾“å…¥çš„å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç©ºæ ¼å­—ç¬¦ï¼Œå¹¶è¿”å›è¿‡æ»¤åçš„å­—ç¬¦ä¸²ã€‚ use std::borrow::Cow; fn remove_spaces\u003c'a\u003e(input: \u0026'a str) -\u003e Cow\u003c'a, str\u003e { if input.contains(' ') { let mut buf = String::with_capacity(input.len()); for c in input.chars() { if c != ' ' { buf.push(c); } } return Cow::Owned(buf); } return Cow::Borrowed(input); } ","date":"2022-12-13","objectID":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/:1:0","tags":["Rust"],"title":"Rustååƒ»çŸ¥è¯†ç‚¹","uri":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/"},{"categories":["Rust"],"content":"HRTBS(Higher-Ranked Trait Bounds) HRTBSä¸»è¦ç”¨äºè§£å†³å‡½æ•°å‚æ•°å«æœ‰é—­åŒ…,å¹¶ä¸”é—­åŒ…å‚æ•°å«æœ‰å¼•ç”¨ è¯­æ³•:for\u003câ€˜a\u003e T: Trait\u003câ€˜a\u003e ä¾‹å¦‚å¦‚ä¸‹ä»£ç å®é™…æ˜¯ä¸èƒ½ç¼–è¯‘é€šè¿‡çš„,å› ä¸ºç¼–è¯‘å™¨ä¸èƒ½æ¨æ–­å‡ºè¿”å›å“ªä¸ªå¼•ç”¨ fn call_on_ref_zero\u003cF\u003e(f: F) where F: Fn(\u0026i32, \u0026i32) -\u003e \u0026i32 { let zero = 0; f(\u0026zero, \u0026zero); } å°è¯•æ·»åŠ ç”Ÿå‘½å‘¨æœŸå‚æ•°,è¿˜æ˜¯ä¸èƒ½é€šè¿‡ç¼–è¯‘,å› ä¸ºzeroå˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­äºâ€™açš„. fn call_on_ref_zero\u003c'a, F\u003e(f: F) where F: Fn(\u0026'a i32, \u0026'a i32) -\u003e \u0026'a i32 { let zero = 0; f(\u0026zero, \u0026zero); } æˆ‘ä»¬å°è¯•ä½¿ç”¨HRTBSè¯•è¯• fn call_on_ref_zero\u003cF\u003e(f: F) where for\u003c'a\u003e F: Fn(\u0026'a i32, \u0026'a i32) -\u003e \u0026'a i32 { let zero = 0; f(\u0026zero, \u0026zero); } å¦ä¸€ä¸ªä¾‹å­ fn foo\u003c'b, F\u003e(f: F) -\u003e \u0026'b str where for\u003c'a\u003e F: Fn(\u0026'a str) -\u003e \u0026'a str, { let s = \"hello\"; f(s) } fn bar(s: \u0026str) -\u003e \u0026str { \u0026s[..1] } fn main() { let s = foo(bar); println!(\"{s}\"); } æœ€åä¸€ä¸ªä¾‹å­: fn foo\u003c'a\u003e(f: Box\u003cdyn Fn(\u0026'a i32)\u003e) { let x = 1; f(\u0026x); { let y = 2; f(\u0026y); } } ç¬¬ä¸€æ¬¡è°ƒç”¨ f(\u0026x) æ—¶ç”Ÿå‘½å‘¨æœŸ 'a ç­‰äºå˜é‡ x çš„ç”Ÿå‘½å‘¨æœŸï¼›è€Œåœ¨ç¬¬äºŒæ¬¡è°ƒç”¨ f(\u0026y) æ—¶ï¼Œç”Ÿå‘½å‘¨æœŸ 'a åˆç­‰äºäº†å˜é‡ y çš„ç”Ÿå‘½å‘¨æœŸï¼›è€Œå˜é‡ x å’Œå˜é‡ y çš„ç”Ÿå‘½å‘¨æœŸæ˜¾ç„¶æ˜¯ä¸åŒçš„ã€‚å› æ­¤æ— æ³•ç”¨ä¸€ä¸ªé™æ€çš„ç”Ÿå‘½å‘¨æœŸæ¥æè¿° 'a ï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯ï¼Œé—­åŒ… f åœ¨å…·ä½“è°ƒç”¨æ—¶ç»‘å®šå…·ä½“çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¯”å¦‚è°ƒç”¨ f(\u0026x) æ—¶ç»‘å®šçš„æ˜¯ x çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œè°ƒç”¨ f(\u0026y) æ—¶ç»‘å®šçš„æ˜¯ y çš„ç”Ÿå‘½å‘¨æœŸã€‚ ä½¿ç”¨HRTBSä¿®æ”¹å¦‚ä¸‹: fn foo(f: Box\u003cdyn for\u003c'a\u003e Fn(\u0026'a i32)\u003e) { let x = 1; f(\u0026x); { let y = 2; f(\u0026y); } } è¿™æ ·ç”Ÿå‘½å‘¨æœŸ 'a å°±ä¸å†æ˜¯é™æ€çš„äº†ï¼Œä»–ä¼šéšç€é—­åŒ… f çš„è°ƒç”¨ç»‘å®šåˆ°ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼šf(\u0026x) è°ƒç”¨æ—¶ç»‘å®šåˆ° x çš„ç”Ÿå‘½å‘¨æœŸï¼Œf(\u0026y) è°ƒç”¨æ—¶ç»‘å®šåˆ° y çš„ç”Ÿå‘½å‘¨æœŸã€‚ ","date":"2022-12-13","objectID":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/:2:0","tags":["Rust"],"title":"Rustååƒ»çŸ¥è¯†ç‚¹","uri":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/"},{"categories":["Rust"],"content":"PhantomData PhantomDataä¸»è¦ç”¨äºæ— ç•Œç”Ÿå‘½å‘¨æœŸ(unbounded lifetime)æˆ–è€…éœ€è¦drop structéè‡ªèº«å­—æ®µ,ä¾‹å¦‚: use std::marker: struct Vec\u003cT\u003e { data: *const T, // *constæ˜¯å¯å˜çš„ï¼ len: usize, cap: usize, _marker: marker::PhantomData\u003cT\u003e, } PhantomDataæ¨¡å¼è¡¨ Phantom ç±»å‹ 'a 'T PhantomData\u003cT\u003e - åå˜ï¼ˆå¯è§¦å‘dropæ£€æŸ¥ï¼‰ PhantomData\u003c\u0026'a T\u003e åå˜ åå˜ PhantomData\u003c\u0026'a mut T\u003e åå˜ ä¸å˜ PhantomData\u003c*const T\u003e - åå˜ PhantomData\u003c*mut T\u003e - ä¸å˜ PhantomData\u003cfn(T)\u003e - é€†å˜(*) PhantomData\u003cfn() -\u003e T\u003e - åå˜ PhantomData\u003cfn(T) -\u003e T\u003e - ä¸å˜ PhantomData\u003cCell\u003c\u0026'a ()\u003e\u003e ä¸å˜ - (*)å¦‚æœå‘ç”Ÿå˜æ€§çš„å†²çªï¼Œè¿™ä¸ªæ˜¯ä¸å˜çš„ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³›å‹ç»“æ„ä½“æ¥å®ç°å¯¹åŒä¸€ç§ç±»å¯¹è±¡ä¸åŒå­ç±»å¯¹è±¡çš„åŒºåˆ†ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿä¸­è¦è®¾è®¡è¿™æ ·ä¸€ä¸ªåŠŸèƒ½ï¼Œå°†ç”¨æˆ·åˆ†ä¸ºå…è´¹ç”¨æˆ·å’Œä»˜è´¹ç”¨æˆ·ï¼Œè€Œä¸”å…è´¹ç”¨æˆ·åœ¨ä½“éªŒå…è´¹åŠŸèƒ½ä¹‹åï¼Œå¦‚æœæƒ³å‡çº§æˆä»˜è´¹ç”¨æˆ·ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚æŒ‰ç…§æˆ‘ä»¬å¸¸è§„çš„æ€ç»´ï¼Œå¯èƒ½æ˜¯å®šä¹‰ä¸¤ä¸ªç»“æ„ä½“ FreeCustomer ä»¥åŠ PaidCustomerï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ³›å‹ç»“æ„ä½“æ¥å®ç°ï¼Œä¾‹å¦‚ï¼š struct Customer\u003cT\u003e { id: u64, name: String, } ä¸è¿‡ï¼Œæˆ‘ä»¬è¿™é‡Œçš„ T åˆæ— å¤„å®‰æ”¾ï¼Œæ‰€ä»¥åˆä¸å¾—ä¸ä½¿ç”¨ PhantomDataï¼Œå®ƒå°±åƒä¸€ä¸ªå ä½ç¬¦ï¼Œä½†æ˜¯åˆæ²¡æœ‰å¤§å°ï¼Œå¯ä»¥ä¸ºæˆ‘ä»¬æŒæœ‰åœ¨å£°æ˜æ—¶ä½¿ç”¨ä¸åˆ°çš„æ•°æ®ï¼š use std::{ marker::PhantomData, sync::atomic::{self, AtomicU64}, }; static NEXT_ID: AtomicU64 = AtomicU64::new(0); struct Customer\u003cT\u003e { id: u64, name: String, phantom: PhantomData\u003cT\u003e, } struct FreeFeature; struct PaidFeature; trait Free { fn feature1(\u0026self); fn feature2(\u0026self); } trait Paid: Free { fn paid_feature(\u0026self); } /// ä¸º Customer\u003cT\u003e å®ç°éœ€è¦çš„æ–¹æ³• impl\u003cT\u003e Customer\u003cT\u003e { fn new(name: String) -\u003e Self { Self { id: NEXT_ID.fetch_add(1, atomic::Ordering::Relaxed), name, phantom: PhantomData, } } } /// å…è´¹ç”¨æˆ·å¯ä»¥å‡çº§åˆ°ä»˜è´¹ç”¨æˆ· impl Customer\u003cFreeFeature\u003e { fn advance(self, payment: f64) -\u003e Customer\u003cPaidFeature\u003e { println!( \"{}ï¼ˆ{}ï¼‰ å°†èŠ±è´¹ {:.2} å…ƒå‡çº§åˆ°ä»˜è´¹ç”¨æˆ·\", self.name, self.id, payment ); self.into() } } /// æ‰€æœ‰å®¢æˆ·éƒ½æœ‰æƒä½¿ç”¨å…è´¹åŠŸèƒ½ impl\u003cT\u003e Free for Customer\u003cT\u003e { fn feature1(\u0026self) { println!(\"{} æ­£åœ¨ä½¿ç”¨å…è´¹åŠŸèƒ½ä¸€\", self.name) } fn feature2(\u0026self) { println!(\"{} æ­£åœ¨ä½¿ç”¨å…è´¹åŠŸèƒ½äºŒ\", self.name) } } /// ä»˜è´¹ç”¨æˆ·æ‰èƒ½ä½¿ç”¨çš„åŠŸèƒ½ impl Paid for Customer\u003cPaidFeature\u003e { fn paid_feature(\u0026self) { println!(\"{} æ­£åœ¨ä½¿ç”¨ä»˜è´¹åŠŸèƒ½\", self.name) } } /// å…è®¸ä½¿ç”¨å…è´¹ç”¨æˆ·è½¬æ¢æˆä»˜è´¹ç”¨æˆ· impl From\u003cCustomer\u003cFreeFeature\u003e\u003e for Customer\u003cPaidFeature\u003e { fn from(c: Customer\u003cFreeFeature\u003e) -\u003e Self { Self::new(c.name) } } #[cfg(test)] mod tests { use super::*; #[test] fn test_customer() { // ä¸€å¼€å§‹æ˜¯å…è´¹ç”¨æˆ· let customer = Customer::\u003cFreeFeature\u003e::new(\"MichaelFu\".to_owned()); customer.feature1(); customer.feature2(); // å‡çº§æˆä»˜è´¹ç”¨æˆ·ï¼Œå¯èƒ½ä½¿ç”¨ä»˜è´¹åŠŸèƒ½å’Œæ™®é€šåŠŸèƒ½ let customer = customer.advance(99.99); customer.feature1(); customer.feature2(); customer.paid_feature(); } } ","date":"2022-12-13","objectID":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/:3:0","tags":["Rust"],"title":"Rustååƒ»çŸ¥è¯†ç‚¹","uri":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/"},{"categories":["Rust"],"content":"Thread_local thread_localæ˜¯ä¸€ç§å°†æ•°æ®å­˜å‚¨åˆ°å…¨å±€å˜é‡ä¸­çš„æ–¹æ³•ï¼Œç¨‹åºä¸­çš„æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å‰¯æœ¬ã€‚çº¿ç¨‹ä¸å…±äº«è¿™ä¸ªæ•°æ®ï¼Œæ‰€ä»¥è®¿é—®ä¸éœ€è¦åŒæ­¥,thread_localä¸­å£°æ˜çš„å˜é‡ï¼Œåœ¨çº¿ç¨‹ç»“æŸåä¼šè¢«é‡Šæ”¾ï¼Œæ¯”å¦‚å¦‚æœæœ‰10ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨äº†è¯¥thread_localå˜é‡,åˆ™è¿™10ä¸ªçº¿ç¨‹ç»“æŸæ—¶å°†æœ‰10ä¸ªè¯¥ç±»å‹çš„å˜é‡è¢«é‡Šæ”¾ã€‚è¿™é€‚ç”¨äºthread_per_coreæ¶æ„çš„å¼‚æ­¥è¿è¡Œæ—¶(ç±»ä¼¼äºnginx),è€Œä¸æ˜¯tokioè¿™ç§work-stealing scheduler(ä»»åŠ¡çªƒå–). ä¸¾ä¸ªä¾‹å­: use std::borrow::Cow; use std::cell::RefCell; use std::thread; fn main() { thread_local!(static FOO: RefCell\u003cu32\u003e = RefCell::new(1)); FOO.with(|f| { assert_eq!(*f.borrow(), 1); *f.borrow_mut() = 2; }); // æ¯ä¸ªçº¿ç¨‹å¼€å§‹æ—¶éƒ½ä¼šæ‹¿åˆ°çº¿ç¨‹å±€éƒ¨å˜é‡çš„FOOçš„åˆå§‹å€¼ let t = thread::spawn(move || { FOO.with(|f| { assert_eq!(*f.borrow(), 1); *f.borrow_mut() = 3; }); }); // ç­‰å¾…çº¿ç¨‹å®Œæˆ t.join().unwrap(); // å°½ç®¡å­çº¿ç¨‹ä¸­ä¿®æ”¹ä¸ºäº†3ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¾ç„¶æ‹¥æœ‰mainçº¿ç¨‹ä¸­çš„å±€éƒ¨å€¼ï¼š2 FOO.with(|f| { assert_eq!(*f.borrow(), 2); }); } ","date":"2022-12-13","objectID":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/:4:0","tags":["Rust"],"title":"Rustååƒ»çŸ¥è¯†ç‚¹","uri":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/"},{"categories":["Rust"],"content":"Barrier(çº¿ç¨‹å±éšœ) ä½¿ç”¨ Barrier è®©å¤šä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œåˆ°æŸä¸ªç‚¹åï¼Œæ‰ç»§ç»­ä¸€èµ·å¾€åæ‰§è¡Œï¼š use std::sync::{Arc, Barrier}; use std::thread; fn main() { let mut handles = Vec::with_capacity(5); let barrier = Arc::new(Barrier::new(5)); for _ in 0..5 { let b = barrier.clone(); handles.push(thread::spawn(move|| { println!(\"before wait\"); b.wait(); println!(\"after wait\"); })); } for handle in handles { handle.join().unwrap(); } } ","date":"2022-12-13","objectID":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/:5:0","tags":["Rust"],"title":"Rustååƒ»çŸ¥è¯†ç‚¹","uri":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/"},{"categories":["Rust"],"content":"once_cellå’Œlazy_static once_cell å’Œ lazy_static éƒ½æ˜¯ Rust ä¸­ç”¨äºå®ç°å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰çš„åº“ã€‚ once_cell é€‚ç”¨äºç¨‹åºåˆå§‹åŒ–åŠ è½½é…ç½®æ–‡ä»¶è¿™ç§åœºæ™¯ LazyCellå’ŒLazyLocké€‚ç”¨äºåˆå§‹åŒ–æŸä¸ªå˜é‡,æ¯”å¦‚è¯´æ­£åˆ™çš„compile,æ•°æ®åº“è¿æ¥ç­‰åœºæ™¯. #![feature(once_cell)] use std::cell; use std::collections::HashMap; use std::sync; use std::sync::Once; static INIT: Once = sync::Once::new(); static mut SUM: u64 = 0; fn init_sum() -\u003e u64 { unsafe { INIT.call_once(|| { println!(\"this is first init\"); SUM = (1..100000).sum(); }); SUM } } fn main() { let split_line = \"*\".repeat(100); let first_result = init_sum(); println!(\"first result: {first_result}\"); let second_result = init_sum(); println!(\"second result: {second_result}\"); println!(\"{split_line}\"); let once = cell::OnceCell::\u003cHashMap\u003c\u0026str, \u0026str\u003e\u003e::new(); let dict = once.get_or_init(|| { println!(\"this is hash map init once\"); let mut map = HashMap::new(); map.insert(\"lang\", \"rust\"); map.insert(\"edition\", \"2021\"); map }); println!(\"once dict: {dict:?}\"); let dict_twice = once.get_or_init(|| { println!(\"this is hash map init twice\"); let mut map = HashMap::new(); map.insert(\"lang\", \"python\"); map.insert(\"version\", \"1.10\"); map }); println!(\"twice dict: {dict_twice:?}\"); println!(\"{split_line}\"); let lazy_init = cell::LazyCell::new(|| env!(\"PATH\")); println!(\"lazy_init: {}\", *lazy_init); // thread safe lazy cell let lazy_init_safe = sync::LazyLock::new(|| env!(\"PATH\")); print!(\"lazy_init_safe: {}\", *lazy_init_safe); } ","date":"2022-12-13","objectID":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/:6:0","tags":["Rust"],"title":"Rustååƒ»çŸ¥è¯†ç‚¹","uri":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/"},{"categories":["Rust"],"content":"impl A and T: A åœ¨ impl ä¸­è¢«å£°æ˜çš„ç±»å‹å‚æ•°ï¼Œè‡³å°‘è¦æ»¡è¶³ä¸‹é¢ä¸‰ç§å½¢å¼ï¼š impl Fooï¼Œ T å‡ºç°åœ¨å®ç°çš„Self ç±»å‹Foo ä¸­ ã€‚ impl SomeTrait for Foo ï¼Œ Tå‡ºç°åœ¨è¦å®ç°çš„ trait ä¸­ ã€‚ impl\u003cT, U\u003e SomeTrait for T where T: AnotherTrait\u003cAssocType=U\u003e ï¼Œ å‡ºç°åœ¨ T çš„ trait é™å®šçš„å…³è”ç±»å‹ä¸­ã€‚ å‚è€ƒèµ„æ–™: ã€Rustã€‘å¹½çµæ•°æ®ï¼ˆPhantomDataï¼‰ | MichaelFu (fudenglong.site) 3.10 PhantomDataï¼ˆå¹½çµæ•°æ®ï¼‰ | ç¬¬ä¸‰ç« ã€æ‰€æœ‰æƒ |ã€ŠRust é«˜çº§ç¼–ç¨‹ 2018ã€‹| Rust æŠ€æœ¯è®ºå› (learnku.com) Rusté«˜é˜¶ç”Ÿå‘½å‘¨æœŸç»‘å®š (xiaopengli89.github.io) ","date":"2022-12-13","objectID":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/:7:0","tags":["Rust"],"title":"Rustååƒ»çŸ¥è¯†ç‚¹","uri":"/rust%E5%81%8F%E5%83%BB%E7%9F%A5%E8%AF%86%E7%82%B9/"},{"categories":["c/c++"],"content":"cmakeç®€æ˜“æ•™ç¨‹ ","date":"2022-12-10","objectID":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/:0:0","tags":["cmake"],"title":"Cmakeç®€æ˜“æ•™ç¨‹","uri":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/"},{"categories":["c/c++"],"content":"1. æ·»åŠ å¤´æ–‡ä»¶ç›®å½•INCLUDE_DIRECTORIES å®ƒç›¸å½“äºg++é€‰é¡¹ä¸­çš„-Iå‚æ•°çš„ä½œç”¨ï¼Œä¹Ÿç›¸å½“äºç¯å¢ƒå˜é‡ä¸­å¢åŠ è·¯å¾„åˆ°CPLUS_INCLUDE_PATHå˜é‡çš„ä½œç”¨ã€‚ è¯­æ³•ï¼š include_directories([AFTER|BEFORE] [SYSTEM] dir1 [dir2 ...]) ","date":"2022-12-10","objectID":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/:1:0","tags":["cmake"],"title":"Cmakeç®€æ˜“æ•™ç¨‹","uri":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/"},{"categories":["c/c++"],"content":"2. æ·»åŠ éœ€è¦é“¾æ¥çš„åº“æ–‡ä»¶ç›®å½•LINK_DIRECTORIES è¯­æ³•ï¼š link_directories(directory1 directory2 ...) å®ƒç›¸å½“äºg++å‘½ä»¤çš„-Lé€‰é¡¹çš„ä½œç”¨ï¼Œä¹Ÿç›¸å½“äºç¯å¢ƒå˜é‡ä¸­å¢åŠ LD_LIBRARY_PATHçš„è·¯å¾„çš„ä½œç”¨ã€‚ link_directories(\"/home/server/third/lib\") ","date":"2022-12-10","objectID":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/:2:0","tags":["cmake"],"title":"Cmakeç®€æ˜“æ•™ç¨‹","uri":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/"},{"categories":["c/c++"],"content":"3. æ·»åŠ éœ€è¦é“¾æ¥çš„åº“æ–‡ä»¶è·¯å¾„LINK_LIBRARIES è¯­æ³•ï¼š link_libraries(library1 \u003cdebug | optimized\u003e library2 ...) ","date":"2022-12-10","objectID":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/:3:0","tags":["cmake"],"title":"Cmakeç®€æ˜“æ•™ç¨‹","uri":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/"},{"categories":["c/c++"],"content":"4. è®¾ç½®è¦é“¾æ¥çš„åº“æ–‡ä»¶çš„åç§°TARGET_LINK_LIBRARIES è¯­æ³•ï¼š target_link_libraries(\u003ctarget\u003e [item1 [item2 [...]]] [[debug|optimized|general] \u003citem\u003e] ...) ","date":"2022-12-10","objectID":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/:4:0","tags":["cmake"],"title":"Cmakeç®€æ˜“æ•™ç¨‹","uri":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/"},{"categories":["c/c++"],"content":"5. æŸ¥æ‰¾åº“æ‰€åœ¨ç›®å½•FIND_LIBRARY è¯­æ³•ï¼š find_library (\u003cVAR\u003e name1 [path1 path2 ...]) find_library ( \u003cVAR\u003e name | NAMES name1 [name2 ...] [NAMES_PER_DIR] [HINTS path1 [path2 ... ENV var]] [PATHS path1 [path2 ... ENV var]] [PATH_SUFFIXES suffix1 [suffix2 ...]] [DOC \"cache documentation string\"] [NO_DEFAULT_PATH] [NO_CMAKE_ENVIRONMENT_PATH] [NO_CMAKE_PATH] [NO_SYSTEM_ENVIRONMENT_PATH] [NO_CMAKE_SYSTEM_PATH] [CMAKE_FIND_ROOT_PATH_BOTH | ONLY_CMAKE_FIND_ROOT_PATH | NO_CMAKE_FIND_ROOT_PATH] ) ä¾‹å­å¦‚ä¸‹ï¼š FIND_LIBRARY(RUNTIME_LIB rt /usr/lib /usr/local/lib NO_DEFAULT_PATH) cmakeä¼šåœ¨ç›®å½•ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰€æœ‰ç›®å½•ä¸­éƒ½æ²¡æœ‰ï¼Œå€¼RUNTIME_LIBå°±ä¼šè¢«èµ‹ä¸ºNO_DEFAULT_PATH ","date":"2022-12-10","objectID":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/:5:0","tags":["cmake"],"title":"Cmakeç®€æ˜“æ•™ç¨‹","uri":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/"},{"categories":["c/c++"],"content":"6. æŸ¥æ‰¾æºæ–‡ä»¶å’Œå¤´æ–‡ä»¶ # æŸ¥æ‰¾æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰.cppä¸.hæ–‡ä»¶ å¹¶å­˜æ”¾åˆ°æŒ‡å®šå˜é‡åSC_FILESä¸­ FILE(GLOB SC_FILES \"*.cpp\" \"*.h\") ","date":"2022-12-10","objectID":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/:6:0","tags":["cmake"],"title":"Cmakeç®€æ˜“æ•™ç¨‹","uri":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/"},{"categories":["c/c++"],"content":"7. æ·»åŠ æºæ–‡ä»¶ç›®å½• ä½¿ç”¨ aux_source_directory å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¼šæŸ¥æ‰¾æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æºæ–‡ä»¶ï¼Œç„¶åå°†ç»“æœå­˜è¿›æŒ‡å®šå˜é‡åã€‚ è¯­æ³•ï¼š aux_source_directory(\u003cdir\u003e \u003cvariable\u003e) # ç”Ÿæˆé“¾æ¥åº“ add_library (MathFunctions ${DIR_LIB_SRCS}) å‚è€ƒé“¾æ¥ï¼š cmake æ·»åŠ å¤´æ–‡ä»¶ç›®å½•ï¼Œé“¾æ¥åŠ¨æ€ã€é™æ€åº“ - ç‹å½¬å½¬ - åšå®¢å›­ (cnblogs.com) ","date":"2022-12-10","objectID":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/:7:0","tags":["cmake"],"title":"Cmakeç®€æ˜“æ•™ç¨‹","uri":"/cmake%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/"},{"categories":["Python"],"content":"opencvå®ç°æŠ å›¾å’Œè£å‰ª ","date":"2022-12-04","objectID":"/opencv%E6%8A%A0%E5%9B%BE%E5%92%8C%E8%A3%81%E5%89%AA%E5%9B%BE%E7%89%87/:0:0","tags":["opencv"],"title":"OpencvæŠ å›¾å’Œè£å‰ªå›¾ç‰‡","uri":"/opencv%E6%8A%A0%E5%9B%BE%E5%92%8C%E8%A3%81%E5%89%AA%E5%9B%BE%E7%89%87/"},{"categories":["Python"],"content":"1. æŠ å›¾ æ­¥éª¤: åŠ è½½å›¾åƒ è½¬æ¢å›¾åƒæ ¼å¼(BGR â€“\u003e HSV) è®¾ç½®é˜ˆå€¼ é€šè¿‡é˜ˆå€¼æå–éƒ¨åˆ†åŒºåŸŸ æ˜¾ç¤ºå›¾ç‰‡ å…³äºHSVå¯å‚è€ƒï¼šHSLå’ŒHSVè‰²å½©ç©ºé—´ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦ (wikipedia.org) window_name = 'hsv' img = cv2.imread(r\"D:\\picture\\other\\2E3246E873376135DC6F202D1456B37E.jpg\") # è®¾ç½®é«˜ä½é˜ˆå€¼ hsv_low = np.array([0, 0, 0]) hsv_high = np.array([134, 255, 138]) # å°†BGRè½¬ä¸ºHSV dst = cv2.cvtColor(img, cv2.COLOR_HSV2BGR) # é€šè¿‡HSVçš„é«˜ä½é˜ˆå€¼ï¼Œæå–å›¾åƒéƒ¨åˆ†åŒºåŸŸ mask_img = cv2.inRange(dst, hsv_low, hsv_high) # è¿›è¡Œä¸ä½è¿ç®— img_ = cv2.bitwise_and(img, img, mask=mask_img) cv2.imshow(window_name, img_) cv2.waitKey(0) cv2.destroyAllWindows() ","date":"2022-12-04","objectID":"/opencv%E6%8A%A0%E5%9B%BE%E5%92%8C%E8%A3%81%E5%89%AA%E5%9B%BE%E7%89%87/:1:0","tags":["opencv"],"title":"OpencvæŠ å›¾å’Œè£å‰ªå›¾ç‰‡","uri":"/opencv%E6%8A%A0%E5%9B%BE%E5%92%8C%E8%A3%81%E5%89%AA%E5%9B%BE%E7%89%87/"},{"categories":["Python"],"content":"2. è£å‰ªå›¾ç‰‡ æ­¥éª¤ åŠ è½½å›¾åƒ è®¾ç½®é¼ æ ‡äº‹ä»¶ - é¼ æ ‡å·¦é”®å•å‡»ç”»ç‚¹\r- é¼ æ ‡å³é”®å•å‡»é—­åˆæ‰€ç”»çš„ç‚¹\r- é¼ æ ‡å³é”®åŒå‡»å¡«å…… # è§¦å‘é¼ æ ‡ç§»åŠ¨äº‹ä»¶ # cv2.CV_EVENT_MOUSEMOVE # è§¦å‘å·¦é”®æŠ¬èµ·äº‹ä»¶ # cv2.CV_EVENT_LBUTTONUP # è§¦å‘å³é”®æŒ‰ä¸‹äº‹ä»¶ # cv2.CV_EVENT_RBUTTONDOWN # è§¦å‘å³é”®æŠ¬èµ·äº‹ä»¶ # cv2.CV_EVENT_RBUTTONUP # è§¦å‘å·¦é”®åŒå‡»äº‹ä»¶ # cv2.CV_EVENT_LBUTTONDBLCLK # è§¦å‘å³é”®åŒå‡»äº‹ä»¶ # cv2.CV_EVENT_RBUTTONDBLCLK coordinates = [] window_name = 'draw' def on_mouse_callback(event, x, y, flag, param): # å·¦é”®ç‚¹å‡»,ç”»ç‚¹ if event == cv2.EVENT_LBUTTONDOWN: xy = f'{x},{y}' coordinates.append((x, y)) cv2.circle(img, (x, y), 1, (0, 0, 255), thickness=-1) cv2.putText(img, xy, (x, y), cv2.FONT_HERSHEY_PLAIN, 1.0, (0, 0, 0), thickness=1) cv2.imshow(window_name, img) # å³é”®å•å‡»ï¼Œç”»ä¸è§„åˆ™å›¾å½¢ elif event == cv2.EVENT_RBUTTONDOWN: pts = np.array(coordinates, np.int32) # é¡¶ç‚¹é›† #é¡¶ç‚¹åæ ‡è½¬ä¸ºrowsx1x2, rowä¸ºé¡¶ç‚¹æ•° pts = pts.reshape((-1, 1, 2)) cv2.polylines(img, [pts], True, (255, 255, 255), 2) cv2.imshow(window_name, img) # å³é”®åŒå‡»ï¼Œå¡«å……é¢œè‰² elif event == cv2.EVENT_RBUTTONDBLCLK: area = np.array(coordinates) # å¯ä»¥ç»˜åˆ¶å¤šä¸ªå›¾å½¢ cv2.fillPoly(img, [area], (255, 255, 255)) # ç»˜åˆ¶å‡¸å¤šè¾¹å½¢ # cv2.fillConvexPoly(img, area, (255, 255, 255)) cv2.imshow(window_name, img) coordinates.clear() cv2.namedWindow(window_name) cv2.setMouseCallback(window_name, on_mouse_callback) cv2.imshow(window_name, img) cv2.waitKey(0) cv2.destroyAllWindows() Rustç‰ˆopencvå®ç°æŠ å›¾ Cargo.toml [dependencies] opencv = { version = \"0.71\" } src/main.rs use opencv::{ core::{bitwise_and, in_range, Vector, CV_8UC3}, highgui::{destroy_all_windows, imshow, wait_key}, imgcodecs::{imread, ImreadModes}, imgproc::{cvt_color, COLOR_BGR2HSV}, prelude::*, }; fn main() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e { let img = imread( r\"D:\\picture\\other\\2E3246E873376135DC6F202D1456B37E.jpg\", ImreadModes::IMREAD_COLOR as i32, )?; unsafe { let mut lowerb = Vector::from_slice(\u0026[0, 0, 0u8]); let mut upperb = Vector::from_slice(\u0026[134, 255, 138u8]); let mut dst = Mat::new_nd(img.dims(), \u0026img.size().unwrap().width, CV_8UC3)?; let mut mask_img = Mat::new_nd(img.dims(), \u0026img.size().unwrap().width, CV_8UC3)?; let mut result = Mat::new_nd(img.dims(), \u0026img.size().unwrap().width, CV_8UC3)?; cvt_color(\u0026img, \u0026mut dst, COLOR_BGR2HSV, 0)?; in_range(\u0026img, \u0026mut lowerb, \u0026mut upperb, \u0026mut mask_img)?; bitwise_and(\u0026img, \u0026img, \u0026mut result, \u0026mask_img)?; imshow(\"winname\", \u0026result)?; } wait_key(0)?; destroy_all_windows()?; Ok(()) } ","date":"2022-12-04","objectID":"/opencv%E6%8A%A0%E5%9B%BE%E5%92%8C%E8%A3%81%E5%89%AA%E5%9B%BE%E7%89%87/:2:0","tags":["opencv"],"title":"OpencvæŠ å›¾å’Œè£å‰ªå›¾ç‰‡","uri":"/opencv%E6%8A%A0%E5%9B%BE%E5%92%8C%E8%A3%81%E5%89%AA%E5%9B%BE%E7%89%87/"},{"categories":["Rust"],"content":"Rustä¸­ä½¿ç”¨opencv å› ä¸ºåœ¨macoså’Œlinuxä¸Šå®‰è£…æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œåªä»‹ç»windowsä¸Šçš„å®‰è£… ","date":"2022-12-04","objectID":"/rust%E4%BD%BF%E7%94%A8opencv/:0:0","tags":["opencv"],"title":"Rustä½¿ç”¨opencv","uri":"/rust%E4%BD%BF%E7%94%A8opencv/"},{"categories":["Rust"],"content":"å®‰è£…ç¯å¢ƒ ","date":"2022-12-04","objectID":"/rust%E4%BD%BF%E7%94%A8opencv/:1:0","tags":["opencv"],"title":"Rustä½¿ç”¨opencv","uri":"/rust%E4%BD%BF%E7%94%A8opencv/"},{"categories":["Rust"],"content":"1. å®‰è£…opencv ä¸‹è½½åœ°å€ï¼šReleases - OpenCV é€‰æ‹©windowså¹³å°ï¼Œä¸‹è½½åé»˜è®¤å®‰è£…å³å¯ è®¾ç½®ç¯å¢ƒå˜é‡ OPENCV_INCLUDE_PATHS OPENCV_LINK_LIBS OPENCV_LINK_PATHS æ³¨æ„ï¼šopencv_world460è¿™ä¸ªä¸æ˜¯å›ºå®šçš„ï¼Œéœ€è¦æ ¹æ®ä¸‹è½½çš„å…·ä½“ç‰ˆæœ¬è®¾ç½®ï¼Œæˆ‘çš„ç‰ˆæœ¬ä¸­ä½äºD:\\development\\opencv\\build\\x64\\vc15\\binç›®å½• ","date":"2022-12-04","objectID":"/rust%E4%BD%BF%E7%94%A8opencv/:1:1","tags":["opencv"],"title":"Rustä½¿ç”¨opencv","uri":"/rust%E4%BD%BF%E7%94%A8opencv/"},{"categories":["Rust"],"content":"2. å®‰è£…LLVM ä¸‹è½½åœ°å€ï¼šReleases Â· llvm/llvm-project (github.com) æ ¹æ®éœ€è¦å®‰è£…32ä½æˆ–è€…64ä½ï¼Œæœ‰äº›ç‰ˆæœ¬å¯èƒ½æ²¡æœ‰è¿™2ä¸ªé€‰é¡¹ï¼Œå¯ä»¥é€‰æ‹©ä»¥å‰çš„ç‰ˆæœ¬ï¼Œæ²¡å¿…è¦é€‰æ‹©æœ€æ–°çš„ç‰ˆæœ¬ã€‚ä¸‹è½½åé»˜è®¤å®‰è£…å³å¯ï¼Œæ³¨æ„éœ€è¦åœ¨æ·»åŠ LLVMåˆ°ç¯å¢ƒå˜é‡ä¸­ ","date":"2022-12-04","objectID":"/rust%E4%BD%BF%E7%94%A8opencv/:1:2","tags":["opencv"],"title":"Rustä½¿ç”¨opencv","uri":"/rust%E4%BD%BF%E7%94%A8opencv/"},{"categories":["Rust"],"content":"ç®€å•ä½¿ç”¨ ","date":"2022-12-04","objectID":"/rust%E4%BD%BF%E7%94%A8opencv/:2:0","tags":["opencv"],"title":"Rustä½¿ç”¨opencv","uri":"/rust%E4%BD%BF%E7%94%A8opencv/"},{"categories":["Rust"],"content":"1. ç¡®ä¿å®‰è£…äº†Rustç¯å¢ƒ ","date":"2022-12-04","objectID":"/rust%E4%BD%BF%E7%94%A8opencv/:2:1","tags":["opencv"],"title":"Rustä½¿ç”¨opencv","uri":"/rust%E4%BD%BF%E7%94%A8opencv/"},{"categories":["Rust"],"content":"2. æ–°å»ºé¡¹ç›® cargo new opencv-rust-test ","date":"2022-12-04","objectID":"/rust%E4%BD%BF%E7%94%A8opencv/:2:2","tags":["opencv"],"title":"Rustä½¿ç”¨opencv","uri":"/rust%E4%BD%BF%E7%94%A8opencv/"},{"categories":["Rust"],"content":"3. é…ç½®Cargo.tomlæ–‡ä»¶ [dependencies] opencv = { version = \"0.71\" } ","date":"2022-12-04","objectID":"/rust%E4%BD%BF%E7%94%A8opencv/:2:3","tags":["opencv"],"title":"Rustä½¿ç”¨opencv","uri":"/rust%E4%BD%BF%E7%94%A8opencv/"},{"categories":["Rust"],"content":"4. å°†opencv_world460.dllæ–‡ä»¶æ‹·è´åˆ°é¡¹ç›®æ ¹ç›®å½•(é‡è¦ï¼ï¼ï¼) å¦‚æœopencv_world460.dllè·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œåº”è¯¥å°±ä¸éœ€è¦å°†æ–‡ä»¶æ‹·è´(æ²¡æœ‰å®é™…æµ‹è¯•) ","date":"2022-12-04","objectID":"/rust%E4%BD%BF%E7%94%A8opencv/:2:4","tags":["opencv"],"title":"Rustä½¿ç”¨opencv","uri":"/rust%E4%BD%BF%E7%94%A8opencv/"},{"categories":["Rust"],"content":"5. ç¼–å†™ä»£ç æµ‹è¯•ç¯å¢ƒæ˜¯å¦æ­£å¸¸ src/main.rs use opencv::{ highgui::{destroy_all_windows, imshow, wait_key}, imgcodecs::{imread, ImreadModes}, }; fn main() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e { let img_path = r\"D:\\picture\\other\\2E3246E873376135DC6F202D1456B37E.jpg\"; let img = imread(img_path, ImreadModes::IMREAD_COLOR as i32)?; imshow(\"winname\", \u0026img)?; wait_key(0)?; destroy_all_windows()?; Ok(()) } ","date":"2022-12-04","objectID":"/rust%E4%BD%BF%E7%94%A8opencv/:2:5","tags":["opencv"],"title":"Rustä½¿ç”¨opencv","uri":"/rust%E4%BD%BF%E7%94%A8opencv/"},{"categories":["Rust"],"content":"6. è¿è¡Œæµ‹è¯• # ä½¿ç”¨cargoå‘½ä»¤è¿è¡Œçœ‹çœ‹æ˜¯å¦æ­£å¸¸æ˜¾ç¤ºå›¾ç‰‡ cargo run ","date":"2022-12-04","objectID":"/rust%E4%BD%BF%E7%94%A8opencv/:2:6","tags":["opencv"],"title":"Rustä½¿ç”¨opencv","uri":"/rust%E4%BD%BF%E7%94%A8opencv/"},{"categories":["Rust"],"content":"7. æŠ¥é”™è§£å†³ ä¸»è¦å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š twistedfall/opencv-rust: Rust bindings for OpenCV 3 \u0026 4 (github.com) ","date":"2022-12-04","objectID":"/rust%E4%BD%BF%E7%94%A8opencv/:2:7","tags":["opencv"],"title":"Rustä½¿ç”¨opencv","uri":"/rust%E4%BD%BF%E7%94%A8opencv/"},{"categories":["Linux"],"content":"ç®¡é“ ","date":"2022-11-20","objectID":"/linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/:0:0","tags":["ipc"],"title":"Linuxè¿›ç¨‹é—´é€šä¿¡","uri":"/linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/"},{"categories":["Linux"],"content":"åŒ¿åç®¡é“(Pipe) ç‰¹ç‚¹ åŠåŒå·¥ åªèƒ½ç”¨äºå…·æœ‰äº²ç¼˜å…³ç³»è¿›ç¨‹(çˆ¶å­ï¼Œå…„å¼Ÿ) å¯ä»¥è§†ä½œç‰¹æ®Šæ–‡ä»¶ï¼Œè¯»å†™å¯ä»¥ä½¿ç”¨writeï¼Œreadå‡½æ•° #include\"stdio.h\" #include\"unistd.h\" // https://learnku.com/articles/44477 // **ç‰¹ç‚¹** // 1. åŠåŒå·¥ // 2. åªèƒ½ç”¨äºå…·æœ‰äº²ç¼˜å…³ç³»è¿›ç¨‹(çˆ¶å­ï¼Œå…„å¼Ÿ) // 3. å¯ä»¥è§†ä½œç‰¹æ®Šæ–‡ä»¶ï¼Œè¯»å†™å¯ä»¥ä½¿ç”¨writeï¼Œreadå‡½æ•° int main() { int fd[2]; pid_t pid; char buf[32]; //åˆ›å»ºç®¡é“ if (pipe(fd) \u003c 0) { printf(\"Create Pipe Error \\n\"); } //åˆ›å»ºå­è¿›ç¨‹ if ((pid = fork()) \u003c 0) { printf(\"Fork Error \\n\"); } else if (pid \u003e 0) { close(fd[0]); // å…³é—­çˆ¶è¿›ç¨‹è¯»ç«¯ write(fd[1], \"hello world\", 8); //çˆ¶è¿›ç¨‹å†™ç«¯å†™å…¥ } else { close(fd[1]); // å…³é—­å­è¿›ç¨‹å†™ç«¯ read(fd[0], buf, 8); // å­è¿›ç¨‹è¯»å–çˆ¶è¿›ç¨‹æ¶ˆæ¯ printf(\"Child Recv Msg: %s\", buf); } } ","date":"2022-11-20","objectID":"/linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/:1:0","tags":["ipc"],"title":"Linuxè¿›ç¨‹é—´é€šä¿¡","uri":"/linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/"},{"categories":["Linux"],"content":"å‘½åç®¡é“(FIFO) ç‰¹ç‚¹ å’ŒåŒ¿åç®¡é“ä¸åŒï¼ŒFIFOå¯ä»¥åœ¨æ— å…³è¿›ç¨‹é—´é€šä¿¡ FIFOæœ‰è·¯å¾„åä¸ä¹‹å…³è”ï¼Œä»¥ä¸€ç§ç‰¹æ®Šæ–‡ä»¶å½¢å¼å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿä¸­ fifo_read.c #include\"stdio.h\" #include\"stdlib.h\" #include\"unistd.h\" #include\"errno.h\" #include\"fcntl.h\" #include\"sys/stat.h\" int main() { int fd; int len; char buf[1024]; if (mkfifo(\"/home\", 0666) \u003c 0 \u0026\u0026 errno != EEXIST) { perror(\"Create FIFO Failed\"); } if ((fd = open(\"/home\", O_RDONLY)) \u003c 0) { perror(\"Open FIFO Failed\"); exit(1); } while ((len = read(fd, buf, 1024)) \u003e 0) { printf(\"Read Message: %s\", buf); } close(fd); return 0; } fifo_write.c #include\"stdio.h\" #include\"unistd.h\" #include\"stdlib.h\" #include\"fcntl.h\" // O_WRONLY #include\"sys/stat.h\" #include\"time.h\" // ## å‘½åç®¡é“(FIFO) // ** ç‰¹ç‚¹** // 1. å’ŒåŒ¿åç®¡é“ä¸åŒï¼ŒFIFOå¯ä»¥åœ¨æ— å…³è¿›ç¨‹é—´é€šä¿¡ // 2. FIFOæœ‰è·¯å¾„åä¸ä¹‹å…³è”ï¼Œä»¥ä¸€ç§ç‰¹æ®Šæ–‡ä»¶å½¢å¼å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿä¸­ int main() { int fd; int n, i; char buf[1024]; time_t tp; printf(\"Parent Process PID:\", getpid()); if ((fd = open(\"/home\", O_WRONLY)) \u003c 0) { // å†™æ¨¡å¼æ‰“å¼€FIFO perror(\"Open FIFO Failed\"); exit(1); } for (i = 0; i \u003c 10; ++i) { time(\u0026tp);// å½“å‰ç³»ç»Ÿæ—¶é—´ n = sprintf(buf, \"Process %d's time is %s\", getpid(), ctime(\u0026tp)); printf(\"Send message: %s\", buf); // å†™å…¥æ•°æ®åˆ°FIFOä¸­ if (write(fd, buf, n + 1) \u003c 0) { perror(\"Write FIFO Failed\"); close(fd); exit(1); } sleep(1); } close(fd); return 0; } æ¶ˆæ¯é˜Ÿåˆ— ç‰¹ç‚¹ æ¶ˆæ¯é˜Ÿåˆ—æ˜¯é¢å‘è®°å½•çš„ï¼Œå…¶ä¸­çš„æ¶ˆæ¯å…·æœ‰ç‰¹å®šçš„æ ¼å¼ä»¥åŠç‰¹å®šçš„ä¼˜å…ˆçº§ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ç‹¬ç«‹äºå‘é€ä¸æ¥æ”¶è¿›ç¨‹ã€‚è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ—åŠå…¶å†…å®¹å¹¶ä¸ä¼šè¢«åˆ é™¤ã€‚ æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å®ç°æ¶ˆæ¯çš„éšæœºæŸ¥è¯¢ï¼Œæ¶ˆæ¯ä¸ä¸€å®šè¦ä»¥å…ˆè¿›å…ˆå‡ºçš„æ¬¡åºè¯»å–ï¼Œä¹Ÿå¯ä»¥æŒ‰æ¶ˆæ¯çš„ç±»å‹è¯»å–ã€‚ msg_client.c #include\"stdio.h\" #include\"stdlib.h\" #include\"unistd.h\" #include\"sys/msg.h\" #define MSG_FILE \"/etc/passwd\" // ç»“æ„ä½“ç¬¬ä¸€ä¸ªå­—æ®µä¸€å®šä¸ºé•¿æ•´å‹ struct msg_from { long mtype; char mtext[256]; }; int main() { int msqid; key_t key; struct msg_from msg; // keyå€¼ä¸å˜ï¼Œè¦ä¹ˆç¡®ä¿ftok()çš„æ–‡ä»¶ä¸è¢«åˆ é™¤ï¼Œè¦ä¹ˆä¸ç”¨ftok()ï¼ŒæŒ‡å®šä¸€ä¸ªå›ºå®šçš„keyå€¼ã€‚ // è·å–keyå€¼ if ((key = ftok(MSG_FILE, 'z')) \u003c 0) { perror(\"ftok error\"); exit(1); } printf(\"Message Queue - Client key is: %d.\\n\", key); // æ‰“å¼€æ¶ˆæ¯é˜Ÿåˆ— if ((msqid = msgget(key, IPC_CREAT | 0777)) == -1) { perror(\"msgget error\"); exit(1); } // æ‰“å°æ¶ˆæ¯é˜Ÿåˆ—IDå’Œè¿›ç¨‹ID printf(\"My msqid is: %d.\\n\", msqid); printf(\"My pid is: %d.\\n\", getpid()); // æ·»åŠ æ¶ˆæ¯ï¼Œç±»å‹ä¸º888 msg.mtype = 888; sprintf(msg.mtext, \"hello, I'm client %d\", getpid()); //msgidæ˜¯ç”±msggetå‡½æ•°è¿”å›çš„æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦ã€‚ // __msgpæ˜¯ä¸€ä¸ªæŒ‡å‘å‡†å¤‡å‘é€æ¶ˆæ¯çš„æŒ‡é’ˆï¼Œæ¶ˆæ¯çš„æ•°æ®ç»“æ„å´æœ‰ä¸€å®šçš„è¦æ±‚ï¼Œ // æŒ‡é’ˆmsg_ptræ‰€æŒ‡å‘çš„æ¶ˆæ¯ç»“æ„ä¸€å®šè¦æ˜¯ä»¥ä¸€ä¸ª**é•¿æ•´å‹**æˆå‘˜å˜é‡å¼€å§‹çš„ç»“æ„ä½“ï¼Œæ¥æ”¶å‡½æ•°å°†ç”¨è¿™ä¸ªæˆå‘˜æ¥ç¡®å®šæ¶ˆæ¯çš„ç±»å‹ msgsnd(msqid, \u0026msg, sizeof(msg.mtext), 0); // msgrcvå‡½æ•°typeå‚æ•°æœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½ï¼š // type == 0ï¼Œè¿”å›é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯ï¼› // type \u003e 0ï¼Œè¿”å›é˜Ÿåˆ—ä¸­æ¶ˆæ¯ç±»å‹ä¸º type çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯ï¼› // type \u003c 0ï¼Œè¿”å›é˜Ÿåˆ—ä¸­æ¶ˆæ¯ç±»å‹å€¼å°äºæˆ–ç­‰äº type ç»å¯¹å€¼çš„æ¶ˆæ¯ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œåˆ™å–ç±»å‹å€¼æœ€å°çš„æ¶ˆæ¯ã€‚ // è¯»å–ç±»å‹ä¸º999çš„æ¶ˆæ¯ msgrcv(msqid, \u0026msg, 256, 999, 0); printf(\"Client: receive msg.mtext is: %s.\\n\", msg.mtext); printf(\"Client: receive msg.mtype is: %d.\\n\", msg.mtype); } msg_server.c #include\"stdio.h\" #include\"stdlib.h\" #include\"unistd.h\" #include\"sys/msg.h\" #define MSG_FILE \"/etc/passwd\" // ç»“æ„ä½“ç¬¬ä¸€ä¸ªå­—æ®µä¸€å®šä¸ºé•¿æ•´å‹ struct msg_from { long mtype; char mtext[256]; }; int main() { int msqid; key_t key; struct msg_from msg; // è·å–keyå€¼ if ((key = ftok(MSG_FILE, 'z')) \u003c 0) { perror(\"ftok error\"); exit(1); } // æ‰“å°keyå€¼ printf(\"Message Queue - Server key is: %d.\\n\", key); // åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ— if ((msqid = msgget(key, IPC_CREAT | 0700)) == -1) { perror(\"msgget error\"); exit(1); } printf(\"My msqid is: %d.\\n\", msqid); printf(\"My pid is: %d.\\n\", getpid()); for (;;) { // è¿”å›ç±»å‹ä¸º888çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯ msgrcv(msqid, \u0026msg, 256, 888, 0); printf(\"Server: receive msg.mtext is: %s.\\n\", msg.mtext); printf(\"Server: receive msg.mtype is: %d.\\n\", msg.mtype); msg.mtype = 999; sprintf(msg.mtext, \"hello, I'm server %d\", getpid()); msgsnd(msqid, \u0026msg, sizeof(msg.mtext), 0); } return 0; } ä¿¡å·é‡ ç‰¹ç‚¹ æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ ç”¨äºå®ç°è¿›ç¨‹é—´äº’æ–¥å’ŒåŒæ­¥,ä¸æ˜¯å­˜å‚¨è¿›ç¨‹é—´é€šä¿¡æ•°æ® ç¤ºä¾‹ #include\"stdio.h\" #include\"stdlib.h\" #include\"unistd.h\" #include\"sys/sem.h\" union semun { int val; struct semid_ds* buf; unsigned short* array; }; int init_sem(int sem_id, int value) { union semun tmp; tmp.val = value; if (semctl(sem_id, 0, SETVAL, tmp) == -1) { perror(\"Init Semaphore Error\"); return -1; } return 0; } // pæ“ä½œ // è‹¥ä¿¡å·é‡å€¼ä¸º1ï¼Œè·å–èµ„æºå¹¶å°†ä¿¡å·å€¼ç½®ä¸º-1 // è‹¥ä¿¡å·é‡å€¼ä¸º0ï¼Œè¿›ç¨‹æŒ‚èµ·ç­‰å¾… int sem_p(int sem_id) { struct sembuf sbuf; sbuf.sem_num = 0; // åºå· sbuf.sem_op = -1; // æ“ä½œ sbuf.sem_flg = SEM_UNDO; if (semop(sem_id, \u0026sbuf, 1) == -1) { perror(\"P operation Error\"); return -","date":"2022-11-20","objectID":"/linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/:2:0","tags":["ipc"],"title":"Linuxè¿›ç¨‹é—´é€šä¿¡","uri":"/linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/"},{"categories":["Python"],"content":"ç´¢å¼• import pandas as pd import numpy as np df = pd.DataFrame(np.arange(50).reshape(-1, 5), columns=list('abcde')) # æ ¹æ®åˆ—æ ‡ç­¾ç´¢å¼• df['a'] # æˆ–è€… df.loc[:,'a'] # æ ¹æ®åˆ—ç´¢å¼• df.iloc[:, 0] # df['a'] == df.loc[:,'a'] == df.iloc[:, 0] è®¡ç®— # æ‰€æœ‰å…ƒç´ ä¹˜æ³• df * 10 # æŒ‡å®šåˆ—ç›¸ä¹˜ # æ³¨æ„ï¼šä¸ä¼šåœ¨åŸåœ°ä¿®æ”¹ï¼Œéœ€è¦é‡æ–°èµ‹å€¼ df['a'] = df['a'] * 10 # æŒ‡å®šä½ç½®æ“ä½œ df.iloc[0,3] = 100 # ä¹Ÿå¯ä»¥æŒ‡å®šå¤šåˆ—æ“ä½œï¼Œç”Ÿæˆæ–°åˆ— df['e'] = df['a'] * df['b'] åˆå¹¶ df_new = pd.DataFrame(np.arange(200, 230).reshape(-1, 2), columns=['z','x']) # æ³¨æ„ï¼šè¿™é‡Œå› ä¸º2ä¸ªDataFrameè¡Œç´¢å¼•æ²¡æœ‰å†²çªï¼Œç´¢å¼•è¿™é‡Œæ²¡æœ‰é—®é¢˜ã€‚ # axis ä¸º0æ—¶ä»¥è¡Œåˆå¹¶(å¯ä»¥æ˜¯å®ç°æ•°æ®è¿½åŠ )ï¼Œä¸º1æ—¶ä»¥åˆ—åˆå¹¶ pd.concat([df, df_new], axis=1) # å½“ä¸‹é¢çš„dfçš„è¡Œç´¢å¼•ä¸è¿ç»­æ—¶ï¼Œdf_newå°±ä¼šç¼ºå°‘ä¸€äº›è¡Œçš„æ•°æ® df = df[df.loc[:, 'a'] % 100 == 0] pd.concat([df, df_new], axis=1) # å¦‚æœå½“å‡ºç°ä¸Šé¢ä¸€ç§æƒ…å†µï¼Œè€Œåˆä¸æƒ³ä¸¢æ‰df_newçš„æ•°æ®æ—¶å¯ä»¥ä½¿ç”¨é‡æ–°ç´¢å¼•çš„æ–¹æ³• df = df.reset_index(drop=True) pd.concat([df, df_new], axis=1) è¿½åŠ æ•°æ® # ä¸èƒ½è¿™æ ·è¿½åŠ ï¼Œéœ€è¦åˆ—æ ‡ç­¾ç›¸å¯¹åº” df.append([1, 3, 5, 3,5]) # æ–°Dataframeéœ€è¦å’Œdfæ ‡ç­¾å¯¹åº” new_row = pd.DataFrame(np.full((1,4), 5), columns=list('abcd')) df.append(new_row) # ä¹Ÿå¯ä»¥è¿™æ · # pd.concat([df, new_row], axis=0) Apply ä½¿ç”¨ # å½“Dateframeä¸­ä¸å†æ˜¯å­˜æ•°å­—æ—¶ï¼Œå°±ä¸èƒ½æ ¹æ®ç›´æ¥å¯¹åˆ—è¿›è¡Œæ“ä½œç”Ÿæˆæ–°åˆ—ï¼Œæœ‰äº›æ—¶å€™è¿˜å«æœ‰å¤æ‚çš„æ¡ä»¶åˆ¤æ–­ï¼Œè¿™æ—¶å€™æ—¢å¯ä»¥ä½¿ç”¨applyå‡½æ•° # æ³¨æ„å½“æ–°åŠ åˆ—æ—¶éœ€è¦è®¾ç½®axis=1 df['f'] = df[['b','c']].apply(lambda x: x[0]*100 if x[0] % 2 == 0 else x[1] - 100, axis=1) æ’åº # æ ¹æ®ç´¢å¼•æ’åº,axis=0ä»£è¡¨è¡Œï¼Œaxis=1ä»£è¡¨åˆ— df.sort_index() # æ ¹æ®å€¼æ’åº,å¯æ ¹æ®å¤šä¸ªå€¼æ’åº df.sort_values(by=['a']) # å¦‚æœDataframeå«æœ‰é‡å¤åˆ—ï¼Œé‡å¤åˆ—çš„æ•°æ®åˆä¸ç›¸åŒï¼Œä½†åˆæƒ³æŒ‰å€¼æ’åºï¼Œå¯ä»¥å‚è€ƒä¸‹é¢ # æ¯”å¦‚è¯´2ï¼Œ4åˆ—åç›¸åŒï¼Œæƒ³æŒ‰ç…§ç¬¬2åˆ—çš„å€¼æ’åº # sort_col_values = df.iloc[:, 2].to_numpy() # sort_indexs = sort_col_values.argsort() # df = df.iloc[:, sort_indexs] å»é‡ # ä½¿ç”¨å‡½æ•°drop_duplicatesï¼Œå…¶ä¸­subsetæŒ‡å®šè¦å»é‡çš„åˆ—åï¼Œä¸èƒ½å†™åˆ—ç´¢å¼•ï¼Œå³æŒ‡å®šçš„ç›¸åŒåˆ—æ‰è¿›è¡Œå»é‡ï¼Œé»˜è®¤æŒ‰ç…§æ‰€æœ‰åˆ—ç›¸åŒå»é‡ï¼Œkeepå‚æ•°å¯ä»¥æŒ‡å®šä¿ç•™firstï¼Œlastã€‚inplaceé€‰æ‹©æ˜¯å¦ä¿®æ”¹åŸDataframe # df.drop_duplicates(subset=[], keep='first', inplace=False) # å½“Dataframeæœ‰é‡å¤åˆ—åï¼Œé‡å¤åˆ—åæ•°æ®ä¸ç›¸åŒæ—¶ï¼Œå¯ä»¥å°†Dataframeæ‹†åˆ†ï¼Œå†è¿›è¡Œå»é‡ï¼Œå»é‡åå†åˆå¹¶ # ä¾‹å¦‚ï¼š2ï¼Œ4åˆ—åé‡å¤ï¼Œéœ€è¦æŒ‰ç…§1ï¼Œ2åˆ—å»é‡ # æ‹†åˆ† front = df.iloc[:, :2] back = df.iloc[:, 2:] # å»é‡ front.drop_duplicates(subset=['a', 'b'], keep='first', inplace=True) back = back.iloc[front.index, :] # åˆå¹¶,è¿™é‡Œèƒ½ä¿è¯è¡Œç´¢å¼•èƒ½ä¸€ä¸€å¯¹åº”ï¼Œæ‰€ä»¥ä¸ç”¨é‡å»ºç´¢å¼•ä¹Ÿè¡Œã€‚å½“æ—¶ä¹Ÿå¯ä»¥é€‰æ‹©é‡å»ºç´¢å¼• pd.concat([front, back], axis=1) å­—ç¬¦ä¸²æ“ä½œ åœ¨pandasä¸­å¯ä»¥é’ˆå¯¹éœ€è¦æ“ä½œåˆ—æ–¹ä¾¿çš„ä½¿ç”¨å­—ç¬¦ä¸²çš„æ‰€æœ‰å‡½æ•° # ä¸¾ä¾‹ï¼š # æ³¨æ„ï¼šè¿™é‡Œçš„replaceæ–¹æ³•é»˜è®¤ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥æ·»åŠ regex=Falseæ¥å…³é—­ df['a'].str.replace(regex=False) åˆ†ç»„å’Œèšåˆ # å¯¹æŒ‡å®šåˆ—è¿›è¡Œèšåˆè®¡ç®—ï¼Œaggä¼šè¿”å›åˆ†ç»„ç»“æœï¼Œå¹¶ä¸”åˆ—æ•°æ®ä¸ºèšåˆæ“ä½œåçš„ç»“æœ # ä½¿ç”¨ä»¥ä¸‹è®¿é—®ç”Ÿæˆèšåˆç»“æœ lang = df.groupby(by='å§“å').agg({'è¯­æ–‡': 'sum'}) math = df.groupby(by='å§“å').agg({'æ•°å­¦': 'sum'}) english = df.groupby(by='å§“å').agg({'è‹±è¯­': 'sum'}) # pd.concat([lang, math, english], axis=1) # ä»¥ä¸Šç­‰äºä¸‹é¢è¿™è¡Œã€‚ # df.groupby(by='å§“å').sum() # å¦‚æœè¦å¯¹ä¸åŒåˆ—è¿›è¡Œä¸åŒèšåˆæ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š df = df.groupby(by='å§“å').agg({'è¯­æ–‡': 'sum', 'å§“å': 'count'}) # æ³¨æ„ï¼šå¦‚æœä½¿ç”¨ä»¥ä¸Šæ–¹æ³•ä¼šå‡ºç°é‡å¤åˆ—ï¼Œé‚£å°±éœ€è¦é‡å‘½ååˆ—å df = df.rename({'å§“å': 'count'}, axis=1) # ä½¿ç”¨transformè¿”å›DataFrame # df['count'] = df.groupby(by='å§“å')['æ•°å­¦'].transform('sum') è¯»å–å’Œä¿å­˜ # è¯»å–csvæä¾›äº†è®¸å¤šä½¿ç”¨çš„é€‰é¡¹ï¼Œæ¯”å¦‚å¯ä»¥æŒ‡å®šåˆ†éš”ç¬¦ï¼Œè¯»å–éƒ¨åˆ†æ•°æ®ï¼Œè·³è¿‡è¡¨å¤´ï¼ŒæŒ‡å®šåˆ—åè¯»å– # å‚è€ƒï¼šhttps://www.gairuo.com/p/pandas-read-csv pd.read_csv( filepath_or_buffer: 'FilePathOrBuffer', sep=\u003cno_default\u003e, delimiter=None, header='infer', names=\u003cno_default\u003e, index_col=None, usecols=None, squeeze=False, prefix=\u003cno_default\u003e, mangle_dupe_cols=True, dtype: 'DtypeArg | None' = None, engine=None, converters=None, true_values=None, false_values=None, skipinitialspace=False, skiprows=None, skipfooter=0, nrows=None, na_values=None, keep_default_na=True, na_filter=True, verbose=False, skip_blank_lines=True, parse_dates=False, infer_datetime_format=False, keep_date_col=False, date_parser=None, dayfirst=False, cache_dates=True, iterator=False, chunksize=None, compression='infer', thousands=None, decimal: 'str' = '.', lineterminator=None, quotechar='\"', quoting=0, doublequote=True, escapechar=None, comment=None, encoding=None, encoding_errors: 'str | None' = 'strict', dialect=None, error_bad_lines=None, warn_bad_lines=None, on_bad_lines=None, delim_whitespace=False, low_memory=True, memory_map=False, float_precision=None, storage_options: 'StorageOptions' = None, ) # è¯»å–excel # å‚è€ƒhttps://www.gairuo.com/p/pandas-read-excel pd.read_excel(io, sheet_name=0, header=0, names=None, index_col=None, usecols=None, squeeze=False, dtype=None, engine=None, converters=None, true_values=None, false_values=None, skiprows=None, nrows=None, na_values=None, keep_default_na=True, verbose=Fa","date":"2022-11-12","objectID":"/pandas%E4%BD%BF%E7%94%A8%E5%B0%8F%E7%BB%93/:0:0","tags":["pandas"],"title":"Pandasä½¿ç”¨å°ç»“","uri":"/pandas%E4%BD%BF%E7%94%A8%E5%B0%8F%E7%BB%93/"},{"categories":["Numpy","Python"],"content":"Numpy æ’åºå‡½æ•° numpy.sort(a, axis=-1, kind=None, order=None) å‚æ•°: a : è¦æ’åºçš„æ•°ç»„ï¼› axis ï¼š æŒ‰ä»€ä¹ˆè½´è¿›è¡Œæ’åºï¼Œé»˜è®¤æŒ‰æœ€åä¸€ä¸ªè½´è¿›è¡Œæ’åºï¼› kind ï¼šæ’åºæ–¹æ³•ï¼Œé»˜è®¤æ˜¯å¿«é€Ÿæ’åº(ä¸ç¨³å®š)ï¼Œå¯é€‰å‚æ•°æœ‰:{â€˜quicksortâ€™, â€˜mergesortâ€™, â€˜heapsortâ€™, â€˜stableâ€™} order : å½“æ•°ç»„å®šä¹‰äº†å­—æ®µå±æ€§æ—¶ï¼Œå¯ä»¥æŒ‰ç…§æŸä¸ªå±æ€§è¿›è¡Œæ’åºï¼› numpy.argsort(a, axis=-1, kind=None, order=None):numpy.argsort å‡½æ•°ç”¨äºå°†æ•°ç»„æ’åºåï¼Œè¿”å›æ•°ç»„å…ƒç´ ä»å°åˆ°å¤§ä¾æ¬¡æ’åºçš„æ‰€æœ‰å…ƒç´ ç´¢å¼• å‚æ•°: a : è¦æ’åºçš„æ•°ç»„ axis ï¼š æŒ‰ä»€ä¹ˆè½´è¿›è¡Œæ’åºï¼Œé»˜è®¤æŒ‰æœ€åä¸€ä¸ªè½´è¿›è¡Œæ’åº kind ï¼šæ’åºæ–¹æ³•ï¼Œé»˜è®¤æ˜¯å¿«é€Ÿæ’åº order : å½“æ•°ç»„å®šä¹‰äº†å­—æ®µå±æ€§æ—¶ï¼Œå¯ä»¥æŒ‰ç…§æŸä¸ªå±æ€§è¿›è¡Œæ’åº æ’åºåç´¢å¼•è§£é‡Šï¼š æ¯”å¦‚è¯´ç¬¬ä¸€è¡Œæ’åºåçš„ç»“æœä¸ºï¼š[1, 0, 2] è¡¨ç¤ºåŸæ•°ç»„ç´¢å¼•ä¸º 1 çš„æ•°ç°åœ¨å˜ä¸º 0ï¼ŒåŸç´¢å¼•ä¸º 0 å˜ä¸º 1ï¼ŒåŸç´¢å¼•ä¸º 2 ä¿æŒä¸å˜,å³[0, 1, 2] -\u003e [1, 0, 2] numpy.lexsort(keys, axis=-1): numpy.lexsort å‡½æ•°ç”¨äºæŒ‰ç…§å¤šä¸ªæ¡ä»¶ï¼ˆé”®ï¼‰è¿›è¡Œæ’åºï¼Œè¿”å›æ’åºåç´¢å¼•ã€‚ è¿™é‡Œä¸¾ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼šå°å‡åˆè€ƒè¯•ï¼Œé‡ç‚¹ç­å½•å–å­¦ç”ŸæŒ‰ç…§æ€»æˆç»©å½•å–ã€‚åœ¨æ€»æˆç»©ç›¸åŒæ—¶ï¼Œæ•°å­¦æˆç»©é«˜çš„ä¼˜å…ˆå½•å–ï¼Œåœ¨æ€»æˆç»©å’Œæ•°å­¦æˆç»©éƒ½ç›¸åŒæ—¶ï¼ŒæŒ‰ç…§è‹±è¯­æˆç»©å½•å–â€¦â€¦ è¿™é‡Œï¼Œæ€»æˆç»©æ’åœ¨ç”µå­è¡¨æ ¼çš„æœ€åä¸€åˆ—ï¼Œæ•°å­¦æˆç»©åœ¨å€’æ•°ç¬¬äºŒåˆ—ï¼Œè‹±è¯­æˆç»©åœ¨å€’æ•°ç¬¬ä¸‰åˆ—ã€‚ å‚æ•°: keys ï¼šåºåˆ—æˆ–å…ƒç»„ï¼Œè¦æ’åºçš„ä¸åŒçš„åˆ— axis ï¼šæŒ‡å®šæ¬¡æ’åºçš„è½´(é»˜è®¤ä¸º-1ï¼Œå³æœ€åä¸€ä¸ªè½´) æ³¨æ„ï¼šæ ¹æ®æ•°ç»„çš„ shape ç»´æ•°æŒ‡å®šæ¬¡æ’åºè½´ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæ˜¯äºŒç»´æ•°ç»„åªèƒ½è®¾ç½®ä¸º 0ï¼Œå› ä¸º 1 æ˜¯è‘—æ’åºè½´ã€‚å¦‚æœ shape ä¸º(2,3,5),åˆ™ axis å¯æŒ‡å®šä¸º 0 æˆ–è€… 1 æ ¹æ®è¡Œå’Œåˆ—æ’åº ","date":"2022-11-05","objectID":"/numpy%E4%BD%BF%E7%94%A8%E6%8E%92%E5%BA%8F/:0:0","tags":["numpy","sort"],"title":"Numpyä½¿ç”¨æ’åº","uri":"/numpy%E4%BD%BF%E7%94%A8%E6%8E%92%E5%BA%8F/"},{"categories":["Rust","Openssl","Crypto"],"content":"AES åŠ å¯†ç®—æ³• AES(Advanced Encryption Standard)ï¼Œå…¨ç§°ï¼šé«˜çº§åŠ å¯†æ ‡å‡†ï¼Œæ˜¯ä¸€ç§æœ€å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³• ","date":"2022-10-31","objectID":"/rust%E4%BD%BF%E7%94%A8openssl%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/:0:0","tags":["rust","openssl","aes"],"title":"Rustä½¿ç”¨opensslåŠ å¯†ç®—æ³•","uri":"/rust%E4%BD%BF%E7%94%A8openssl%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"},{"categories":["Rust","Openssl","Crypto"],"content":"é…ç½® Rust Toml æ–‡ä»¶ [dependencies] openssl = { version = \"0.10\", features = [\"vendored\"] } ","date":"2022-10-31","objectID":"/rust%E4%BD%BF%E7%94%A8openssl%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/:1:0","tags":["rust","openssl","aes"],"title":"Rustä½¿ç”¨opensslåŠ å¯†ç®—æ³•","uri":"/rust%E4%BD%BF%E7%94%A8openssl%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"},{"categories":["Rust","Openssl","Crypto"],"content":"ç¤ºä¾‹ä»£ç  use openssl::symm::{Cipher, Crypter, Mode}; fn main() { let key = \"061cecfd897548208c76c04b6e7fb\".as_bytes(); let crypto_word: \u0026mut Vec\u003cu8\u003e = \u0026mut \"keyword\".as_bytes().to_vec(); let block_size = Cipher::aes_128_cbc().block_size(); // æ·»åŠ å¡«å…… pkcs7_padding(crypto_word, block_size); let mut output = vec![0; 1024]; // å–16ä½å¯†é’¥ let mut encrypter = Crypter::new(Cipher::aes_128_ecb(), Mode::Encrypt, \u0026key[..16], None).unwrap(); match encrypter.update(\u0026f, \u0026mut output) { Ok(size) =\u003e { eprintln!(\"size is: {size}\"); println!(\"{:?}\", \u0026output[..size]); println!(\"{:02x?}\", \u0026output[..size]); // è½¬æ¢ä¸º16è¿›åˆ¶ } Err(_) =\u003e {} }; } fn pkcs7_padding(data: \u0026mut Vec\u003cu8\u003e, block_size: usize) { let padding_num = block_size - data.len() % block_size; let padding = padding_num as u8; data.append(\u0026mut [padding].repeat(padding_num)); } å‚è€ƒé“¾æ¥ï¼š AES åŠ è§£å¯†-CBC ECB - ç‹¬å­¤å‰‘â€”å®‡æ« - åšå®¢å›­ (cnblogs.com) AES åŠ å¯†(3)ï¼šAES åŠ å¯†æ¨¡å¼ä¸å¡«å…… - çŸ¥ä¹ (zhihu.com) ","date":"2022-10-31","objectID":"/rust%E4%BD%BF%E7%94%A8openssl%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/:2:0","tags":["rust","openssl","aes"],"title":"Rustä½¿ç”¨opensslåŠ å¯†ç®—æ³•","uri":"/rust%E4%BD%BF%E7%94%A8openssl%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"},{"categories":["æ•™ç¨‹"],"content":"å®‰è£…é•œåƒ ä¸‹è½½åœ°å€ï¼š https://ubuntu.com/download/raspberry-pi åˆ·å…¥é•œåƒåˆ°SDå¡ åˆ·å…¥åéœ€è¦é‡æ–°æ‹”æ’SDå¡ æ‰¾åˆ°system-bootç›˜ç¬¦ç›˜ç¬¦ä¸‹network-configæ–‡ä»¶ æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹wifié…ç½® version: 2 ethernets: eth0: dhcp4: true optional: true #wifis: # wlan0: # dhcp4: true # optional: true # access-points: # myhomewifi: # password: \"S3kr1t\" # myworkwifi: # password: \"correct battery horse staple\" # workssid: # auth: # key-management: eap # method: peap # identity: \"me@example.com\" # password: \"passw0rd\" # ca-certificate: /etc/my_ca.pem å¼€æœºæŸ¥æ‰¾wifi æŸ¥æ‰¾æ ‘è“æ´¾ipåœ°å€å¯ç”¨æ–¹æ³•ï¼š ç™»å½•è·¯ç”±å™¨åå°æŸ¥çœ‹è¿æ¥è®¾å¤‡ä¸­æ ‘è“æ´¾IP ä½¿ç”¨Advanced_IP_Scannerè½¯ä»¶ è¿æ¥ssh åˆå§‹ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ï¼šubuntu ssh ubuntu@ip æ³¨æ„ï¼šç¬¬ä¸€æ¬¡ç™»é™†ä¼šå¼ºåˆ¶è¦æ±‚ä¿®æ”¹å¯†ç ï¼Œä¿®æ”¹åå†æ¬¡ç™»å½•å³å¯ï¼Œå¯†ç ä¹Ÿä¸èƒ½å¤ªçŸ­ æ¢æº å¤‡ä»½ sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak ä¿®æ”¹æ–‡ä»¶å†…å®¹ä¸º: deb http://mirrors.cloud.tencent.com/ubuntu-ports jammy main restricted deb http://mirrors.cloud.tencent.com/ubuntu-ports jammy-updates main restricted deb http://mirrors.cloud.tencent.com/ubuntu-ports jammy universe deb http://mirrors.cloud.tencent.com/ubuntu-ports jammy-updates universe deb http://mirrors.cloud.tencent.com/ubuntu-ports jammy multiverse deb http://mirrors.cloud.tencent.com/ubuntu-ports jammy-updates multiverse deb http://mirrors.cloud.tencent.com/ubuntu-ports jammy-backports main restricted universe multiverse deb http://mirrors.cloud.tencent.com/ubuntu-ports jammy-security main restricted deb http://mirrors.cloud.tencent.com/ubuntu-ports jammy-security universe deb http://mirrors.cloud.tencent.com/ubuntu-ports jammy-security multiverse æ›´æ–° sudo apt update sudo apt upgrade -y å‚è€ƒé“¾æ¥ï¼š æ ‘è“æ´¾æŠ˜è…¾è®°ï¼ˆä¸€ï¼‰â€“ å®‰è£…ç³»ç»Ÿï¼ˆUbuntu Server 20.04.1ï¼‰ | ä¿®è¡Œçš„æŠ€æœ¯é˜ (mrxiuxing.com) ","date":"2022-10-24","objectID":"/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%89%E8%A3%85ubutnu%E6%97%A0%E6%98%BE%E7%A4%BA%E5%99%A8%E7%BD%91%E7%BB%9C%E5%88%9D%E6%AC%A1%E5%BC%80%E6%9C%BA/:0:0","tags":["raspberry"],"title":"æ ‘è“æ´¾å®‰è£…Ubutnuæ— æ˜¾ç¤ºå™¨ç½‘ç»œåˆæ¬¡å¼€æœº","uri":"/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%89%E8%A3%85ubutnu%E6%97%A0%E6%98%BE%E7%A4%BA%E5%99%A8%E7%BD%91%E7%BB%9C%E5%88%9D%E6%AC%A1%E5%BC%80%E6%9C%BA/"},{"categories":["æ•™ç¨‹"],"content":"Hugoåšå®¢ä»é›¶åˆ°å‘å¸ƒ ","date":"2022-10-22","objectID":"/hugo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2/:0:0","tags":["hugo","cloudflare"],"title":"Hugoé™æ€åšå®¢éƒ¨ç½²","uri":"/hugo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2/"},{"categories":["æ•™ç¨‹"],"content":"1. å®‰è£… å®‰è£…hugo: ä¸‹è½½åœ°å€ï¼šhttps://github.com/gohugoio/hugo/releases/tag/v0.104.3 æ³¨æ„ï¼š æœ‰äº›ä¸»é¢˜éœ€è¦ä¸‹è½½extendedç‰ˆæœ¬ å®‰è£…gitï¼š ä¸‹è½½åœ°å€ï¼šhttps://git-scm.com/ ","date":"2022-10-22","objectID":"/hugo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2/:1:0","tags":["hugo","cloudflare"],"title":"Hugoé™æ€åšå®¢éƒ¨ç½²","uri":"/hugo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2/"},{"categories":["æ•™ç¨‹"],"content":"2. é…ç½®è¿œç¨‹ä»“åº“ï¼Œå¹¶æ–°å»ºä¸€ä¸ªç©ºé¡¹ç›®(ä¸éœ€è¦README.mdæ–‡ä»¶)ï¼Œåå­—ä¸€èˆ¬å’Œç«™ç‚¹åç›¸åŒ ","date":"2022-10-22","objectID":"/hugo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2/:2:0","tags":["hugo","cloudflare"],"title":"Hugoé™æ€åšå®¢éƒ¨ç½²","uri":"/hugo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2/"},{"categories":["æ•™ç¨‹"],"content":"3. æœ¬åœ°éƒ¨ç½² æ–°å»ºç«™ç‚¹å¹¶é…ç½®git hugo new site your_site_name # ä¸‹è½½ä½ éœ€è¦çš„ä¸»é¢˜çš„å‹ç¼©åŒ…æ”¾åˆ°themeç›®å½•ä¸‹æˆ–è€…ä½¿ç”¨`git submodule`æ‹‰å–ï¼Œä¾‹ï¼š git submodule add https://github.com/hugo-fixit/FixIt.git themes/FixIt # æ ¹æ®ä¸»é¢˜æ–‡æ¡£é…ç½®config.tomlæ–‡ä»¶ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªä¸»é¢˜å¯ç›´æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„config.tomlæ–‡ä»¶é…ç½® # 0. å½“æœ¬åœ°å¯ä»¥æ­£å¸¸é¢„è§ˆç«™ç‚¹æ—¶è¿è¡Œï¼Œhugoå‘½ä»¤æ‰“åŒ…ï¼Œç”Ÿæˆé™æ€æ–‡ä»¶ # 1. ä½¿ç”¨gitåˆå§‹åŒ–ç«™ç‚¹ # 2. æ·»åŠ è¿œç¨‹ä»“åº“ git remote add origin remtoe_url # 3. æ‹‰å–è¿œç¨‹ # 4. æäº¤å½“å‰ä»£ç  # 4. æ–°å»ºåˆ†æ”¯(ä¾‹å¦‚ï¼šrelease)ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š git switch -c release # æˆ–è€… git checkout -b release # 5. åˆå¹¶ä¸»åˆ†æ”¯åˆ†æ”¯publicç›®å½•åˆ°å½“å‰åˆ†æ”¯ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š git checkout master public/** # 6. ç§»åŠ¨publicä¸‹æ‰€æœ‰å†…å®¹åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ï¼š mv public/* . # 7. å†æäº¤å½“å‰åˆ†æ”¯å†…å®¹ ","date":"2022-10-22","objectID":"/hugo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2/:3:0","tags":["hugo","cloudflare"],"title":"Hugoé™æ€åšå®¢éƒ¨ç½²","uri":"/hugo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2/"},{"categories":["æ•™ç¨‹"],"content":"3. æ¨é€åˆ°è¿œç¨‹ # ä½¿ç”¨gitæ¨é€åˆ°è¿œç¨‹ä»“åº“ git switch master git push -u origin master git switch release git push -u origin release # å°†è¿œç¨‹ä»“åº“é»˜è®¤åˆ†æ”¯è®¾ç½®ä¸ºrelease ","date":"2022-10-22","objectID":"/hugo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2/:4:0","tags":["hugo","cloudflare"],"title":"Hugoé™æ€åšå®¢éƒ¨ç½²","uri":"/hugo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2/"},{"categories":["æ•™ç¨‹"],"content":"4. ä½¿ç”¨cloudflareå‘å¸ƒ æ³¨å†Œä¸€ä¸ªcloudflareè´¦å·ï¼šhttps://dash.cloudflare.com/ ç‚¹å‡»Pagesï¼Œé€‰æ‹©åˆ›å»ºé¡¹ç›®ä¸‹è¿æ¥åˆ°Gitï¼Œç„¶åæ ¹æ®éœ€è¦é…ç½®ç›¸åº”ä¿¡æ¯ ","date":"2022-10-22","objectID":"/hugo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2/:5:0","tags":["hugo","cloudflare"],"title":"Hugoé™æ€åšå®¢éƒ¨ç½²","uri":"/hugo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2/"},{"categories":null,"content":"Kunpeng Computeå®‰å…¨ç¼–ç¨‹æŒ‡å— æœ¬æ–‡æ¡£åŸºäºCè¯­è¨€æä¾›ä¸€äº›å®‰å…¨ç¼–ç¨‹å»ºè®®ï¼Œç”¨äºæŒ‡å¯¼å¼€å‘å®è·µã€‚ æ•°æ®ç±»å‹ ","date":"0001-01-01","objectID":"/securecoding/:0:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ç¡®ä¿æœ‰ç¬¦å·æ•´æ•°è¿ç®—ä¸æº¢å‡º ã€æè¿°ã€‘ æœ‰ç¬¦å·æ•´æ•°æº¢å‡ºæ˜¯æœªå®šä¹‰çš„è¡Œä¸ºã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œå¯¹å¤–éƒ¨æ•°æ®ä¸­çš„æœ‰ç¬¦å·æ•´æ•°å€¼åœ¨å¦‚ä¸‹åœºæ™¯ä¸­ä½¿ç”¨æ—¶ï¼Œéœ€è¦ç¡®ä¿è¿ç®—ä¸ä¼šå¯¼è‡´æº¢å‡ºï¼š æŒ‡é’ˆè¿ç®—çš„æ•´æ•°æ“ä½œæ•°(æŒ‡é’ˆåç§»å€¼) æ•°ç»„ç´¢å¼• å˜é•¿æ•°ç»„çš„é•¿åº¦(åŠé•¿åº¦è¿ç®—è¡¨è¾¾å¼) å†…å­˜æ‹·è´çš„é•¿åº¦ å†…å­˜åˆ†é…å‡½æ•°çš„å‚æ•° å¾ªç¯åˆ¤æ–­æ¡ä»¶ åœ¨ç²¾åº¦ä½äºintçš„æ•´æ•°ç±»å‹ä¸Šè¿›è¡Œè¿ç®—æ—¶ï¼Œéœ€è¦è€ƒè™‘æ•´æ•°æå‡ã€‚ç¨‹åºå‘˜è¿˜éœ€è¦æŒæ¡æ•´æ•°è½¬æ¢è§„åˆ™ï¼ŒåŒ…æ‹¬éšå¼è½¬æ¢è§„åˆ™ï¼Œä»¥ä¾¿è®¾è®¡å®‰å…¨çš„ç®—æœ¯è¿ç®—ã€‚ 1)åŠ æ³• ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘(åŠ æ³•) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œå‚ä¸åŠ æ³•è¿ç®—çš„æ•´æ•°æ˜¯å¤–éƒ¨æ•°æ®ï¼Œåœ¨ä½¿ç”¨å‰æœªåšæ ¡éªŒï¼Œå¯èƒ½å‡ºç°æ•´æ•°æº¢å‡ºã€‚ int num_a = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int num_b = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int sum = num_a + num_b; ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘(åŠ æ³•) int num_a = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int num_b = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int sum = 0; if (((num_a \u003e 0) \u0026\u0026 (num_b \u003e (INT_MAX - num_a))) || ((num_a \u003c 0) \u0026\u0026 (num_b \u003c (INT_MIN - num_a)))) { ... // é”™è¯¯å¤„ç† } sum = num_a + num_b; ... 2)å‡æ³• ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘(å‡æ³•) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œå‚ä¸å‡æ³•è¿ç®—çš„æ•´æ•°æ˜¯å¤–éƒ¨æ•°æ®ï¼Œåœ¨ä½¿ç”¨å‰æœªåšæ ¡éªŒï¼Œå¯èƒ½å‡ºç°æ•´æ•°æº¢å‡ºï¼Œè¿›è€Œé€ æˆåç»­çš„å†…å­˜å¤åˆ¶æ“ä½œå‡ºç°ç¼“å†²åŒºæº¢å‡ºã€‚ unsigned char *content = ... // æŒ‡å‘æŠ¥æ–‡å¤´çš„æŒ‡é’ˆ size_t content_size = ... // ç¼“å†²åŒºçš„æ€»é•¿åº¦ int total_len = ... // æŠ¥æ–‡æ€»é•¿åº¦ int skip_len = ... // ä»æ¶ˆæ¯ä¸­è§£æå‡ºæ¥çš„éœ€è¦å¿½ç•¥çš„æ•°æ®é•¿åº¦ // ç”¨total_len - skip_len è®¡ç®—å‰©ä½™æ•°æ®é•¿åº¦ï¼Œå¯èƒ½å‡ºç°æ•´æ•°æº¢å‡º (void)memmove(content, content + skip_len, total_len - skip_len); ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘(å‡æ³•) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œé‡æ„ä¸ºä½¿ç”¨size_tç±»å‹çš„å˜é‡è¡¨ç¤ºæ•°æ®é•¿åº¦ï¼Œå¹¶æ ¡éªŒå¤–éƒ¨æ•°æ®é•¿åº¦æ˜¯å¦åœ¨åˆæ³•èŒƒå›´å†…ã€‚ unsigned char *content = ... //æŒ‡å‘æŠ¥æ–‡å¤´çš„æŒ‡é’ˆ size_t content_size = ... // ç¼“å†²åŒºçš„æ€»é•¿åº¦ size_t total_len = ... // æŠ¥æ–‡æ€»é•¿åº¦ size_t skip_len = ... // ä»æ¶ˆæ¯ä¸­è§£æå‡ºæ¥çš„éœ€è¦å¿½ç•¥çš„æ•°æ®é•¿åº¦ if (skip_len \u003e= total_len || total_len \u003e content_size) { ... // é”™è¯¯å¤„ç† } (void)memmove(content, content + skip_len, total_len - skip_len); ... 3)ä¹˜æ³• ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘(ä¹˜æ³•) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œå†…æ ¸ä»£ç å¯¹æ¥è‡ªç”¨æˆ·æ€çš„æ•°å€¼èŒƒå›´åšäº†æ ¡éªŒï¼Œä½†æ˜¯ç”±äºoptæ˜¯intç±»å‹ï¼Œè€Œæ ¡éªŒæ¡ä»¶ä¸­é”™è¯¯çš„ä½¿ç”¨äº†ULONG_MAXè¿›è¡Œé™åˆ¶ï¼Œå¯¼è‡´æ•´æ•°æº¢å‡ºã€‚ int opt = ... // æ¥è‡ªç”¨æˆ·æ€ if ((opt \u003c 0) || (opt \u003e (ULONG_MAX / (60 * HZ)))) { // é”™è¯¯çš„ä½¿ç”¨äº†ULONG_MAXåšä¸Šé™æ ¡éªŒ return -EINVAL; } ... = opt * 60 * HZ; // å¯èƒ½å‡ºç°æ•´æ•°æº¢å‡º ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘(ä¹˜æ³•) ä¸€ç§æ”¹è¿›æ–¹æ¡ˆæ˜¯å°†optçš„ç±»å‹ä¿®æ”¹ä¸ºunsigned longç±»å‹ï¼Œè¿™ç§æ–¹æ¡ˆé€‚ç”¨äºä¿®æ”¹äº†å˜é‡ç±»å‹æ›´ç¬¦åˆä¸šåŠ¡é€»è¾‘çš„åœºæ™¯ã€‚ unsigned long opt = ... // å°†ç±»å‹é‡æ„ä¸º unsigned long ç±»å‹ã€‚ if (opt \u003e (ULONG_MAX / (60 * HZ))) { return -EINVAL; } ... = opt * 60 * HZ; ... å¦ä¸€ç§æ”¹è¿›æ–¹æ¡ˆæ˜¯å°†æ•°å€¼ä¸Šé™ä¿®æ”¹ä¸ºINT_MAXã€‚ int opt = ... // æ¥è‡ªç”¨æˆ·æ€ if ((opt \u003c 0) || (opt \u003e (INT_MAX / (60 * HZ)))) { // ä¿®æ”¹ä½¿ç”¨INT_MAXä½œä¸ºä¸Šé™å€¼ return -EINVAL; } ... = opt * 60 * HZ; 4)é™¤æ³• ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘(é™¤æ³•) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œåšé™¤æ³•è¿ç®—å‰åªæ£€æŸ¥äº†æ˜¯å¦å‡ºç°è¢«é›¶é™¤çš„é—®é¢˜ï¼Œç¼ºå°‘å¯¹æ•°å€¼èŒƒå›´çš„æ ¡éªŒï¼Œå¯èƒ½å‡ºç°æ•´æ•°æº¢å‡ºã€‚ int num_a = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int num_b = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int result = 0; if (num_b == 0) { ... // å¯¹é™¤æ•°ä¸º0çš„é”™è¯¯å¤„ç† } result = num_a / num_b; // å¯èƒ½å‡ºç°æ•´æ•°æº¢å‡º ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘(é™¤æ³•) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼ŒæŒ‰ç…§æœ€å¤§å…è®¸å€¼è¿›è¡Œæ ¡éªŒï¼Œé˜²æ­¢æ•´æ•°æº¢å‡ºï¼Œåœ¨ç¼–ç¨‹æ—¶å¯æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯åšæ›´ä¸¥æ ¼çš„å€¼åŸŸæ ¡éªŒã€‚ int num_a = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int num_b = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int result = 0; // æ£€æŸ¥é™¤æ•°ä¸º0åŠé™¤æ³•æº¢å‡ºé”™è¯¯ if ((num_b == 0) || ((num_a == INT_MIN) \u0026\u0026 (num_b == -1))) { ... // é”™è¯¯å¤„ç† } result = num_a / num_b; ... 5)æ±‚ä½™æ•° ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘(æ±‚ä½™æ•°) int num_a = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int num_b = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int result = 0; if (num_b == 0) { ... // å¯¹é™¤æ•°ä¸º0çš„é”™è¯¯å¤„ç† } result = num_a % num_b; // å¯èƒ½å‡ºç°æ•´æ•°æº¢å‡º ... } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘(æ±‚ä½™æ•°) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼ŒæŒ‰ç…§æœ€å¤§å…è®¸å€¼è¿›è¡Œæ ¡éªŒï¼Œé˜²æ­¢æ•´æ•°æº¢å‡ºã€‚åœ¨ç¼–ç¨‹æ—¶å¯æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯åšæ›´ä¸¥æ ¼çš„å€¼åŸŸæ ¡éªŒã€‚ int num_a = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int num_b = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int result = 0; // æ£€æŸ¥é™¤æ•°ä¸º0åŠé™¤æ³•æº¢å‡ºé”™è¯¯ if ((num_b == 0) || ((num_a == INT_MIN) \u0026\u0026 (num_b == -1))) { ... // é”™è¯¯å¤„ç† } result = num_a % num_b; ... } 6)ä¸€å…ƒå‡ å½“æ“ä½œæ•°ç­‰äºæœ‰ç¬¦å·æ•´æ•°ç±»å‹çš„æœ€å°å€¼æ—¶ï¼Œåœ¨äºŒè¿›åˆ¶è¡¥ç ä¸€å…ƒæ±‚åæœŸé—´ä¼šå‘ç”Ÿæº¢å‡ºã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘(ä¸€å…ƒå‡) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œè®¡ç®—å‰æœªæ ¡éªŒæ•°å€¼èŒƒå›´ï¼Œå¯èƒ½å‡ºç°æ•´æ•°æº¢å‡ºã€‚ int num_a = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int result = -num_a; // å¯èƒ½å‡ºç°æ•´æ•°æº¢å‡º ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘(ä¸€å…ƒå‡) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼ŒæŒ‰ç…§æœ€å¤§å…è®¸å€¼è¿›è¡Œæ ¡éªŒï¼Œé˜²æ­¢æ•´æ•°æº¢å‡ºã€‚åœ¨ç¼–ç¨‹æ—¶å¯æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯åšæ›´ä¸¥æ ¼çš„å€¼åŸŸæ ¡éªŒã€‚ int num_a = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int result = 0; if (num_a == LNT_MIN) { ... // é”™è¯¯å¤„ç† } result = -num_a; ... ","date":"0001-01-01","objectID":"/securecoding/:1:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ç¡®ä¿æ— ç¬¦å·æ•´æ•°è¿ç®—ä¸å›ç»• ã€æè¿°ã€‘ æ¶‰åŠæ— ç¬¦å·æ“ä½œæ•°çš„è®¡ç®—æ°¸è¿œä¸ä¼šæº¢å‡ºï¼Œå› ä¸ºè¶…å‡ºæ— ç¬¦å·æ•´æ•°ç±»å‹è¡¨ç¤ºèŒƒå›´çš„è®¡ç®—ç»“æœä¼šæŒ‰ç…§ï¼ˆç»“æœç±»å‹å¯è¡¨ç¤ºçš„æœ€å¤§å€¼ + 1ï¼‰çš„æ•°å€¼å–æ¨¡ã€‚ è¿™ç§è¡Œä¸ºæ›´å¤šæ—¶å€™è¢«éæ­£å¼åœ°ç§°ä¸ºæ— ç¬¦å·æ•´æ•°å›ç»•ã€‚ åœ¨ç²¾åº¦ä½äºintçš„æ•´æ•°ç±»å‹ä¸Šè¿›è¡Œè¿ç®—æ—¶ï¼Œéœ€è¦è€ƒè™‘æ•´æ•°æå‡ã€‚ç¨‹åºå‘˜è¿˜éœ€è¦æŒæ¡æ•´æ•°è½¬æ¢è§„åˆ™ï¼ŒåŒ…æ‹¬éšå¼è½¬æ¢è§„åˆ™ï¼Œä»¥ä¾¿è®¾è®¡å®‰å…¨çš„ç®—æœ¯è¿ç®—ã€‚ å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œå¯¹å¤–éƒ¨æ•°æ®ä¸­çš„æ— ç¬¦å·æ•´æ•°å€¼åœ¨å¦‚ä¸‹åœºæ™¯ä¸­ä½¿ç”¨æ—¶ï¼Œéœ€è¦ç¡®ä¿è¿ç®—ä¸ä¼šå¯¼è‡´å›ç»•ï¼š æŒ‡é’ˆè¿ç®—çš„æ•´æ•°æ“ä½œæ•°(æŒ‡é’ˆåç§»å€¼) æ•°ç»„ç´¢å¼• å˜é•¿æ•°ç»„çš„é•¿åº¦(åŠé•¿åº¦è¿ç®—è¡¨è¾¾å¼) å†…å­˜æ‹·è´çš„é•¿åº¦ å†…å­˜åˆ†é…å‡½æ•°çš„å‚æ•° å¾ªç¯åˆ¤æ–­æ¡ä»¶ 1)åŠ æ³• ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘(åŠ æ³•) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œæ ¡éªŒä¸‹ä¸€ä¸ªå­æŠ¥æ–‡çš„é•¿åº¦åŠ ä¸Šå·²å¤„ç†æŠ¥æ–‡çš„é•¿åº¦æ˜¯å¦è¶…è¿‡äº†æ•´ä½“æŠ¥æ–‡çš„æœ€å¤§é•¿åº¦ï¼Œåœ¨æ ¡éªŒæ¡ä»¶ä¸­çš„åŠ æ³•è¿ç®—å¯èƒ½ä¼šå‡ºç°æ•´æ•°å›ç»•ï¼Œé€ æˆç»•è¿‡è¯¥æ ¡éªŒçš„é—®é¢˜ã€‚ size_t total_len = ... // æŠ¥æ–‡çš„æ€»é•¿åº¦ size_t read_len = 0 // è®°å½•å·²ç»å¤„ç†æŠ¥æ–‡çš„é•¿åº¦ ... size_t pkt_len = parse_pkt_len(); // ä»ç½‘ç»œæŠ¥æ–‡ä¸­è§£æå‡ºæ¥çš„ä¸‹ä¸€ä¸ªå­æŠ¥æ–‡çš„é•¿åº¦ if (read_len + pkt_len \u003e total_len) { // å¯èƒ½å‡ºç°æ•´æ•°å›ç»• ... // é”™è¯¯å¤„ç† } ... read_len += pkt_len; ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘(åŠ æ³•) ç”±äºread_lenå˜é‡è®°å½•çš„æ˜¯å·²ç»å¤„ç†æŠ¥æ–‡çš„é•¿åº¦ï¼Œå¿…ç„¶ä¼šå°äºtotal_lenï¼Œå› æ­¤å°†ä»£ç ä¸­çš„åŠ æ³•è¿ç®—ä¿®æ”¹ä¸ºå‡æ³•è¿ç®—ï¼Œå¯¼è‡´æ¡ä»¶ç»•è¿‡ã€‚ size_t total_len = ... // æŠ¥æ–‡çš„æ€»é•¿åº¦ size_t read_len = 0; // è®°å½•å·²ç»å¤„ç†æŠ¥æ–‡çš„é•¿åº¦ ... size_t pkt_len = parse_pkt_len(); // æ¥è‡ªç½‘ç»œæŠ¥æ–‡ if (pkt_len \u003e total_len - read_len) { ... // é”™è¯¯å¤„ç† } ... read_len += pkt_len; ... 2)å‡æ³• ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘(å‡æ³•) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œæ ¡éªŒlenåˆæ³•èŒƒå›´çš„è¿ç®—å¯èƒ½ä¼šå‡ºç°æ•´æ•°å›ç»•ï¼Œå¯¼è‡´æ¡ä»¶ç»•è¿‡ã€‚ size_t len = ... // æ¥è‡ªç”¨æˆ·æ€è¾“å…¥ if (SCTP_SIZE_MAX - len \u003c sizeof(SctpAuthBytes)) { // å‡æ³•æ“ä½œå¯èƒ½å‡ºç°æ•´æ•°å›ç»• ... // é”™è¯¯å¤„ç† } ... = kmalloc(sizeof(SctpAuthBytes) + len, gfp); // å¯èƒ½å‡ºç°æ•´æ•°å›ç»• ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘(å‡æ³•) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œè°ƒæ•´å‡æ³•è¿ç®—çš„ä½ç½®ï¼ˆéœ€è¦ç¡®ä¿ç¼–è¯‘æœŸé—´å‡æ³•è¡¨è¾¾å¼çš„å€¼ä¸ç¿»è½¬ï¼‰ï¼Œé¿å…æ•´æ•°å›ç»•é—®é¢˜ã€‚ size_t len = ... // æ¥è‡ªç”¨æˆ·æ€è¾“å…¥ if (len \u003e SCTP_SIZE_MAX - sizeof(SctpAuthBytes)) { // ç¡®ä¿ç¼–è¯‘æœŸé—´å‡æ³•è¡¨è¾¾å¼çš„å€¼ä¸ç¿»è½¬ ... // é”™è¯¯å¤„ç† } ... = kmalloc(sizeof(SctpAuthBytes) + len, gfp); ... 3)ä¹˜æ³• ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ï¼ˆä¹˜æ³•ï¼‰ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨å¤–éƒ¨æ•°æ®è®¡ç®—ç”³è¯·å†…å­˜é•¿åº¦æ—¶æœªæ ¡éªŒï¼Œå¯èƒ½å‡ºç°æ•´æ•°å›ç»•ã€‚ size_t width = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® size_t hight = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® unsigned char *buf = (unsigned char *)malloc(width * hight); æ— ç¬¦å·æ•´æ•°å›ç»•å¯èƒ½å¯¼è‡´åˆ†é…çš„å†…å­˜ä¸è¶³ã€‚ ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ï¼ˆä¹˜æ³•ï¼‰ å¦‚ä¸‹ä»£ç æ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œæ ¡éªŒå‚ä¸ä¹˜æ³•è¿ç®—çš„æ•´æ•°æ•°å€¼èŒƒå›´ï¼Œç¡®ä¿ä¸ä¼šå‡ºç°æ•´æ•°å›ç»•ã€‚ size_t width = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® size_t hight = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® if (width == 0 || hight == 0) { ... // é”™è¯¯å¤„ç† } if (width \u003e SIZE_MAX / hight) { ... // é”™è¯¯å¤„ç† } unsigned char *buf = (unsigned char *)malloc(width * hight); ã€ä¾‹å¤–ã€‘ ä¸ºæ­£ç¡®æ‰§è¡Œç¨‹åºï¼Œå¿…è¦æ—¶æ— ç¬¦å·æ•´æ•°å¯èƒ½è¡¨ç°å‡ºæ¨¡æ€ï¼ˆå›ç»•ï¼‰ã€‚å»ºè®®å°†å˜é‡å£°æ˜æ˜ç¡®æ³¨é‡Šä¸ºæ”¯æŒæ¨¡æ•°è¡Œä¸ºï¼Œå¹¶ä¸”å¯¹è¯¥æ•´æ•°çš„æ¯ä¸ªæ“ä½œä¹Ÿåº”æ˜ç¡®æ³¨é‡Šä¸ºæ”¯æŒæ¨¡æ•°è¡Œä¸ºã€‚ ã€ç›¸å…³è½¯ä»¶CWEç¼–å·ã€‘ CWE-190 ","date":"0001-01-01","objectID":"/securecoding/:2:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ç¡®ä¿é™¤æ³•å’Œä½™æ•°è¿ç®—ä¸ä¼šå¯¼è‡´é™¤é›¶é”™è¯¯(è¢«é›¶é™¤) ã€æè¿°ã€‘ æ•´æ•°çš„é™¤æ³•å’Œå–ä½™è¿ç®—çš„ç¬¬äºŒä¸ªæ“ä½œæ•°å€¼ä¸º0ä¼šå¯¼è‡´ç¨‹åºäº§ç”Ÿæœªå®šä¹‰çš„è¡Œä¸ºï¼Œå› æ­¤ä½¿ç”¨æ—¶è¦ç¡®ä¿æ•´æ•°çš„é™¤æ³•å’Œä½™æ•°è¿ç®—ä¸ä¼šå¯¼è‡´é™¤é›¶é”™è¯¯(è¢«é›¶é™¤ï¼Œä¸‹åŒ)ã€‚ 1)é™¤æ³• ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘(é™¤æ³•) æœ‰ç¬¦å·æ•´æ•°ç±»å‹çš„é™¤æ³•è¿ç®—å¦‚æœé™åˆ¶ä¸å½“ï¼Œä¼šå¯¼è‡´æº¢å‡ºã€‚ å¦‚ä¸‹ç¤ºä¾‹å¯¹æœ‰ç¬¦å·æ•´æ•°è¿›è¡Œçš„é™¤æ³•è¿ç®—åšäº†é˜²æ­¢æº¢å‡ºé™åˆ¶ï¼Œç¡®ä¿ä¸ä¼šå¯¼è‡´æº¢å‡ºï¼Œä½†ä¸èƒ½é˜²æ­¢æœ‰ç¬¦å·æ“ä½œæ•°num_aå’Œnum_bä¹‹é—´çš„é™¤æ³•è¿‡ç¨‹ä¸­å‡ºç°é™¤é›¶é”™è¯¯ï¼š int num_a = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int num_b = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int result = 0; if ((num_a == INT_MIN) \u0026\u0026 (num_b == -1)) { ... // é”™è¯¯å¤„ç† } result = num_a / num_b; // å¯èƒ½å‡ºç°é™¤é›¶é”™è¯¯ ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘(é™¤æ³•) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œæ·»åŠ num_bæ˜¯å¦ä¸º0çš„æ ¡éªŒï¼Œé˜²æ­¢é™¤é›¶é”™è¯¯ã€‚ int num_a = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int num_b = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int result = 0; if ((num_b == 0) | | ((num_a == INT_MIN) \u0026\u0026 (num_b == -1))) { ... // é”™è¯¯å¤„ç† } result = num_a / num_b; ... 2)å–ä½™ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘(æ±‚ä½™æ•°) å¦‚ä¸‹ä»£ç ï¼ŒåŒé™¤æ³•çš„é”™è¯¯ä»£ç ç¤ºä¾‹ä¸€æ ·ï¼Œå¯èƒ½å‡ºç°é™¤é›¶é”™è¯¯ï¼Œå› ä¸ºè®¸å¤šå¹³å°ä»¥ç›¸åŒçš„æŒ‡ä»¤å®ç°æ±‚ä½™æ•°å’Œé™¤æ³•è¿ç®—ã€‚ int num_a = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int num_b = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int result = 0; if ((num_a == INT_MIN) \u0026\u0026 (num_b == -1)) { ... // é”™è¯¯å¤„ç† } result = num_a % num_b; // å¯èƒ½å‡ºç°é™¤é›¶é”™è¯¯ ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘(æ±‚ä½™æ•°) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œæ·»åŠ num_bæ˜¯å¦ä¸º0çš„æ ¡éªŒï¼Œé˜²æ­¢é™¤é›¶é”™è¯¯ã€‚ int num_a = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int num_b = ... // æ¥è‡ªå¤–éƒ¨æ•°æ® int result = 0; if ((num_b == 0) | | ((num_a == INT_MIN) \u0026\u0026 (num_b == -1))) { ... // é”™è¯¯å¤„ç† } result = num_a % num_b; ... å˜é‡ ","date":"0001-01-01","objectID":"/securecoding/:3:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ç¦æ­¢ä½¿ç”¨æœªç»åˆå§‹åŒ–çš„å˜é‡ ã€æè¿°ã€‘ è¿™é‡Œçš„å˜é‡ï¼ŒæŒ‡çš„æ˜¯å±€éƒ¨åŠ¨æ€å˜é‡ï¼Œå¹¶ä¸”è¿˜åŒ…æ‹¬å†…å­˜å †ä¸Šç”³è¯·çš„å†…å­˜å—ã€‚ å› ä¸ºä»–ä»¬çš„åˆå§‹å€¼éƒ½æ˜¯ä¸å¯é¢„æ–™çš„ï¼Œæ‰€ä»¥ç¦æ­¢æœªç»æœ‰æ•ˆåˆå§‹åŒ–å°±ç›´æ¥è¯»å–å…¶å€¼ã€‚ void foo( ...) { int data; bar(data); // é”™è¯¯ï¼šæœªåˆå§‹åŒ–å°±ä½¿ç”¨ ... } å¦‚æœæœ‰ä¸åŒåˆ†æ”¯ï¼Œè¦ç¡®ä¿æ‰€æœ‰åˆ†æ”¯éƒ½å¾—åˆ°åˆå§‹åŒ–åæ‰èƒ½ä½¿ç”¨ï¼š #define CUSTOMIZED_SIZE 100 void foo( ...) { int data; if (condition \u003e 0) { data = CUSTOMIZED_SIZE; } bar(data); // é”™è¯¯ï¼šéƒ¨åˆ†åˆ†æ”¯è¯¥å€¼æœªåˆå§‹åŒ– ... } ","date":"0001-01-01","objectID":"/securecoding/:4:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"æŒ‡å‘èµ„æºå¥æŸ„æˆ–æè¿°ç¬¦çš„å˜é‡ï¼Œåœ¨èµ„æºé‡Šæ”¾åç«‹å³èµ‹äºˆæ–°å€¼ ã€æè¿°ã€‘ æŒ‡å‘èµ„æºå¥æŸ„æˆ–æè¿°ç¬¦çš„å˜é‡åŒ…æ‹¬æŒ‡é’ˆã€æ–‡ä»¶æè¿°ç¬¦ã€socketæè¿°ç¬¦ä»¥åŠå…¶å®ƒæŒ‡å‘èµ„æºçš„å˜é‡ã€‚ ä»¥æŒ‡é’ˆä¸ºä¾‹ï¼Œå½“æŒ‡é’ˆæˆåŠŸç”³è¯·äº†ä¸€æ®µå†…å­˜ä¹‹åï¼Œåœ¨è¿™æ®µå†…å­˜é‡Šæ”¾ä»¥åï¼Œå¦‚æœå…¶æŒ‡é’ˆæœªç«‹å³è®¾ç½®ä¸ºNULLï¼Œä¹Ÿæœªåˆ†é…ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œé‚£è¿™ä¸ªæŒ‡é’ˆå°±æ˜¯ä¸€ä¸ªæ‚¬ç©ºæŒ‡é’ˆã€‚ å¦‚æœå†å¯¹æ‚¬ç©ºæŒ‡é’ˆæ“ä½œï¼Œå¯èƒ½ä¼šå‘ç”Ÿé‡å¤é‡Šæ”¾æˆ–è®¿é—®å·²é‡Šæ”¾å†…å­˜çš„é—®é¢˜ï¼Œé€ æˆå®‰å…¨æ¼æ´ã€‚ æ¶ˆå‡è¯¥æ¼æ´çš„æœ‰æ•ˆæ–¹æ³•æ˜¯å°†é‡Šæ”¾åçš„æŒ‡é’ˆç«‹å³è®¾ç½®ä¸ºä¸€ä¸ªç¡®å®šçš„æ–°å€¼ï¼Œä¾‹å¦‚è®¾ç½®ä¸ºNULLã€‚å¯¹äºå…¨å±€æ€§çš„èµ„æºå¥æŸ„æˆ–æè¿°ç¬¦ï¼Œåœ¨èµ„æºé‡Šæ”¾åï¼Œåº”è¯¥é©¬ä¸Šè®¾ç½®æ–°å€¼ï¼Œä»¥é¿å…ä½¿ç”¨å…¶å·²é‡Šæ”¾çš„æ— æ•ˆå€¼ï¼›å¯¹äºåªåœ¨å•ä¸ªå‡½æ•°å†…ä½¿ç”¨çš„èµ„æºå¥æŸ„æˆ–æè¿°ç¬¦ï¼Œåº”ç¡®ä¿èµ„æºé‡Šæ”¾åå…¶æ— æ•ˆå€¼ä¸è¢«å†æ¬¡ä½¿ç”¨ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œæ ¹æ®æ¶ˆæ¯ç±»å‹å¤„ç†æ¶ˆæ¯ï¼Œå¤„ç†å®Œåé‡Šæ”¾æ‰bodyæˆ–headæŒ‡å‘çš„å†…å­˜ï¼Œä½†æ˜¯é‡Šæ”¾åæœªå°†æŒ‡é’ˆè®¾ç½®ä¸ºNULLã€‚å¦‚æœè¿˜æœ‰å…¶ä»–å‡½æ•°å†æ¬¡å¤„ç†è¯¥æ¶ˆæ¯ç»“æ„ä½“æ—¶ï¼Œå¯èƒ½å‡ºç°é‡å¤é‡Šæ”¾å†…å­˜æˆ–è®¿é—®å·²é‡Šæ”¾å†…å­˜çš„é—®é¢˜ã€‚ int foo(void) { SomeStruct *msg = NULL; ... // åˆå§‹åŒ–msg-\u003etypeï¼Œåˆ†é… msg-\u003ebody çš„å†…å­˜ç©ºé—´ if (msg-\u003etype == MESSAGE_A) { ... free(msg-\u003ebody); } ... EXIT: ... free(msg-\u003ebody); return ret; } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œç«‹å³å¯¹é‡Šæ”¾åçš„æŒ‡é’ˆè®¾ç½®ä¸ºNULLï¼Œé¿å…é‡å¤æ”¾æŒ‡é’ˆã€‚ int foo(void) { SomeStruct *msg = NULL; ... // åˆå§‹åŒ–msg-\u003etypeï¼Œåˆ†é… msg-\u003ebody çš„å†…å­˜ç©ºé—´ if (msg-\u003etype == MESSAGE_A) { ... free(msg-\u003ebody); msg-\u003ebody = NULL; } ... EXIT: ... free(msg-\u003ebody); return ret; } å½“free()å‡½æ•°çš„å…¥å‚ä¸ºNULLæ—¶ï¼Œå‡½æ•°ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­æ–‡ä»¶æè¿°ç¬¦å…³é—­åæœªèµ‹æ–°å€¼ã€‚ SOCKET s = INVALID_SOCKET; int fd = -1; ... closesocket(s); ... close(fd); ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œåœ¨èµ„æºé‡Šæ”¾åï¼Œå¯¹åº”çš„å˜é‡åº”è¯¥ç«‹å³èµ‹äºˆæ–°å€¼ã€‚ SOCKET s = INVALID_SOCKET; int fd = -1; ... closesocket(s); s = INVALID_SOCKET; ... close(fd); fd = -1; ... æŒ‡é’ˆå’Œæ•°ç»„ ","date":"0001-01-01","objectID":"/securecoding/:5:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"å¤–éƒ¨æ•°æ®ä½œä¸ºæ•°ç»„ç´¢å¼•æ—¶å¿…é¡»ç¡®ä¿åœ¨æ•°ç»„å¤§å°èŒƒå›´å†… ã€æè¿°ã€‘ å¤–éƒ¨æ•°æ®ä½œä¸ºæ•°ç»„ç´¢å¼•å¯¹å†…å­˜è¿›è¡Œè®¿é—®æ—¶ï¼Œå¿…é¡»å¯¹æ•°æ®çš„å¤§å°è¿›è¡Œä¸¥æ ¼çš„æ ¡éªŒï¼Œç¡®ä¿æ•°ç»„ç´¢å¼•åœ¨æœ‰æ•ˆèŒƒå›´å†…ï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¸¥é‡çš„é”™è¯¯ã€‚ å½“ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ•°ç»„å…ƒç´ æ—¶ï¼Œå¯ä»¥æŒ‡å‘æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œä½†æ˜¯ä¸èƒ½è¯»å†™è¯¥ä½ç½®çš„å†…å­˜ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­, set_dev_id()å‡½æ•°å­˜åœ¨å·®ä¸€é”™è¯¯ï¼Œå½“ index ç­‰äº DEV_NUM æ—¶ï¼Œæ°å¥½è¶Šç•Œå†™ä¸€ä¸ªå…ƒç´ ï¼› åŒæ ·get_dev()å‡½æ•°ä¹Ÿå­˜åœ¨å·®ä¸€é”™è¯¯ï¼Œè™½ç„¶å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å½“è§£å¼•ç”¨è¿™ä¸ªå‡½æ•°è¿”å›çš„æŒ‡é’ˆæ—¶ï¼Œè¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚ #define DEV_NUM 10 #define MAX_NAME_LEN 128 typedef struct { int id; char name[MAX_NAME_LEN]; } Dev; static Dev devs[DEV_NUM]; int set_dev_id(size_t index, int id) { if (index \u003e DEV_NUM) { // é”™è¯¯ï¼šå·®ä¸€é”™è¯¯ã€‚ ... // é”™è¯¯å¤„ç† } devs[index].id = id; return 0; } static Dev *get_dev(size_t index) { if (index \u003e DEV_NUM) { // é”™è¯¯ï¼šå·®ä¸€é”™è¯¯ã€‚ ... // é”™è¯¯å¤„ç† } return devs + index; } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œä¿®æ”¹æ ¡éªŒç´¢å¼•çš„æ¡ä»¶ï¼Œé¿å…å·®ä¸€é”™è¯¯ã€‚ #define DEV_NUM 10 #define MAX_NAME_LEN 128 typedef struct { int id; char name[MAX_NAME_LEN]; } Dev; static Dev devs[DEV_NUM]; int set_dev_Id (size_t index, int id) { if (index \u003e= DEV_NUM) { ... // é”™è¯¯å¤„ç† } devs[index].id = id; return 0; } static Dev *get_dev(size_t index) { if (index \u003e= DEV_NUM) { ... // é”™è¯¯å¤„ç† } return devs + index; } ã€ç›¸å…³è½¯ä»¶CWEç¼–å·ã€‘ CWE-119ï¼ŒCWE-123ï¼ŒCWE-125 ","date":"0001-01-01","objectID":"/securecoding/:6:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ç¦æ­¢é€šè¿‡å¯¹æŒ‡é’ˆå˜é‡è¿›è¡Œsizeofæ“ä½œæ¥è·å–æ•°ç»„å¤§å° ã€æè¿°ã€‘ å°†æŒ‡é’ˆå½“åšæ•°ç»„è¿›è¡Œsizeofæ“ä½œæ—¶ï¼Œä¼šå¯¼è‡´å®é™…çš„æ‰§è¡Œç»“æœä¸é¢„æœŸä¸ç¬¦ã€‚ä¾‹å¦‚ï¼šå˜é‡å®šä¹‰ char *p = arrayï¼Œå…¶ä¸­arrayçš„å®šä¹‰ä¸ºchar array[LEN]ï¼Œè¡¨è¾¾å¼sizeof(p) å¾—åˆ°çš„ç»“æœä¸ sizeof(char *)ç›¸åŒï¼Œå¹¶éarrayçš„é•¿åº¦ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œbufferå’Œpathåˆ†åˆ«æ˜¯æŒ‡é’ˆå’Œæ•°ç»„ï¼Œç¨‹åºå‘˜æƒ³å¯¹è¿™2ä¸ªå†…å­˜è¿›è¡Œæ¸…0æ“ä½œï¼Œä½†ç”±äºç¨‹åºå‘˜çš„ç–å¿½ï¼Œå°†å†…å­˜å¤§å°è¯¯å†™æˆäº†sizeof(buffer)ï¼Œä¸é¢„æœŸä¸ç¬¦ã€‚ char path[MAX_PATH]; char *buffer = (char *)malloc(SIZE); ... (void)memset(path, 0, sizeof(path)); // sizeofä¸é¢„æœŸä¸ç¬¦ï¼Œå…¶ç»“æœä¸ºæŒ‡é’ˆæœ¬èº«çš„å¤§å°è€Œä¸æ˜¯ç¼“å†²åŒºå¤§å° (void)memset(buffer, 0, sizeof(buffer)); ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œå°†sizeof(buffer)ä¿®æ”¹ä¸ºç”³è¯·çš„ç¼“å†²åŒºå¤§å°ï¼š char path[MAX_PATH]; char *buffer = (char *)malloc(SIZE); ... (void)memset(path, 0, sizeof(path)); (void)memset(buffer, 0, SIZE); // ä½¿ç”¨ç”³è¯·çš„ç¼“å†²åŒºå¤§å° å­—ç¬¦ä¸² ","date":"0001-01-01","objectID":"/securecoding/:7:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ç¡®ä¿å­—ç¬¦ä¸²å­˜å‚¨æœ‰è¶³å¤Ÿçš„ç©ºé—´å®¹çº³å­—ç¬¦æ•°æ®å’Œnullç»“æŸç¬¦ ã€æè¿°ã€‘ å°†æ•°æ®å¤åˆ¶åˆ°ä¸è¶³ä»¥å®¹çº³æ•°æ®çš„ç¼“å†²åŒºï¼Œä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚ç¼“å†²åŒºæº¢å‡ºç»å¸¸å‘ç”Ÿåœ¨å­—ç¬¦ä¸²æ“ä½œä¸­ã€‚ä¸ºäº†é¿å…è¿™ç§é”™è¯¯ï¼Œæˆªæ–­æ‹·è´çš„æ•°æ®ä»¥é™åˆ¶å­—ç¬¦ä¸²çš„å­—èŠ‚é•¿åº¦æ˜¯ä¸€ç§é˜²å¾¡æ–¹æ³•ï¼Œä½†æ˜¯æœ€å¥½çš„æªæ–½æ˜¯ç¡®ä¿ç›®æ ‡ç¼“å†²åŒºçš„å¤§å°è¶³ä»¥å®¹çº³å¤åˆ¶æ•°æ®å’Œnullç»“æŸç¬¦ã€‚å½“å­—ç¬¦ä¸²å­˜å‚¨åœ¨å †ç©ºé—´æ—¶ï¼Œ ç¡®ä¿åˆ†é…å†…å­˜æ—¶å·²åˆ†é…äº†è¶³å¤Ÿçš„ç©ºé—´ã€‚ éƒ¨åˆ†å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ç”±äºè®¾è®¡æ—¶å®‰å…¨è€ƒè™‘ä¸è¶³ï¼Œæˆ–è€…å­˜åœ¨ä¸€äº›éšå«çš„ç›®çš„ç¼“å†²åŒºé•¿åº¦è¦æ±‚ï¼Œå®¹æ˜“è¢«è¯¯ç”¨ï¼Œå¯¼è‡´ç¼“å†²åŒºå†™æº¢å‡ºã€‚æ­¤ç±»å…¸å‹å‡½æ•°åŒ…æ‹¬ä¸åœ¨Cæ ‡å‡†åº“å‡½æ•°ä¸­çš„itoa()ï¼Œrealpath()å‡½æ•°ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘(itoa) æœ‰äº›å‡½æ•°å¦‚itoa(), realpath()éœ€è¦åœ¨å¯¹ä¼ å…¥çš„ç¼“å†²åŒºæŒ‡é’ˆä½ç½®è¿›è¡Œå†™å…¥æ“ä½œï¼Œä½†å‡½æ•°å¹¶æ²¡æœ‰æä¾›ç¼“å†²åŒºé•¿åº¦ã€‚å› æ­¤ï¼Œåœ¨è°ƒç”¨è¿™äº›å‡½æ•°å‰ï¼Œå¿…é¡»æä¾›è¶³å¤Ÿçš„ç¼“å†²åŒºã€‚ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œè¯•å›¾å°†æ•°å­—è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç›®æ ‡å­˜å‚¨ç©ºé—´çš„é¢„ç•™é•¿åº¦ä¸è¶³ï¼š int num = ... char str[8]; itoa(num, str, 10); // 10è¿›åˆ¶æ•´æ•°çš„æœ€å¤§å­˜å‚¨é•¿åº¦æ˜¯12ä¸ªå­—èŠ‚ ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œåœ¨å¯¹å¤–éƒ¨æ•°æ®è¿›è¡Œè§£æå¹¶å°†å†…å®¹ä¿å­˜åˆ°nameä¸­ï¼Œè€ƒè™‘äº†nameçš„å¤§å°ï¼š int num = ... char str[13]; itoa(num, str, 10); // 10è¿›åˆ¶æ•´æ•°çš„æœ€å¤§å­˜å‚¨é•¿åº¦æ˜¯12ä¸ªå­—èŠ‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘(realpath) å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œè¯•å›¾å°†è·¯å¾„æ ‡å‡†åŒ–ï¼Œä½†æ˜¯ç›®æ ‡å­˜å‚¨ç©ºé—´çš„é•¿åº¦ä¸è¶³ï¼š #define MAX_PATH_LEN 100 char resolved_path[MAX_PATH_LEN]; / * - realpathå‡½æ•°çš„å­˜å‚¨ç¼“å†²åŒºé•¿åº¦æ˜¯ç”±PATH_MAXå¸¸é‡å®šä¹‰ï¼Œ - æˆ–æ˜¯ç”±_PC_PATH_MAXç³»ç»Ÿå€¼é…ç½®çš„ï¼Œé€šå¸¸éƒ½å¤§äº100å­—èŠ‚ */ char *res = realpath(path, resolved_path); ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ å¯ä»¥å°†realpathçš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥NULL, ä»¥è®©ç³»ç»Ÿè‡ªåŠ¨åˆ†é…åˆé€‚çš„å†…å­˜ã€‚ char *resolved_path = NULL; resolved_path = realpath(path, NULL); if (resolved_path == NULL) { ... // å¤„ç†é”™è¯¯ } ... if (resolved_path != NULL) { free(resolved_path); resolved_path = NULL; } ... ","date":"0001-01-01","objectID":"/securecoding/:8:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"å¯¹å­—ç¬¦ä¸²è¿›è¡Œå­˜å‚¨æ“ä½œï¼Œç¡®ä¿å­—ç¬¦ä¸²æœ‰nullç»“æŸç¬¦ ã€æè¿°ã€‘ éƒ¨åˆ†å­—ç¬¦ä¸²å¤„ç†å‡½æ•°æ“ä½œå­—ç¬¦ä¸²æ—¶ï¼Œå°†æˆªæ–­è¶…å‡ºæŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œå¦‚strncpy()å‡½æ•°æœ€å¤šå¤åˆ¶nä¸ªå­—ç¬¦åˆ°ç›®çš„ç¼“å†²åŒºï¼Œå¦‚æœæºå­—ç¬¦ä¸²é•¿åº¦å¤§äºnï¼Œåˆ™ä¸ä¼šå†™å…¥nullç»“æŸç¬¦åˆ°ç›®çš„ç¼“å†²åŒºï¼Œç›®çš„ç¼“å†²åŒºçš„å†…å®¹ä¸ºnä¸ªè¢«å¤åˆ¶çš„å­—ç¬¦ã€‚ä½¿ç”¨è¿™ç±»å‡½æ•°æ—¶ï¼Œå¯èƒ½ä¼šæ— æ„æˆªæ–­å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œå¹¶åœ¨æŸäº›æƒ…å†µä¸‹ä¼šå¯¼è‡´è½¯ä»¶æ¼æ´ã€‚ å› æ­¤ï¼Œå¯¹å­—ç¬¦ä¸²è¿›è¡Œå­˜å‚¨æ“ä½œï¼Œå¿…é¡»ç¡®ä¿å­—ç¬¦ä¸²æœ‰nullç»“æŸç¬¦ï¼Œå¦åˆ™åœ¨åç»­çš„è°ƒç”¨strlenç­‰æ“ä½œä¸­ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜è¶Šç•Œè®¿é—®æ¼æ´ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ åœ¨å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨strncpyå‡½æ•°å¤åˆ¶å­—ç¬¦ä¸²æ—¶å¯èƒ½ä¼šå‘ç”Ÿæˆªæ–­ï¼ˆå‘ç”Ÿæ¡ä»¶ä¸ºï¼šstrlen(name) \u003e sizeof(file_name) - 1ï¼‰ã€‚å½“å‘ç”Ÿæˆªæ–­æ—¶ï¼Œfile_nameçš„å†…å®¹æ˜¯ä¸å®Œæ•´çš„ï¼Œå¹¶ä¸”ç¼ºå°‘ â€™ 0 â€˜ç»“æŸç¬¦ï¼Œåç»­å¯¹file_nameçš„æ“ä½œå¯èƒ½ä¼šå¯¼è‡´è½¯ä»¶æ¼æ´ï¼š #define FILE_NAME_LEN 128 char file_name [FILE_NAME_LEN ]; (void)strncpy(file_name, name, sizeof(file_name) - 1); ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ #define FILE_NAME_LEN 128 char file_name[FILE_NAME_LEN ]; if (strlen(name) \u003e FILE_NAME_LEN - 1) { ... // å¤„ç†é”™è¯¯ } (void)strcpy(file_name, name); ... ã€ä¾‹å¤–ã€‘ ç¨‹åºå‘˜çš„ç›®çš„æ˜¯æ•…æ„æˆªæ–­å­—ç¬¦ä¸²ã€‚ ã€ç›¸å…³è½¯ä»¶CWEç¼–å·ã€‘ CWE-170ï¼ŒCWE-464 æ–­è¨€ ","date":"0001-01-01","objectID":"/securecoding/:9:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ç¦æ­¢ç”¨æ–­è¨€æ£€æµ‹ç¨‹åºåœ¨è¿è¡ŒæœŸé—´å¯èƒ½å¯¼è‡´çš„é”™è¯¯ï¼Œå¯èƒ½å‘ç”Ÿçš„é”™è¯¯è¦ç”¨é”™è¯¯å¤„ç†ä»£ç æ¥å¤„ç† ã€æè¿°ã€‘ æ–­è¨€ä¸»è¦ç”¨äºè°ƒè¯•æœŸé—´ï¼Œåœ¨ç¼–è¯‘Releaseç‰ˆæœ¬æ—¶å°†å…¶å…³é—­ã€‚å› æ­¤ï¼Œæ–­è¨€åº”è¯¥ç”¨äºé˜²æ­¢ä¸æ­£ç¡®çš„ç¨‹åºå‘˜å‡è®¾ï¼Œè€Œä¸èƒ½ç”¨åœ¨Releaseç‰ˆæœ¬ä¸Šæ£€æŸ¥ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯ã€‚ æ–­è¨€æ°¸è¿œä¸åº”ç”¨äºéªŒè¯æ˜¯å¦å­˜åœ¨è¿è¡Œæ—¶ï¼ˆä¸é€»è¾‘ç›¸å¯¹ï¼‰é”™è¯¯ï¼Œä¾‹å¦‚ æ— æ•ˆçš„ç”¨æˆ·è¾“å…¥ï¼ˆåŒ…æ‹¬å‘½ä»¤è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡ï¼‰ æ–‡ä»¶é”™è¯¯ï¼ˆä¾‹å¦‚ï¼Œæ‰“å¼€ï¼Œè¯»å–æˆ–å†™å…¥æ–‡ä»¶æ—¶å‡ºé”™ï¼‰ ç½‘ç»œé”™è¯¯ï¼ˆåŒ…æ‹¬ç½‘ç»œåè®®é”™è¯¯ï¼‰ å†…å­˜ä¸è¶³çš„æƒ…å†µï¼ˆä¾‹å¦‚ï¼Œmalloc()ç±»ä¼¼çš„æ•…éšœï¼‰ ç³»ç»Ÿèµ„æºè€—å°½ï¼ˆä¾‹å¦‚ï¼Œæ–‡ä»¶æè¿°ç¬¦ï¼Œè¿›ç¨‹ï¼Œçº¿ç¨‹ï¼‰ ç³»ç»Ÿè°ƒç”¨é”™è¯¯ï¼ˆä¾‹å¦‚ï¼Œæ‰§è¡Œæ–‡ä»¶ï¼Œé”å®šæˆ–è§£é”äº’æ–¥é”æ—¶å‡ºé”™ï¼‰ æ— æ•ˆçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œæ–‡ä»¶ï¼Œå†…å­˜ï¼Œç”¨æˆ·ï¼‰ ä¾‹å¦‚ï¼Œé˜²æ­¢ç¼“å†²åŒºæº¢å‡ºçš„ä»£ç ä¸èƒ½ä½¿ç”¨æ–­è¨€å®ç°ï¼Œå› ä¸ºè¯¥ä»£ç å¿…é¡»ç¼–è¯‘åˆ°Releaseç‰ˆæœ¬çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚ å¦‚æœæœåŠ¡å™¨ç¨‹åºåœ¨ç½‘è¿è¡Œæ—¶ç”±æ¶æ„ç”¨æˆ·è§¦å‘æ–­è¨€å¤±è´¥ï¼Œä¼šå¯¼è‡´æ‹’ç»æœåŠ¡æ”»å‡»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ›´é€‚åˆä½¿ç”¨è½¯æ•…éšœæ¨¡å¼ï¼Œä¾‹å¦‚å†™å…¥æ—¥å¿—æ–‡ä»¶å’Œæ‹’ç»è¯·æ±‚ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ ä»¥ä¸‹ä»£ç çš„æ‰€æœ‰ASSERTçš„ç”¨æ³•æ˜¯é”™è¯¯çš„ã€‚ä¾‹å¦‚ï¼Œé”™è¯¯çš„ä½¿ç”¨ASSERTå®æ¥éªŒè¯å†…å­˜åˆ†é…æ˜¯å¦æˆåŠŸï¼Œå› ä¸ºå†…å­˜çš„å¯ç”¨æ€§å–å†³äºç³»ç»Ÿçš„æ•´ä½“çŠ¶æ€ï¼Œå¹¶ä¸”åœ¨ç¨‹åºè¿è¡Œçš„ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è€—å°½ï¼Œæ‰€ä»¥å¿…é¡»ä»¥å…·æœ‰éŸ§æ€§çš„æ–¹å¼æ¥å¦¥å–„å¤„ç†å¹¶å°†ç¨‹åºä»å†…å­˜è€—å°½ä¸­æ¢å¤ã€‚å› æ­¤ï¼Œä½¿ç”¨ASSERTå®æ¥éªŒè¯å†…å­˜åˆ†é…æ˜¯å¦æˆåŠŸå°†æ˜¯ä¸åˆé€‚çš„ï¼Œå› ä¸ºè¿™æ ·åšå¯èƒ½å¯¼è‡´è¿›ç¨‹çªç„¶ç»ˆæ­¢ï¼Œä»è€Œå¼€å¯äº†æ‹’ç»æœåŠ¡æ”»å‡»çš„å¯èƒ½æ€§ã€‚ FILE *fp = fopen(path, \"r\"); ASSERT(fp != NULL); // é”™è¯¯ç”¨æ³•ï¼šæ–‡ä»¶æœ‰å¯èƒ½æ‰“å¼€å¤±è´¥ char *str = (char *)malloc(MAX_LINE); ASSERT(str != NULL); // é”™è¯¯ç”¨æ³•ï¼šå†…å­˜æœ‰å¯èƒ½åˆ†é…å¤±è´¥ ReadLine(fp, str); char *p = strstr(str, \"age=\"); ASSERT(p != NULL); // é”™è¯¯ç”¨æ³•ï¼šæ–‡ä»¶ä¸­ä¸ä¸€å®šå­˜åœ¨è¯¥å­—ç¬¦ä¸² char *end = NULL; long age = strtol(p + 4, \u0026end, 10); ASSERT(age \u003e 0); // é”™è¯¯ç”¨æ³•ï¼šæ–‡ä»¶å†…å®¹ä¸ä¸€å®šç¬¦åˆé¢„æœŸ ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ ä¸‹é¢ä»£ç æ¼”ç¤ºäº†å¦‚ä½•é‡æ„ä¸Šé¢çš„é”™è¯¯ä»£ç : FILE *fp = fopen(path, \"r\"); if (fp == NULL) { ... // é”™è¯¯å¤„ç† } char *str = (char *)malloc(MAX_LINE); if (str == NULL) { ... // é”™è¯¯å¤„ç† } read_line(fp, str); char *p = strstr(str, \"age=\"); if (p == NULL) { ... // é”™è¯¯å¤„ç† } char *end = NULL; long age = strtol(p + 4, \u0026end, 10); if (age \u003c= 0) { ... // é”™è¯¯å¤„ç† } ","date":"0001-01-01","objectID":"/securecoding/:10:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ç¦æ­¢åœ¨æ–­è¨€å†…æ”¹å˜è¿è¡Œç¯å¢ƒ ã€æè¿°ã€‘ åœ¨ç¨‹åºæ­£å¼å‘å¸ƒé˜¶æ®µï¼Œæ–­è¨€ä¸ä¼šè¢«ç¼–è¯‘è¿›å»ï¼Œä¸ºäº†ç¡®ä¿è°ƒè¯•ç‰ˆå’Œæ­£å¼ç‰ˆçš„åŠŸèƒ½ä¸€è‡´æ€§ï¼Œä¸¥ç¦åœ¨æ–­è¨€ä¸­ä½¿ç”¨ä»»ä½•èµ‹å€¼ã€ä¿®æ”¹å˜é‡ã€èµ„æºæ“ä½œã€å†…å­˜ç”³è¯·ç­‰æ“ä½œã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹çš„æ–­è¨€æ–¹å¼æ˜¯é”™è¯¯çš„ï¼š ASSERT(p1 = p2); // p1è¢«ä¿®æ”¹ ASSERT(i++ \u003e 1000); // iè¢«ä¿®æ”¹ ASSERT(close(fd) == 0); // fdè¢«å…³é—­ å‡½æ•°è®¾è®¡ ","date":"0001-01-01","objectID":"/securecoding/:11:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"æ•°ç»„ä½œä¸ºå‡½æ•°å‚æ•°æ—¶ï¼Œå¿…é¡»åŒæ—¶å°†å…¶é•¿åº¦ä½œä¸ºå‡½æ•°çš„å‚æ•° ã€æè¿°ã€‘ é€šè¿‡å‡½æ•°å‚æ•°ä¼ é€’æ•°ç»„å‡½æ•°å‚æ•°å¿…é¡»åŒæ—¶ä¼ é€’æ•°ç»„å¯å®¹çº³å…ƒç´ çš„ä¸ªæ•°ï¼Œè€Œä¸æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„æ•°ç»„æœ€å¤§å¤§å°ï¼›åŒæ ·ï¼Œé€šè¿‡å‡½æ•°å‚æ•°ä¼ é€’ä¸€å—å†…å­˜è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œå¿…é¡»åŒæ—¶ä¼ é€’å†…å­˜å—å¤§å°ï¼Œå¦åˆ™å‡½æ•°åœ¨è®¿é—®å†…å­˜åç§»æ—¶ï¼Œæ— æ³•åˆ¤æ–­åç§»çš„åˆæ³•èŒƒå›´ï¼Œäº§ç”Ÿè¶Šç•Œè®¿é—®çš„æ¼æ´ã€‚åœ¨æœ¬è§„åˆ™ä¸­æ‰€è¯´çš„\"æ•°ç»„\"ä¸ä»…å±€é™ä¸ºæ•°ç»„ç±»å‹å˜é‡ï¼Œè¿˜åŒ…æ‹¬å­—ç¬¦ä¸²æˆ–æŒ‡å‘è¿ç»­å†…å­˜å—çš„æŒ‡é’ˆã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œå‡½æ•°pars_msgä¸çŸ¥é“msgçš„èŒƒå›´ï¼Œå®¹æ˜“äº§ç”Ÿå†…å­˜è¶Šç•Œè®¿é—®æ¼æ´ã€‚ int parse_msg(unsigned char *msg) { ... } void foo(void) { size_t len = get_msg_len(); ... unsigned char *msg = (unsigned char *)malloc(len); ... parse_msg(msg); ... } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ æ­£ç¡®çš„åšæ³•æ˜¯å°†msgçš„å¤§å°ä½œä¸ºå‚æ•°ä¼ é€’åˆ°parse_msgä¸­ï¼Œå¦‚ä¸‹ä»£ç ï¼š int parse_msg(unsigned char *msg, size_t msg_len) { ASSERT(msg != NULL); ASSERT(msg_len != 0); ... } void foo(void) { size_t len = get_msg_len(); ... unsigned char *msg = (unsigned char *)malloc(len); ... parse_msg(msg, len); ... } ","date":"0001-01-01","objectID":"/securecoding/:12:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"å‡½æ•°çš„æŒ‡é’ˆå‚æ•°å¦‚æœä¸æ˜¯ç”¨äºä¿®æ”¹æ‰€æŒ‡å‘çš„å¯¹è±¡å°±åº”è¯¥å£°æ˜ä¸ºæŒ‡å‘constçš„æŒ‡é’ˆ ã€æè¿°ã€‘ const æŒ‡é’ˆå‚æ•°ï¼Œå°†é™åˆ¶å‡½æ•°é€šè¿‡è¯¥æŒ‡é’ˆä¿®æ”¹æ‰€æŒ‡å‘å¯¹è±¡ï¼Œä½¿ä»£ç æ›´ç‰¢å›ºã€æ›´å®‰å…¨ã€‚ ç¤ºä¾‹ï¼šå¦‚strncmp çš„ä¾‹å­ï¼ŒæŒ‡å‘çš„å¯¹è±¡ä¸å˜åŒ–çš„æŒ‡é’ˆå‚æ•°å£°æ˜ä¸ºconstã€‚ // æ­£ç¡®ï¼šä¸å˜å‚æ•°å£°æ˜ä¸ºconst int strncmp(const char *s1, const char *s2, size_t n); æ³¨æ„ï¼š æŒ‡é’ˆå‚æ•°è¦ä¸è¦åŠ constå–å†³äºå‡½æ•°è®¾è®¡ï¼Œè€Œä¸æ˜¯çœ‹å‡½æ•°å®ä½“å†…æœ‰æ²¡æœ‰å‘ç”Ÿ\"ä¿®æ”¹å¯¹è±¡\"çš„åŠ¨ä½œã€‚ ","date":"0001-01-01","objectID":"/securecoding/:13:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"è°ƒç”¨æ ¼å¼åŒ–è¾“å…¥/è¾“å‡ºå‡½æ•°æ—¶ï¼Œç¦æ­¢formatå‚æ•°å—å¤–éƒ¨æ•°æ®æ§åˆ¶ ã€æè¿°ã€‘ è°ƒç”¨æ ¼å¼åŒ–å‡½æ•°æ—¶ï¼Œå¦‚æœformatå‚æ•°ç”±å¤–éƒ¨æ•°æ®æä¾›ï¼Œæˆ–ç”±å¤–éƒ¨æ•°æ®æ‹¼æ¥è€Œæ¥ï¼Œä¼šé€ æˆå­—ç¬¦ä¸²æ ¼å¼åŒ–æ¼æ´ã€‚ æ”»å‡»è€…å¦‚æœèƒ½å¤Ÿå®Œå…¨æˆ–è€…éƒ¨åˆ†æ§åˆ¶æ ¼å¼å­—ç¬¦ä¸²å†…å®¹ï¼Œå¯ä»¥ä½¿è¢«æ”»å‡»çš„è¿›ç¨‹å´©æºƒã€æŸ¥çœ‹æ ˆå†…å®¹ã€æŸ¥çœ‹å†…å­˜å†…å®¹æˆ–è€…åœ¨ä»»æ„å†…å­˜ä½ç½®å†™å…¥æ•°æ®ã€‚ç»“æœæ˜¯ï¼Œæ”»å‡»è€…èƒ½å¤Ÿä»¥è¢«æ”»å‡»è¿›ç¨‹çš„æƒé™æ‰§è¡Œä»»æ„ä»£ç ã€‚ æ ¼å¼åŒ–è¾“å‡ºå‡½æ•°ç‰¹åˆ«å±é™©ï¼Œè¿™æ˜¯å› ä¸ºè®¸å¤šç¨‹åºå‘˜æ²¡æœ‰æ„è¯†åˆ°å®ƒä»¬æ˜¯å…·æœ‰æ”»å‡»èƒ½åŠ›çš„ã€‚æ¯”å¦‚ï¼šæ ¼å¼åŒ–è¾“å‡ºå‡½æ•°å¯ä»¥ä½¿ç”¨%nè½¬æ¢ç¬¦ï¼Œå‘æŒ‡å®šåœ°å€å†™å…¥ä¸€ä¸ªæ•´æ•°å€¼ã€‚ è¿™äº›æ ¼å¼åŒ–å‡½æ•°æœ‰ï¼š æ ¼å¼åŒ–è¾“å‡ºå‡½æ•°: xxxprintf; æ ¼å¼åŒ–è¾“å…¥å‡½æ•°: xxxscanf; æ ¼å¼åŒ–é”™è¯¯æ¶ˆæ¯å‡½æ•°: err(), verr(), errx(), verrx(), warn(), vwarn(), warnx(), vwarnx(), error(), error_at_line(); æ ¼å¼åŒ–æ—¥å¿—å‡½æ•°: syslog(), vsyslog(). ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­çš„incorrect_password()å‡½æ•°çš„åŠŸèƒ½æ˜¯åœ¨èº«ä»½éªŒè¯æ— æ•ˆæ—¶ï¼ˆæŒ‡å®šç”¨æˆ·æ²¡æœ‰æ‰¾åˆ°æˆ–è€…å¯†ç ä¸æ­£ç¡®ï¼‰ï¼Œæ˜¾ç¤ºä¸€æ¡é”™è¯¯ä¿¡æ¯ã€‚ è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªæºè‡ªç”¨æˆ·çš„å­—ç¬¦ä¸²æ•°æ®userï¼Œè€Œuseræ˜¯æœªéªŒè¯çš„ï¼Œæ˜¯å¤–éƒ¨å¯æ§çš„ã€‚ è¯¥å‡½æ•°å°†useræ„é€ ä¸€æ¡é”™è¯¯ä¿¡æ¯ï¼Œç„¶åç”¨Cè¯­è¨€æ ‡å‡†å‡½æ•°fprintfæ‰“å°åˆ°stderrã€‚ // è°ƒç”¨è€…éœ€ä¿è¯å…¥å‚userçš„é•¿åº¦è¢«é™åˆ¶ä¸º256ä¸ªå­—èŠ‚æˆ–è€…æ›´å°‘ void incorrect_password(const char *user) { int ret = -1; static const char msg_format[] = \"%s cannot be authenticated.\\n\"; size_t len = strlen(user) + 1 + sizeof(msg_format); char *msg = (char *)malloc(len); if (msg == NULL) { ... // é”™è¯¯å¤„ç† } ret = snprintf(msg, msg_format, user); if (ret == -1) { ... // é”™è¯¯å¤„ç† } else { fprintf(stderr, msg); // msgä¸­æœ‰æ¥è‡ªæœªéªŒè¯çš„å¤–éƒ¨æ•°æ®ï¼Œå­˜åœ¨æ ¼å¼åŒ–æ¼æ´ } free(msg); } ç¤ºä¾‹ä»£ç ä¸­é¦–å…ˆè®¡ç®—äº†æ¶ˆæ¯çš„é•¿åº¦ï¼Œç„¶ååˆ†é…å†…å­˜ï¼Œæ¥ç€åˆ©ç”¨snprintf()å‡½æ•°æ‹¼æ¥äº†æ¶ˆæ¯å†…å®¹ã€‚å› æ­¤æ¶ˆæ¯å†…å®¹ä¸­åŒ…å«äº†msg_formatçš„å†…å®¹å’Œç”¨æˆ·çš„å†…å®¹ã€‚ å½“å…¥å‚userä¸­å«æœ‰ç”¨æˆ·è¾“å…¥çš„æ ¼å¼ç¬¦ï¼ˆå¦‚%s,%p,%nç­‰åï¼Œfprintf()åœ¨æ‰§è¡Œæ—¶ï¼Œä¼šå°†msgä½œä¸ºä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥è¿›è¡Œè§£æï¼Œè€Œä¸æ˜¯ç›´æ¥è¾“å‡ºæ¶ˆæ¯å†…å®¹ï¼Œ ä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶msgä¸­çš„å†…å®¹ä¸ä¼šè¢«ç›´æ¥æ‰“å°åˆ°stderrä¸­ï¼Œåè€Œä¼šå°†ä¸€äº›æœªçŸ¥çš„æ•°æ®æ‰“å°åˆ°stderrï¼Œå¼•å‘ç¨‹åºæœªå®šä¹‰çš„è¡Œä¸ºã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸ä¸¥é‡çš„æ ¼å¼åŒ–æ¼æ´ã€‚ ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ ä¸‹é¢æ˜¯ç¬¬ä¸€ç§æ¨èåšæ³•ï¼Œä»£ç ä¸­ä½¿ç”¨fputs()æ¥ä»£æ›¿fprintf()å‡½æ•°ï¼Œfputs()ä¼šç›´æ¥å°†msgçš„å†…å®¹è¾“å‡ºåˆ°stderrä¸­ï¼Œè€Œä¸ä¼šå»è§£æå®ƒã€‚ // å…¥å‚userçš„é•¿åº¦è¢«é™åˆ¶ä¸º256ä¸ªå­—èŠ‚æˆ–è€…æ›´å°‘ void incorrect_password(const char *user) { int ret = -1; static const char msg_format[] = \"%s cannot be authenticated.\\n\"; // è¿™é‡ŒåŠ æ³•è¿ç®—ä¸ä¼šæ•´æ•°æº¢å‡ºï¼Œå› ä¸ºuseræœ‰é™åˆ¶ size_t len = strlen(user) + 1 + sizeof(msg_format); char *msg = (char *)malloc(len); if (msg == NULL) { ... // é”™è¯¯å¤„ç† } ret = snprintf(msg, msg_format, user); if (ret == -1) { ... // é”™è¯¯å¤„ç† } else { fputs(stderr, msg); // ä½¿ç”¨fputså‡½æ•°ä»£æ›¿fprintfå‡½æ•° } free(msg); } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ ä¸‹é¢æ˜¯ç¬¬äºŒç§æ¨èåšæ³•ï¼Œä»£ç ä¸­å°†ä¸å—ä¿¡ä»»çš„ç”¨æˆ·è¾“å…¥userä½œä¸ºfprintf()çš„å¯é€‰å‚æ•°ä¹‹ä¸€ï¼Œç”¨\"%s\"å°†userä»¥å­—ç¬¦ä¸²çš„å½¢å¼å›ºå®šä¸‹æ¥ï¼Œç„¶åè¾“å‡ºåˆ°stderrä¸­ï¼Œè€Œä¸ä½œä¸ºæ ¼å¼å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ ·å°±æ¶ˆé™¤äº†æ ¼å¼å­—ç¬¦ä¸²æ¼æ´å‡ºç°çš„å¯èƒ½æ€§ã€‚ void incorrect_password(const char *user) { static const char msg_format[] = \"%s cannot be authenticated.\\n\"; fprintf(stderr, msg_format, user); } ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨äº†POSIXå‡½æ•°syslog()ï¼Œä½†æ˜¯syslog()å‡½æ•°ä¹Ÿå¯èƒ½å‡ºç°æ ¼å¼å­—ç¬¦ä¸²æ¼æ´ã€‚ void foo(void) { char *msg = get_msg(); ... syslog(LOG_INFO, msg); // å­˜åœ¨æ ¼å¼åŒ–æ¼æ´ } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ ä¸‹é¢æ˜¯æ¨èåšæ³•ï¼Œä»£ç ä¸­å°†ä¸å—ä¿¡ä»»çš„ç”¨æˆ·è¾“å…¥msgä½œä¸ºsyslog()çš„å¯é€‰å‚æ•°ä¹‹ä¸€ï¼Œç”¨\"%s\"å°†msgä»¥å­—ç¬¦ä¸²çš„å½¢å¼å›ºå®šä¸‹æ¥ï¼Œç„¶åè¾“å‡ºåˆ°ç³»ç»Ÿæ—¥å¿—ä¸­ï¼Œè€Œä¸ä½œä¸ºæ ¼å¼å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ ·å°±æ¶ˆé™¤äº†æ ¼å¼å­—ç¬¦ä¸²æ¼æ´å‡ºç°çš„å¯èƒ½æ€§ã€‚ void foo(void) { static const char msg_format[] = \"%s cannot be authenticated.\\n\"; char *msg = get_msg(); ... syslog(LOG_INFO, msg_format, msg); // è¿™é‡Œæ²¡æœ‰æ ¼å¼åŒ–æ¼æ´ } å‡½æ•°ä½¿ç”¨ ","date":"0001-01-01","objectID":"/securecoding/:14:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"è°ƒç”¨æ ¼å¼åŒ–è¾“å…¥/è¾“å‡ºå‡½æ•°æ—¶ï¼Œä½¿ç”¨æœ‰æ•ˆçš„æ ¼å¼å­—ç¬¦ä¸² ã€æè¿°ã€‘ æ ¼å¼åŒ–è¾“å…¥/è¾“å‡ºå‡½æ•°ï¼ˆå¦‚fscanf()/fprintf()åŠç›¸å…³å‡½æ•°ï¼‰åœ¨formatå­—ç¬¦ä¸²æ§åˆ¶ä¸‹è¿›è¡Œè½¬æ¢ã€æ ¼å¼åŒ–ã€æ‰“å°å…¶å®å‚ã€‚ åœ¨åˆ›å»ºæ ¼å¼åŒ–å­—ç¬¦ä¸²æ—¶çš„å¸¸è§é”™è¯¯åŒ…æ‹¬ï¼š formatä¸­å‚æ•°ä¸ªæ•°ä¸å®å‚ä¸ªæ•°ä¸ä¸€è‡´ï¼› ä½¿ç”¨æ— æ•ˆçš„è½¬æ¢æŒ‡ç¤ºç¬¦ï¼› ä½¿ç”¨ä¸è½¬æ¢æŒ‡ç¤ºç¬¦ä¸å…¼å®¹çš„æ ‡å¿—å­—ç¬¦ï¼› ä½¿ç”¨ä¸è½¬æ¢æŒ‡ç¤ºç¬¦ä¸å…¼å®¹çš„é•¿åº¦ä¿®é¥°ç¬¦ï¼› formatä¸­è½¬æ¢æŒ‡ç¤ºç¬¦ä¸å®å‚ç±»å‹ä¸åŒ¹é…ï¼› ä½¿ç”¨intä»¥å¤–ç±»å‹çš„å®å‚æŒ‡å®šå®½åº¦æˆ–è€…ç²¾åº¦ï¼› ä¸è¦ä¸ºæ ¼å¼åŒ–è¾“å…¥/è¾“å‡ºå‡½æ•°æä¾›æœªçŸ¥çš„æˆ–è€…æ— æ•ˆçš„è½¬æ¢è§„æ ¼ï¼Œä»¥åŠæ ‡å¿—å­—ç¬¦ã€ç²¾åº¦ã€é•¿åº¦ä¿®é¥°ç¬¦ã€è½¬æ¢æŒ‡ç¤ºç¬¦çš„æ— æ•ˆç»„åˆã€‚åŒæ ·ï¼Œä¸è¦æä¾›ä¸æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„è½¬æ¢æŒ‡ç¤ºç¬¦ç±»å‹ä¸åŒ¹é…çš„å®å‚ã€‚è¿™å¯èƒ½ä¼šä½¿ç¨‹åºäº§ç”Ÿæœªå®šä¹‰è¡Œä¸ºã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œprintf()çš„å®å‚infoLevelç±»å‹ä¸å¯¹åº”çš„è½¬æ¢æŒ‡ç¤ºç¬¦ â€™s â€˜ä¸åŒ¹é…ï¼Œæ­£ç¡®çš„è½¬æ¢æŒ‡ç¤ºç¬¦è¦ä½¿ç”¨ â€™d â€˜ã€‚åŒæ ·ï¼Œå®å‚infoMsgç±»å‹ä¸å¯¹åº”çš„è½¬æ¢æŒ‡ç¤ºç¬¦ â€™d â€˜ä¸åŒ¹é…ï¼Œæ­£ç¡®çš„è½¬æ¢æŒ‡ç¤ºç¬¦è¦ä½¿ç”¨ â€™s â€˜ã€‚ è¿™äº›ç”¨æ³•ä¼šä½¿ç¨‹åºäº§ç”Ÿæœªå®šä¹‰è¡Œä¸ºï¼Œæ¯”å¦‚ï¼šprintf()å°†æŠŠinfoLevelå®å‚è§£é‡Šä¸ºæŒ‡é’ˆï¼Œè¯•å›¾ä»infoLevelåŒ…å«çš„åœ°å€ä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»è€Œå‘ç”Ÿéæ³•è®¿é—®ã€‚ void foo(void) { const char *info_msg = \"Information seed to user.\"; int info_level = 3; ... printf(\"infoLevel: %s, infoMsg: %d\\n\", info_level, info_msg); ... } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ æ­£ç¡®çš„åšæ³•æ˜¯ç¡®ä¿printf()å‡½æ•°çš„å®å‚åŒ¹é…formatçš„è½¬æ¢æŒ‡ç¤ºç¬¦ã€‚ void foo(void) { const char *info_msg = \"Information seed to user.\"; int info_level = 3; ... printf(\"infoLevel: %d, infoMsg: %s\\n\", info_level, info_msg); ... } ã€å½±å“ã€‘ é”™è¯¯çš„æ ¼å¼ä¸²å¯èƒ½é€ æˆå†…å­˜ç ´åæˆ–è€…ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ã€‚ ","date":"0001-01-01","objectID":"/securecoding/:15:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ç¦æ­¢ä½¿ç”¨alloca()å‡½æ•°ç”³è¯·æ ˆä¸Šå†…å­˜ ã€æè¿°ã€‘ POSIXå’ŒC99å‡æœªå®šä¹‰alloca()çš„è¡Œä¸ºï¼Œåœ¨æœ‰äº›å¹³å°ä¸‹ä¸æ”¯æŒè¯¥å‡½æ•°ï¼Œä½¿ç”¨allocaä¼šé™ä½ç¨‹åºçš„å…¼å®¹æ€§å’Œå¯ç§»æ¤æ€§ï¼Œè¯¥å‡½æ•°åœ¨æ ˆå¸§é‡Œç”³è¯·å†…å­˜ï¼Œç”³è¯·çš„å¤§å°å¾ˆå¯èƒ½è¶…è¿‡æ ˆçš„è¾¹ç•Œï¼Œå½±å“åç»­çš„ä»£ç æ‰§è¡Œã€‚ è¯·ä½¿ç”¨mallocä»å †ä¸­åŠ¨æ€åˆ†é…å†…å­˜ã€‚ ã€å½±å“ã€‘ ç¨‹åºæ ˆçš„å¤§å°éå¸¸æœ‰é™ï¼Œå¦‚æœåˆ†é…å¯¼è‡´æ ˆæº¢å‡ºï¼Œåˆ™ç¨‹åºäº§ç”Ÿæœªå®šä¹‰è¡Œ ","date":"0001-01-01","objectID":"/securecoding/:16:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ç¦æ­¢ä½¿ç”¨realloc()å‡½æ•° ã€æè¿°ã€‘ realloc()æ˜¯ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„å‡½æ•°ï¼ŒåŸå‹å¦‚ä¸‹ï¼š void *realloc(void *ptr, size_t size); éšç€å‚æ•°çš„ä¸åŒï¼Œå…¶è¡Œä¸ºä¹Ÿæ˜¯ä¸åŒï¼š å½“pträ¸ä¸ºNULLï¼Œä¸”sizeä¸ä¸º0æ—¶ï¼Œè¯¥å‡½æ•°ä¼šé‡æ–°è°ƒæ•´å†…å­˜å¤§å°ï¼Œå¹¶å°†æ–°çš„å†…å­˜æŒ‡é’ˆè¿”å›ï¼Œå¹¶ä¿è¯æœ€å°çš„sizeçš„å†…å®¹ä¸å˜ï¼› å‚æ•°pträ¸ºNULLï¼Œä½†sizeä¸ä¸º0ï¼Œé‚£ä¹ˆå…¶è¡Œä¸ºç­‰åŒäºmalloc(size)ï¼› å‚æ•°sizeä¸º0ï¼Œåˆ™reallocçš„è¡Œä¸ºç­‰åŒäºfree(ptr)ã€‚ ç”±æ­¤å¯è§ï¼Œä¸€ä¸ªç®€å•çš„Cå‡½æ•°ï¼Œå´è¢«èµ‹äºˆäº†3ç§è¡Œä¸ºï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„å‡½æ•°ã€‚è™½ç„¶åœ¨ç¼–ç¨‹ä¸­æä¾›äº†ä¸€äº›ä¾¿åˆ©æ€§ï¼Œå¦‚æœè®¤è¯†ä¸è¶³ï¼Œä½¿ç”¨ä¸å½“ï¼Œæ˜¯å´ææ˜“å¼•å‘å„ç§bugã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨reallocä¸å½“å¯¼è‡´å†…å­˜æ³„æ¼ã€‚ ä»£ç ä¸­å¸Œæœ›å¯¹ptrçš„ç©ºé—´è¿›è¡Œæ‰©å……ï¼Œå½“realloc()åˆ†é…å¤±è´¥çš„æ—¶å€™ï¼Œä¼šè¿”å›NULLã€‚ä½†æ˜¯å‚æ•°ä¸­çš„ptrçš„å†…å­˜æ˜¯æ²¡æœ‰è¢«é‡Šæ”¾çš„ï¼Œå¦‚æœç›´æ¥å°†realloc()çš„è¿”å›å€¼èµ‹ç»™ptrï¼Œé‚£ä¹ˆptråŸæ¥æŒ‡å‘çš„å†…å­˜å°±ä¼šä¸¢å¤±ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚ // å½“realloc()åˆ†é…å†…å­˜å¤±è´¥æ—¶ä¼šè¿”å›NULLï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ char *ptr = (char *)realloc(ptr, NEW_SIZE); if (ptr == NULL) { ...// é”™è¯¯å¤„ç† } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ ä½¿ç”¨malloc()å‡½æ•°ä»£æ›¿realloc()å‡½æ•°ã€‚ // ä½¿ç”¨malloc()å‡½æ•°ä»£æ›¿realloc()å‡½æ•° char *new_ptr = (char *)malloc(NEW_SIZE); if (new_ptr == NULL) { ... // é”™è¯¯å¤„ç† } (void)memcpy(new_ptr, old_ptr, old_size); ... // è¿”å›å‰ï¼Œé‡Šæ”¾old_Ptr ã€å½±å“ã€‘ ä½¿ç”¨ä¸å½“å®¹æ˜“é€ æˆå†…å­˜æ³„æ¼å’ŒåŒé‡é‡Šæ”¾é—®é¢˜ã€‚ä¸æ­£ç¡®çš„å†…å­˜å¯¹é½å¯èƒ½å¯¼è‡´å¯¹è±¡è®¿é—®å¼‚å¸¸ã€‚ ","date":"0001-01-01","objectID":"/securecoding/:17:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ç¦æ­¢å¤–éƒ¨å¯æ§æ•°æ®ä½œä¸ºè¿›ç¨‹å¯åŠ¨å‡½æ•°çš„å‚æ•° ã€æè¿°ã€‘ æœ¬æ¡æ¬¾ä¸­è¿›ç¨‹å¯åŠ¨å‡½æ•°åŒ…æ‹¬systemã€popenã€execlã€execlpã€execleã€execvã€execvpç­‰ã€‚ system()ã€popen()ç­‰å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œå¦‚æœå¤–éƒ¨å¯æ§æ•°æ®ä½œä¸ºè¿™äº›å‡½æ•°çš„å‚æ•°ï¼Œä¼šå¯¼è‡´æ³¨å…¥æ¼æ´ã€‚ ä½¿ç”¨execl()ã€execlp()ç­‰å‡½æ•°æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æœä½¿ç”¨shellå¯åŠ¨çš„æ–°è¿›ç¨‹ï¼Œåˆ™åŒæ ·å­˜åœ¨å‘½ä»¤æ³¨å…¥é£é™©ã€‚ å› æ­¤ï¼Œæ€»æ˜¯ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨Cæ ‡å‡†å‡½æ•°å®ç°éœ€è¦çš„åŠŸèƒ½ã€‚å¦‚æœç¡®å®éœ€è¦ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œè¯·ä½¿ç”¨ç™½åå•æœºåˆ¶ç¡®ä¿è¿™äº›å‡½æ•°çš„å‚æ•°ä¸å—ä»»ä½•å¤–æ¥æ•°æ®çš„å½±å“ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ system() å‡½æ•°æ‰§è¡Œ cmd å‘½ä»¤ä¸²æ¥è‡ªå¤–éƒ¨ï¼Œæ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š char *cmd = get_cmd_from_remote(); if (cmd == NULL) { ... // å¤„ç†é”™è¯¯ } system(cmd); å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ system() å‡½æ•°æ‰§è¡Œ cmd å‘½ä»¤ä¸²çš„ä¸€éƒ¨åˆ†æ¥è‡ªå¤–éƒ¨ï¼Œæ”»å‡»è€…å¯èƒ½è¾“å…¥ â€˜some dir;useradd xxx â€˜å­—ç¬¦ä¸²ï¼Œåˆ›å»ºä¸€ä¸ªxxxçš„ç”¨æˆ·ï¼š char cmd[MAX_LEN ]; int ret; char *name = get_dir_name_from_remote(); if (name == NULL) { ... // å¤„ç†é”™è¯¯ } ret = sprintf(cmd, \"ls %s\", name); ... system(cmd); ä½¿ç”¨execç³»åˆ—å‡½æ•°æ¥é¿å…å‘½ä»¤æ³¨å…¥æ—¶ï¼Œæ³¨æ„execç³»åˆ—å‡½æ•°ä¸­çš„pathã€fileå‚æ•°ç¦æ­¢ä½¿ç”¨å‘½ä»¤è§£æå™¨(å¦‚/bin/sh)ã€‚ int execl(const char *path, const char *arg, ...); int execlp(const char *file, const char *arg, ...); int execle(const char *path, const char *arg, ..., char * const envp[]); int execv(const char *path, char *const argv[]); int execvp(const char *file, char *const argv[]); ä¾‹å¦‚ï¼Œç¦æ­¢å¦‚ä¸‹ä½¿ç”¨æ–¹å¼ï¼š char *cmd = get_dir_name_from_remote(); execl(\"/bin/sh\", \"sh\", \"-c\", cmd, NULL); ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ (ä½¿ç”¨åº“å‡½æ•°) åœ¨Linuxä¸‹å®ç°å¯¹å½“å‰ç›®å½•ä¸‹æ–‡ä»¶åçš„æ‰“å°ï¼Œå¯ä»¥ä½¿ç”¨opendir(), readdir(), stat()ç­‰å‡½æ•°ç›´æ¥å®ç°ls-lå‘½ä»¤çš„åŠŸèƒ½ï¼Œä¸å¿…ä½¿ç”¨system()å‡½æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–çš„ls -lç¤ºä¾‹ç‰ˆæœ¬ï¼Œåˆ—å‡ºä¸€ä¸ªç”±ç¨‹åºå†…éƒ¨æŒ‡å®šçš„æ–‡ä»¶çš„ä¿¡æ¯ï¼Œè¯¥å‡½æ•°ä»…è€ƒè™‘äº†ä¸éœ€è¦é‡å…¥çš„æƒ…å†µã€‚ static int OutputFileInfo(const char *file_name) { const char priv[] = {'x', 'w', 'r'}; ASSERT(file_name != NULL); struct stat st; int ret = stat(file_name, \u0026st); if (ret == -1) { return -1; } const struct passwd *pw = getpwuid(st.st_uid); if (pw == NULL) { return -1; } const struct group *gp = getgrgid(st.st_gid); if (gp == NULL) { return -1; } if (S_ISREG(st.st_mode)) { printf(\"-\"); } else if (S_ISDIR(st.st_mode)) { printf(\"d\"); } for (int i = 8; i \u003e= 0; i --) { if ((st.st_mode \u0026 (1 \u003c \u003c i)) != 0) { printf(\"%c\", priv[i % 3]); } else { printf(\"-\"); } } printf(\"%s %s %ld %s\\n\", pw-\u003epw_name, gp-\u003egr_name, st.st_size, file_name); return 0; } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ (ä½¿ç”¨execç³»åˆ—å‡½æ•°) å¯ä»¥é€šè¿‡åº“å‡½æ•°ç®€å•å®ç°çš„åŠŸèƒ½ï¼ˆå¦‚ä¸Šä¾‹ï¼‰ï¼Œéœ€è¦é¿å…è°ƒç”¨å‘½ä»¤å¤„ç†å™¨æ¥æ‰§è¡Œå¤–éƒ¨å‘½ä»¤ã€‚å¦‚æœç¡®å®éœ€è¦è°ƒç”¨å•ä¸ªå‘½ä»¤ï¼Œåº”ä½¿ç”¨exec *å‡½æ•°æ¥å®ç°å‚æ•°åŒ–è°ƒç”¨ï¼Œå¹¶å¯¹è°ƒç”¨çš„å‘½ä»¤å®æ–½ç™½åå•ç®¡ç†ã€‚ pid_t pid; char * const envp[] = { NULL }; ... char *file_name = get_dir_name_from_remote(); if (file_name == NULL) { ... // å¤„ç†é”™è¯¯ } ... if ((pid = fork()) \u003c 0) { ... } else if (pid == 0) { // ä½¿ç”¨some_toolå¯¹æŒ‡å®šæ–‡ä»¶è¿›è¡ŒåŠ å·¥ execle( \"/bin/some_tool\", \"some_tool\", file_name, NULL, envp); _Exit(-1); } ... int status; waitpid(pid, \u0026status, 0); FILE *fp = fopen(file_name, \"r\"); ... æ­¤æ—¶ï¼Œå¤–éƒ¨è¾“å…¥çš„file_nameä»…ä½œä¸ºsome_toolå‘½ä»¤çš„å‚æ•°ï¼Œæ²¡æœ‰å‘½ä»¤æ³¨å…¥çš„é£é™©ã€‚ ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ (ä½¿ç”¨ç™½åå•) å¯¹è¾“å…¥çš„æ–‡ä»¶ååŸºäºåˆç†çš„ç™½åå•æ£€æŸ¥ï¼Œé¿å…å‘½ä»¤æ³¨å…¥ã€‚ char *cmd = get_cmd_from_remote(); if (cmd == NULL) { ... // å¤„ç†é”™è¯¯ } // ä½¿ç”¨ç™½åå•æ£€æŸ¥å‘½ä»¤æ˜¯å¦åˆæ³•ï¼Œä»…å…è®¸ \"some_tool_a\", \"some_tool_b\"å‘½ä»¤ï¼Œå¤–éƒ¨æ— æ³•éšæ„æ§åˆ¶ if (!is_valid_cmd(cmd)) { ... // å¤„ç†é”™è¯¯ } system(cmd); ... ã€ç›¸å…³è½¯ä»¶CWEç¼–å·ã€‘ CWE-676ï¼ŒCWE-88 ","date":"0001-01-01","objectID":"/securecoding/:18:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ç¦æ­¢åœ¨ä¿¡å·å¤„ç†ä¾‹ç¨‹ä¸­è°ƒç”¨éå¼‚æ­¥å®‰å…¨å‡½æ•° ã€æè¿°ã€‘ åœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­åªè°ƒç”¨å¼‚æ­¥å®‰å…¨å‡½æ•°ã€‚ é™¤äº†Cè¯­è¨€æ ‡å‡†å‡½æ•°ä»¥å¤–ï¼Œå…¶ä»–ç³»ç»Ÿå‡½æ•°ä¹Ÿæä¾›äº†ä¸€äº›çš„å¼‚æ­¥å®‰å…¨å‡½æ•°ï¼Œåœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­ä½¿ç”¨è¿™äº›å‡½æ•°ä¹‹å‰ï¼Œåº”ç¡®ä¿è°ƒç”¨çš„å‡½æ•°åœ¨æ‰€æœ‰å¯èƒ½çš„æ‰§è¡Œç¯å¢ƒä¸‹å‡æ˜¯å¼‚æ­¥å®‰å…¨çš„ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨äº†éå¼‚æ­¥å®‰å…¨å‡½æ•°printf()ï¼š void handler(int num) { printf(\"receive signal = %d \\n\", SIGINT); } int main(int argc, char **argv) { if (signal(SIGINT, handler) == SIG_ERR) { ... // é”™è¯¯å¤„ç† } while (true) { ... // ç¨‹åºä¸»å¾ªç¯ä»£ç  } return 0; } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œå°½é‡ä¸åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å‡½æ•°ï¼Œä»…åœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­ä¿®æ”¹volatile sig_atomic_tç±»å‹çš„å˜é‡ï¼š static volatile sig_atomic_t g_flag = 0; void handler(int num) { g_flag = 1; } int main(int argc, char **argv) { if (signal(SIGINT, handler) == SIG_ERR) { ... // é”™è¯¯å¤„ç† } while (true) { if (g_flag != 0) { printf(\"receive signal = %d\\n\", SIGINT); } ... // ç¨‹åºä¸»å¾ªç¯ä»£ç  } ... return 0; } ã€ç›¸å…³è½¯ä»¶CWEç¼–å·ã€‘ CWE-479 å†…å­˜ ","date":"0001-01-01","objectID":"/securecoding/:19:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"å†…å­˜åˆ†é…åå¿…é¡»åˆ¤æ–­æ˜¯å¦æˆåŠŸ ã€æè¿°ã€‘ å†…å­˜åˆ†é…ä¸€æ—¦å¤±è´¥ï¼Œé‚£ä¹ˆåç»­çš„æ“ä½œä¼šå­˜åœ¨æœªå®šä¹‰çš„è¡Œä¸ºé£é™©ã€‚æ¯”å¦‚mallocç”³è¯·å¤±è´¥è¿”å›äº†ç©ºæŒ‡é’ˆï¼Œå¯¹ç©ºæŒ‡é’ˆçš„è§£å¼•ç”¨æ˜¯ä¸€ç§æœªå®šä¹‰è¡Œä¸ºã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œè°ƒç”¨mallocåˆ†é…å†…å­˜ä¹‹åï¼Œæ²¡æœ‰åˆ¤æ–­æ˜¯å¦æˆåŠŸï¼Œç›´æ¥å¼•ç”¨äº†pã€‚å¦‚æœmallocå¤±è´¥ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªç©ºæŒ‡é’ˆå¹¶ä¼ é€’ç»™pã€‚å½“å¦‚ä¸‹ä»£ç åœ¨å†…å­˜æ‹·è´ä¸­è§£å¼•ç”¨äº†è¯¥ç©ºæŒ‡é’ˆpæ—¶ï¼Œç¨‹åºä¼šå‡ºç°æœªå®šä¹‰è¡Œä¸ºã€‚ struct tm *make_tm(int year, int mon, int day, int hour, int min, int sec) { struct tm *tmb = (struct tm*)malloc(sizeof(*tmb)); tmb-\u003eyear = year; ... return tmb; } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œåœ¨mallocåˆ†é…å†…å­˜ä¹‹åï¼Œç«‹å³åˆ¤æ–­å…¶æ˜¯å¦æˆåŠŸï¼Œæ¶ˆé™¤äº†ä¸Šè¿°çš„é£é™©ã€‚ struct tm *make_tm(int year, int mon, int day, int hour, int min, int sec) { struct tm *tmb = (struct tm *)malloc(sizeof(*tmb)); if (tmb == NULL) { ... // é”™è¯¯å¤„ç† } tmb-\u003eyear = year; ... return tmb; } ","date":"0001-01-01","objectID":"/securecoding/:20:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"å¤–éƒ¨è¾“å…¥ä½œä¸ºå†…å­˜æ“ä½œç›¸å…³å‡½æ•°çš„å¤åˆ¶é•¿åº¦æ—¶ï¼Œéœ€è¦æ ¡éªŒå…¶åˆæ³•æ€§ ã€æè¿°ã€‘ å°†æ•°æ®å¤åˆ¶åˆ°å®¹é‡ä¸è¶³ä»¥å®¹çº³è¯¥æ•°æ®çš„å†…å­˜ä¸­ä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚ä¸ºäº†é˜²æ­¢æ­¤ç±»é”™è¯¯ï¼Œå¿…é¡»æ ¹æ®ç›®æ ‡å®¹é‡çš„å¤§å°é™åˆ¶è¢«å¤åˆ¶çš„æ•°æ®å¤§å°ï¼Œæˆ–è€…å¿…é¡»ç¡®ä¿ç›®æ ‡å®¹é‡è¶³å¤Ÿå¤§ä»¥å®¹çº³è¦å¤åˆ¶çš„æ•°æ®ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¤–éƒ¨è¾“å…¥çš„æ•°æ®ä¸ä¸€å®šä¼šç›´æ¥ä½œä¸ºå†…å­˜å¤åˆ¶é•¿åº¦ä½¿ç”¨ï¼Œè¿˜å¯èƒ½ä¼šé—´æ¥å‚ä¸å†…å­˜å¤åˆ¶æ“ä½œã€‚ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼ŒinputTable-\u003ecountæ¥è‡ªå¤–éƒ¨æŠ¥æ–‡ï¼Œè™½ç„¶æ²¡æœ‰ç›´æ¥ä½œä¸ºå†…å­˜å¤åˆ¶é•¿åº¦ä½¿ç”¨ï¼Œè€Œæ˜¯ä½œä¸ºforå¾ªç¯ä½“çš„ä¸Šé™ä½¿ç”¨ï¼Œé—´æ¥å‚ä¸äº†å†…å­˜å¤åˆ¶æ“ä½œã€‚ç”±äºæ²¡æœ‰æ ¡éªŒå…¶å¤§å°ï¼Œå¯é€ æˆç¼“å†²åŒºæº¢å‡ºï¼š typedef struct { size_t count; int val[MAX_num_bERS]; } ValueTable; ValueTable *value_table_dup(const ValueTable *input_table) { ValueTable *output_table = ... // åˆ†é…å†…å­˜ ... for (size_t i = 0; i \u003c input_table-\u003ecount; i++) { output_table-\u003eval[i] = input_table-\u003eval[i]; } ... } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œå¯¹input_table-\u003ecountåšäº†æ ¡éªŒã€‚ typedef struct { size_t count; int val[MAX_num_bERS]; }ValueTable; ValueTable *value_table_dup(const ValueTable *input_table) { ValueTable *output_table = ... // åˆ†é…å†…å­˜ ... / * - æ ¹æ®åº”ç”¨åœºæ™¯ï¼Œå¯¹æ¥è‡ªå¤–éƒ¨æŠ¥æ–‡çš„å¾ªç¯é•¿åº¦input_table-\u003ecount - ä¸output_table-\u003evalæ•°ç»„å¤§å°åšæ ¡éªŒï¼Œé¿å…é€ æˆç¼“å†²åŒºæº¢å‡º */ if (input_table-\u003ecount \u003e sizeof(output_table-\u003eval) / sizeof(output_table-\u003eval[0]){ return NULL; } for (size_t i = 0; i \u003c input_table-\u003ecount; i++) { output_table-\u003eval[i] = input_table-\u003eval[i]; } ... } ","date":"0001-01-01","objectID":"/securecoding/:21:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"å†…å­˜ä¸­çš„æ•æ„Ÿä¿¡æ¯ä½¿ç”¨å®Œæ¯•åç«‹å³æ¸…0 ã€æè¿°ã€‘ å†…å­˜ä¸­çš„å£ä»¤ã€å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ä½¿ç”¨å®Œæ¯•åç«‹å³æ¸…0ï¼Œé¿å…è¢«æ”»å‡»è€…è·å–æˆ–è€…æ— æ„é—´æ³„æ¼ç»™ä½æƒé™ç”¨æˆ·ã€‚è¿™é‡Œæ‰€è¯´çš„å†…å­˜åŒ…æ‹¬ä½†ä¸é™äºï¼š åŠ¨æ€åˆ†é…çš„å†…å­˜ é™æ€åˆ†é…çš„å†…å­˜ è‡ªåŠ¨åˆ†é…ï¼ˆå †æ ˆï¼‰å†…å­˜ å†…å­˜ç¼“å­˜ ç£ç›˜ç¼“å­˜ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ é€šå¸¸å†…å­˜åœ¨é‡Šæ”¾å‰ä¸éœ€è¦æ¸…é™¤å†…å­˜æ•°æ®ï¼Œå› ä¸ºè¿™æ ·åœ¨è¿è¡Œæ—¶ä¼šå¢åŠ é¢å¤–å¼€é”€ï¼Œæ‰€ä»¥åœ¨è¿™æ®µå†…å­˜è¢«é‡Šæ”¾ä¹‹åï¼Œä¹‹å‰çš„æ•°æ®è¿˜æ˜¯ä¼šä¿ç•™åœ¨å…¶ä¸­ã€‚å¦‚æœè¿™æ®µå†…å­˜ä¸­çš„æ•°æ®åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œåˆ™å¯èƒ½ä¼šæ„å¤–æ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚ä¸ºäº†é˜²æ­¢æ•æ„Ÿä¿¡æ¯æ³„æ¼ï¼Œå¿…é¡»å…ˆæ¸…é™¤å†…å­˜ä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼Œç„¶åå†é‡Šæ”¾ã€‚ åœ¨å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œå­˜å‚¨åœ¨æ‰€å¼•ç”¨çš„åŠ¨æ€å†…å­˜ä¸­çš„æ•æ„Ÿä¿¡æ¯secretè¢«å¤åˆ¶åˆ°æ–°åŠ¨æ€åˆ†é…çš„ç¼“å†²åŒºnewSecretï¼Œæœ€ç»ˆé€šè¿‡free()é‡Šæ”¾ã€‚å› ä¸ºé‡Šæ”¾å‰æœªæ¸…é™¤è¿™å—å†…å­˜æ•°æ®ï¼Œè¿™å—å†…å­˜å¯èƒ½è¢«é‡æ–°åˆ†é…åˆ°ç¨‹åºçš„å¦ä¸€éƒ¨åˆ†ï¼Œä¹‹å‰å­˜å‚¨åœ¨newSecretä¸­çš„æ•æ„Ÿä¿¡æ¯å¯èƒ½ä¼šæ— æ„ä¸­è¢«æ³„éœ²ã€‚ char *secret = NULL; / * - å‡è®¾ secret æŒ‡å‘æ•æ„Ÿä¿¡æ¯ï¼Œæ•æ„Ÿä¿¡æ¯çš„å†…å®¹æ˜¯é•¿åº¦å°äºSIZE_MAXä¸ªå­—ç¬¦ï¼Œ - å¹¶ä¸”ä»¥nullç»ˆæ­¢çš„å­—èŠ‚å­—ç¬¦ä¸² */ size_t size = strlen(secret); char *new_secret = NULL; new_secret = (char *)malloc(size + 1); if (new_secret == NULL) { ... // é”™è¯¯å¤„ç† } else { strcpy(new_secret, secret); ... // å¤„ç† new_secret ... free(new_secret); new_secret = NULL; } ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œä¸ºäº†é˜²æ­¢ä¿¡æ¯æ³„æ¼ï¼Œåº”å…ˆæ¸…é™¤åŒ…å«æ•æ„Ÿä¿¡æ¯çš„åŠ¨æ€å†…å­˜ï¼ˆç”¨ â€™ 0 â€˜å­—ç¬¦å¡«å……ç©ºé—´ï¼‰ï¼Œç„¶åå†é‡Šæ”¾å®ƒã€‚ char *secret = NULL; / * - å‡è®¾ secret æŒ‡å‘æ•æ„Ÿä¿¡æ¯ï¼Œæ•æ„Ÿä¿¡æ¯çš„å†…å®¹æ˜¯é•¿åº¦å°äºSIZE_MAXä¸ªå­—ç¬¦ï¼Œ - å¹¶ä¸”ä»¥nullç»ˆæ­¢çš„å­—èŠ‚å­—ç¬¦ä¸² */ size_t size = strlen(secret); char *new_secret = NULL; new_secret = (char *)malloc(size + 1); if (new_secret == NULL) { ... // é”™è¯¯å¤„ç† } else { strcpy(new_secret, secret); ... // å¤„ç† new_secret ... (void)memset(new_secret, 0, size + 1); free(new_secret); new_secret = NULL; } ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ ä¸‹é¢æ˜¯å¦å¤–ä¸€ä¸ªæ¶‰åŠæ•æ„Ÿä¿¡æ¯æ¸…ç†çš„åœºæ™¯ï¼Œåœ¨ä»£ç è·å–åˆ°å¯†ç åï¼Œå°†å¯†ç ä¿å­˜åˆ°passwordä¸­ï¼Œè¿›è¡Œå¯†ç éªŒè¯ï¼Œä½¿ç”¨å®Œæ¯•åï¼Œé€šè¿‡memsetå¯¹passwordæ¸…0ã€‚ int foo(void) { char password [MAX_PWD_LEN ] = {0}; if (!get_password(password, sizeof(password))) { ... // å¤„ç†é”™è¯¯ } if (!verify_password(password)) { ... // å¤„ç†é”™è¯¯ } ... (void)memset(password, 0, sizeof(password)); ... } æ–‡ä»¶ ","date":"0001-01-01","objectID":"/securecoding/:22:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"åˆ›å»ºæ–‡ä»¶æ—¶å¿…é¡»æ˜¾å¼æŒ‡å®šåˆé€‚çš„æ–‡ä»¶è®¿é—®æƒé™ ã€æè¿°ã€‘ åˆ›å»ºæ–‡ä»¶æ—¶ï¼Œå¦‚æœä¸æ˜¾å¼æŒ‡å®šåˆé€‚è®¿é—®æƒé™ï¼Œå¯èƒ½ä¼šè®©æœªç»æˆæƒçš„ç”¨æˆ·è®¿é—®è¯¥æ–‡ä»¶ï¼Œé€ æˆä¿¡æ¯æ³„éœ²ï¼Œæ–‡ä»¶æ•°æ®è¢«ç¯¡æ”¹ï¼Œæ–‡ä»¶ä¸­è¢«æ³¨å…¥æ¶æ„ä»£ç ç­‰é£é™©ã€‚ è™½ç„¶æ–‡ä»¶çš„è®¿é—®æƒé™ä¹Ÿä¾èµ–äºæ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯å½“å‰è®¸å¤šæ–‡ä»¶åˆ›å»ºå‡½æ•°ï¼ˆä¾‹å¦‚POSIX openå‡½æ•°ï¼‰éƒ½å…·æœ‰è®¾ç½®ï¼ˆæˆ–å½±å“ï¼‰æ–‡ä»¶è®¿é—®æƒé™çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å½“ä½¿ç”¨è¿™äº›å‡½æ•°åˆ›å»ºæ–‡ä»¶æ—¶ï¼Œå¿…é¡»æ˜¾å¼æŒ‡å®šåˆé€‚çš„æ–‡ä»¶è®¿é—®æƒé™ï¼Œä»¥é˜²æ­¢æ„å¤–è®¿é—®ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ ä½¿ç”¨POSIX open()å‡½æ•°åˆ›å»ºæ–‡ä»¶ä½†æœªæ˜¾ç¤ºæŒ‡å®šè¯¥æ–‡ä»¶çš„è®¿é—®æƒé™ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ–‡ä»¶åˆ›å»ºæ—¶å…·æœ‰è¿‡é«˜çš„è®¿é—®æƒé™ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ¼æ´ã€‚ void foo(void) { int fd = -1; char *file_name = NULL; ... // åˆå§‹åŒ– file_name fd = open(file_name, O_CREAT | O_WRONLY); // æ²¡æœ‰æ˜¾å¼æŒ‡å®šè®¿é—®æƒé™ if (fd == -1) { ... // é”™è¯¯å¤„ç† } ... } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ åº”è¯¥åœ¨opençš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­æ˜¾å¼æŒ‡å®šæ–°åˆ›å»ºæ–‡ä»¶çš„è®¿é—®æƒé™ã€‚å¯ä»¥æ ¹æ®æ–‡ä»¶å®é™…çš„åº”ç”¨æƒ…å†µè®¾ç½®ä½•ç§è®¿é—®æƒé™ã€‚ void foo(void) { int fd = -1; char *file_name = NULL; ... // åˆå§‹åŒ– file_name å’ŒæŒ‡å®šå…¶è®¿é—®æƒé™ // æ­¤å¤„æ ¹æ®æ–‡ä»¶å®é™…éœ€è¦ï¼Œæ˜¾å¼æŒ‡å®šå…¶è®¿é—®æƒé™ int fd = open(file_name, O_CREAT | O_WRONLY, S_IRUSR | S_IWUSR); if (fd == -1) { ... // é”™è¯¯å¤„ç† } ... } ","date":"0001-01-01","objectID":"/securecoding/:23:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"å¿…é¡»å¯¹æ–‡ä»¶è·¯å¾„è¿›è¡Œè§„èŒƒåŒ–åå†ä½¿ç”¨ ã€æè¿°ã€‘ å½“æ–‡ä»¶è·¯å¾„æ¥è‡ªå¤–éƒ¨æ•°æ®æ—¶ï¼Œå¿…é¡»å¯¹å…¶åšåˆæ³•æ€§æ ¡éªŒï¼Œå¦‚æœä¸æ ¡éªŒï¼Œå¯èƒ½é€ æˆç³»ç»Ÿæ–‡ä»¶çš„è¢«ä»»æ„è®¿é—®ã€‚ä½†æ˜¯ç¦æ­¢ç›´æ¥å¯¹å…¶è¿›è¡Œæ ¡éªŒï¼Œæ­£ç¡®åšæ³•æ˜¯åœ¨æ ¡éªŒä¹‹å‰å¿…é¡»å¯¹å…¶è¿›è¡Œè·¯å¾„è§„èŒƒåŒ–å¤„ç†ï¼Œå› ä¸ºï¼š åŒä¸€ä¸ªæ–‡ä»¶å¯ä»¥é€šè¿‡å¤šç§å½¢å¼çš„è·¯å¾„æ¥æè¿°å’Œå¼•ç”¨ï¼Œä¾‹å¦‚æ—¢å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼›è€Œä¸”è·¯å¾„åã€ç›®å½•åå’Œæ–‡ä»¶åå¯èƒ½åŒ…å«ä½¿æ ¡éªŒå˜å¾—å›°éš¾å’Œä¸å‡†ç¡®çš„å­—ç¬¦ï¼ˆå¦‚ï¼š\".\"ã€\"..\"ï¼‰ã€‚æ­¤å¤–ï¼Œæ–‡ä»¶è¿˜å¯ä»¥æ˜¯ç¬¦å·é“¾æ¥ï¼Œè¿™è¿›ä¸€æ­¥æ¨¡ç³Šäº†æ–‡ä»¶çš„å®é™…ä½ç½®æˆ–æ ‡è¯†ï¼Œå¢åŠ äº†æ ¡éªŒçš„éš¾åº¦å’Œæ ¡éªŒå‡†ç¡®æ€§ã€‚æ‰€ä»¥å¿…é¡»å…ˆå°†æ–‡ä»¶è·¯å¾„è§„èŒƒåŒ–ï¼Œä»è€Œæ›´å®¹æ˜“æ ¡éªŒå…¶è·¯å¾„ã€ç›®å½•æˆ–æ–‡ä»¶åï¼Œå¢åŠ æ ¡éªŒå‡†ç¡®æ€§ï¼Œå¦‚ä½¿ç”¨realpathå‡½æ•°ã€‚ ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹è¯´æ˜å¦‚ä¸‹ï¼š å½“æ–‡ä»¶è·¯å¾„æ¥è‡ªå¤–éƒ¨æ•°æ®æ—¶ï¼Œéœ€è¦å…ˆå°†æ–‡ä»¶è·¯å¾„è§„èŒƒåŒ–ï¼Œå¦‚æœæ²¡æœ‰ä½œè§„èŒƒåŒ–å¤„ç†ï¼Œæ”»å‡»è€…å°±æœ‰æœºä¼šé€šè¿‡æ¶æ„æ„é€ æ–‡ä»¶è·¯å¾„è¿›è¡Œæ–‡ä»¶çš„è¶Šæƒè®¿é—®ã€‚ ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ \"../../../etc/passwd\"çš„æ–¹å¼è¿›è¡Œä»»æ„æ–‡ä»¶è®¿é—®ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ åœ¨æ­¤é”™è¯¯çš„ç¤ºä¾‹ä¸­ï¼Œargv[1]åŒ…å«ä¸€ä¸ªæºäºå—æ±¡æŸ“æºçš„æ–‡ä»¶åï¼Œå¹¶ä¸”è¯¥æ–‡ä»¶åå·²æ‰“å¼€ä»¥è¿›è¡Œå†™å…¥ã€‚åœ¨ä½¿ç”¨æ­¤æ–‡ä»¶åæ“ä½œä¹‹å‰ï¼Œåº”è¯¥å¯¹å…¶è¿›è¡ŒéªŒè¯ï¼Œä»¥ç¡®ä¿å®ƒå¼•ç”¨çš„æ˜¯é¢„æœŸçš„æœ‰æ•ˆæ–‡ä»¶ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œargv[1]å¼•ç”¨çš„æ–‡ä»¶åå¯èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œä¾‹å¦‚ç›®å½•å­—ç¬¦ï¼Œè¿™ä½¿éªŒè¯å˜å¾—å›°éš¾ï¼Œç”šè‡³ä¸å¯èƒ½ã€‚è€Œä¸”ï¼Œargv[1]ä¸­å¯èƒ½åŒ…å«å¯ä»¥æŒ‡å‘ä»»æ„æ–‡ä»¶è·¯å¾„çš„ç¬¦å·é“¾æ¥ï¼Œå³ä½¿è¯¥æ–‡ä»¶åé€šè¿‡äº†éªŒè¯ï¼Œä¹Ÿä¼šå¯¼è‡´è¯¥æ–‡ä»¶åæ˜¯æ— æ•ˆçš„ã€‚ è¿™ç§åœºæ™¯ä¸‹ï¼Œå¯¹æ–‡ä»¶åçš„ç›´æ¥éªŒè¯å³ä½¿è¢«æ‰§è¡Œä¹Ÿæ˜¯å¾—ä¸åˆ°é¢„æœŸçš„ç»“æœï¼Œå¯¹fopen()çš„è°ƒç”¨å¯èƒ½ä¼šå¯¼è‡´è®¿é—®ä¸€ä¸ªæ„å¤–çš„æ–‡ä»¶ã€‚ ... if (!verify_file(input_file_name) { // æ²¡æœ‰å¯¹input_file_nameåšè§„èŒƒåŒ–ï¼Œç›´æ¥åšæ ¡éªŒ ... // é”™è¯¯å¤„ç† } if (fopen(input_file_name, \"w\") == NULL) { ... // é”™è¯¯å¤„ç† } ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ è§„èŒƒåŒ–æ–‡ä»¶åæ˜¯å…·æœ‰ä¸€å®šéš¾åº¦çš„ï¼Œå› ä¸ºè¿™éœ€è¦äº†è§£åº•å±‚æ–‡ä»¶ç³»ç»Ÿã€‚ POSIX realpath()å‡½æ•°å¯ä»¥å¸®åŠ©å°†è·¯å¾„åè½¬æ¢ä¸ºè§„èŒƒå½¢å¼ã€‚ å¯¹ä¸Šé¢çš„é”™è¯¯ä»£ç ç¤ºä¾‹ï¼Œæˆ‘ä»¬é‡‡ç”¨å¦‚ä¸‹è§£å†³æ–¹æ¡ˆï¼š char *real_path_res = NULL; ... // åœ¨æ ¡éªŒä¹‹å‰ï¼Œå…ˆå¯¹input_file_nameåšè§„èŒƒåŒ–å¤„ç† real_path_res = realpath(input_file_name, NULL); if (real_path_res == NULL) { ... // è§„èŒƒåŒ–çš„é”™è¯¯å¤„ç† } // è§„èŒƒåŒ–ä»¥åå¯¹è·¯å¾„è¿›è¡Œæ ¡éªŒ if (!verify_file(real_path_res) { ... // æ ¡éªŒçš„é”™è¯¯å¤„ç† } // ä½¿ç”¨ if (fopen(real_path_res, \"w\") == NULL) { ... // å®é™…æ“ä½œçš„é”™è¯¯å¤„ç† } ... free(real_path_res); real_path_res = NULL; ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ æ ¹æ®æˆ‘ä»¬çš„å®é™…åœºæ™¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é‡‡ç”¨çš„ç¬¬äºŒå¥—è§£å†³æ–¹æ¡ˆï¼Œè¯´æ˜å¦‚ä¸‹ï¼š å¦‚æœPATH_MAXè¢«å®šä¹‰ä¸ºä¸­çš„ä¸€ä¸ªå¸¸é‡ï¼Œé‚£ä¹ˆä½¿ç”¨éç©ºçš„resolved_pathè°ƒç”¨realpath()ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚ åœ¨æœ¬ä¾‹ä¸­realpath()å‡½æ•°æœŸæœ›resolved_pathå¼•ç”¨ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œè¯¥å­—ç¬¦æ•°ç»„è¶³å¤Ÿå¤§ï¼Œå¯ä»¥å®¹çº³è§„èŒƒåŒ–çš„è·¯å¾„ã€‚ å¦‚æœå®šä¹‰äº†PATH_MAXï¼Œåˆ™åˆ†é…ä¸€ä¸ªå¤§å°ä¸ºPATH_MAXçš„ç¼“å†²åŒºæ¥ä¿å­˜realpath()çš„ç»“æœã€‚æ­£ç¡®ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š char *real_path_res = NULL; char *canonical_file_name = NULL; size_t path_size = 0; ... path_size = (size_t)PATH_MAX; if (verify_path_size(path_size) == TRUE) { canonical_file_name = (char *)malloc(path_size); if (canonical_file_name == NULL) { ... // é”™è¯¯å¤„ç† } real_path_res = realpath(inputFilename, canonical_file_name); } if (real_path_res == NULL) { ... // é”™è¯¯å¤„ç† } if (verify_file(real_path_res) == FALSE) { ... // é”™è¯¯å¤„ç† } if (fopen(real_path_res, \"w\") == NULL ) { ... // é”™è¯¯å¤„ç† } ... free(canonical_file_name); canonical_file_name = NULL; ... ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ ä¸‹é¢çš„ä»£ç åœºæ™¯æ˜¯ä»å¤–éƒ¨è·å–åˆ°æ–‡ä»¶åç§°ï¼Œæ‹¼æ¥æˆæ–‡ä»¶è·¯å¾„åï¼Œç›´æ¥å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œè¯»å–ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥è¯»å–åˆ°ä»»æ„æ–‡ä»¶çš„å†…å®¹ï¼š char *file_name = get_msg_from_remote(); ... sprintf(untrust_path, \"/tmp/%s\", file_name); char *text = read_file_content(untrust_path); ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ æ­£ç¡®çš„åšæ³•æ˜¯ï¼Œå¯¹è·¯å¾„è¿›è¡Œè§„èŒƒåŒ–åï¼Œå†åˆ¤æ–­è·¯å¾„æ˜¯å¦æ˜¯æœ¬ç¨‹åºæ‰€è®¤ä¸ºçš„åˆæ³•çš„è·¯å¾„ï¼š char *file_name = get_msg_from_remote(); ... sprintf(untrust_path, \"/tmp/%s\", file_name); char path[PATH_MAX] = {0}; if (realpath(untrust_path, path) == NULL) { ... // å¤„ç†é”™è¯¯ } if (!is_valid_path(path)) { // æ£€æŸ¥æ–‡ä»¶çš„ä½ç½®æ˜¯å¦æ­£ç¡® ... // å¤„ç†é”™è¯¯ } char *text = read_file_content(path); ã€ä¾‹å¤–ã€‘ è¿è¡Œäºæ§åˆ¶å°çš„å‘½ä»¤è¡Œç¨‹åºï¼Œé€šè¿‡æ§åˆ¶å°æ‰‹å·¥è¾“å…¥æ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥ä½œä¸ºæœ¬æ¡æ¬¾ä¾‹å¤–ã€‚ int main(int argc, char **argv) { int fd = -1; if (argc == 2) { fd = open(argv[1], O_RDONLY); ... } ... } ","date":"0001-01-01","objectID":"/securecoding/:24:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ä¸è¦åœ¨å…±äº«ç›®å½•ä¸­åˆ›å»ºä¸´æ—¶æ–‡ä»¶ ã€æè¿°ã€‘ ç¨‹åºçš„ä¸´æ—¶æ–‡ä»¶åº”å½“æ˜¯ç¨‹åºè‡ªèº«ç‹¬äº«çš„ï¼Œä»»ä½•å°†è‡ªèº«ä¸´æ—¶æ–‡ä»¶ç½®äºå…±äº«ç›®å½•çš„åšæ³•ï¼Œå°†å¯¼è‡´å…¶ä»–å…±äº«ç”¨æˆ·è·å¾—è¯¥ç¨‹åºçš„é¢å¤–ä¿¡æ¯ï¼Œäº§ç”Ÿä¿¡æ¯æ³„éœ²ã€‚å› æ­¤ï¼Œä¸è¦åœ¨ä»»ä½•å…±äº«ç›®å½•åˆ›å»ºä»…ç”±ç¨‹åºè‡ªèº«ä½¿ç”¨çš„ä¸´æ—¶æ–‡ä»¶ã€‚ ç¨‹åºå‘˜é€šå¸¸ä¼šåœ¨å…±äº«ç›®å½•ä¸­(ä¾‹å¦‚åœ¨/tmpå’Œ/var/tmpåˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶ä¸”è¿˜æœ‰å¯èƒ½ä¼šå®šæœŸæ¸…é™¤è¿™äº›ä¸´æ—¶æ–‡ä»¶(ä¾‹å¦‚ï¼Œæ¯æ™šæˆ–é‡æ–°å¯åŠ¨æœŸé—´)ï¼Œä½†ä¹Ÿå¯èƒ½ä¸æ³¨æ„æ¸…ç†ã€‚ ä¸´æ—¶æ–‡ä»¶é€šå¸¸ç”¨äºè¾…åŠ©ä¿å­˜ä¸èƒ½é©»ç•™åœ¨å†…å­˜ä¸­çš„æ•°æ®æˆ–å­˜å‚¨ä¸´æ—¶çš„æ•°æ®ï¼Œä¹Ÿå¯ç”¨ä½œè¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æ‰‹æ®µï¼ˆé€šè¿‡æ–‡ä»¶ç³»ç»Ÿä¼ è¾“æ•°æ®ï¼‰ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè¿›ç¨‹åœ¨å…±äº«ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åå¯èƒ½ä½¿ç”¨äº†ä¼—æ‰€å‘¨çŸ¥çš„åç§°æˆ–è€…ä¸€ä¸ªä¸´æ—¶çš„åç§°ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶åœ¨è¿›ç¨‹é—´å…±äº«ä¿¡æ¯ã€‚è¿™ç§é€šè¿‡åœ¨å…±äº«ç›®å½•ä¸­åˆ›å»ºä¸´æ—¶æ–‡ä»¶çš„æ–¹æ³•å®ç°è¿›ç¨‹é—´å…±äº«çš„åšæ³•å¾ˆå±é™©ï¼Œå› ä¸ºå…±äº«ç›®å½•ä¸­çš„è¿™äº›æ–‡ä»¶å¾ˆå®¹æ˜“è¢«æ”»å‡»è€…åŠ«æŒæˆ–æ“çºµã€‚è¿™é‡Œæœ‰å‡ ç§ç¼“è§£ç­–ç•¥ï¼š 1.ä½¿ç”¨å…¶ä»–ä½çº§IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰æœºåˆ¶ï¼Œä¾‹å¦‚å¥—æ¥å­—æˆ–å…±äº«å†…å­˜ã€‚ 2.ä½¿ç”¨æ›´é«˜çº§åˆ«çš„IPCæœºåˆ¶ï¼Œä¾‹å¦‚è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚ 3.ä½¿ç”¨ä»…èƒ½ç”±ç¨‹åºæœ¬èº«è®¿é—®çš„å®‰å…¨ç›®å½•(å¤šçº¿ç¨‹/è¿›ç¨‹ä¸‹æ³¨æ„é˜²æ­¢æ¡ä»¶ç«äº‰)ã€‚ åŒæ—¶ï¼Œä¸‹é¢åˆ—å‡ºäº†å‡ é¡¹ä¸´æ—¶æ–‡ä»¶åˆ›å»ºä½¿ç”¨çš„æ–¹æ³•ï¼Œäº§å“æ ¹æ®å…·ä½“åœºæ™¯æ‰§è¡Œä»¥ä¸‹ä¸€é¡¹æˆ–è€…å‡ é¡¹ï¼ŒåŒæ—¶äº§å“ä¹Ÿå¯ä»¥è‡ªå®šä¹‰åˆé€‚çš„æ–¹æ³•ã€‚ 1.æ–‡ä»¶å¿…é¡»å…·æœ‰åˆé€‚çš„æƒé™ï¼Œåªæœ‰ç¬¦åˆæƒé™çš„ç”¨æˆ·æ‰èƒ½è®¿é—® 2.åˆ›å»ºçš„æ–‡ä»¶åæ˜¯å”¯ä¸€çš„ã€æˆ–ä¸å¯é¢„æµ‹çš„ 3.ä»…å½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶æ‰åˆ›å»ºæ‰“å¼€(åŸå­åˆ›å»ºæ‰“å¼€) 4.ä½¿ç”¨ç‹¬å è®¿é—®æ‰“å¼€ï¼Œé¿å…ç«äº‰æ¡ä»¶ 5.åœ¨ç¨‹åºé€€å‡ºä¹‹å‰ç§»é™¤ åŒæ—¶ä¹Ÿéœ€è¦æ³¨æ„åˆ°ï¼Œå½“æŸä¸ªç›®å½•è¢«å¼€æ”¾è¯»/å†™æƒé™ç»™å¤šä¸ªç”¨æˆ·æˆ–è€…ä¸€ç»„ç”¨æˆ·æ—¶ï¼Œè¯¥å…±äº«ç›®å½•æ½œåœ¨çš„å®‰å…¨é£é™©è¿œè¿œå¤§äºè®¿é—®è¯¥ç›®å½•ä¸­ä¸´æ—¶æ–‡ä»¶è¿™ä¸ªåŠŸèƒ½çš„æœ¬èº«ã€‚ å¦‚æœæƒ³å®‰å…¨åœ°åœ¨å…±äº«ç›®å½•ä¸­åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œè€Œä¸å—å¨èƒæ˜¯ä¸å®¹æ˜“çš„ã€‚ä¾‹å¦‚ï¼Œç”¨äºæœ¬åœ°æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿçš„ä»£ç åœ¨ä¸è¿œç¨‹æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿä¸€èµ·å…±äº«ä½¿ç”¨æ—¶å¯èƒ½ä¼šå—åˆ°æ”»å‡»ã€‚è€Œä¸”ä¸Šé¢çš„å‡½æ•°å®‰å…¨ç‰ˆæœ¬è¿˜å—é™äºæ‰€ä½¿ç”¨çš„Cè¿è¡Œæ—¶åº“ã€æ“ä½œç³»ç»Ÿå’Œæ–‡ä»¶ç³»ç»Ÿçš„ç‰ˆæœ¬ã€‚å”¯ä¸€å®‰å…¨çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸è¦åœ¨å…±äº«ç›®å½•ä¸­åˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ï¼Œç¨‹åºåœ¨Linuxç³»ç»Ÿçš„å…±äº«ç›®å½•/tmpä¸‹åˆ›å»ºä¸´æ—¶æ–‡ä»¶æ¥ä¿å­˜ä¸´æ—¶æ•°æ®ï¼Œä¸”æ–‡ä»¶åæ˜¯ç¡¬ç¼–ç çš„ã€‚ ç”±äºæ–‡ä»¶åæ˜¯ç¡¬ç¼–ç çš„ï¼Œå› æ­¤æ˜¯å¯é¢„æµ‹çš„ï¼Œæ”»å‡»è€…åªéœ€ç”¨ç¬¦å·é“¾æ¥æ›¿æ¢æ–‡ä»¶ï¼Œç„¶åé“¾æ¥æ‰€å¼•ç”¨çš„ç›®æ ‡æ–‡ä»¶å°±ä¼šè¢«æ‰“å¼€å¹¶å†™å…¥æ–°å†…å®¹ã€‚ void proc_data(const char *file_name) { FILE *fp = fopen(file_name, \"wb+\"); if (fp == NULL) { ... // é”™è¯¯å¤„ç† } ... // å†™æ–‡ä»¶ fclose(fp); } int main(void) { // ä¸åˆè§„ï¼š1.åœ¨ç³»ç»Ÿå…±äº«ç›®å½•ä¸­åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼›2.ä¸´æ—¶æ–‡ä»¶åç¡¬ç¼–ç  char *real_file = \"/tmp/data\"; ... proc_data(real_file); ... return 0; } ã€æ­£ç¡®æ¡ˆä¾‹ã€‘ Linuxä¸‹çš„/tmpç›®å½•æ˜¯ä¸€ä¸ªæ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®çš„å…±äº«ç›®å½•ï¼Œä¸åº”åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºä»…ç”±ç¨‹åºè‡ªèº«ä½¿ç”¨çš„ä¸´æ—¶æ–‡ä»¶ã€‚ ã€ä¸šç•Œå…¸å‹æ¼æ´ã€‘CVE-2004-2502 å…¶å®ƒ ","date":"0001-01-01","objectID":"/securecoding/:25:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ä¸è¦åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è®¿é—®å…±äº«å¯¹è±¡ ã€æè¿°ã€‘ åœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­è®¿é—®å’Œä¿®æ”¹å…±äº«å¯¹è±¡å¯èƒ½ä¼šé€ æˆç«äº‰æ¡ä»¶ï¼Œä½¿æ•°æ®å¤„äºä¸ç¡®å®šçš„çŠ¶æ€ã€‚ è¿™æ¡è§„åˆ™æœ‰ä¸¤ä¸ªä¸é€‚ç”¨çš„åœºæ™¯ï¼ˆC11æ ‡å‡†ç¬¬5.1.2.3ç« èŠ‚ç¬¬5æ®µï¼‰æ˜¯ï¼š 1ï¼‰ è¯»å†™ä¸éœ€è¦åŠ é”çš„åŸå­å¯¹è±¡; 2ï¼‰è¯»å†™volatile sig_atomic_tç±»å‹çš„å¯¹è±¡ï¼Œå› ä¸ºå…·æœ‰volatile sig_atomic_tç±»å‹çš„å¯¹è±¡å³ä½¿åœ¨å‡ºç°å¼‚æ­¥ä¸­æ–­çš„æ—¶å€™ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªåŸå­å®ä½“è®¿é—®ï¼Œæ˜¯å¼‚æ­¥å®‰å…¨çš„ã€‚ æ­¤å¤–ï¼Œåœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­ï¼Œå¦‚æœè¦è°ƒç”¨å‡½æ•°ï¼Œè¯·ä»…è°ƒç”¨å¼‚æ­¥ä¿¡å·å®‰å…¨å‡½æ•°ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ åœ¨è¿™ä¸ªä¿¡å·å¤„ç†è¿‡ç¨‹ä¸­ï¼Œç¨‹åºæ‰“ç®—å°†p_msgä½œä¸ºå…±äº«å¯¹è±¡ï¼Œå½“äº§ç”ŸSIGINTä¿¡å·æ—¶æ›´æ–°å…±äº«å¯¹è±¡çš„å†…å®¹ï¼Œä½†æ˜¯è¯¥p_msgå˜é‡ç±»å‹ä¸æ˜¯volatile sig_atomic_tï¼Œæ‰€ä»¥ä¸æ˜¯å¼‚æ­¥å®‰å…¨çš„ã€‚ #define MAX_MSG_SIZE 32 static char g_msg_buf[MAX_MSG_SIZE] = {0}; static char *g_msg = g_msg_buf; void signal_handler(int signum) { // ä¸‹é¢ä»£ç æ“ä½œg_msgä¸åˆè§„ï¼Œå› ä¸ºä¸æ˜¯å¼‚æ­¥å®‰å…¨çš„ (void)memset(g_msg, 0, MAX_MSG_SIZE); strcpy(g_msg, \"signal SIGINT received.\"); ... // } int main(void) { strcpy(g_msg, \"No msg yet.\"); // åˆå§‹åŒ–æ¶ˆæ¯å†…å®¹ signal(SIGINT, signal_handler); // è®¾ç½®SIGINTä¿¡å·å¯¹åº”çš„å¤„ç†å‡½æ•° ... // ç¨‹åºä¸»å¾ªç¯ä»£ç  return 0; } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œåœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­ä»…å°†volatile sig_atomic_tç±»å‹ä½œä¸ºå…±äº«å¯¹è±¡ä½¿ç”¨ã€‚ #define MAX_MSG_SIZE 32 volatile sig_atomic_t g_sig_flag = 0; void signal_handler(int signum) { g_sig_flag = 1; // åˆè§„ } int main(void) { signal(SIGINT, signal_handler); char msg_buf[MAX_MSG_SIZE]; strcpy(msg_buf, \"No msg yet.\"); // åˆå§‹åŒ–æ¶ˆæ¯å†…å®¹ ... // ç¨‹åºä¸»å¾ªç¯ä»£ç  if (g_sig_flag == 1) { // åœ¨é€€å‡ºä¸»å¾ªç¯ä¹‹åï¼Œæ ¹æ®sigFlagçŠ¶æ€å†åˆ·æ–°æ¶ˆæ¯å†…å®¹ strcpy(msgBuf, \"signal SIGINT received.\"); } return 0; } ã€ç›¸å…³è½¯ä»¶CWEç¼–å·ã€‘ CWE-662ï¼ŒCWE-828 ","date":"0001-01-01","objectID":"/securecoding/:26:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ç¦ç”¨randå‡½æ•°äº§ç”Ÿç”¨äºå®‰å…¨ç”¨é€”çš„ä¼ªéšæœºæ•° ã€æè¿°ã€‘ Cè¯­è¨€æ ‡å‡†åº“rand()å‡½æ•°ç”Ÿæˆçš„æ˜¯ä¼ªéšæœºæ•°ï¼Œæ‰€ä»¥ä¸èƒ½ä¿è¯å…¶äº§ç”Ÿçš„éšæœºæ•°åºåˆ—è´¨é‡ã€‚æ‰€ä»¥ç¦æ­¢ä½¿ç”¨rand()å‡½æ•°äº§ç”Ÿçš„éšæœºæ•°ç”¨äºå®‰å…¨ç”¨é€”ï¼Œå¿…é¡»ä½¿ç”¨å®‰å…¨çš„éšæœºæ•°äº§ç”Ÿæ–¹å¼ï¼Œå¦‚ï¼š /dev/randomæ–‡ä»¶ã€‚ å…¸å‹çš„å®‰å…¨ç”¨é€”åœºæ™¯åŒ…æ‹¬(ä½†ä¸é™äº)ä»¥ä¸‹å‡ ç§ï¼š ä¼šè¯æ ‡è¯†SessionIDçš„ç”Ÿæˆï¼› æŒ‘æˆ˜ç®—æ³•ä¸­çš„éšæœºæ•°ç”Ÿæˆï¼› éªŒè¯ç çš„éšæœºæ•°ç”Ÿæˆï¼› ç”¨äºå¯†ç ç®—æ³•ç”¨é€”ï¼ˆä¾‹å¦‚ç”¨äºç”ŸæˆIVã€ç›å€¼ã€å¯†é’¥ç­‰ï¼‰çš„éšæœºæ•°ç”Ÿæˆã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ ç¨‹åºå‘˜æœŸæœ›ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ä¸å¯è¢«çŒœæµ‹çš„HTTPä¼šè¯IDï¼Œä½†è¯¥IDæ˜¯é€šè¿‡è°ƒç”¨rand()å‡½æ•°äº§ç”Ÿçš„æ•°å­—éšæœºæ•°ï¼Œå®ƒçš„IDæ˜¯å¯çŒœæµ‹çš„ï¼Œå¹¶ä¸”éšæœºæ€§æœ‰é™ã€‚ ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘(POSIX) å¯ä»¥ä½¿ç”¨/dev/randomæ–‡ä»¶å¾—åˆ°éšæœºæ•°ã€‚ ã€å½±å“ã€‘ ä½¿ç”¨rand()å‡½æ•°å¯èƒ½é€ æˆå¯é¢„æµ‹çš„éšæœºæ•°ã€‚ å†…æ ¸æ“ä½œ ","date":"0001-01-01","objectID":"/securecoding/:27:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"å†…æ ¸mmapæ¥å£å®ç°ä¸­ï¼Œç¡®ä¿å¯¹æ˜ å°„èµ·å§‹åœ°å€å’Œå¤§å°è¿›è¡Œåˆæ³•æ€§æ ¡éªŒ ã€æè¿°ã€‘ **è¯´æ˜ï¼š**Linuxå†…æ ¸ mmapæ¥å£ä¸­ï¼Œç»å¸¸ä½¿ç”¨remap_pfn_range()å‡½æ•°å°†è®¾å¤‡ç‰©ç†å†…å­˜æ˜ å°„åˆ°ç”¨æˆ·è¿›ç¨‹ç©ºé—´ã€‚å¦‚æœæ˜ å°„èµ·å§‹åœ°å€ç­‰å‚æ•°ç”±ç”¨æˆ·æ€æ§åˆ¶å¹¶ç¼ºå°‘åˆæ³•æ€§æ ¡éªŒï¼Œå°†å¯¼è‡´ç”¨æˆ·æ€å¯é€šè¿‡æ˜ å°„è¯»å†™ä»»æ„å†…æ ¸åœ°å€ã€‚å¦‚æœæ”»å‡»è€…ç²¾å¿ƒæ„é€ ä¼ å…¥å‚æ•°ï¼Œç”šè‡³å¯åœ¨å†…æ ¸ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å¦‚ä¸‹ä»£ç åœ¨ä½¿ç”¨remap_pfn_range()è¿›è¡Œå†…å­˜æ˜ å°„æ—¶ï¼Œæœªå¯¹ç”¨æˆ·å¯æ§çš„æ˜ å°„èµ·å§‹åœ°å€å’Œç©ºé—´å¤§å°è¿›è¡Œåˆæ³•æ€§æ ¡éªŒï¼Œå¯å¯¼è‡´å†…æ ¸å´©æºƒæˆ–ä»»æ„ä»£ç æ‰§è¡Œã€‚ static int incorrect_mmap(struct file *file, struct vm_area_struct *vma) { unsigned long size; size = vma-\u003evm_end - vma-\u003evm_start; vma-\u003evm_page_prot = pgprot_noncached(vma-\u003evm_page_prot); //é”™è¯¯ï¼šæœªå¯¹æ˜ å°„èµ·å§‹åœ°å€ã€ç©ºé—´å¤§å°åšåˆæ³•æ€§æ ¡éªŒ if (remap_pfn_range(vma, vma-\u003evm_start, vma-\u003evm_pgoff, size, vma-\u003evm_page_prot)) { err_log(\"%s, remap_pfn_range fail\", __func__); return EFAULT; } else { vma-\u003evm_flags \u0026= ~VM_IO; } return EOK; } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ å¢åŠ å¯¹æ˜ å°„èµ·å§‹åœ°å€ç­‰å‚æ•°çš„åˆæ³•æ€§æ ¡éªŒã€‚ static int correct_mmap(struct file *file, struct vm_area_struct *vma) { unsigned long size; size = vma-\u003evm_end - vma-\u003evm_start; //ä¿®æ”¹ï¼šæ·»åŠ æ ¡éªŒå‡½æ•°ï¼ŒéªŒè¯æ˜ å°„èµ·å§‹åœ°å€ã€ç©ºé—´å¤§å°æ˜¯å¦åˆæ³• if (!valid_mmap_phys_addr_range(vma-\u003evm_pgoff, size)) { return EINVAL; } vma-\u003evm_page_prot = pgprot_noncached(vma-\u003evm_page_prot); if (remap_pfn_range(vma, vma-\u003evm_start, vma-\u003evm_pgoff, size, vma-\u003evm_page_prot)) { err_log( \"%s, remap_pfn_range fail \", __func__); return EFAULT; } else { vma-\u003evm_flags \u0026= ~VM_IO; } return EOK; } ","date":"0001-01-01","objectID":"/securecoding/:28:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"å†…æ ¸ç¨‹åºä¸­å¿…é¡»ä½¿ç”¨å†…æ ¸ä¸“ç”¨å‡½æ•°è¯»å†™ç”¨æˆ·æ€ç¼“å†²åŒº ã€æè¿°ã€‘ ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´è¿›è¡Œæ•°æ®äº¤æ¢æ—¶ï¼Œå¦‚æœåœ¨å†…æ ¸ä¸­ä¸åŠ ä»»ä½•æ ¡éªŒï¼ˆå¦‚æ ¡éªŒåœ°å€èŒƒå›´ã€ç©ºæŒ‡é’ˆï¼‰è€Œç›´æ¥å¼•ç”¨ç”¨æˆ·æ€ä¼ å…¥æŒ‡é’ˆï¼Œå½“ç”¨æˆ·æ€ä¼ å…¥éæ³•æŒ‡é’ˆæ—¶ï¼Œå¯å¯¼è‡´å†…æ ¸å´©æºƒã€ä»»æ„åœ°å€è¯»å†™ç­‰é—®é¢˜ã€‚å› æ­¤ï¼Œåº”å½“ç¦æ­¢ä½¿ç”¨memcpy()ã€sprintf()ç­‰å±é™©å‡½æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨å†…æ ¸æä¾›çš„ä¸“ç”¨å‡½æ•°ï¼šcopy_from_user()ã€copy_to_user()ã€put_user()å’Œget_user()æ¥è¯»å†™ç”¨æˆ·æ€ç¼“å†²åŒºï¼Œè¿™äº›å‡½æ•°å†…éƒ¨æ·»åŠ äº†å…¥å‚æ ¡éªŒåŠŸèƒ½ã€‚ æ‰€æœ‰ç¦ç”¨å‡½æ•°åˆ—è¡¨ä¸ºï¼šmemcpy()ã€bcopy()ã€memmove()ã€strcpy()ã€strncpy()ã€strcat()ã€strncat()ã€sprintf()ã€vsprintf()ã€snprintf()ã€vsnprintf()ã€sscanf()ã€vsscanf()ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å†…æ ¸æ€ç›´æ¥ä½¿ç”¨ç”¨æˆ·æ€ä¼ å…¥çš„bufæŒ‡é’ˆä½œä¸ºsnprintf()çš„å‚æ•°ï¼Œå½“bufä¸ºNULLæ—¶ï¼Œå¯å¯¼è‡´å†…æ ¸å´©æºƒã€‚ ssize_t incorrect_show(struct file *file, char__user *buf, size_t size, loff_t *data) { // é”™è¯¯ï¼šç›´æ¥å¼•ç”¨ç”¨æˆ·æ€ä¼ å…¥æŒ‡é’ˆï¼Œå¦‚æœbufä¸ºNULLï¼Œåˆ™ç©ºæŒ‡é’ˆå¼‚å¸¸å¯¼è‡´å†…æ ¸å´©æºƒ return snprintf(buf, size, \"%ld\\n\", debug_level); } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ ä½¿ç”¨copy_to_user()å‡½æ•°ä»£æ›¿snprintf()ã€‚ ssize_t correct_show(struct file *file, char __user *buf, size_t size, loff_t *data) { int ret = 0; char level_str[MAX_STR_LEN] = {0}; snprintf(level_str, MAX_STR_LEN, \"%ld \\n\", debug_level); if(strlen(level_str) \u003e= size) { return EFAULT; } // ä¿®æ”¹ï¼šä½¿ç”¨ä¸“ç”¨å‡½æ•°copy_to_user()å°†æ•°æ®å†™å…¥åˆ°ç”¨æˆ·æ€bufï¼Œå¹¶æ³¨æ„é˜²æ­¢ç¼“å†²åŒºæº¢å‡º ret = copy_to_user(buf, level_str, strlen(level_str)+1); return ret; } ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ å†…æ ¸æ€ç›´æ¥ä½¿ç”¨ç”¨æˆ·æ€ä¼ å…¥çš„æŒ‡é’ˆuser_bufä½œä¸ºæ•°æ®æºè¿›è¡Œmemcpy()æ“ä½œï¼Œå½“user_bufä¸ºNULLæ—¶ï¼Œå¯å¯¼è‡´å†…æ ¸å´©æºƒã€‚ size_t incorrect_write(struct file *file, const char __user *user_buf, size_t count, loff_t *ppos) { ... char buf [128] = {0}; int buf_size = 0; buf_size = min(count, (sizeof(buf)-1)); // é”™è¯¯ï¼šç›´æ¥å¼•ç”¨ç”¨æˆ·æ€ä¼ å…¥æŒ‡é’ˆï¼Œå¦‚æœuser_bufä¸ºNULLï¼Œåˆ™å¯å¯¼è‡´å†…æ ¸å´©æºƒ (void)memcpy(buf, user_buf, buf_size); ... } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ ä½¿ç”¨copy_from_user()å‡½æ•°ä»£æ›¿memcpy()ã€‚ ssize_t correct_write(struct file *file, const char __user *user_buf, size_t count, loff_t *ppos) { ... char buf[128] = {0}; int buf_size = 0; buf_size = min(count, (sizeof(buf)-1)); // ä¿®æ”¹ï¼šä½¿ç”¨ä¸“ç”¨å‡½æ•°copy_from_user()å°†æ•°æ®å†™å…¥åˆ°å†…æ ¸æ€bufï¼Œå¹¶æ³¨æ„é˜²æ­¢ç¼“å†²åŒºæº¢å‡º if (copy_from_user(buf, user_buf, buf_size)) { return EFAULT; } ... } ","date":"0001-01-01","objectID":"/securecoding/:29:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"å¿…é¡»å¯¹copy_from_user()æ‹·è´é•¿åº¦è¿›è¡Œæ ¡éªŒï¼Œé˜²æ­¢ç¼“å†²åŒºæº¢å‡º **è¯´æ˜ï¼š**å†…æ ¸æ€ä»ç”¨æˆ·æ€æ‹·è´æ•°æ®æ—¶é€šå¸¸ä½¿ç”¨copy_from_user()å‡½æ•°ï¼Œå¦‚æœæœªå¯¹æ‹·è´é•¿åº¦åšæ ¡éªŒæˆ–è€…æ ¡éªŒä¸å½“ï¼Œä¼šé€ æˆå†…æ ¸ç¼“å†²åŒºæº¢å‡ºï¼Œå¯¼è‡´å†…æ ¸panicæˆ–ææƒã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ æœªæ ¡éªŒæ‹·è´é•¿åº¦ã€‚ static long gser_ioctl(struct file *fp, unsigned cmd, unsigned long arg) { char smd_write_buf[GSERIAL_BUF_LEN]; switch (cmd) { case GSERIAL_SMD_WRITE: if (copy_from_user(\u0026smd_write_arg, argp, sizeof(smd_write_arg))) {...} // é”™è¯¯ï¼šæ‹·è´é•¿åº¦å‚æ•°smd_write_arg.sizeç”±ç”¨æˆ·è¾“å…¥ï¼Œæœªæ ¡éªŒ copy_from_user(smd_write_buf, smd_write_arg.buf, smd_write_arg.size); ... } } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ æ·»åŠ é•¿åº¦æ ¡éªŒã€‚ static long gser_ioctl(struct file *fp, unsigned cmd, unsigned long arg) { char smd_write_buf[GSERIAL_BUF_LEN]; switch (cmd) { case GSERIAL_SMD_WRITE: if (copy_from_user(\u0026smd_write_arg, argp, sizeof(smd_write_arg))){...} // ä¿®æ”¹ï¼šæ·»åŠ æ ¡éªŒ if (smd_write_arg.size \u003e= GSERIAL_BUF_LEN) {......} copy_from_user(smd_write_buf, smd_write_arg.buf, smd_write_arg.size); ... } } ","date":"0001-01-01","objectID":"/securecoding/:30:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"å¿…é¡»å¯¹copy_to_user()æ‹·è´çš„æ•°æ®è¿›è¡Œåˆå§‹åŒ–ï¼Œé˜²æ­¢ä¿¡æ¯æ³„æ¼ ã€æè¿°ã€‘ **è¯´æ˜ï¼š**å†…æ ¸æ€ä½¿ç”¨copy_to_user()å‘ç”¨æˆ·æ€æ‹·è´æ•°æ®æ—¶ï¼Œå½“æ•°æ®æœªå®Œå…¨åˆå§‹åŒ–ï¼ˆå¦‚ç»“æ„ä½“æˆå‘˜æœªèµ‹å€¼ã€å­—èŠ‚å¯¹é½å¼•èµ·çš„å†…å­˜ç©ºæ´ç­‰ï¼‰ï¼Œä¼šå¯¼è‡´æ ˆä¸ŠæŒ‡é’ˆç­‰æ•æ„Ÿä¿¡æ¯æ³„æ¼ã€‚æ”»å‡»è€…å¯åˆ©ç”¨ç»•è¿‡kaslrç­‰å®‰å…¨æœºåˆ¶ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ æœªå®Œå…¨åˆå§‹åŒ–æ•°æ®ç»“æ„æˆå‘˜ã€‚ static long rmnet_ctrl_ioctl(struct file *fp, unsigned cmd, unsigned long arg) { struct ep_info info; switch (cmd) { case FRMNET_CTRL_EP_LOOKUP: info.ph_ep_info.ep_type = DATA_EP_TYPE_HSUSB; info.ipa_ep_pair.cons_pipe_num = port-\u003eipa_cons_idx; info.ipa_ep_pair.prod_pipe_num = port-\u003eipa_prod_idx; // é”™è¯¯: infoç»“æ„ä½“æœ‰4ä¸ªæˆå‘˜ï¼Œæœªå…¨éƒ¨èµ‹å€¼ ret = copy_to_user((void __user *)arg, \u0026info, sizeof(info)); ... } } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ å…¨éƒ¨è¿›è¡Œåˆå§‹åŒ–ã€‚ static long rmnet_ctrl_ioctl(struct file *fp, unsigned cmd, unsigned long arg) { struct ep_info info; // ä¿®æ”¹ï¼šä½¿ç”¨memsetåˆå§‹åŒ–ç¼“å†²åŒºï¼Œä¿è¯ä¸å­˜åœ¨å› å­—èŠ‚å¯¹é½æˆ–æœªèµ‹å€¼å¯¼è‡´çš„å†…å­˜ç©ºæ´ (void)memset(\u0026info, '0', sizeof(ep_info)); switch (cmd) { case FRMNET_CTRL_EP_LOOKUP: info.ph_ep_info.ep_type = DATA_EP_TYPE_HSUSB; info.ipa_ep_pair.cons_pipe_num = port-\u003eipa_cons_idx; info.ipa_ep_pair.prod_pipe_num = port-\u003eipa_prod_idx; ret = copy_to_user((void __user *)arg, \u0026info, sizeof(info)); ... } } ","date":"0001-01-01","objectID":"/securecoding/:31:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ç¦æ­¢åœ¨å¼‚å¸¸å¤„ç†ä¸­ä½¿ç”¨BUG_ONå®ï¼Œé¿å…é€ æˆå†…æ ¸panic ã€æè¿°ã€‘ BUG_ONå®ä¼šè°ƒç”¨å†…æ ¸çš„panic()å‡½æ•°ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯å¹¶ä¸»åŠ¨å´©æºƒç³»ç»Ÿï¼Œåœ¨æ­£å¸¸é€»è¾‘å¤„ç†ä¸­ï¼ˆå¦‚ioctlæ¥å£çš„cmdå‚æ•°ä¸è¯†åˆ«ï¼‰ä¸åº”å½“ä½¿ç³»ç»Ÿå´©æºƒï¼Œç¦æ­¢åœ¨æ­¤ç±»å¼‚å¸¸å¤„ç†åœºæ™¯ä¸­ä½¿ç”¨BUG_ONå®ï¼Œæ¨èä½¿ç”¨WARN_ONå®ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ æ­£å¸¸æµç¨‹ä¸­ä½¿ç”¨äº†BUG_ONå® / * åˆ¤æ–­Q6ä¾§è®¾ç½®å®šæ—¶å™¨æ˜¯å¦ç¹å¿™ï¼Œ1-å¿™ï¼Œ0-ä¸å¿™ */ static unsigned int is_modem_set_timer_busy(special_timer *smem_ptr) { int i = 0; if (smem_ptr == NULL) { printk(KERN_EMERG\"%s:smem_ptr NULL!\\n\", __FUNCTION__); // é”™è¯¯ï¼šç³»ç»ŸBUG_ONå®æ‰“å°è°ƒç”¨æ ˆåè°ƒç”¨panic()ï¼Œå¯¼è‡´å†…æ ¸æ‹’ç»æœåŠ¡ï¼Œä¸åº”åœ¨æ­£å¸¸æµç¨‹ä¸­ä½¿ç”¨ BUG_ON(1); return 1; } ... } ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ å»æ‰BUG_ONå®ã€‚ / * åˆ¤æ–­Q6ä¾§è®¾ç½®å®šæ—¶å™¨æ˜¯å¦ç¹å¿™ï¼Œ1-å¿™ï¼Œ0-ä¸å¿™ */ static unsigned int is_modem_set_timer_busy(special_timer *smem_ptr) { int i = 0; if (smem_ptr == NULL) { printk(KERN_EMERG\"%s:smem_ptr NULL!\\n\", __FUNCTION__); // ä¿®æ”¹ï¼šå»æ‰BUG_ONè°ƒç”¨ï¼Œæˆ–ä½¿ç”¨WARN_ON return 1; } ... } ","date":"0001-01-01","objectID":"/securecoding/:32:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"åœ¨ä¸­æ–­å¤„ç†ç¨‹åºæˆ–æŒæœ‰è‡ªæ—‹é”çš„è¿›ç¨‹ä¸Šä¸‹æ–‡ä»£ç ä¸­ï¼Œç¦æ­¢ä½¿ç”¨ä¼šå¼•èµ·è¿›ç¨‹ä¼‘çœ çš„å‡½æ•° ã€æè¿°ã€‘ Linuxä»¥è¿›ç¨‹ä¸ºè°ƒåº¦å•ä½ï¼Œåœ¨Linuxä¸­æ–­ä¸Šä¸‹æ–‡ä¸­ï¼Œåªæœ‰æ›´é«˜ä¼˜å…ˆçº§çš„ä¸­æ–­æ‰èƒ½å°†å…¶æ‰“æ–­ï¼Œç³»ç»Ÿåœ¨ä¸­æ–­å¤„ç†çš„æ—¶å€™ä¸èƒ½è¿›è¡Œè¿›ç¨‹è°ƒåº¦ã€‚å¦‚æœä¸­æ–­å¤„ç†ç¨‹åºå¤„äºä¼‘çœ çŠ¶æ€ï¼Œå°±ä¼šå¯¼è‡´å†…æ ¸æ— æ³•å”¤é†’ï¼Œä»è€Œä½¿å¾—å†…æ ¸å¤„äºç˜«ç—ªã€‚ è‡ªæ—‹é”åœ¨ä½¿ç”¨æ—¶ï¼ŒæŠ¢å æ˜¯å¤±æ•ˆçš„ã€‚è‹¥è‡ªæ—‹é”åœ¨é”ä½ä»¥åè¿›å…¥ç¡çœ ï¼Œç”±äºä¸èƒ½è¿›è¡Œå¤„ç†å™¨æŠ¢å ï¼Œå…¶å®ƒè¿›ç¨‹éƒ½å°†å› ä¸ºä¸èƒ½è·å¾—CPUï¼ˆå•æ ¸CPUï¼‰è€Œåœæ­¢è¿è¡Œï¼Œå¯¹å¤–è¡¨ç°ä¸ºç³»ç»Ÿå°†ä¸ä½œä»»ä½•å“åº”ï¼Œå‡ºç°æŒ‚æ­»ã€‚ å› æ­¤ï¼Œåœ¨ä¸­æ–­å¤„ç†ç¨‹åºæˆ–æŒæœ‰è‡ªæ—‹é”çš„è¿›ç¨‹ä¸Šä¸‹æ–‡ä»£ç ä¸­ï¼Œåº”è¯¥ç¦æ­¢ä½¿ç”¨å¯èƒ½ä¼šå¼•èµ·ä¼‘çœ ï¼ˆå¦‚vmalloc()ã€msleep()ç­‰ï¼‰ã€é˜»å¡ï¼ˆå¦‚copy_from_user(),copy_to_user()ç­‰ï¼‰æˆ–è€…è€—è´¹å¤§é‡æ—¶é—´ï¼ˆå¦‚printk()ç­‰ï¼‰çš„å‡½æ•°ã€‚ ","date":"0001-01-01","objectID":"/securecoding/:33:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"åˆç†ä½¿ç”¨å†…æ ¸æ ˆï¼Œé˜²æ­¢å†…æ ¸æ ˆæº¢å‡º ã€æè¿°ã€‘ Linuxçš„å†…æ ¸æ ˆå¤§å°æ˜¯å›ºå®šçš„ï¼ˆä¸€èˆ¬32ä½ç³»ç»Ÿä¸º8Kï¼Œ64ä½ç³»ç»Ÿä¸º16Kï¼Œå› æ­¤èµ„æºéå¸¸å®è´µã€‚ä¸åˆç†çš„ä½¿ç”¨å†…æ ¸æ ˆï¼Œå¯èƒ½ä¼šå¯¼è‡´æ ˆæº¢å‡ºï¼Œé€ æˆç³»ç»ŸæŒ‚æ­»ã€‚å› æ­¤éœ€è¦åšåˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š åœ¨æ ˆä¸Šç”³è¯·å†…å­˜ç©ºé—´ä¸è¦è¶…è¿‡å†…æ ¸æ ˆå¤§å°ï¼› æ³¨æ„å‡½æ•°çš„åµŒå¥—ä½¿ç”¨æ¬¡æ•°ï¼› ä¸è¦å®šä¹‰è¿‡å¤šçš„å˜é‡ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ ä»¥ä¸‹ä»£ç ä¸­å®šä¹‰çš„å˜é‡è¿‡å¤§ï¼Œå¯¼è‡´æ ˆæº¢å‡ºã€‚ ... struct result { char name[4]; unsigned int a; unsigned int b; unsigned int c; unsigned int d; }; // ç»“æ„ä½“resultçš„å¤§å°ä¸º20å­—èŠ‚ int foo() { struct result temp[512]; // é”™è¯¯: tempæ•°ç»„å«æœ‰512ä¸ªå…ƒç´ ï¼Œæ€»å¤§å°ä¸º10Kï¼Œè¿œè¶…å†…æ ¸æ ˆå¤§å° (void)memset(temp, 0, sizeof(result) * 512); ... // use temp do something return 0; } ... ä»£ç ä¸­æ•°ç»„tempæœ‰512ä¸ªå…ƒç´ ï¼Œæ€»å…±10Kå¤§å°ï¼Œè¿œè¶…å†…æ ¸çš„8Kï¼Œæ˜æ˜¾çš„æ ˆæº¢å‡ºã€‚ ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ ä½¿ç”¨kmalloc()ä»£æ›¿ä¹‹ã€‚ ... struct result { char name[4]; unsigned int a; unsigned int b; unsigned int c; unsigned int d; }; // ç»“æ„ä½“resultçš„å¤§å°ä¸º20å­—èŠ‚ int foo() { struct result *temp = NULL; temp = (result *)kmalloc(sizeof(result) * 512, GFP_KERNEL); //ä¿®æ”¹ï¼šä½¿ç”¨kmalloc()ç”³è¯·å†…å­˜ ... // check temp is not NULL (void)memset(temp, 0, sizeof(result) * 512); ... // use temp do something ... // free temp return 0; } ... ","date":"0001-01-01","objectID":"/securecoding/:34:0","tags":null,"title":"","uri":"/securecoding/"},{"categories":null,"content":"ä¸´æ—¶å…³é—­åœ°å€æ ¡éªŒæœºåˆ¶åï¼Œåœ¨æ“ä½œå®Œæˆåå¿…é¡»åŠæ—¶æ¢å¤ ã€æè¿°ã€‘ SMEPå®‰å…¨æœºåˆ¶æ˜¯æŒ‡ç¦æ­¢å†…æ ¸æ‰§è¡Œç”¨æˆ·ç©ºé—´çš„ä»£ç ï¼ˆPXNæ˜¯ARMç‰ˆæœ¬çš„SMEPï¼‰ã€‚ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚open()ï¼Œwrite()ç­‰ï¼‰æœ¬æ¥æ˜¯æä¾›ç»™ç”¨æˆ·ç©ºé—´ç¨‹åºè®¿é—®çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›å‡½æ•°ä¼šå¯¹ä¼ å…¥çš„å‚æ•°åœ°å€è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœå…¥å‚æ˜¯éç”¨æˆ·ç©ºé—´åœ°å€åˆ™æŠ¥é”™ã€‚å› æ­¤ï¼Œè¦åœ¨å†…æ ¸ç¨‹åºä¸­ä½¿ç”¨è¿™äº›ç³»ç»Ÿè°ƒç”¨ï¼Œå°±å¿…é¡»ä½¿å‚æ•°åœ°å€æ ¡éªŒåŠŸèƒ½å¤±æ•ˆã€‚set_fs()/get_fs()å°±ç”¨æ¥è§£å†³è¯¥é—®é¢˜ã€‚è¯¦ç»†è¯´æ˜è§å¦‚ä¸‹ä»£ç ï¼š ... mmegment_t old_fs; printk(\"Hello, I'm the module that intends to write message to file.\\n\"); if (file == NULL) { file = filp_open(MY_FILE, O_RDWR | O_APPEND | O_CREAT, 0664); } if (IS_ERR(file)) { printk(\"Error occured while opening file %s, exiting ...\\n\", MY_FILE); return 0; } sprintf(buf, \"%s\", \"The Message.\"); old_fs = get_fs(); // get_fs()çš„ä½œç”¨æ˜¯è·å–ç”¨æˆ·ç©ºé—´åœ°å€ä¸Šé™å€¼ // #define get_fs() (current-\u003eaddr_limit set_fs(KERNEL_DS); // set_fsçš„ä½œç”¨æ˜¯å°†åœ°å€ç©ºé—´ä¸Šé™æ‰©å¤§åˆ°KERNEL_DSï¼Œè¿™æ ·å†…æ ¸ä»£ç å¯ä»¥è°ƒç”¨ç³»ç»Ÿå‡½æ•° file-\u003ef_op-\u003ewrite(file, (char *)buf, sizeof(buf), \u0026file-\u003ef_pos); // å†…æ ¸ä»£ç å¯ä»¥è°ƒç”¨write()å‡½æ•° set_fs(old_fs); // ä½¿ç”¨å®ŒååŠæ—¶æ¢å¤åŸæ¥ç”¨æˆ·ç©ºé—´åœ°å€é™åˆ¶å€¼ ... é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œå¯ä»¥äº†è§£åˆ°æœ€ä¸ºå…³é”®çš„å°±æ˜¯æ“ä½œå®Œæˆåï¼Œè¦åŠæ—¶æ¢å¤åœ°å€æ ¡éªŒåŠŸèƒ½ã€‚å¦åˆ™SMEP/PXNå®‰å…¨æœºåˆ¶å°±ä¼šå¤±æ•ˆï¼Œä½¿å¾—è®¸å¤šæ¼æ´çš„åˆ©ç”¨å˜å¾—å¾ˆå®¹æ˜“ã€‚ ã€é”™è¯¯ä»£ç ç¤ºä¾‹ã€‘ åœ¨ç¨‹åºé”™è¯¯å¤„ç†åˆ†æ”¯ï¼Œæœªé€šè¿‡set_fs()æ¢å¤åœ°å€æ ¡éªŒåŠŸèƒ½ã€‚ ... oldfs = get_fs(); set_fs(KERNEL_DS); /* åœ¨æ—¶é—´æˆ³ç›®å½•ä¸‹é¢åˆ›å»ºdoneæ–‡ä»¶ */ fd = sys_open(path, O_CREAT | O_WRONLY, FILE_LIMIT); if (fd \u003c 0) { BB_PRINT_ERR(\"sys_mkdir[%s] error, fd is[%d]\\n\", path, fd); return; // é”™è¯¯ï¼šåœ¨é”™è¯¯å¤„ç†ç¨‹åºåˆ†æ”¯æœªæ¢å¤åœ°å€æ ¡éªŒæœºåˆ¶ } sys_close(fd); set_fs(oldfs); ... ã€æ­£ç¡®ä»£ç ç¤ºä¾‹ã€‘ åœ¨é”™è¯¯å¤„ç†ç¨‹åºä¸­æ¢å¤åœ°å€æ ¡éªŒåŠŸèƒ½ã€‚ ... oldfs = get_fs(); set_fs(KERNEL_DS); /* åœ¨æ—¶é—´æˆ³ç›®å½•ä¸‹é¢åˆ›å»ºdoneæ–‡ä»¶ */ fd = sys_open(path, O_CREAT | O_WRONLY, FILE_LIMIT); if (fd \u003c 0) { BB_PRINT_ERR(\"sys_mkdir[%s] error, fd is[%d] \\n\", path, fd); set_fs(oldfs); // ä¿®æ”¹ï¼šåœ¨é”™è¯¯å¤„ç†ç¨‹åºåˆ†æ”¯ä¸­æ¢å¤åœ°å€æ ¡éªŒæœºåˆ¶ return; } sys_close(fd); set_fs(oldfs); ... ","date":"0001-01-01","objectID":"/securecoding/:35:0","tags":null,"title":"","uri":"/securecoding/"}]